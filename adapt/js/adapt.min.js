require(["bowser","underscore","backbone","semver","react","react-dom","html-react-parser","libraries/select2","libraries/download","libraries/vimeo-player.min","libraries/youtube_iframe_api","libraries/renderToString"],(function(Bowser,_$1,Backbone$1,semver,React,ReactDOM,HTMLReactParser,Select2,download,Vimeo,Youtube,renderToString){"use strict";function _interopDefaultLegacy(e){return e&&typeof e==="object"&&"default"in e?e:{default:e}}var Bowser__default=_interopDefaultLegacy(Bowser);var ___default=_interopDefaultLegacy(_$1);var Backbone__default=_interopDefaultLegacy(Backbone$1);var semver__default=_interopDefaultLegacy(semver);var React__default=_interopDefaultLegacy(React);var ReactDOM__default=_interopDefaultLegacy(ReactDOM);var HTMLReactParser__default=_interopDefaultLegacy(HTMLReactParser);var Select2__default=_interopDefaultLegacy(Select2);var download__default=_interopDefaultLegacy(download);var Vimeo__default=_interopDefaultLegacy(Vimeo);var renderToString__default=_interopDefaultLegacy(renderToString);class Wait extends Backbone.Controller{initialize(){this._waitCount=0;this._callbackHandle=null;this.being=this.begin.bind(this);this.end=this.end.bind(this)}isWaiting(){return this._waitCount!==0}begin(){if(!this.isWaiting())this.trigger("wait");this._waitCount++;if(this._callbackHandle){clearTimeout(this._callbackHandle);this._callbackHandle=null}return this}end(){if(!this.isWaiting())return this;this._waitCount--;if(this.isWaiting()||this._callbackHandle)return this;this._callbackHandle=setTimeout(function(){this._callbackHandle=null;this.trigger("ready")}.bind(this),0);return this}queue(callback){if(!callback){this.begin();return new Promise((resolve=>{this.once("ready",resolve);this.end()}))}this.begin();this.once("ready",callback);this.end();return this}for(callback){this.begin();_.defer((()=>callback(_.once(this.end))));return this}}const wait=new Wait;var wait$1=__AMD("core/js/wait",wait);var LockingModel=__AMD("core/js/models/lockingModel",class LockingModel extends Backbone.Model{lockedAttributes(){return null}set(...args){if(typeof args[0]!=="object"){const[name,value]=args.splice(0,2);args.unshift({[name]:value})}const options=args[1]??{};const attrValues=args[0];const newValues={};for(const attrName in attrValues){const attrVal=attrValues[attrName];const willChange=this.attributes[attrName]!==attrValues[attrName];if(!willChange)continue;const isNotLocking=typeof attrVal!=="boolean"||!this.isLocking(attrName);if(isNotLocking){newValues[attrName]=attrVal;continue}const defaults=_.result(this,"defaults");const isDefault=defaults[attrName]!==undefined;const isInitialDefault=isDefault&&!this.changed;const isSettingValueForSpecificPlugin=options?.pluginName;if(!isSettingValueForSpecificPlugin){if(!isInitialDefault){console.error("Must supply a pluginName to change a locked attribute")}options.pluginName="compatibility"}const pluginName=options.pluginName;const lockingValue=this._lockedAttributes[attrName];const isAttemptingToLock=lockingValue===attrVal;if(isAttemptingToLock){if(!isInitialDefault){this.setLockState(attrName,true,{pluginName:pluginName,skipcheck:true})}newValues[attrName]=lockingValue;continue}this.setLockState(attrName,false,{pluginName:pluginName,skipcheck:true});const totalLockValue=this.getLockCount(attrName,{skipcheck:true});if(totalLockValue===0){newValues[attrName]=!lockingValue;continue}}if(!Object.keys(newValues).length)return this;super.set(newValues,options);return this}setLocking(attrName,defaultLockValue){if(this.isLocking(attrName))return;if(!this._lockedAttributes)this._lockedAttributes={};this._lockedAttributes[attrName]=defaultLockValue}unsetLocking(attrName){if(!this.isLocking(attrName))return;if(!this._lockedAttributes)return;delete this._lockedAttributes[attrName];delete this._lockedAttributesValues[attrName];if(Object.keys(this._lockedAttributes).length===0){delete this._lockedAttributes;delete this._lockedAttributesValues}}isLocking(attrName){const isCheckingGeneralLockingState=attrName===undefined;let hasDerivedLockedAttributes=Object.prototype.hasOwnProperty.call(this,"_lockedAttributes");if(!hasDerivedLockedAttributes){this._lockedAttributes=_.result(this,"lockedAttributes");hasDerivedLockedAttributes=true}const isUsingLockedAttributes=Boolean(this._lockedAttributes);if(isCheckingGeneralLockingState){return isUsingLockedAttributes}if(!isUsingLockedAttributes)return false;const isAttributeALockingAttribute=Object.prototype.hasOwnProperty.call(this._lockedAttributes,attrName);if(!isAttributeALockingAttribute)return false;if(!this._lockedAttributesValues){this._lockedAttributesValues={}}if(!this._lockedAttributesValues[attrName]){this._lockedAttributesValues[attrName]={}}return true}isLocked(attrName,options){const shouldSkipCheck=options?.skipcheck;if(!shouldSkipCheck){const stopProcessing=!this.isLocking(attrName);if(stopProcessing)return}return this.getLockCount(attrName)>0}getLockCount(attrName,options){const shouldSkipCheck=options?.skipcheck;if(!shouldSkipCheck){const stopProcessing=!this.isLocking(attrName);if(stopProcessing)return}const isGettingValueForSpecificPlugin=options?.pluginName;if(isGettingValueForSpecificPlugin){return this._lockedAttributesValues[attrName][options.pluginName]?1:0}const lockingAttributeValues=Object.values(this._lockedAttributesValues[attrName]);const lockingAttributeValuesSum=lockingAttributeValues.reduce(((sum,value)=>sum+(value?1:0)),0);return lockingAttributeValuesSum}setLockState(attrName,value,options){const shouldSkipCheck=options?.skipcheck;if(!shouldSkipCheck){const stopProcessing=!this.isLocking(attrName);if(stopProcessing)return this}const isSettingValueForSpecificPlugin=options?.pluginName;if(!isSettingValueForSpecificPlugin){console.error("Must supply a pluginName to set a locked attribute lock value");options.pluginName="compatibility"}if(value){this._lockedAttributesValues[attrName][options.pluginName]=value}else{delete this._lockedAttributesValues[attrName][options.pluginName]}return this}});class AdaptSingleton extends LockingModel{initialize(){this.loadScript=window.__loadScript}defaults(){return{_canScroll:true,_outstandingCompletionChecks:0,_pluginWaitCount:0,_isStarted:false,_shouldDestroyContentObjects:true}}lockedAttributes(){return{_canScroll:false}}async init(){this.addDirection();this.disableAnimation();this.trigger("adapt:preInitialize");await wait$1.queue();this.deferUntilCompletionChecked((async()=>{this.trigger("adapt:start");await wait$1.queue();if(!Backbone.History.started){Backbone.history.start()}this.set("_isStarted",true);this.trigger("adapt:initialize");await wait$1.queue()}))}checkingCompletion(){const outstandingChecks=this.get("_outstandingCompletionChecks");this.set("_outstandingCompletionChecks",outstandingChecks+1)}checkedCompletion(){const outstandingChecks=this.get("_outstandingCompletionChecks");this.set("_outstandingCompletionChecks",outstandingChecks-1)}async deferUntilCompletionChecked(callback=(()=>{})){if(this.get("_outstandingCompletionChecks")===0)return callback();return new Promise((resolve=>{const checkIfAnyChecksOutstanding=(model,outstandingChecks)=>{if(outstandingChecks!==0)return;this.off("change:_outstandingCompletionChecks",checkIfAnyChecksOutstanding);callback();resolve()};this.on("change:_outstandingCompletionChecks",checkIfAnyChecksOutstanding)}))}isWaitingForPlugins(){this.log.deprecated("Use wait.isWaiting() as Adapt.isWaitingForPlugins() will be removed in the future");return wait$1.isWaiting()}checkPluginsReady(){this.log.deprecated("Use wait.isWaiting() as Adapt.checkPluginsReady() will be removed in the future");if(this.isWaitingForPlugins()){return}this.trigger("plugins:ready")}parseRelativeString(relativeString){const parts=relativeString.replace(/\s*([+\-=]+\d+){1}/g,"$1").split(/[@ ]/).filter(Boolean);const parsed=parts.map((part=>{let splitIndex=part.search(/[+\-=\d]{1}/);if(splitIndex===-1)splitIndex=part.length;const symbol=part.slice(splitIndex,splitIndex+1);const type=part.slice(0,splitIndex).replace(/^@/,"");let offset=null;let inset=null;switch(symbol){case"=":inset=parseInt(part.slice(splitIndex+1).trim()||0);break;default:offset=parseInt(part.slice(splitIndex).trim()||0);break}return{type:type,offset:offset,inset:inset}}));return parsed.length===1?parsed[0]:parsed}addDirection(){const defaultDirection=this.config.get("_defaultDirection");$("html").addClass("dir-"+defaultDirection).attr("dir",defaultDirection)}disableAnimation(){const disableAnimationArray=this.config.get("_disableAnimationFor");const disableAnimation=this.config.get("_disableAnimation");if(disableAnimationArray){for(let i=0,l=disableAnimationArray.length;i<l;i++){if(!$("html").is(disableAnimationArray[i]))continue;this.config.set("_disableAnimation",true);$("html").addClass("disable-animation");console.log("Animation disabled.")}return}$("html").toggleClass("disable-animation",disableAnimation===true)}async remove(){const currentView=this.parentView;if(currentView){currentView.model.setOnChildren({_isReady:false,_isRendered:false})}this.trigger("preRemove",currentView);await wait$1.queue();if(currentView&&this.get("_shouldDestroyContentObjects")){currentView.destroy()}this.trigger("remove",currentView);_.defer(this.trigger.bind(this),"postRemove",currentView)}get a11y(){}get componentStore(){}get data(){}get device(){}get drawer(){}get location(){}get notify(){}get offlineStorage(){}get router(){}get scrolling(){}get startController(){}get store(){}get tracking(){}get wait(){}async navigateToElement(){}async scrollTo(){}register(name,object){}getViewName(){}getViewClass(){}getModelName(){}getModelClass(){}findById(){}findViewByModelId(){}findByTrackingPosition(){}}const Adapt=new AdaptSingleton;var Adapt$1=__AMD("core/js/adapt",Adapt);class OfflineStorage extends Backbone.Controller{initialize(handler){this.ready=true;this._handler=undefined;if(!handler){return}this.ready=false;this._handler=handler}hasHandler(){return this._handler!==undefined}save(){Adapt$1.trigger("tracking:save");return this._handler?.save?.(...arguments)}serialize(value){if(this._handler?.serialize){return this._handler.serialize(...arguments)}return JSON.stringify(value)}deserialize(value){if(this._handler?.deserialize){return this._handler.deserialize(...arguments)}return JSON.parse(value)}set(name,value){this.trigger("offlineStorage:set",name,value);if(this._handler?.set){return this._handler.set(...arguments)}this[name]=value}get(name){if(this._handler?.get){return this._handler.get(...arguments)}return this[name]}clear(){if(this._handler?.clear){return this._handler.clear(...arguments)}return false}setReadyStatus(){this.ready=true;Adapt$1.trigger("offlineStorage:ready")}}const offlineStorage=new OfflineStorage;var offlineStorage$1=__AMD("core/js/offlineStorage",offlineStorage);class Device extends Backbone.Controller{initialize(){___default["default"].bindAll(this,"onWindowResize","calculateResize");this.bowser=Bowser__default["default"].parse(window.navigator.userAgent);this.$html=$("html");this.$window=$(window);this.touch=Modernizr.touchevents;this.screenWidth=this.getScreenWidth();this.screenHeight=this.getScreenHeight();this.setViewportHeight();this.browser=(this.bowser.browser.name||"").toLowerCase();this.version=(this.bowser.browser.version||"").toLowerCase();this.OS=this.getOperatingSystem().toLowerCase();this.osVersion=this.bowser.os.version||"";this.renderingEngine=this.getRenderingEngine();this.listenTo(Adapt$1,{"configModel:dataLoaded":this.onConfigDataLoaded,"navigationView:postRender":this.setNavigationHeight});const browser=this.browser.toLowerCase();let browserString=browser.replace(/msie|internet explorer/,"ie");browserString+=` version-${this.version} OS-${this.OS} ${this.getAppleDeviceType()}`;browserString+=browserString.replace(".","-").toLowerCase();browserString+=` ${browserString.replace(/\./g,"-").toLowerCase()}`;browserString+=` pixel-density-${this.pixelDensity()}`;this.$html.addClass(browserString)}get orientation(){return this.screenWidth>=this.screenHeight?"landscape":"portrait"}get aspectRatio(){return this.screenWidth/this.screenHeight}onConfigDataLoaded(){this.screenSize=this.checkScreenSize();this.$html.addClass("size-"+this.screenSize);if(this.orientation){this.$html.addClass("orientation-"+this.orientation)}this.$window.on("resize orientationchange",this.onWindowResize)}get screenSizes(){const screenSizes={...Adapt$1.config.get("screenSize")};const screenSizesList=Object.entries(screenSizes);const screensizeEmThreshold=300;const baseFontSize=16;for(const[name,value]of screenSizesList){screenSizes[name]=value>screensizeEmThreshold?value/baseFontSize:value}return screenSizes}isScreenSizeMin(name){return Boolean(window.matchMedia(`(min-width: ${this.screenSizes[name]}em)`)?.matches)}checkScreenSize(){const screenSizesList=Object.entries(this.screenSizes);screenSizesList.sort(((a,b)=>a[1]-b[1]));const fontSize=parseFloat($("html").css("font-size"));const screenSizeEmWidth=window.innerWidth/fontSize;const smallestScreenSize=screenSizesList[0][0];const screenSize=screenSizesList.reduce(((screenSize,[name,value])=>{if(screenSizeEmWidth>=value)return name;return screenSize}),smallestScreenSize);return screenSize}getScreenWidth(){return this.isAppleDevice()?this.getAppleScreenWidth():window.innerWidth||this.$window.width()}getScreenHeight(){return this.isAppleDevice()?this.getAppleScreenHeight():window.innerHeight||this.$window.height()}setViewportHeight(){document.documentElement.style.setProperty("--adapt-viewport-height",`${window.innerHeight}px`)}setNavigationHeight(){document.documentElement.style.setProperty("--adapt-navigation-height",`${$(".nav").height()}px`)}getOperatingSystem(){let os=this.bowser.os.name.toLowerCase()||"";if(os===""){const platform=navigator.platform.toLowerCase();const match=platform.match(/win|mac|linux/);if(match)os=match[0];if(os==="win")os="windows";if(!os)os=""}if(!os)os="platformunknown";return os}getRenderingEngine(){return this.bowser.engine.name||""}onWindowResize(){if(this.hasWindowResized)return;requestAnimationFrame(this.calculateResize);this.hasWindowResized=true}calculateResize(){this.hasWindowResized=false;const previousWidth=this.screenWidth;const previousHeight=this.screenHeight;this.screenWidth=this.getScreenWidth();this.screenHeight=this.getScreenHeight();this.setViewportHeight();this.setNavigationHeight();if(previousWidth===this.screenWidth&&previousHeight===this.screenHeight){return}if(this.orientation){this.$html.toggleClass("orientation-landscape",this.orientation==="landscape");this.$html.toggleClass("orientation-portrait",this.orientation==="portrait")}const newScreenSize=this.checkScreenSize();if(newScreenSize!==this.screenSize){this.screenSize=newScreenSize;const screenSizes=this.screenSizes;for(const name in screenSizes){if(name===this.screenSize)continue;this.$html.removeClass(`size-${name}`)}this.$html.toggleClass(`size-${this.screenSize}`,true);Adapt$1.trigger("device:changed",this.screenSize)}Adapt$1.trigger("device:preResize device:resize device:postResize",this.screenWidth)}isAppleDevice(){return/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream||navigator.userAgent.match(/Mac/)&&navigator?.maxTouchPoints>2}get shouldReportInvertedAppleScreenSize(){const windowRatio=window.innerWidth/window.innerHeight;const screenRatio=window.screen.width/window.screen.height;const isWindowPortrait=windowRatio<1;const isScreenPortrait=screenRatio<1;const isDeviceBadlyReportingScreenOrientation=isWindowPortrait!==isScreenPortrait;return isDeviceBadlyReportingScreenOrientation}getAppleScreenWidth(){return this.shouldReportInvertedAppleScreenSize?window.screen.height:window.screen.width}getAppleScreenHeight(){return this.shouldReportInvertedAppleScreenSize?window.screen.width:window.screen.height}getAppleDeviceType(){const platformType=this.bowser.platform.type?.toLowerCase()||"";const browserName=this.bowser.browser.name?.toLowerCase()||"";const isIPhone=platformType==="mobile"&&browserName==="safari";const isIPad=platformType==="tablet"&&browserName==="safari";if(isIPhone)return"iphone";if(isIPad)return"ipad";return""}pixelDensity(){const pixelDensity=window.devicePixelRatio||1;if(pixelDensity>=3){return"ultra-high"}else if(pixelDensity>=2){return"high"}else if(pixelDensity>=1.5){return"medium"}else{return"low"}}}const device=new Device;var device$1=__AMD("core/js/device",device);class Location extends Backbone__default["default"].Controller{initialize(){this._previousId=null;this._previousContentType=null;this._previousModel=null;this._previousClasses=null;this._lastVisitedType=null;this._lastVisitedMenu=null;this._lastVisitedPage=null;this._currentId=null;this._currentModel=null;this._currentLocation=null;this._contentType=null}}const location=new Location;var location$1=__AMD("core/js/location",location);var AriaDisabled=__AMD("core/js/a11y/ariaDisabled",class BrowserFocus extends Backbone.Controller{initialize({a11y:a11y}){this.a11y=a11y;this._onKeyDown=this._onKeyDown.bind(this);this._onClick=this._onClick.bind(this);this.$body=$("body");this.listenTo(Adapt$1,{"accessibility:ready":this._attachEventListeners})}_attachEventListeners(){this.$body[0].addEventListener("keydown",this._onKeyDown,true);this.$body[0].addEventListener("click",this._onClick,true)}isAriaDisabled($element){const $closestFor=$element.closest("[for]");const isAriaDisabled=$element.closest("[aria-disabled=true]").length===1||$closestFor.length&&$(`#${$closestFor.attr("for")}`).is("[aria-disabled=true]");return isAriaDisabled}_onClick(event){if(!event.isTrusted)return;const $element=$(event.target);if(!this.isAriaDisabled($element))return;event.preventDefault();event.stopImmediatePropagation()}_onKeyDown(event){if(!event.isTrusted)return;if(!["Enter"," "].includes(event.key))return;const $element=$(event.target);if(!this.isAriaDisabled($element))return;event.preventDefault();event.stopImmediatePropagation()}});var BrowserConfig=__AMD("core/js/a11y/browserConfig",class BrowserConfig extends Backbone.Controller{initialize({a11y:a11y}){this.a11y=a11y;this.listenTo(Adapt$1,{"accessibility:ready":this._onReady})}_onReady(){if(this.a11y.config._options._isPrefersReducedMotionEnabled)this._enablePrefersReducedMotion()}_enablePrefersReducedMotion(){if(!window.matchMedia)return;const isEnabledInBrowser=window.matchMedia("(prefers-reduced-motion: reduce");$("html").toggleClass("is-prefers-reduced-motion",Boolean(isEnabledInBrowser?.matches))}});var BrowserFocus=__AMD("core/js/a11y/browserFocus",class BrowserFocus extends Backbone.Controller{initialize({a11y:a11y}){this.a11y=a11y;this._onBlur=this._onBlur.bind(this);this._onClick=this._onClick.bind(this);this.$body=$("body");this.listenTo(Adapt$1,{"accessibility:ready":this._attachEventListeners})}_attachEventListeners(){this.$body.on("blur","*",this._onBlur).on("blur",this._onBlur);this.$body[0].addEventListener("click",this._onClick,true)}_onBlur(event){const config=this.a11y.config;if(!config._isEnabled||!config._options._isFocusNextOnDisabled){return}const $element=$(event.target);if($element.is("[data-a11y-force-focus]")){$element.removeAttr("tabindex data-a11y-force-focus")}if(event.target!==event.currentTarget){return}const isNotBodyHTMLOrLostFocus=!$(event.relatedTarget).is("body, html")&&event.relatedTarget!==null;if(isNotBodyHTMLOrLostFocus){return}const isNotDisabledHiddenOrDetached=!$element.is("[disabled]")&&$element.css("display")!=="none"&&$element.css("visibility")!=="hidden"&&$element.parents("html").length;if(isNotDisabledHiddenOrDetached){this._refocusCurrentActiveElement();return}this.a11y.focusNext($element)}_refocusCurrentActiveElement(){const element=this.a11y.currentActiveElement;if(!element)return;this.a11y.focus(element,{preventScroll:true})}_onClick(event){if(!event.isTrusted)return;const config=this.a11y.config;if(!config._isEnabled||!config._options._isFocusOnClickEnabled){return}const $element=$(event.target);const $stack=$([...$element.toArray(),...$element.parents().toArray()]);const $focusable=$stack.filter(config._options._tabbableElements);if(!$focusable.length){this._refocusCurrentActiveElement();return}const $closestFocusable=$element.closest(config._options._tabbableElements);if($closestFocusable[0]!==document.activeElement){this.a11y._isForcedFocus=true;$closestFocusable[0].focus();this.a11y._isForcedFocus=false}if(!config._options._isClickDelayedAfterFocusEnabled)return;const element=$element[0];event.preventDefault();event.stopImmediatePropagation();setTimeout((()=>{element.focus();element.click()}),50)}});var FocusOptions=__AMD("core/js/a11y/focusOptions",class FocusOptions{constructor({preventScroll:preventScroll=false,defer:defer=false}={}){this.preventScroll=preventScroll;this.defer=defer}});var KeyboardFocusOutline=__AMD("core/js/a11y/keyboardFocusOutline",class KeyboardFocusOutline extends Backbone.Controller{initialize({a11y:a11y}){this.a11y=a11y;this._onKeyDown=this._onKeyDown.bind(this);this.$html=$("html");this.showOnKeys={9:true,13:true,32:true,37:true,38:true,39:true,40:true};this.listenTo(Adapt$1,{"accessibility:ready":this._attachEventListeners})}_attachEventListeners(){document.addEventListener("keydown",this._onKeyDown);this._start()}_start(){const config=this.a11y.config;if(config._options._isFocusOutlineDisabled){this.$html.addClass("a11y-disable-focusoutline");return}if(!config._isEnabled||!config._options._isFocusOutlineKeyboardOnlyEnabled){return}this.$html.addClass("a11y-disable-focusoutline")}_onKeyDown(event){const config=this.a11y.config;if(config._options._isFocusOutlineDisabled){this.$html.addClass("a11y-disable-focusoutline");return}if(!config._isEnabled||!config._options._isFocusOutlineKeyboardOnlyEnabled||!this.showOnKeys[event.keyCode]){return}const $element=$(event.target);if(!$element.is(config._options._tabbableElements)||$element.is(config._options._focusOutlineKeyboardOnlyIgnore)){return}this.$html.removeClass("a11y-disable-focusoutline")}});const LOG_LEVEL=ENUM(["DEBUG","INFO","WARN","ERROR","FATAL"]);var LOG_LEVEL$1=__AMD("core/js/enums/logLevelEnum",LOG_LEVEL);class Logging extends Backbone.Controller{initialize(){this._config={_isEnabled:true,_level:LOG_LEVEL$1.INFO.asLowerCase,_console:true,_warnFirstOnly:true};this._warned={};this.listenToOnce(Adapt$1,"configModel:dataLoaded",this.onLoadConfigData)}onLoadConfigData(){this.loadConfig();this.debug("Logging config loaded");this.trigger("log:ready")}loadConfig(){if(Adapt$1.config.has("_logging")){this._config=Adapt$1.config.get("_logging")}this.checkQueryStringOverride()}checkQueryStringOverride(){const matches=window.location.search.match(/[?&]loglevel=([a-z]*)/i);if(!matches||matches.length<2)return;const override=LOG_LEVEL$1(matches[1].toUpperCase());if(!override)return;this._config._level=override.asLowerCase;this.debug("Loglevel override in query string:",this._config._level)}debug(...args){this._log(LOG_LEVEL$1.DEBUG,args)}info(...args){this._log(LOG_LEVEL$1.INFO,args)}warn(...args){this._log(LOG_LEVEL$1.WARN,args)}error(...args){this._log(LOG_LEVEL$1.ERROR,args)}fatal(...args){this._log(LOG_LEVEL$1.FATAL,args)}removed(...args){args=["REMOVED"].concat(args);this.warnOnce(...args)}deprecated(...args){args=["DEPRECATED"].concat(args);this.warnOnce(...args)}warnOnce(...args){if(this._hasWarned(args)){return}this._log(LOG_LEVEL$1.WARN,args)}_log(level,data){const isEnabled=this._config._isEnabled;if(!isEnabled)return;const configLevel=LOG_LEVEL$1(this._config._level.toUpperCase());const isLogLevelAllowed=level>=configLevel;if(!isLogLevelAllowed)return;this._logToConsole(level,data);this.trigger("log",level,data);this.trigger("log:"+level.asLowerCase,level,data)}_logToConsole(level,data){const shouldLogToConsole=this._config._console;if(!shouldLogToConsole)return;const log=[level.asUpperCase+":"];data&&log.push(...data);if(console[level.asLowerCase]){console[level.asLowerCase](...log)}else{console.log(...log)}}_hasWarned(args){if(!this._config._warnFirstOnly){return false}const hash=args.map(String).join(":");if(this._warned[hash]){return true}this._warned[hash]=true;return false}}const logging=new Logging;var logging$1=__AMD("core/js/logging",logging);var Log=__AMD("core/js/a11y/log",class Log extends Backbone.Controller{initialize({a11y:a11y}){this.a11y=a11y;this._warned={}}_hasWarned(args){const config=this.a11y.config;if(!config._options._warnFirstOnly){return false}const hash=args.map(String).join(":");if(this._warned[hash]){return true}this._warned[hash]=true;return false}_canWarn(){const config=this.a11y.config;return Boolean(config._options._warn)}removed(...args){if(!this._canWarn){return}args=["A11Y"].concat(args);if(this._hasWarned(args)){return}logging$1.removed(...args);return this}deprecated(...args){if(!this._canWarn){return}args=["A11Y"].concat(args);if(this._hasWarned(args)){return}logging$1.deprecated(...args);return this}});var Scroll=__AMD("core/js/a11y/scroll",class Scroll extends Backbone.Controller{initialize({a11y:a11y}){this._a11y=a11y;this._onTouchStart=this._onTouchStart.bind(this);this._onTouchEnd=this._onTouchEnd.bind(this);this._onScrollEvent=this._onScrollEvent.bind(this);this._onKeyDown=this._onKeyDown.bind(this);this._scrollDisabledElements=$([]);this.$window=$(window);this.$body=$("body");this._preventScrollOnKeys={33:true,34:true,35:true,36:true,37:true,38:true,39:true,40:true};this._arrowKeys={37:true,38:true,39:true,40:true};this._ignoreKeysOnElementsMatching="textarea, input[type=radio], select";this._isRunning=false;this._touchStartEventObject=null;window.addEventListener("touchstart",this._onTouchStart);window.addEventListener("touchend",this._onTouchEnd);window.addEventListener("touchmove",this._onScrollEvent,{passive:false});window.addEventListener("wheel",this._onScrollEvent,{passive:false});document.addEventListener("wheel",this._onScrollEvent,{passive:false});document.addEventListener("keydown",this._onKeyDown)}disable($elements){$elements=$($elements);this._scrollDisabledElements=this._scrollDisabledElements.add($elements);this._checkRunning();return this}enable($elements){$elements=$($elements);if(!$elements.length){this.clear();return this}this._scrollDisabledElements=this._scrollDisabledElements.not($elements);this._checkRunning();return this}clear(){this._scrollDisabledElements=$([]);this._checkRunning();return this}_checkRunning(){if(!this._scrollDisabledElements.length){this._stop();return}this._start()}_start(){if(this._isRunning){return}this._isRunning=true}_onTouchStart(event){if(!this._isRunning)return;event=$.event.fix(event);this._touchStartEventObject=event;return true}_onTouchEnd(){if(!this._isRunning)return;this._touchStartEventObject=null;return true}_onScrollEvent(event){if(!this._isRunning)return;event=$.event.fix(event);return this._preventScroll(event)}_onKeyDown(event){if(!this._isRunning)return;event=$.event.fix(event);if(this._arrowKeys[event.which]&&this._a11y.isArrowable(event.target)){return}if(!this._preventScrollOnKeys[event.which]){return}if(this._a11y.isPopupOpen&&!this._isScrollable($(event.target))){const $openPopup=this._a11y.popupStack[this._a11y.popupStack.length-1];const $firstScrollable=this._isScrollable($openPopup)?$openPopup:this._a11y._findFirstForwardDescendant($openPopup,this._isScrollable);if($firstScrollable.length){event.target=$firstScrollable}}const $target=$(event.target);if($target.is(this._ignoreKeysOnElementsMatching)){return}return this._preventScroll(event)}_preventScroll(event){const isGesture=event.touches?.length>1;if(isGesture){return}const $target=$(event.target);if(this._scrollDisabledElements.length){const scrollingParent=this._getScrollingParent(event,$target);if(scrollingParent.filter(this._scrollDisabledElements).length===0){this.$window.scroll();return}}event.preventDefault();return false}_getScrollingParent(event,$target){const isTouchEvent=event.type==="touchmove";const isKeyDownEvent=event.type==="keydown";const hasTouchStartEvent=this._touchStartEventObject?.originalEvent;if(isTouchEvent&&!hasTouchStartEvent&&!isKeyDownEvent){return $target}const directionY=this._getScrollDirection(event);if(directionY==="none"){return this.$body}const parents=[$target[0],...$target.parents()];for(let i=0,l=parents.length;i<l;i++){const $parent=$(parents[i]);if($parent.is("body")){return this.$body}if(!this._isScrollable($parent)){continue}if(!this._isScrolling($parent,directionY)){continue}return $parent}return this.$body}_isScrollable($target){const scrollType=$target.css("overflow-y");if(scrollType!=="auto"&&scrollType!=="scroll"){return false}const pointerEvents=$target.css("pointer-events");if(pointerEvents==="none"){return false}return true}_isScrolling($target,directionY){const scrollTop=Math.ceil($target.scrollTop());const innerHeight=$target.outerHeight();const scrollHeight=$target[0].scrollHeight;let hasScrollingSpace=false;switch(directionY){case"down":hasScrollingSpace=scrollTop+innerHeight<scrollHeight;if(hasScrollingSpace){return true}break;case"up":hasScrollingSpace=scrollTop>0;if(hasScrollingSpace){return true}break}return false}_getScrollDirection(event){const deltaY=this._getScrollDelta(event);if(deltaY===0){return"none"}return deltaY>0?"up":"down"}_getScrollDelta(event){let deltaY=0;const isTouchEvent=event.type==="touchmove";const isKeyDownEvent=event.type==="keydown";const originalEvent=event.originalEvent;if(isTouchEvent){const startOriginalEvent=this._touchStartEventObject.originalEvent;let currentY=originalEvent.pageY;let previousY=startOriginalEvent.pageY;if(currentY===0||currentY===previousY){currentY=originalEvent.touches[0].pageY;previousY=startOriginalEvent.touches[0].pageY}deltaY=currentY-previousY}else if(isKeyDownEvent){deltaY=[33,36,38].includes(event.which)?1:[34,35,40].includes(event.which)?-1:0}else{const hasDeltaY=originalEvent.wheelDeltaY||originalEvent.deltaY!==undefined;if(hasDeltaY){deltaY=-originalEvent.deltaY}else{deltaY=originalEvent.wheelDelta||0}}return deltaY}_stop(){if(!this._isRunning){return}this._isRunning=false}});const DEFAULT_TYPE_LABEL={course:"Main menu",menu:"Sub menu",page:"Page"};var TopOfContentObject=__AMD("core/js/a11y/topOfContentObject",class TopOfContentObject extends Backbone.Controller{initialize({a11y:a11y}){this.a11y=a11y;this.$body=$("body");this.listenTo(Adapt$1,{"accessibility:ready":this.createElement,"router:location":this.updateElement})}createElement(){const config=this.a11y.config;if(!config._isEnabled||!config._options._isPopupManagementEnabled)return;this.$element=$('<div id="a11y-topofcontentobject" tabindex="-1" class="visually-hidden"></div>');this.$body.prepend(this.$element)}updateElement(location){const config=this.a11y.config;if(!config._isEnabled||!config._options._isPopupManagementEnabled)return;if(!location._currentModel)return;const json=location._currentModel.toJSON();json._globals=Adapt$1.course.get("_globals");json.type=this.a11y.normalize(json._globals._accessibility._ariaLabels[json._type]??DEFAULT_TYPE_LABEL[json._type]);json.displayTitle=this.a11y.normalize(json.displayTitle);const template=Handlebars.compile(json._globals._accessibility._ariaLabels.topOfContentObject??"{{type}} {{displayTitle}}");this.$element.html(template(json))}goto(){const config=this.a11y.config;if(!config._isEnabled||!config._options._isPopupManagementEnabled)return;if(document.activeElement===this.$element[0])return;this.$element[0].focus()}});var WrapFocus=__AMD("core/js/a11y/wrapFocus",class WrapFocus extends Backbone.Controller{initialize({a11y:a11y}){this.a11y=a11y;_.bindAll(this,"_onWrapAround");this.listenTo(Adapt$1,{"accessibility:ready":this._attachEventListeners})}_attachEventListeners(){const config=this.a11y.config;$("body").on("click focus",config._options._focusguard,this._onWrapAround)}_onWrapAround(event){const config=this.a11y.config;if(!config._isEnabled||!config._options._isPopupWrapFocusEnabled){return}event.preventDefault();event.stopPropagation();this.a11y.focusFirst("body",{defer:false})}});var Popup=__AMD("core/js/a11y/popup",class Popup extends Backbone.Controller{initialize({a11y:a11y}){this.a11y=a11y;this._floorStack=[$("body")];this._focusStack=[];this._tabIndexes={};this._ariaHiddens={};this._elementUIDIndex=0;this.listenTo(Adapt$1,{"popup:opened"($element,ignoreInternalTrigger){if(ignoreInternalTrigger){return}this.a11y.log.deprecated('Adapt.trigger("popup:opened", $element) is replaced with a11y.popupOpened($element);');this.opened($element,true)},"popup:closed"($target,ignoreInternalTrigger){if(ignoreInternalTrigger){return}this.a11y.log.deprecated('Adapt.trigger("popup:closed", $target) is replaced with a11y.popupClosed($target);');this.closed($target,true)}})}get isOpen(){return this._floorStack.length>1}get stack(){return this._floorStack.slice(1)}opened($popupElement,silent){$popupElement=$popupElement||$(document.activeElement);this._addPopupLayer($popupElement);if(!silent){Adapt$1.trigger("popup:opened",$popupElement,true)}return this}_addPopupLayer($popupElement){$popupElement=$($popupElement);this._floorStack.push($popupElement);this._focusStack.push($(document.activeElement));if($popupElement.is("dialog")){$popupElement[0].addEventListener("cancel",(event=>event.preventDefault()));$popupElement[0].showModal();return}const config=this.a11y.config;if(!config._isEnabled||!config._options._isPopupManagementEnabled||$popupElement.length===0){return $popupElement}logging$1.deprecated("a11y/popup opened: Use native dialog tag for",$popupElement);let $elements=$(config._options._tabbableElements).filter(config._options._tabbableElementsExcludes);const $branch=$popupElement.add($popupElement.parents());const $siblings=$branch.siblings().filter(config._options._tabbableElementsExcludes);$elements=$elements.add($siblings);$elements.each(((index,item)=>{const $item=$(item);if(typeof item.a11y_uid==="undefined"){item.a11y_uid="UID"+ ++this._elementUIDIndex}const elementUID=item.a11y_uid;if(this._tabIndexes[elementUID]===undefined){this._tabIndexes[elementUID]=[]}if(this._ariaHiddens[elementUID]===undefined){this._ariaHiddens[elementUID]=[]}const tabindex=$item.attr("tabindex");const ariaHidden=$item.attr("aria-hidden");this._tabIndexes[elementUID].push(tabindex===undefined?"":tabindex);this._ariaHiddens[elementUID].push(ariaHidden===undefined?"":ariaHidden);if(config._options._isPopupTabIndexManagementEnabled){$item.attr("tabindex",-1)}if(config._options._isPopupAriaHiddenManagementEnabled){$item.attr("aria-hidden",true)}}));const $items=$popupElement.find(config._options._tabbableElements).filter(config._options._tabbableElementsExcludes);if(config._options._isPopupTabIndexManagementEnabled){$items.attr("tabindex",0)}if(config._options._isPopupAriaHiddenManagementEnabled){$items.removeAttr("aria-hidden").removeClass("aria-hidden").parents(config._options._ariaHiddenExcludes).removeAttr("aria-hidden").removeClass("aria-hidden")}}async closed($forceFocusElement,silent){if(!silent){Adapt$1.trigger("popup:closing");await wait$1.queue()}const $previousFocusElement=this._removeLastPopupLayer();const $focusElement=$forceFocusElement||$previousFocusElement||$("body");if(!silent){Adapt$1.trigger("popup:closed",$focusElement,true)}this.a11y.focusFirst($($focusElement),{preventScroll:true});return this}_removeLastPopupLayer(){if(this._floorStack.length<=1){return}const $popupElement=this._floorStack.pop();if($popupElement.is("dialog")){$popupElement[0].close();return this._focusStack.pop()}const config=this.a11y.config;if(!config._isEnabled||!config._options._isPopupManagementEnabled){return $(document.activeElement)}$(config._options._tabbableElements).filter(config._options._tabbableElementsExcludes).each(((index,item)=>{const $item=$(item);let previousTabIndex="";let previousAriaHidden="";if(typeof item.a11y_uid==="undefined"){item.a11y_uid="UID"+ ++this._elementUIDIndex}const elementUID=item.a11y_uid;if(this._tabIndexes[elementUID]?.length){previousTabIndex=this._tabIndexes[elementUID].pop();previousAriaHidden=this._ariaHiddens[elementUID].pop()}if(this._tabIndexes[elementUID]?.length){delete this._tabIndexes[elementUID];delete this._ariaHiddens[elementUID]}if(config._options._isPopupTabIndexManagementEnabled){if(previousTabIndex===""){$item.removeAttr("tabindex")}else{$item.attr({tabindex:previousTabIndex})}}if(config._options._isPopupAriaHiddenManagementEnabled){if(previousAriaHidden===""){$item.removeAttr("aria-hidden")}else{$item.attr({"aria-hidden":previousAriaHidden})}}}));return this._focusStack.pop()}setCloseTo($focusElement){const $original=this._focusStack.pop();this._focusStack.push($focusElement);return $original}});var defaultAriaLevels=__AMD("core/js/enums/defaultAriaLevels",{_menu:1,_menuGroup:2,_menuItem:2,_page:1,_article:2,_block:3,_component:4,_componentItem:5,_notify:1});var deprecated=__AMD("core/js/a11y/deprecated",(function(a11y){Object.assign($.fn,{isFixedPostion(){a11y.log.removed('$("..").isFixedPostion was unneeded and has been removed, let us know if you need it back.');return false},a11y_aria_label(){a11y.log.removed('$("..").a11y_aria_label was incorrect behaviour.');return this},limitedScrollTo(){a11y.log.removed("$.limitedScrollTo had no impact on the screen reader cursor.");return this},a11y_text(){a11y.log.removed("a11y_text is no longer required. https://tink.uk/understanding-screen-reader-interaction-modes/");return this},a11y_selected(){a11y.log.removed('$("..").a11y_selected is removed. Please use aria-live instead.');return this},a11y_on(isOn){a11y.log.deprecated('$("..").a11y_on, use a11y.findTabbable($element); and a11y.toggleAccessible($elements, isAccessible); instead.');const $tabbable=a11y.findTabbable(this);a11y.toggleAccessible($tabbable,isOn);return this},a11y_only(){a11y.log.removed('$("..").a11y_only, use a11y.popupOpened($popupElement); instead.');return this},scrollDisable(){if(a11y.config._options._isScrollDisableEnabled===false){return this}a11y.log.deprecated('$("..").scrollDisable, use a11y.scrollDisable($elements); instead.');a11y.scrollDisable(this);return this},scrollEnable(){if(a11y.config._options._isScrollDisableEnabled===false){return this}a11y.log.deprecated('$("..").scrollEnable, use a11y.scrollEnable($elements); instead.');a11y.scrollEnable(this);return this},a11y_popup(){a11y.log.deprecated('$("..").a11y_popup, use a11y.popupOpened($popupElement); instead.');return a11y.popupOpened(this)},a11y_cntrl(isOn,withDisabled){a11y.log.deprecated('$("..").a11y_cntrl, use a11y.toggleAccessible($elements, isAccessible); and if needed a11y.toggleEnabled($elements, isEnabled); instead.');a11y.toggleAccessible(this,isOn);if(withDisabled)a11y.toggleEnabled(this,isOn);return this},a11y_cntrl_enabled(isOn){a11y.log.deprecated('$("..").a11y_cntrl_enabled, use a11y.toggleAccessibleEnabled($elements, isAccessibleEnabled); instead.');a11y.toggleAccessibleEnabled(this,isOn);return this},isReadable(){a11y.log.deprecated('$("..").isReadable, use a11y.isReadable($element); instead.');return a11y.isReadable(this)},findForward(selector){a11y.log.removed('$("..").findForward has been removed as the use cases are very small, let us know if you need it back.');return a11y._findFirstForward(this,selector)},findWalk(selector){a11y.log.removed('$("..").findWalk has been removed as the use cases are very small, let us know if you need it back.');return a11y._findFindForwardDescendant(this,selector)},focusNoScroll(){a11y.log.deprecated('$("..").focusNoScroll, use a11y.focus($element); instead.');return a11y.focus(this)},focusNext(returnOnly){a11y.log.deprecated('$("..").focusNext, use a11y.focusNext($element); or if needed a11y.findFirstReadable($element); instead.');if(returnOnly){return a11y.findFirstReadable(this)}return a11y.focusNext(this)},focusOrNext(returnOnly){a11y.log.deprecated('$("..").focusOrNext, use a11y.focusFirst($element); or if needed a11y.findFirstReadable($element); or a11y.isReadable($element); instead.');if(returnOnly){if(a11y.isReadable(this))return this;return a11y.findFirstReadable(this)}return a11y.focusFirst(this)},a11y_focus(dontDefer){a11y.log.deprecated('$("..").a11y_focus, use a11y.focusFirst($element, { defer: true }); instead.');a11y.focusFirst(this,{defer:!dontDefer});return this}});Object.assign($,{a11y_alert(){a11y.log.removed("$.a11y_alert is removed. Please use aria-live instead.");return this},a11y_update(){a11y.log.removed("a11y_update is no longer required.");return this},a11y_text(text){a11y.log.removed("a11y_text is no longer required. https://tink.uk/understanding-screen-reader-interaction-modes/");return text},a11y_on(isOn,selector){a11y.log.deprecated('$("..").a11y_on, use a11y.toggleHidden($elements, isHidden); instead.');return a11y.toggleHidden(selector,!isOn)},a11y_popdown($focusTarget){a11y.log.removed("$.a11y_popdown, use a11y.popupClosed($focusTarget); instead.");return a11y.popupClosed($focusTarget)},a11y_focus(dontDefer){a11y.log.deprecated('$.a11y_focus, use a11y.focusFirst("body", { defer: true }); instead.');a11y.focusFirst("body",{defer:!dontDefer});return this},a11y_normalize(html){a11y.log.deprecated('$.a11y_normalize, use a11y.normalize("html"); instead.');return a11y.normalize(html)},a11y_remove_breaks(html){a11y.log.deprecated('$.a11y_remove_breaks, use a11y.removeBreaks("html"); instead.');return a11y.removeBreaks(html)}})}));class Components extends Backbone__default["default"].Controller{initialize(){this._register={};this.register=this.register.bind(this);this.getViewName=this.getViewName.bind(this);this.getViewClass=this.getViewClass.bind(this);this.getModelName=this.getModelName.bind(this);this.getModelClass=this.getModelClass.bind(this)}register(name,object){if(Array.isArray(name)){name.forEach((name=>this.register(name,object)));return object}if(name.split(" ").length>1){this.register(name.split(" "),object);return object}if(!object.view&&!object.model||object instanceof Backbone__default["default"].View){logging$1.deprecated("View-only registrations are no longer supported");object={view:object}}if(object.view&&!object.view.template){object.view.template=name}const isModelSetAndInvalid=object.model&&!(object.model.prototype instanceof Backbone__default["default"].Model)&&!(object.model instanceof Function);if(isModelSetAndInvalid){throw new Error("The registered model is not a Backbone.Model or Function")}const isViewSetAndInvalid=object.view&&!(object.view.prototype instanceof Backbone__default["default"].View)&&!(object.view instanceof Function);if(isViewSetAndInvalid){throw new Error("The registered view is not a Backbone.View or Function")}this._register[name]=Object.assign({},this._register[name],object);return object}getViewName(nameModelViewOrData){if(typeof nameModelViewOrData==="string"){return nameModelViewOrData}if(nameModelViewOrData instanceof Backbone__default["default"].Model){nameModelViewOrData=nameModelViewOrData.toJSON()}if(nameModelViewOrData instanceof Backbone__default["default"].View){let foundName;Object.entries(this._register).forEach((([key,entry])=>{if(!entry?.view)return;if(!(nameModelViewOrData instanceof entry.view))return;foundName=key;return true}));return foundName}if(nameModelViewOrData instanceof Object){const names=[typeof nameModelViewOrData._view==="string"&&nameModelViewOrData._view,typeof nameModelViewOrData._component==="string"&&nameModelViewOrData._component,typeof nameModelViewOrData._type==="string"&&nameModelViewOrData._type].filter(Boolean);if(names.length){const name=names.find((name=>this._register[name]?.view));return name||names.pop()}}throw new Error("Cannot derive view class name from input")}getViewClass(nameModelViewOrData){const name=this.getViewName(nameModelViewOrData);const object=this._register[name];if(!object){logging$1.error(`A view for '${name}' isn't registered in your project`);return}const isBackboneView=object.view?.prototype instanceof Backbone__default["default"].View;if(!isBackboneView&&object.view instanceof Function){return object.view()}return object.view}getModelName(nameModelOrData){if(typeof nameModelOrData==="string"){return nameModelOrData}if(nameModelOrData instanceof Backbone__default["default"].Model){nameModelOrData=nameModelOrData.toJSON()}if(nameModelOrData instanceof Object){const name=nameModelOrData._component;const entry=this._register[name];const isViewOnlyQuestion=entry&&!entry.model&&entry.view?._isQuestionType;if(isViewOnlyQuestion){logging$1.deprecated(`Assuming a question model for a view-only question: ${name}`);return"question"}const names=[typeof nameModelOrData._model==="string"&&nameModelOrData._model,typeof nameModelOrData._component==="string"&&nameModelOrData._component,typeof nameModelOrData._type==="string"&&nameModelOrData._type].filter(Boolean);if(names.length){const name=names.find((name=>this._register[name]?.model));return name||names.pop()}}throw new Error("Cannot derive model class name from input")}getModelClass(nameModelOrData){const name=this.getModelName(nameModelOrData);const object=this._register[name];if(!object){logging$1.error(`A model for '${name}' isn't registered in your project`);return}const isBackboneModel=object.model?.prototype instanceof Backbone__default["default"].Model;if(!isBackboneModel&&object.model instanceof Function){return object.model()}return object.model}}const components=new Components;var components$1=__AMD("core/js/components",components);var AdaptCollection=__AMD("core/js/collections/adaptCollection",class AdaptCollection extends Backbone.Collection{initialize(models,options){this.once("reset",this.loadedData,this)}loadedData(){Adapt$1.trigger("adaptCollection:dataLoaded")}});var BuildModel=__AMD("core/js/models/buildModel",class BuildModel extends LockingModel{defaults(){return{jsonext:"json"}}initialize(attrs,options){this.url=options.url;this.fetch({success:()=>{this.isLoaded=true;Adapt$1.trigger("buildModel:dataLoaded")},error:()=>{console.log("Unable to load adapt/js/build.js");Adapt$1.trigger("buildModel:dataLoaded")}})}isFrameworkVersion(version){return semver__default["default"].satisfies(this.get("package").version,version,{includePrerelease:true})}isPluginInstalled(name,version="*"){const plugin=this.get("plugins").find((plugin=>{if(plugin.name!==name)return false;return semver__default["default"].satisfies(plugin.version,version,{includePrerelease:true})}));return Boolean(plugin)}whenReady(){if(this.isLoaded)return Promise.resolve();return new Promise((resolve=>{Adapt$1.once("buildModel:dataLoaded",resolve)}))}});var ConfigModel=__AMD("core/js/models/configModel",class ConfigModel extends LockingModel{defaults(){return{screenSize:null,_forceRouteLocking:false,_canLoadData:true,_disableAnimation:false}}setValuesFromURLParams(){const paramMappings={dir:"_defaultDirection",lang:"_defaultLanguage"};const params=new URLSearchParams(window.location.search);Object.entries(paramMappings).forEach((([key,value])=>{const passedVal=params.get(key);if(!passedVal)return;if(key==="lang"&&Adapt$1.build.get("availableLanguageNames")?.includes(passedVal)===false)return;this.set(value,passedVal)}))}initialize(attrs,options){this.url=options.url;this.fetch({success:()=>{this.setValuesFromURLParams();Adapt$1.trigger("offlineStorage:prepare");wait$1.queue((()=>{Adapt$1.trigger("configModel:dataLoaded");if(!this.get("_canLoadData"))return;Adapt$1.trigger("configModel:loadCourseData")}))},error:()=>logging$1.error("Unable to load course/config.json")})}loadData(){}});class Data extends AdaptCollection{model(json){const ModelClass=components$1.getModelClass(json);if(!ModelClass){return new LockingModel(json)}return new ModelClass(json,{parse:true})}initialize(){super.initialize();this.findById=this.findById.bind(this);this.findViewByModelId=this.findViewByModelId.bind(this);this.findByTrackingPosition=this.findByTrackingPosition.bind(this);this.on({add:this.onAdded,remove:this.onRemoved})}async init(){this.reset();this._byAdaptID={};Adapt$1.build=new BuildModel(null,{url:`adapt/js/build.min.js?timestamp=${Date.now()}`,reset:true});await Adapt$1.build.whenReady();$("html").attr("data-adapt-framework-version",Adapt$1.build.get("package").version);this.loadConfigData()}onAdded(model){this._byAdaptID[model.get("_id")]=model}onRemoved(model){delete this._byAdaptID[model.get("_id")]}loadConfigData(){Adapt$1.config=new ConfigModel(null,{url:Adapt$1.build.get("coursedir")+"/config."+Adapt$1.build.get("jsonext")+`?timestamp=${Adapt$1.build.get("timestamp")}`,reset:true});this.listenToOnce(Adapt$1,"configModel:loadCourseData",this.onLoadCourseData);this.listenTo(Adapt$1.config,{"change:_activeLanguage":this.onLanguageChange,"change:_defaultDirection":this.onDirectionChange})}onDirectionChange(model,direction){if(direction==="rtl"){$("html").removeClass("dir-ltr").addClass("dir-rtl").attr("dir","rtl")}else{$("html").removeClass("dir-rtl").addClass("dir-ltr").attr("dir","ltr")}}onLoadCourseData(){if(!Adapt$1.config.get("_activeLanguage")){Adapt$1.config.set("_activeLanguage",Adapt$1.config.get("_defaultLanguage"));return}this.loadCourseData()}async onLanguageChange(model,language){await wait$1.queue();const previousAttributes=model.previousAttributes();const previousLanguage=previousAttributes._activeLanguage;offlineStorage$1.set("lang",language);if(Adapt$1.get("_isStarted")){Adapt$1.set("_isStarted",false)}await this.loadCourseData(language,previousLanguage)}async loadCourseData(newLanguage,previousLanguage){const language=Adapt$1.config.get("_activeLanguage");const courseFolder=Adapt$1.build.get("coursedir")+"/"+language+"/";$("html").attr("lang",language);await this.loadManifestFiles(courseFolder);await this.triggerDataLoaded();await this.triggerDataReady(newLanguage,previousLanguage);this.triggerInit()}getJSON(path){return new Promise(((resolve,reject)=>{$.getJSON(path,(data=>{data.__path__=path;resolve(data)})).fail((()=>{reject(new Error(`Unable to load ${path}`))}))}))}async loadManifestFiles(languagePath){this.trigger("loading");this.reset();this._byAdaptID={};const manifestPath=languagePath+"language_data_manifest.js";let manifest;try{manifest=await this.getJSON(manifestPath)}catch(err){manifest=["course.json","contentObjects.json","articles.json","blocks.json","components.json"];logging$1.error(`Manifest path '${manifestPath} not found. Using traditional files: ${manifest.join(", ")}`)}let allFileData;try{allFileData=await Promise.all(manifest.map((filePath=>this.getJSON(`${languagePath}${filePath}?timestamp=${Adapt$1.build.get("timestamp")}`))))}catch(error){logging$1.error(error);return}const allModelData=allFileData.reduce(((result,fileData)=>{if(Array.isArray(fileData)){fileData.forEach(((datum,index)=>{datum.__path__=fileData.__path__;datum.__index__=index}));result.push(...fileData)}else if(fileData instanceof Object){result.push(fileData)}else{logging$1.warnOnce(`File data isn't an array or object: ${fileData.__path__}`)}return result}),[]);const course=allModelData.find((modelData=>modelData._type==="course"));if(!course){throw new Error('Expected a model data with "_type": "course", none found.')}Adapt$1.trigger("courseModel:dataLoading");Adapt$1.course=this.push(course);Adapt$1.trigger("courseModel:dataLoaded");allModelData.forEach((modelData=>{if(modelData._type==="course"){return}try{components$1.getModelName(modelData)}catch(error){logging$1.error(`Failed to load object ${modelData.__path__}${Object.hasOwn(modelData,"__index__")?`[${modelData.__index__}]`:""}`);logging$1.error(error);return}this.push(modelData)}));this.checkData();this.trigger("reset");this.trigger("loaded");await wait$1.queue()}async triggerDataLoaded(){logging$1.debug("Firing app:dataLoaded");try{this.forEach((model=>model.setupModel?.()));await wait$1.queue();Adapt$1.trigger("app:dataLoaded")}catch(e){logging$1.error("Error during app:dataLoading trigger",e)}await wait$1.queue()}async triggerDataReady(newLanguage,previousLanguage){if(newLanguage){Adapt$1.trigger("app:languageChanged",newLanguage,previousLanguage);await wait$1.queue()}logging$1.debug("Firing app:dataReady");try{Adapt$1.trigger("app:dataReady")}catch(e){logging$1.error("Error during app:dataReady trigger",e)}await wait$1.queue()}triggerInit(){this.isReady=true;this.trigger("ready")}whenReady(){if(this.isReady)return Promise.resolve();return new Promise((resolve=>{this.once("ready",resolve)}))}hasId(id){return Boolean(this._byAdaptID[id])}findById(id){const model=this._byAdaptID[id];if(!model){logging$1.warn(`data.findById() unable to find id: ${id}`);return}return model}findViewByModelId(id){const model=this.findById(id);if(!model||!Adapt$1.parentView)return;const idPathToView=[id];const currentLocationId=location$1._currentId;const currentLocationModel=model.getAncestorModels().find((model=>{const modelId=model.get("_id");if(modelId===currentLocationId)return true;idPathToView.unshift(modelId);return false}));if(!currentLocationModel){return logging$1.warn(`data.findViewByModelId() unable to find view for model id: ${id}`)}const foundView=idPathToView.reduce(((view,currentId)=>{if(!view)return null;const childViews=view.getChildViews();return childViews?.find((view=>view.model.get("_id")===currentId))}),Adapt$1.parentView);return foundView}findByTrackingPosition(trackingPosition){const[trackingId,indexInTrackingIdDescendants]=trackingPosition;const trackingIdModel=this.find((model=>model.get("_trackingId")===trackingId));if(!trackingIdModel){logging$1.warn(`data.findByTrackingPosition() unable to find trackingPosition: ${trackingPosition}`);return}if(indexInTrackingIdDescendants>=0){let trackingIdDescendants=[trackingIdModel].concat(trackingIdModel.getAllDescendantModels(true));trackingIdDescendants=trackingIdDescendants.filter((model=>!(model.isTypeGroup("component")&&model.get("_isTrackable")===false)));return trackingIdDescendants[indexInTrackingIdDescendants]}const trackingIdAncestors=trackingIdModel.getAncestorModels();const ancestorDistance=Math.abs(indexInTrackingIdDescendants)-1;return trackingIdAncestors[ancestorDistance]}logReadyError(view){const notReadyDescendants=view.model.getAllDescendantModels(true).filter((model=>!model.get("_isReady")));logging$1.error(`View ${notReadyDescendants.map((model=>`${model.get("_id")} (${model.get("_component")??model.get("_type")})`)).join(", ")} failed to become ready, forcing ready status.`);notReadyDescendants.reverse().forEach((model=>model.set("_isReady",true)))}checkData(){this.checkIds();this.checkTrackingIds()}checkIds(){const items=this.toJSON();const idIndex=___default["default"].indexBy(items,"_id");const idGroups=___default["default"].groupBy(items,"_id");const parentIdGroups=___default["default"].groupBy(items,"_parentId");let orphanedIds={};let emptyIds={};let duplicateIds={};let missingIds={};items.forEach((o=>{const isCourseType=o._type==="course";const isComponentType=o._type==="component";if(idGroups[o._id].length>1){duplicateIds[o._id]=true}if(!isComponentType&&!parentIdGroups[o._id]){emptyIds[o._id]=true}if(!isCourseType&&(!o._parentId||!idIndex[o._parentId])){orphanedIds[o._id]=true}if(!isCourseType&&o._parentId&&!idIndex[o._parentId]){missingIds[o._parentId]=true}}));orphanedIds=Object.keys(orphanedIds);emptyIds=Object.keys(emptyIds);duplicateIds=Object.keys(duplicateIds);missingIds=Object.keys(missingIds);const hasErrored=orphanedIds.length||emptyIds.length||duplicateIds.length||missingIds.length;if(orphanedIds.length){logging$1.error(`Orphaned _ids: ${orphanedIds.join(", ")}`)}if(missingIds.length){logging$1.error(`Missing _ids: ${missingIds.join(", ")}`)}if(emptyIds.length){logging$1.error(`Empty _ids: ${emptyIds.join(", ")}`)}if(duplicateIds.length){logging$1.error(`Duplicate _ids: ${duplicateIds.join(", ")}`)}if(hasErrored){const err=new Error("Oops, looks like you have some json errors.");err.number=10011;throw err}}checkTrackingIds(){const items=this.toJSON();const trackingIdType=Adapt$1.build.get("trackingIdType")||"block";const trackingIdCounts=___default["default"].groupBy(items.filter((item=>item._type===trackingIdType)),"_trackingId");const missingTrackingIds=items.filter((item=>item._type===trackingIdType&&item._trackingId===undefined)).map((item=>item._id));if(missingTrackingIds.length){logging$1.error(`Missing _trackingIds: ${missingTrackingIds.join(", ")}`)}const duplicateTrackingIds=Object.entries(trackingIdCounts).filter((([id,group])=>group.length>1)).map((([id,group])=>`${id}:[${group.map((item=>item._id)).join(", ")}]`));if(duplicateTrackingIds.length){logging$1.error(`Duplicate _trackingIds: ${duplicateTrackingIds.join(", ")}`)}const hasErrored=missingTrackingIds.length||duplicateTrackingIds.length;if(hasErrored){const err=new Error("Oops, looks like you have some json errors with trackingIds.");err.number=10011;throw err}}}const data=new Data;var data$1=__AMD("core/js/data",data);class A11y extends Backbone.Controller{defaults(){return{_isPrefersReducedMotionEnabled:true,_isFocusOutlineKeyboardOnlyEnabled:true,_isFocusOutlineDisabled:false,_isFocusAssignmentEnabled:true,_isFocusOnClickEnabled:true,_isClickDelayedAfterFocusEnabled:false,_isFocusNextOnDisabled:true,_isScrollDisableEnabled:true,_isAriaHiddenManagementEnabled:true,_isPopupManagementEnabled:true,_isPopupWrapFocusEnabled:true,_isPopupAriaHiddenManagementEnabled:true,_isPopupTabIndexManagementEnabled:true,_ariaHiddenExcludes:":not(#wrapper):not(body)",_tabbableElements:"a,button,input,select,textarea,[tabindex]:not([data-a11y-force-focus])",_focusOutlineKeyboardOnlyIgnore:"input,textarea",_tabbableElementsExcludes:":not(.a11y-ignore):not([data-a11y-force-focus])",_focusableElements:"a,button,input,select,textarea,[tabindex],label",_readableElements:"[role=heading],[aria-label],[aria-labelledby],[alt]",_focusForwardElementsExcludes:":not([aria-labelledby][role=dialog],[aria-labelledby][role=main],[aria-labelledby][role=region],[aria-labelledby][role=radiogroup],[aria-labelledby][role=group],[aria-labelledby][role=tablist],[aria-labelledby][role=list],[aria-labelledby][role=tree],[aria-labelledby][role=treegrid],[aria-labelledby][role=table],[aria-labelledby][role=grid][aria-labelledby],[role=menu],[aria-labelledby][role=rowgroup])",_focusguard:".a11y-focusguard",_wrapStyleElements:"b,i,abbr,strong,em,small,sub,sup,ins,del,mark,zw,nb",_arrowElements:"input[type=radio]",_warnFirstOnly:true,_warn:true}}initialize(){this.isFocusable=this.isFocusable.bind(this);this.isReadable=this.isReadable.bind(this);this.isTabbable=this.isTabbable.bind(this);this.$html=$("html");this._htmlCharRegex=/&.*;/g;this.config=null;this._ariaDisabled=new AriaDisabled({a11y:this});this._browserConfig=new BrowserConfig({a11y:this});this._browserFocus=new BrowserFocus({a11y:this});this._keyboardFocusOutline=new KeyboardFocusOutline({a11y:this});this._wrapFocus=new WrapFocus({a11y:this});this._popup=new Popup({a11y:this});this._scroll=new Scroll({a11y:this});this._topOfContentObject=new TopOfContentObject({a11y:this});this._isForcedFocus=false;this.log=new Log({a11y:this});deprecated(this);this._removeLegacyElements();this.listenToOnce(Adapt$1,{"configModel:dataLoaded":this._onConfigDataLoaded,"navigationView:postRender":this._removeLegacyElements},this);Adapt$1.on("device:changed",this._setupNoSelect);this.listenTo(Adapt$1,{"router:location":this._onNavigationStart,"contentObjectView:ready router:plugin":this._onNavigationEnd});this._lastFocusTime=0;this._activeElements=[];$(document.body).on("focusin",(()=>{this._activeElements.unshift(document.activeElement);this._activeElements=this._activeElements.filter(this.isReadable);this._activeElements.length=10;this._lastFocusTime=Date.now()}))}_onConfigDataLoaded(){this.config=Adapt$1.config.get("_accessibility");this.config._isActive=false;this.config._options=_.defaults(this.config._options||{},this.defaults());offlineStorage$1.set("a11y",false);this.$html.toggleClass("has-accessibility",this.isEnabled());this._setupNoSelect();this._addFocuserDiv();if(this._isReady){return}this._isReady=true;Adapt$1.trigger("accessibility:ready")}_setupNoSelect(){if(!this.config?._disableTextSelectOnClasses){return}const classes=this.config._disableTextSelectOnClasses.split(" ");const isMatch=classes.some((className=>this.$html.is(className)));this.$html.toggleClass("u-no-select",isMatch)}_addFocuserDiv(){if($("#a11y-focuser").length){return}$("body").append($('<div id="a11y-focuser" class="a11y-ignore" tabindex="-1">&nbsp;</div>'))}_removeLegacyElements(){const $legacyElements=$("body").children("#accessibility-toggle, #accessibility-instructions");const $navigationElements=$(".nav").find("#accessibility-toggle, #accessibility-instructions");if(!$legacyElements.length&&!$navigationElements.length){return}logging$1.warn("REMOVED: #accessibility-toggle and #accessibility-instructions have been removed. Please remove them from all of your .html files.");$legacyElements.remove();$navigationElements.remove()}_onNavigationStart(){if(!this.isEnabled()){return}_.defer((()=>this.toggleHidden(".contentobject",true)))}_onNavigationEnd(view){if(view?.model?.get("_id")!==location$1._currentId||!this.isEnabled()){return}this.toggleHidden(".contentobject",false)}isActive(){this.log.removed("Accessibility is now always active when enabled. Please unify your user experiences.");return false}isEnabled(){return this.config?._isEnabled}get timeSinceLastFocus(){return Date.now()-this._lastFocusTime}get currentActiveElement(){return this._activeElements[0]}get previousActiveElement(){return this._activeElements[1]}ariaLevel({id:id=null,level:level="1",override:override=null}={}){if(level==="course")level="menu";if(arguments.length===2){level=arguments[0];override=arguments[1];id=null}const ariaLevels=Adapt$1.config.get("_accessibility")?._ariaLevels??defaultAriaLevels;if(override===0)override=null;function calculateLevel(id=null,level,offset=0){const isNumber=!isNaN(level);const isTypeName=/[a-zA-z]/.test(level);if(!isTypeName&&isNumber){return parseInt(level)+offset}const relativeDescriptor=Adapt$1.parseRelativeString(level);const nextLevel=ariaLevels?.["_"+relativeDescriptor.type];const hasModelId=Boolean(id);if(!hasModelId){logging$1.warnOnce("Cannot calculate appropriate heading level, no model id was specified");return calculateLevel(id,nextLevel,offset+relativeDescriptor.offset)}const nextModel=data$1.findById(id)?.findAncestor(relativeDescriptor.type?.toLowerCase())??data$1.findById(id);const nextModelId=nextModel?.get("_id")??id;let nextModelOverride=nextModel.get("_ariaLevel");const hasNextTitle=Boolean(nextModel.get("displayTitle"))||Boolean(nextModelOverride);if(nextModelOverride===0)nextModelOverride=null;const accumulatedOffset=offset+(hasNextTitle?relativeDescriptor.offset:0);const resolvedLevel=nextModelOverride??nextLevel;return calculateLevel(nextModelId,resolvedLevel,accumulatedOffset)}return calculateLevel(id,override??level)}toggleHidden($elements,isHidden=true){$elements=$($elements);const config=this.config;if(!config._isEnabled||!config._options._isAriaHiddenManagementEnabled){return this}if(isHidden===true){$elements.attr("aria-hidden",true)}else{$elements.removeAttr("aria-hidden")}return this}toggleAccessibleEnabled($elements,isAccessibleEnabled){this.toggleAccessible($elements,isAccessibleEnabled);this.toggleEnabled($elements,isAccessibleEnabled);return this}toggleAccessible($elements,isReadable=true){$elements=$($elements);const config=this.config;if(!config._isEnabled||!config._options._isAriaHiddenManagementEnabled||$elements.length===0){return this}if(!isReadable){$elements.attr({tabindex:"-1","aria-hidden":"true"}).addClass("aria-hidden")}else{$elements.removeAttr("aria-hidden tabindex").removeClass("aria-hidden");$elements.parents(config._options._ariaHiddenExcludes).removeAttr("aria-hidden").removeClass("aria-hidden")}return this}toggleEnabled($elements,isEnabled=true){$elements=$($elements);if($elements.length===0){return this}if(!isEnabled){$elements.attr({"aria-disabled":"true"}).addClass("is-disabled")}else{$elements.removeAttr("aria-disabled").removeClass("is-disabled")}return this}toggleTabbableDescendants($element,isTabbable=true){const $tabbable=this.findTabbable($element);if(!isTabbable){$tabbable.each(((index,element)=>{if(element.isAdaptTabHidden)return;const $element=$(element);element.isAdaptTabHidden=true;element.adaptPreviousTabIndex=$element.attr("tabindex")??null;$element.attr("tabindex",-1)}));return this}$tabbable.each(((index,element)=>{if(!element.isAdaptTabHidden)return;const $element=$(element);if(element.adaptPreviousTabIndex===null)$element.removeAttr("tabindex");else $element.attr("tabindex",element.adaptPreviousTabIndex);delete element.isAdaptTabHidden;delete element.adaptPreviousTabIndex}));return this}findFirstTabbable($element){$element=$($element).first();return this._findFirstForward($element,this.isTabbable)}findFirstReadable($element){$element=$($element).first();return this._findFirstForward($element,this.isReadable)}findFirstFocusable($element){$element=$($element).first();return this._findFirstForward($element,this.isFocusable)}findTabbable($element){const config=this.config;return $($element).find(config._options._tabbableElements).filter(config._options._tabbableElementsExcludes)}findReadable($element){return $($element).find("*").filter(((index,element)=>this.isReadable(element)))}findFocusable($element){return $($element).find("*").filter(((index,element)=>this.isFocusable(element)))}isTabbable($element){const config=this.config;const value=$($element).is(config._options._tabbableElements).is(config._options._tabbableElementsExcludes);if(!value){return null}return value}isReadable($element,checkParents=true){const config=this.config;$element=$($element).first();const isInDOM=Boolean($element.parents("body").length);if(!isInDOM)return false;const isOutsideOpenPopup=this.isPopupOpen&&!this.popupStack?.lastItem[0]?.contains($element[0]);if(isOutsideOpenPopup)return null;const $branch=checkParents?$element.add($element.parents()):$element;const isNotVisible=$branch.toArray().some((item=>{const style=window.getComputedStyle(item);return style.display==="none"||style.visibility==="hidden"||item.getAttribute("aria-hidden")==="true"}));if(isNotVisible){return false}const hasReadableContent=!/^\s*$/.test($element.text())||!/^\s*$/.test($element.attr("aria-label")??"")||!/^\s*$/.test($element.attr("aria-labelledby")??"");const hasNativeFocusOrIsScreenReadable=($element.is(config._options._focusableElements)||$element.is(config._options._readableElements))&&hasReadableContent;if(hasNativeFocusOrIsScreenReadable){return true}const childNodes=$element[0].childNodes;for(let c=0,cl=childNodes.length;c<cl;c++){const childNode=childNodes[c];const isTextNode=childNode.nodeType===3;if(!isTextNode){continue}const isOnlyWhiteSpace=/^\s*$/.test(childNode.nodeValue);if(isOnlyWhiteSpace){continue}return true}return null}isFocusable($element,checkParents=true){const config=this.config;$element=$($element).first();if(!$element.is(config._options._focusForwardElementsExcludes))return null;return this.isReadable($element,checkParents)}isArrowable($element){const config=this.config;$element=$($element).first();return $element.is(config._options._arrowElements)}_findFirstForward($element,selector){$element=$($element).first();let iterator;switch(typeof selector){case"string":iterator=function($tag){return $tag.is(selector)||undefined};break;case"function":iterator=selector;break;case"undefined":iterator=Boolean}if($element.length===0){return $element.not("*")}let $found=this._findFirstForwardDescendant($element,iterator);if($found.length){return $found}$element.nextAll().toArray().some((sibling=>{const $sibling=$(sibling);const value=iterator($sibling);if(value===false){return false}if(value){$found=$sibling;return true}$found=this._findFirstForwardDescendant($sibling,iterator);return Boolean($found.length)}));if($found.length){return $found}$element.add($element.parents()).toArray().reverse().some((parent=>{const $parent=$(parent);if(iterator($parent)===false){return false}return $parent.nextAll().toArray().some((sibling=>{const $sibling=$(sibling);const value=iterator($sibling);if(value===false){return false}if(value){$found=$sibling;return true}$found=this._findFirstForwardDescendant($sibling,iterator);return Boolean($found.length)}))}));if(!$found.length){return $element.not("*")}return $found}_findFirstForwardDescendant($element,selector){$element=$($element).first();let iterator;switch(typeof selector){case"string":iterator=function($tag){return $tag.is(selector)||undefined};break;case"function":iterator=selector;break;case"undefined":iterator=Boolean}const $notFound=$element.not("*");if($element.length===0){return $notFound}const stack=[{item:$element[0],value:undefined}];let stackIndexPosition=0;let childIndexPosition=stackIndexPosition+1;do{const stackEntry=stack[stackIndexPosition];const $stackItem=$(stackEntry.item);switch(stackEntry.value){case true:return $stackItem;case false:return $notFound}$stackItem.children().toArray().forEach((item=>{const $item=$(item);const value=iterator($item);if(value===false){return}stack.splice(childIndexPosition++,0,{item:item,value:value})}));stackIndexPosition++;childIndexPosition=stackIndexPosition+1}while(stackIndexPosition<stack.length);return $notFound}focusNext($element,options){options=new FocusOptions(options);$element=$($element).first();$element=this.findFirstFocusable($element);this.focus($element,options);return this}focusFirst($element,options){options=new FocusOptions(options);$element=$($element).first();const isBodyFocus=$element[0]===document.body;if(isBodyFocus){this.focus(document.body,options);return}if(this.isReadable($element)){this.focus($element,options);return $element}$element=this.findFirstFocusable($element);this.focus($element,options);return $element}focus($element,options){options=new FocusOptions(options);$element=$($element).first();const config=this.config;if(!config._isEnabled||!config._options._isFocusAssignmentEnabled||$element.length===0){return this}const isBodyFocus=$element[0]===document.body;if(isBodyFocus){this._topOfContentObject.goto();return}const perform=()=>{if($element.attr("tabindex")===undefined){$element.attr({tabindex:"0","data-a11y-force-focus":"true"})}if(options.preventScroll){const y=$(window).scrollTop();try{this._isForcedFocus=true;$element[0].focus({preventScroll:true});this._isForcedFocus=false}catch(e){}switch(device$1.browser){case"internet explorer":case"microsoft edge":case"safari":window.scrollTo(null,y)}}else{this._isForcedFocus=true;$element[0].focus();this._isForcedFocus=false}};if(options.defer){_.defer(perform)}else{perform()}return this}gotoPreviousActiveElement(){if(!this.previousActiveElement)return a11y.focusFirst(Adapt$1.navigation);a11y.focusFirst(this.previousActiveElement)}get isForcedFocus(){return this._isForcedFocus}normalize(htmls){htmls=[...arguments].filter(Boolean).filter(_.isString).join(" ");const text=$("<div>"+htmls+"</div>").text();return text.replace(this._htmlCharRegex,"")}removeBreaks(htmls){htmls=[...arguments].filter(Boolean).filter(_.isString).join(" ");const $div=$("<div>"+htmls+"</div>");const stack=[$div[0]];let stackIndex=0;const outputs=[];do{if(stack[stackIndex].childNodes.length){const nodes=stack[stackIndex].childNodes;const usable=nodes.filter((node=>{const isTextNode=node.nodeType===3;if(isTextNode){return true}const isStyleElement=$(node).is(this.config._options._wrapStyleElements);if(isStyleElement){return true}return false}));outputs.push.apply(outputs,usable);stack.push.apply(stack,nodes)}stackIndex++}while(stackIndex<stack.length);let rtnText="";outputs.forEach((function(item){rtnText+=item.outerHTML||item.textContent}));return rtnText}scrollEnable($elements){this._scroll.enable($elements);return this}scrollDisable($elements){this._scroll.disable($elements);return this}popupOpened($popupElement){this._popup.opened($popupElement);return this}popupClosed($focusElement){this._popup.closed($focusElement);return this}setPopupCloseTo($focusElement){return this._popup.setCloseTo($focusElement)}get isPopupOpen(){return this._popup.isOpen}get popupStack(){return this._popup.stack}}const a11y=new A11y;var a11y$1=__AMD("core/js/a11y",a11y);async function transitionNextFrame(){return new Promise((resolve=>requestAnimationFrame(resolve)))}async function transitionsEnded($element,property=null){$element=$($element).first();if(!willTransition($element,property))return false;const longestEndTime=getTransitionsLongestEndTime($element,property);const buffer=100;const timeoutDuration=longestEndTime+buffer;return new Promise((resolve=>{const onRun=()=>clearTimeout(resolveInterval);const onEnd=()=>{if(hasActiveTransition($element,property))return;done(true)};const done=didTransition=>{clearTimeout(resolveInterval);$element.off("transitionrun",onRun).off("transitioncancel transitionend",onEnd);resolve(didTransition)};$element.on("transitionrun",onRun).on("transitioncancel transitionend",onEnd);const resolveInterval=setTimeout((()=>{logging$1.warn("transition could/did not run, forcing resolution",$element[0]);if(hasActiveTransition($element,property))return;done(false)}),timeoutDuration)}))}function getTransitionsLongestEndTime($element,property=null){$element=$($element);const properties=$element.css("transition-property").split(",").map((property=>property.trim()));const durations=$element.css("transition-duration").split(",").map((duration=>parseFloat(duration)));const delays=$element.css("transition-delay").split(",").map((delay=>parseFloat(delay)));const endTimes=properties.reduce(((result,transitionProperty,index)=>{const duration=durations[index%durations.length];const delay=delays[index%delays.length];const endTime=duration+delay;result[transitionProperty]=endTime;return result}),{});const isAllProperty=property==="all"||Boolean(endTimes.all);const longestEndTime=property&&!isAllProperty?endTimes[property]:Math.max(...Object.values(endTimes));return(longestEndTime??0)*1e3}function willTransition($element,property=null){if(hasActiveTransition($element,property))return true;return getTransitionsLongestEndTime($element,property)>0}function hasActiveTransition($element,property=null){const element=$($element)[0];let transitions=element.getAnimations().filter((animation=>animation instanceof window.CSSTransition));if(property)transitions=transitions.filter((({transitionProperty:transitionProperty})=>transitionProperty===property));return Boolean(transitions.length)}__AMD("core/js/transitions",{transitionsEnded:transitionsEnded,getTransitionsLongestEndTime:getTransitionsLongestEndTime,willTransition:willTransition,hasActiveTransition:hasActiveTransition});class ShadowView extends Backbone__default["default"].View{className(){return"shadow js-shadow u-display-none"}attributes(){return{id:"shadow"}}initialize(){this._isOpen=false;this.disableAnimation=Adapt$1.config.get("_disableAnimation")??false;this.$el.toggleClass("disable-animation",Boolean(this.disableAnimation));this.render()}render(){const template=Handlebars.templates.shadow;this.$el.html(template({_globals:Adapt$1.course.get("_globals")}));return this}get isOpen(){return this._isOpen}async showShadow(){this._isOpen=true;this.$el.addClass("anim-show-before");await transitionNextFrame();this.$el.removeClass("u-display-none");await transitionNextFrame();this.$el.addClass("anim-show-after");await transitionsEnded(this.$el)}async hideShadow(){this._isOpen=false;this.$el.addClass("anim-hide-before");await transitionNextFrame();this.$el.addClass("anim-hide-after");await transitionsEnded(this.$el);this.$el.addClass("u-display-none");await transitionNextFrame();this.$el.removeClass("anim-open-before anim-open-after anim-hide-before anim-hide-after")}}var ShadowView$1=__AMD("core/js/views/ShadowView",ShadowView);class Shadow extends Backbone__default["default"].Controller{initialize(){this.listenTo(Adapt$1,{"adapt:start":this.onAdaptStart})}onAdaptStart(){this._shadowView=new ShadowView$1;this._shadowView.$el.prependTo("body")}get isOpen(){return this._shadowView?.isOpen??false}async show(){return this._shadowView?.showShadow()}async hide(){return this._shadowView?.hideShadow()}remove(){this._shadowView?.remove();this._shadowView=null}}var shadow=__AMD("core/js/shadow",new Shadow);class DrawerItemView extends Backbone.View{className(){return"drawer__menu drawer__item"}attributes(){return{role:"listitem"}}initialize(){this.listenTo(Adapt$1,"drawer:empty",this.remove);this.render()}events(){return{"click .drawer__item-btn":"onDrawerItemClicked"}}render(){const data=this.model.toJSON();const template=Handlebars.templates.drawerItem;$(this.el).html(template(data)).appendTo(".drawer__holder");return this}onDrawerItemClicked(event){event.preventDefault();const eventCallback=this.model.get("eventCallback");Adapt$1.trigger(eventCallback)}}DrawerItemView.type="drawerItem";var DrawerItemView$1=__AMD("core/js/views/drawerItemView",DrawerItemView);class DrawerView extends Backbone__default["default"].View{tagName(){return"dialog"}className(){return["drawer","u-display-none"].filter(Boolean).join(" ")}attributes(){return{"aria-modal":"true","aria-labelledby":"drawer-heading","aria-hidden":"true"}}events(){return{"click .drawer__back":"onBackButtonClicked","click .drawer__close":"onCloseClicked"}}initialize(){_.bindAll(this,"onShadowClicked");this._isVisible=false;this.disableAnimation=Adapt$1.config.get("_disableAnimation")??false;this.$el.toggleClass("disable-animation",Boolean(this.disableAnimation));this._globalDrawerPosition=this.config?._position??"auto";const drawerDuration=this.config?._duration??400;let showEasing=this.config?._showEasing||"easeOutQuart";let hideEasing=this.config?._hideEasing||"easeInQuart";showEasing=showEasing.toLowerCase();hideEasing=hideEasing.toLowerCase();if(showEasing.includes("elastic")){logging$1.removed("drawer show elastic easing is replaced with quint");showEasing=showEasing.replace("elastic","quint")}if(showEasing.includes("bounce")){logging$1.removed("drawer show bounce easing is replaced with back");showEasing=showEasing.replace("bounce","back")}if(hideEasing.includes("elastic")){logging$1.removed("drawer hide elastic easing is replaced with quint");hideEasing=hideEasing.replace("elastic","quint")}if(hideEasing.includes("bounce")){logging$1.removed("drawer hide bounce easing is replaced with back");hideEasing=hideEasing.replace("bounce","back")}const documentElementStyle=document.documentElement.style;documentElementStyle.setProperty("--adapt-drawer-duration",`${drawerDuration}ms`);documentElementStyle.setProperty("--adapt-drawer-show-easing",`var(--adapt-cubic-bezier-${showEasing})`);documentElementStyle.setProperty("--adapt-drawer-hide-easing",`var(--adapt-cubic-bezier-${hideEasing})`);this.setupEventListeners();this.render()}get config(){return Adapt$1.config.get("_drawer")}setupEventListeners(){this.onKeyDown=this.onKeyDown.bind(this);$(window).on("keydown",this.onKeyDown);this.el.addEventListener("mousedown",this.onShadowClicked,{capture:true})}onKeyDown(event){if(event.which!==27)return;event.preventDefault();this.hideDrawer()}onShadowClicked(event){const dialog=this.el;const rect=dialog.getBoundingClientRect();const isInDialog=rect.top<=event.clientY&&event.clientY<=rect.top+rect.height&&rect.left<=event.clientX&&event.clientX<=rect.left+rect.width;if(isInDialog)return;event.preventDefault();this.hideDrawer()}render(){const template=Handlebars.templates.drawer;this.$el.html(template({_globals:Adapt$1.course.get("_globals")}));_.defer(this.postRender.bind(this));return this}postRender(){this.checkIfDrawerIsAvailable()}setDrawerPosition(position){if(this._useMenuPosition)position=null;const isGlobalPositionAuto=this._globalDrawerPosition==="auto";const isRTL=Adapt$1.config.get("_defaultDirection")==="rtl";if(position&&isGlobalPositionAuto&&isRTL)position=position==="left"?"right":"left";if(!isGlobalPositionAuto||!position)position=this._globalDrawerPosition;this.$el.removeClass(`is-position-${this.drawerPosition}`).addClass(`is-position-${position}`);this.drawerPosition=position}openCustomView(view,hasBackButton=true,position){this.$(".js-drawer-holder").removeAttr("role");this._hasBackButton=hasBackButton;this._isCustomViewVisible=true;this._customView=view;Adapt$1.trigger("drawer:empty");this.showDrawer(null,position);this.$(".drawer__holder").html(view instanceof Backbone__default["default"].View?view.$el:view)}checkIfDrawerIsAvailable(){const isEmptyDrawer=this.collection.length===0;$(".js-nav-drawer-btn").toggleClass("u-display-none",isEmptyDrawer);if(isEmptyDrawer){Adapt$1.trigger("drawer:noItems")}}onBackButtonClicked(event){event.preventDefault();this.showDrawer(true)}onCloseClicked(event){event.preventDefault();this.hideDrawer()}get isOpen(){return this._isVisible&&this._isCustomViewVisible===false}async showDrawer(emptyDrawer,position=null){shadow.show();this.setDrawerPosition(position);this.$el.removeClass("u-display-none").attr("aria-hidden","false");if(!this._isVisible){a11y$1.popupOpened(this.$el);a11y$1.scrollDisable("body");this._isVisible=true}if(emptyDrawer){this.$(".drawer__back").addClass("u-display-none");this._isCustomViewVisible=false;this.emptyDrawer();if(this.collection.models.length===1){Adapt$1.trigger(this.collection.models[0].get("eventCallback"));this._isCustomViewVisible=false}else{this._useMenuPosition=true;this.renderItems();Adapt$1.trigger("drawer:openedItemView")}}else{const hideDrawerBackButton=!this._hasBackButton||this.collection.models.length<=1;this.$(".drawer__back").toggleClass("u-display-none",hideDrawerBackButton);Adapt$1.trigger("drawer:openedCustomView")}$(".js-drawer-holder").scrollTop(0);Adapt$1.trigger("drawer:opened");this.$el.addClass("anim-show-before");a11y$1.focusFirst(this.$el,{defer:true});await transitionNextFrame();this.$el.addClass("anim-show-after");await transitionsEnded(this.$el)}emptyDrawer(){this.$(".drawer__holder").empty()}renderItems(){Adapt$1.trigger("drawer:empty");this.emptyDrawer();const isList=this.collection.length>1;if(isList)this.$(".js-drawer-holder").attr("role","list");else this.$(".js-drawer-holder").removeAttr("role");this.collection.forEach((model=>new DrawerItemView$1({model:model})))}async hideDrawer($toElement,{force:force=false}={}){if(!this._isVisible)return;this._useMenuPosition=false;this.$el.css("display","block");a11y$1.popupClosed($toElement);this._isCustomViewVisible=false;shadow.hide();this.$el.addClass("anim-hide-before");if(!force)await transitionNextFrame();this.$el.addClass("anim-hide-after");if(!force)await transitionsEnded(this.$el);this._customView=null;Adapt$1.trigger("drawer:closed");this._isVisible=false;a11y$1.scrollEnable("body");this.$(".js-drawer-holder").removeAttr("role");this.$el.removeClass("anim-show-before anim-show-after anim-hide-before anim-hide-after");this.$el.removeAttr("style").addClass("u-display-none").attr("aria-hidden","true");this.setDrawerPosition(this._globalDrawerPosition)}remove(){this.hideDrawer(null,{force:true});super.remove();this.el.removeEventListener("mousedown",this.onShadowClicked,{capture:true});$(window).off("keydown",this.onKeyDown);Adapt$1.trigger("drawer:empty");this.collection.reset()}}Object.assign(DrawerView,{childContainer:".js-drawer-holder",childView:DrawerItemView$1});var DrawerView$1=__AMD("core/js/views/drawerView",DrawerView);var TemplateRenderEvent=__AMD("core/js/templateRenderEvent",class TemplateRenderEvent{constructor(type,name,mode,value,args){this.type=type;this.name=name;this.mode=mode;this.value=value;this.args=args}});var register=__AMD("core/js/reactHelpers",(function register(name,component){templates[name]=(...args)=>{const mode="reactTemplate";const preRenderEvent=new TemplateRenderEvent(`${mode}:preRender`,name,mode,null,args);Adapt$1.trigger(preRenderEvent.type,preRenderEvent);const value=component(...preRenderEvent.args);const postRenderEvent=new TemplateRenderEvent(`${mode}:postRender`,name,mode,value,preRenderEvent.args);Adapt$1.trigger(postRenderEvent.type,postRenderEvent);return postRenderEvent.value}}));(function(){const original=React__default["default"].createElement;React__default["default"].createElement=(...args)=>{const name=args[0];const mode="reactElement";const preRenderEvent=new TemplateRenderEvent(`${mode}:preRender`,name,mode,null,args);Adapt$1.trigger(preRenderEvent.type,preRenderEvent);const value=original(...preRenderEvent.args);const postRenderEvent=new TemplateRenderEvent(`${mode}:postRender`,name,mode,value,preRenderEvent.args);Adapt$1.trigger(postRenderEvent.type,postRenderEvent);return postRenderEvent.value}})();const templates={};function compile(template,...args){const output=Handlebars.compile(template)(...args);return output}function classes(...args){return _.uniq(_.flatten(args).filter(Boolean).join(" ").split(" ")).join(" ")}function prefixClasses(prefixes,...args){const classes=_.flatten(args).filter(Boolean);const prefixed=_.flatten(prefixes.map((prefix=>classes.map((className=>`${prefix}${className}`)))));return _.uniq(prefixed.join(" ").split(" ")).join(" ")}const FIRST_PASS=1;const SECOND_PASS=2;const THIRD_PASS=3;var TooltipItemView=__AMD("core/js/views/TooltipItemView",class TooltipItemView extends Backbone.View{className(){return["tooltip",this.model.get("isTargetFixedPosition")&&"is-fixed",this.isStatic&&"is-static",this.model.get("tooltipClasses")||"is-vertical-axis is-arrow-middle is-bottom is-middle",this.model.get("isShown")&&"is-shown",this.model.get("wasShown")&&"was-shown",this.model.get("_classes")].filter(Boolean).join(" ")}attributes(){return{id:`tooltip-${this.model.get("_id")}`,style:Object.entries(this.model.get("tooltipStyles")??{}).map((([name,value])=>`${name}: ${value};`)).join(" ")}}updateViewProperties(){const classesToAdd=_.result(this,"className").trim().split(/\s+/);classesToAdd.forEach((i=>this._classSet.add(i)));const classesToRemove=[...this._classSet].filter((i=>!classesToAdd.includes(i)));classesToRemove.forEach((i=>this._classSet.delete(i)));this._setAttributes({..._.result(this,"attributes"),id:_.result(this,"id")});this.$el.removeClass(classesToRemove).addClass(classesToAdd)}initialize({$target:$target,parent:parent}){_.bindAll(this,"onDeviceResize","onMouseOut","doSubsequentPasses");this.changed=_.throttle(this.changed.bind(this),34);this._classSet=new Set(_.result(this,"className").trim().split(/\s+/));this.$target=$target;this.parent=parent;this.$target.attr("aria-describedby",`tooltip-${this.model.get("_id")}`);this.listenTo(this.model,"change",this.changed);this.listenTo(Adapt$1,{"contentObjectView:ready":this.changed,"view:animationStart":this.changed,"device:resize":this.onDeviceResize});this.listenTo(Adapt$1.parentView,"preRemove",this.remove);if(!this.isStatic){$(document).on("mouseleave blur","[data-tooltip-id]",this.onMouseOut)}this.unchangedRenders=0;this.changed()}applyStaticScrollOffset(rect){if(!rect)return rect;const scrollTop=$(window).scrollTop();return{left:rect.left,right:rect.right,width:rect.width,height:rect.height,x:rect.x,top:rect.top+scrollTop,bottom:rect.bottom+scrollTop,y:rect.y+scrollTop}}get environment(){const navigationAlignment=Adapt$1.course.get("_navigation")?._navigationAlignment??"top";const navHeight=$(".nav").outerHeight(true);const $target=this.$target;const{offset:offset,distance:distance,viewPortPadding:viewPortPadding,hasArrow:hasArrow,shouldOverrideOffset:shouldOverrideOffset,shouldOverrideDistance:shouldOverrideDistance,shouldOverrideArrow:shouldOverrideArrow}=fetchCSSVariables(this.el,{offset:this.model.get("_offset"),distance:this.model.get("_distance"),hasArrow:this.model.get("_hasArrow")});const arrowDOMReact=this.$(".tooltip__arrow")[0]?.getBoundingClientRect();const tooltipDOMRect=this.$(".tooltip__body")[0]?.getBoundingClientRect();const targetDOMRect=$target[0]?.getBoundingClientRect();return{position:this.model.get("_position")||"outside bottom middle right",offset:offset,distance:distance,viewPortPadding:viewPortPadding,hasArrow:hasArrow,shouldOverrideOffset:shouldOverrideOffset,shouldOverrideDistance:shouldOverrideDistance,shouldOverrideArrow:shouldOverrideArrow,isDisabled:$target.attr("aria-disabled")!==undefined||$target.hasClass("is-disabled")||$target.is(":disabled"),isStatic:this.isStatic,isTargetFixedPosition:Boolean(this.$target.add(this.$target.parents()).filter(((index,el)=>$(el).css("position")==="fixed")).length),isRTL:Adapt$1.config.get("_defaultDirection")==="rtl",topNavOffset:navigationAlignment==="top"?navHeight:0,bottomNavOffset:navigationAlignment==="bottom"?navHeight:0,targetDOMRect:this.isStatic?this.applyStaticScrollOffset(targetDOMRect):targetDOMRect,clientDOMRect:{width:parseInt(getComputedStyle(document.body).width),height:this.isStatic?parseInt(getComputedStyle(document.getElementById("app")).height):$("html")[0].clientHeight},tooltipDOMRect:this.isStatic?this.applyStaticScrollOffset(tooltipDOMRect):tooltipDOMRect,arrowDOMRect:this.isStatic?this.applyStaticScrollOffset(arrowDOMReact):arrowDOMReact,ariaHidden:document.activeElement===this.$target[0]||this.isStatic}}doFirstPass(){if(!this.model)return;this.model.set("isShown",false,{silent:true});const environment=this.environment;const positions=position(environment,{},FIRST_PASS);const{isDisabled:isDisabled,isStatic:isStatic,isTargetFixedPosition:isTargetFixedPosition,ariaHidden:ariaHidden}=environment;this.model.set({isDisabled:isDisabled,isStatic:isStatic,isTargetFixedPosition:isTargetFixedPosition,ariaHidden:ariaHidden,...positions},{silent:true});this.render()}doSubsequentPasses(){if(!this.model)return false;this.model.set("hasLoaded",true,{silent:true});const multipassCache={};for(let pass=SECOND_PASS,l=THIRD_PASS;pass<=l;pass++){const environment=this.environment;const positions=position(this.environment,multipassCache,pass);const{isDisabled:isDisabled,isStatic:isStatic,isTargetFixedPosition:isTargetFixedPosition,ariaHidden:ariaHidden}=environment;this.model.set({isDisabled:isDisabled,isStatic:isStatic,isTargetFixedPosition:isTargetFixedPosition,ariaHidden:ariaHidden,...positions},{silent:true});this.render()}this.model.set("isShown",true,{silent:true});this.render();this.model.set("wasShown",true,{silent:true});const endHash=JSON.stringify(this.model.get("tooltipStyles"));const hasChanged=this.startHash!==endHash;this.startHash=endHash;return hasChanged}render(){if(!this.model)return;const Template=templates.tooltip;this.model.set("ariaLabel",this.$target.attr("aria-label")||this.$target.find(".aria-label").text(),{silent:true});this.updateViewProperties();ReactDOM__default["default"].render(React__default["default"].createElement(Template,this.model.toJSON()),this.el)}changed(){if(!this.model)return;requestAnimationFrame((()=>{this.doFirstPass();const hasChanged=this.doSubsequentPasses();if(!hasChanged)this.unchangedRenders++;if(hasChanged)this.unchangedRenders=0;if(this.unchangedRenders>=34){this.unchangedRenders=0;return}this.changed()}))}get isStatic(){return Boolean(this.model.get("_isStatic"))}get isTargetPresent(){return Boolean(this.$target.parents("body").length)}onDeviceResize(){if(this.isStatic&&this.isTargetPresent)return this.changed();this.remove()}onMouseOut(){if(this.isStatic)return;this.remove()}remove(){if(this.$el.hasClass("test"))return;this.stopListening(Adapt$1);$(document).off("mouseleave blur","[data-tooltip-id]",this.onMouseOut);this.model?.set({isShown:false,wasShown:false});this.render();this.model=null;this.$target=null;if(this.$target)this.$target.removeAttr("aria-describedby");const rem=super.remove.bind(this);setTimeout((()=>{rem();this.parent.removeItem(this)}),1e3)}});function fetchCSSVariables(target,{offset:offset,distance:distance,hasArrow:hasArrow}){const computed=getComputedStyle(target);offset=offset<0?null:offset??null;distance=distance<0?null:distance??null;return{shouldOverrideOffset:offset!==null&&offset!==undefined&&offset!=="default",shouldOverrideDistance:distance!==null&&distance!==undefined&&distance!=="default",shouldOverrideArrow:hasArrow!==null&&hasArrow!==undefined,offset:lengthToPx("@tooltip-offset",offset??computed.getPropertyValue("--adapt-tooltip-offset")),distance:lengthToPx("@tooltip-distance",distance??computed.getPropertyValue("--adapt-tooltip-distance")),viewPortPadding:lengthToPx("@tooltip-viewport-padding",computed.getPropertyValue("--adapt-tooltip-viewport-padding")),hasArrow:hasArrow??computed.getPropertyValue("--adapt-tooltip-arrow")==="true"}}function lengthToPx(name,length){const unit=String(length).replaceAll(/[\d.]+/g,"").trim();const value=parseFloat(length);if(unit==="rem")return value*parseInt(getComputedStyle(document.body).fontSize);if(unit==="px"||unit==="")return value;throw new Error(`Cannot convert ${name} ${length} to pixels`)}function parseRelativePosition({position:position}){function fixConditions(positions,item1,item2,type){positions=positions.slice(0);const indexOf1=positions.indexOf(item1);const indexOf2=positions.indexOf(item2);let has1=indexOf1!==-1;let has2=indexOf2!==-1;let assume3=false;let specifiedAtIndex=null;if(has1&&has2){const isItem1=has1<has2;specifiedAtIndex=isItem1?indexOf1:indexOf2;has1=isItem1;has2=!isItem1}else if(has1){specifiedAtIndex=indexOf1}else if(has2){specifiedAtIndex=indexOf2}else{assume3=true}if(specifiedAtIndex!==null){positions[specifiedAtIndex]=type;positions=positions.filter(((item,index)=>{if(index<=specifiedAtIndex)return true;return item!==item1&&item!==item2}))}const hasSpecified=has1||has2;return[positions,has1,has2,assume3,hasSpecified,specifiedAtIndex]}position=position.toLowerCase().split(" ").filter(Boolean).join(" ");let positions=position.split(" ");let isArrowStart=null;let isArrowEnd=null;let isArrowMiddle=null;let isTop=null;let isCenter=null;let isBottom=null;let isLeft=null;let isMiddle=null;let isRight=null;let isOutside=null;let isInside=null;let isAreaAuto=null;let hasArrowSpecified=null;let hasVerticalSpecified=null;let verticalIndex=null;let hasHorizontalSpecified=null;let horizontalIndex=null;[positions,isOutside,isInside,isAreaAuto]=fixConditions(positions,"outside","inside","area");if(isAreaAuto)positions.unshift("area");[positions,isArrowStart,isArrowEnd,isArrowMiddle,hasArrowSpecified]=fixConditions(positions,"start","end","arrow");[positions,isTop,isBottom,isCenter,hasVerticalSpecified,verticalIndex]=fixConditions(positions,"top","bottom","vertical");[positions,isLeft,isRight,isMiddle,hasHorizontalSpecified,horizontalIndex]=fixConditions(positions,"left","right","horizontal");if(positions.length>4){positions.length=4}if(positions.length<4){const start=positions.length;positions.length=4;positions.fill("auto",start)}let specifiedCount=[hasArrowSpecified,hasHorizontalSpecified,hasVerticalSpecified].reduce(((sum,bool)=>sum+(bool?1:0)),0);let wasVerticalFilled=false;let wasHorizontalFilled=false;let wasArrowFilled=false;while(true){let isAuto=false;const indexOfMiddle=positions.indexOf("middle");const indexOfAuto=positions.indexOf("auto");const hasMiddleSpecified=indexOfMiddle!==-1;const hasAutoSpecified=indexOfAuto!==-1;let indexOf;let hasValue=false;if(hasMiddleSpecified&&hasAutoSpecified){isAuto=indexOfAuto<indexOfMiddle;indexOf=isAuto?indexOfAuto:indexOfMiddle;hasValue=true}else if(hasAutoSpecified){isAuto=true;indexOf=indexOfAuto;hasValue=true}else if(hasMiddleSpecified){isAuto=false;indexOf=indexOfMiddle;hasValue=true}if(!hasValue)break;const requiresHorizontal=!hasHorizontalSpecified&&!wasHorizontalFilled;const requiresVertical=!hasVerticalSpecified&&!wasVerticalFilled;const requiresArrow=!hasArrowSpecified&&!wasArrowFilled;const shouldArrow=requiresArrow&&(specifiedCount===1||specifiedCount===0||!requiresHorizontal&&!requiresVertical);const shouldHorizontal=!shouldArrow&&requiresHorizontal;const shouldVertical=!shouldHorizontal&&!shouldArrow&&requiresVertical;if(shouldHorizontal){positions[indexOf]="horizontal";if(isAuto)wasHorizontalFilled=true;else hasHorizontalSpecified=true;horizontalIndex=indexOf}else if(shouldArrow){positions[indexOf]="arrow";if(isAuto)wasArrowFilled=true;else hasArrowSpecified=true}else if(shouldVertical){positions[indexOf]="vertical";if(isAuto)wasVerticalFilled=true;else hasVerticalSpecified=true;verticalIndex=indexOf}if(!isAuto)specifiedCount+=1}const isVerticalAxis=verticalIndex<horizontalIndex;const isHorizontalAxis=horizontalIndex<verticalIndex;const isInsideMiddleCenter=isVerticalAxis&&isCenter||isHorizontalAxis&&isMiddle;if(isAreaAuto){isOutside=!isInsideMiddleCenter;isInside=!isOutside}if(isOutside&&isVerticalAxis&&isCenter){isTop=true;isCenter=false;logging$1.info(`tooltips: "${position}"(${positions.join(" ")}) is not a valid location, assuming side 'top'`)}else if(isOutside&&isHorizontalAxis&&isMiddle){isLeft=true;isMiddle=false;logging$1.info(`tooltips: "${position}"(${positions.join(" ")}) is not a valid location, assuming side 'left'`)}const shouldSensibleDefaults=specifiedCount===2;if(shouldSensibleDefaults){if(isOutside&&!hasArrowSpecified&&isVerticalAxis&&hasVerticalSpecified){isArrowMiddle=false;isArrowEnd=isRight;isArrowStart=!isArrowEnd}if(isOutside&&!hasArrowSpecified&&isHorizontalAxis&&hasHorizontalSpecified){isArrowMiddle=false;isArrowEnd=isBottom;isArrowStart=!isArrowEnd}if(isInside&&!hasArrowSpecified&&isVerticalAxis&&hasVerticalSpecified){isArrowMiddle=false;isArrowEnd=!isRight;isArrowStart=!isArrowEnd}if(isInside&&!hasArrowSpecified&&isHorizontalAxis&&hasHorizontalSpecified){isArrowMiddle=false;isArrowEnd=!isBottom;isArrowStart=!isArrowEnd}if(isOutside&&!hasHorizontalSpecified&&isVerticalAxis&&hasArrowSpecified&&!isArrowMiddle){isMiddle=false;isRight=!isArrowStart;isLeft=!isRight}if(isOutside&&!hasVerticalSpecified&&isHorizontalAxis&&hasArrowSpecified&&!isArrowMiddle){isCenter=false;isBottom=!isArrowStart;isTop=!isBottom}if(isInside&&!hasHorizontalSpecified&&isVerticalAxis&&hasArrowSpecified&&!isArrowMiddle){isMiddle=false;isRight=isArrowStart;isLeft=!isRight}if(isInside&&!hasVerticalSpecified&&isHorizontalAxis&&hasArrowSpecified&&!isArrowMiddle){isCenter=false;isBottom=isArrowStart;isTop=!isBottom}}return{isOutside:isOutside,isInside:isInside,isVerticalAxis:isVerticalAxis,isHorizontalAxis:isHorizontalAxis,isLeft:isLeft,isMiddle:isMiddle,isRight:isRight,isTop:isTop,isCenter:isCenter,isBottom:isBottom,isArrowStart:isArrowStart,isArrowMiddle:isArrowMiddle,isArrowEnd:isArrowEnd}}function convertToDistanceRect(DOMRect,clientDOMRect){return{top:DOMRect.top,left:DOMRect.left,right:clientDOMRect.width-DOMRect.right,bottom:clientDOMRect.height-DOMRect.bottom,width:DOMRect.width,height:DOMRect.height}}function invertRTL(bool,isRTL){if(!isRTL)return bool;return!bool}function constrainDimensions(distanceRect,viewPortPadding,isTargetFixedPosition,topNavOffset,bottomNavOffset){return{top:distanceRect.top-viewPortPadding-(isTargetFixedPosition?0:topNavOffset),left:distanceRect.left-viewPortPadding,right:distanceRect.right-viewPortPadding,bottom:distanceRect.bottom-viewPortPadding-(isTargetFixedPosition?0:bottomNavOffset),width:distanceRect.width,height:distanceRect.height}}function swapValues(a,b){return[b,a]}function calculateScrollOffset({isStatic:isStatic,isTargetFixedPosition:isTargetFixedPosition}){const scrollOffsetTop=isTargetFixedPosition||isStatic?0:$(window).scrollTop();const scrollOffsetLeft=isTargetFixedPosition||isStatic?0:$(window).scrollLeft();return{scrollOffsetLeft:scrollOffsetLeft,scrollOffsetTop:scrollOffsetTop}}function position({isStatic:isStatic,isTargetFixedPosition:isTargetFixedPosition,position:position,offset:offset,distance:distance,viewPortPadding:viewPortPadding,hasArrow:hasArrow,shouldOverrideOffset:shouldOverrideOffset,shouldOverrideDistance:shouldOverrideDistance,shouldOverrideArrow:shouldOverrideArrow,isRTL:isRTL,topNavOffset:topNavOffset,bottomNavOffset:bottomNavOffset,targetDOMRect:targetDOMRect,clientDOMRect:clientDOMRect,tooltipDOMRect:tooltipDOMRect,arrowDOMRect:arrowDOMRect}={},multipassCache,pass){const targetDistRect=convertToDistanceRect(targetDOMRect,clientDOMRect);const constrainedClientDistRect={width:clientDOMRect.width-viewPortPadding*2,height:clientDOMRect.height-viewPortPadding*2-(isTargetFixedPosition?0:topNavOffset+bottomNavOffset)};let{isOutside:isOutside,isInside:isInside,isVerticalAxis:isVerticalAxis,isHorizontalAxis:isHorizontalAxis,isLeft:isLeft,isMiddle:isMiddle,isRight:isRight,isFillWidth:isFillWidth=false,isTop:isTop,isCenter:isCenter,isBottom:isBottom,isFillHeight:isFillHeight=false,isArrowStart:isArrowStart,isArrowMiddle:isArrowMiddle,isArrowEnd:isArrowEnd}=parseRelativePosition({position:position});if(pass>=THIRD_PASS){({isOutside:isOutside,isInside:isInside,isVerticalAxis:isVerticalAxis,isHorizontalAxis:isHorizontalAxis,isLeft:isLeft,isMiddle:isMiddle,isRight:isRight,isFillWidth:isFillWidth=false,isTop:isTop,isCenter:isCenter,isBottom:isBottom,isFillHeight:isFillHeight=false}=multipassCache)}let isSnapTop=false;let isSnapLeft=false;let isSnapBottom=false;let isSnapRight=false;let isArrowSnap=false;const tooltipStyles={};if(pass>=SECOND_PASS){const tooltipDistRect=convertToDistanceRect(tooltipDOMRect,clientDOMRect);const arrowDistRect=convertToDistanceRect(arrowDOMRect,clientDOMRect);const constrainedTargetDistRect=constrainDimensions(targetDistRect,viewPortPadding,isTargetFixedPosition,topNavOffset,bottomNavOffset);const constrainedTooltipDistRect=constrainDimensions(tooltipDistRect,viewPortPadding,isTargetFixedPosition,topNavOffset,bottomNavOffset);const constrainedArrowDistRect=constrainDimensions(arrowDistRect,viewPortPadding,isTargetFixedPosition,topNavOffset,bottomNavOffset);const overallHeight=isOutside&&isVerticalAxis?constrainedTooltipDistRect.height+constrainedArrowDistRect.height+distance:constrainedTooltipDistRect.height;const overallWidth=isOutside&&isHorizontalAxis?constrainedTooltipDistRect.width+constrainedArrowDistRect.width+distance:constrainedTooltipDistRect.width;const isOverflowTop=constrainedTooltipDistRect.top<0;const isOverflowBottom=constrainedTooltipDistRect.bottom<0;const isOverflowLeft=constrainedTooltipDistRect.left<0;const isOverflowRight=constrainedTooltipDistRect.right<0;const isOverflowHorizontal=isOverflowLeft||isOverflowRight;const isOverflowVertical=isOverflowTop||isOverflowBottom;const isOverflow=isOverflowHorizontal||isOverflowVertical;const tooltipArea=overallHeight*overallWidth;const topArea=constrainedTargetDistRect.top*constrainedClientDistRect.width;const bottomArea=constrainedTargetDistRect.bottom*constrainedClientDistRect.width;const leftArea=constrainedTargetDistRect.left*constrainedClientDistRect.height;const rightArea=constrainedTargetDistRect.right*constrainedClientDistRect.height;const maxHorizontalArea=Math.max(leftArea,rightArea);const maxVerticalArea=Math.max(topArea,bottomArea);const isVerticalAreaLarger=maxVerticalArea>=maxHorizontalArea;const isHorizontalAreaLarger=maxHorizontalArea>=maxVerticalArea;const canFitWidthLength=isVerticalAxis?overallWidth<=constrainedClientDistRect.width:overallWidth<=constrainedTargetDistRect.left||overallWidth<=constrainedTargetDistRect.right;const canFitHeightLength=isHorizontalAxis?overallHeight<=constrainedClientDistRect.height:overallHeight<=constrainedTargetDistRect.top||overallHeight<=constrainedTargetDistRect.bottom;const canFitInLeftArea=tooltipArea<leftArea;const canFitInRightArea=tooltipArea<rightArea;const canFitInTopArea=tooltipArea<topArea;const canFitInBottomArea=tooltipArea<bottomArea;const canFitInVerticalArea=tooltipArea<maxVerticalArea;const canFitInHorizontalArea=tooltipArea<maxHorizontalArea;const isArrowOffscreen=isVerticalAxis&&(constrainedArrowDistRect.left<offset||constrainedArrowDistRect.right<offset)||isHorizontalAxis&&(constrainedArrowDistRect.top<offset||constrainedArrowDistRect.bottom<offset);const isBadShape=!canFitHeightLength||!canFitWidthLength;const isSwapAxis=isArrowOffscreen&&isHorizontalAxis&&isOverflowVertical||isArrowOffscreen&&isVerticalAxis&&isOverflowHorizontal||isHorizontalAxis&&!canFitInHorizontalArea&&isVerticalAreaLarger||isVerticalAxis&&!canFitInVerticalArea&&isHorizontalAreaLarger;const isFillArea=isSwapAxis&&isBadShape||isVerticalAxis&&isOverflow&&isBadShape&&(canFitInVerticalArea||isVerticalAreaLarger)||isHorizontalAxis&&isOverflow&&isBadShape&&(canFitInHorizontalArea||isHorizontalAreaLarger);if(pass===SECOND_PASS&&(isBadShape||isOverflow)){if(isSwapAxis){[isVerticalAxis,isHorizontalAxis]=swapValues(isVerticalAxis,isHorizontalAxis);if(isCenter){[isMiddle,isLeft,isRight]=[true,false,false];[isBottom,isTop,isCenter]=[true,false,false]}}if(isFillArea){if(isVerticalAxis)isFillWidth=true;if(isHorizontalAxis)isFillHeight=true}const isSwapVerticalSide=!(isHorizontalAxis&&canFitInHorizontalArea)&&(isFillArea&&!(isTop&&canFitInTopArea||isBottom&&canFitInBottomArea)||!isFillArea&&(isBottom&&isOverflowBottom||isTop&&isOverflowTop));if(isSwapVerticalSide&&isFillArea&&(canFitInTopArea||canFitInBottomArea)){isTop=!canFitInBottomArea;isBottom=canFitInBottomArea}else if(isSwapVerticalSide){isTop=constrainedTargetDistRect.top>=constrainedTargetDistRect.bottom;isBottom=constrainedTargetDistRect.top<constrainedTargetDistRect.bottom}const isSwapHorizontalSide=!(isVerticalAxis&&canFitInVerticalArea)&&(isFillArea&&!(isLeft&&canFitInLeftArea||isRight&&canFitInRightArea)||!isFillArea&&(isLeft&&isOverflowLeft||isRight&&isOverflowRight));if(isSwapHorizontalSide&&isFillArea&&(canFitInLeftArea||canFitInRightArea)){isLeft=invertRTL(!canFitInRightArea,isRTL);isRight=invertRTL(canFitInRightArea,isRTL)}else if(isSwapHorizontalSide){isLeft=invertRTL(constrainedTargetDistRect.left>=constrainedTargetDistRect.right,isRTL);isRight=invertRTL(constrainedTargetDistRect.left<constrainedTargetDistRect.right,isRTL)}else if(isSwapAxis){isLeft=invertRTL(isLeft,isRTL);isRight=invertRTL(isRight,isRTL)}if(isSwapVerticalSide||isSwapHorizontalSide||isSwapAxis){isMiddle=!isLeft&&!isRight;isCenter=!isTop&&!isBottom}}if(pass===THIRD_PASS){if(isVerticalAxis){isSnapLeft=isOverflowLeft;isSnapRight=!isSnapLeft&&isOverflowRight}if(isHorizontalAxis){isSnapTop=isOverflowTop;isSnapBottom=!isSnapTop&&isOverflowBottom}isArrowSnap=isArrowOffscreen}Object.assign(tooltipStyles,{"--adapt-tooltip-target-distancetoedge-left":`${constrainedTargetDistRect.left}px`,"--adapt-tooltip-target-distancetoedge-top":`${constrainedTargetDistRect.top}px`,"--adapt-tooltip-target-distancetoedge-right":`${constrainedTargetDistRect.right}px`,"--adapt-tooltip-target-distancetoedge-bottom":`${constrainedTargetDistRect.bottom}px`,"--adapt-tooltip-target-distancetoedge-height":`${constrainedTargetDistRect.height}px`,"--adapt-tooltip-target-distancetoedge-width":`${constrainedTargetDistRect.width}px`});if(pass>=2){Object.assign(multipassCache,{isOutside:isOutside,isInside:isInside,isVerticalAxis:isVerticalAxis,isHorizontalAxis:isHorizontalAxis,isLeft:isLeft,isMiddle:isMiddle,isRight:isRight,isFillWidth:isFillWidth,isTop:isTop,isCenter:isCenter,isBottom:isBottom,isFillHeight:isFillHeight})}}const tooltipClasses=[isOutside&&"is-outside",isInside&&"is-inside",isArrowSnap&&"is-arrow-snap",isVerticalAxis&&"is-vertical-axis",isHorizontalAxis&&"is-horizontal-axis",isLeft&&"is-left",isMiddle&&"is-middle",isRight&&"is-right",isFillWidth&&"is-fill-width",isSnapLeft&&"is-snap-left",isSnapRight&&"is-snap-right",isTop&&"is-top",isCenter&&"is-center",isBottom&&"is-bottom",isFillHeight&&"is-fill-height",isSnapTop&&"is-snap-top",isSnapBottom&&"is-snap-bottom",hasArrow&&"has-arrow",isArrowStart&&"is-arrow-start",isArrowMiddle&&"is-arrow-middle",isArrowEnd&&"is-arrow-end"].filter(Boolean).join(" ");const{scrollOffsetLeft:scrollOffsetLeft,scrollOffsetTop:scrollOffsetTop}=calculateScrollOffset({isStatic:isStatic,isTargetFixedPosition:isTargetFixedPosition});Object.assign(tooltipStyles,{"--adapt-tooltip-viewport-constrained-height":`${constrainedClientDistRect.height}px`,"--adapt-tooltip-viewport-constrained-width":`${constrainedClientDistRect.width}px`,"--adapt-tooltip-scroll-top":`${scrollOffsetTop}px`,"--adapt-tooltip-scroll-left":`${scrollOffsetLeft}px`,"--adapt-tooltip-target-position-top":`${targetDistRect.top}px`,"--adapt-tooltip-target-position-left":`${targetDistRect.left}px`,"--adapt-tooltip-target-position-width":`${targetDistRect.width}px`,"--adapt-tooltip-target-position-height":`${targetDistRect.height}px`});if(shouldOverrideOffset)tooltipStyles["--adapt-tooltip-offset"]=`${offset}px`;if(shouldOverrideDistance)tooltipStyles["--adapt-tooltip-distance"]=`${distance}px`;if(shouldOverrideArrow)tooltipStyles["--adapt-tooltip-arrow"]=String(hasArrow).toLowerCase();return{tooltipClasses:tooltipClasses,tooltipStyles:tooltipStyles}}var TooltipItemModel=__AMD("core/js/models/TooltipItemModel",class TooltipItemModel extends Backbone__default["default"].Model{defaults(){return{...Adapt$1.course.get("_tooltips")||{},_id:null,_isEnabled:true,_classes:"",disabledText:"{{text}}",text:""}}});class DOMElementModificationEventObject{constructor({type:type,target:target,changedAttributes:changedAttributes,previousAttributes:previousAttributes}={}){this.type=type;this.target=target;this.changedAttributes=changedAttributes;this.previousAttributes=previousAttributes}}class DOMElementModifications extends Backbone__default["default"].View{initialize({el:el=document.documentElement,watchImmediateChildrenOnly:watchImmediateChildrenOnly=true,watchAttributes:watchAttributes=false}={}){this._onMutation=this._onMutation.bind(this);this.el=el;this._watch={childList:true,subtree:!watchImmediateChildrenOnly,attributes:watchAttributes,attributeOldValue:watchAttributes}}startWatching(){this._calculateElementFilters();if(this._observer)return this;this._observer=new MutationObserver(this._onMutation);this._observer.observe(this.el,this._watch);return this}static calculateEventNames(eventNames){const firstEvent=eventNames[0];const isNew=firstEvent==="added";const lastRemovedIndex=eventNames.lastIndexOf("removed");const lastAddedIndex=eventNames.lastIndexOf("added");const hasReAdded=lastRemovedIndex!==-1&&lastAddedIndex!==-1&&lastRemovedIndex<lastAddedIndex;if(!isNew&&hasReAdded)return["changed"];const events=_.uniq([isNew&&"added",eventNames[eventNames.length-1]].filter(Boolean));return events}_onMutation(list){const reducedChanges=list.reduce(((changes,item)=>{let addedNodes=Array.from(item.addedNodes);let removedNodes=Array.from(item.removedNodes);const allNodes=[...addedNodes,...removedNodes];const isTextChange=allNodes.some((node=>node.nodeType===Node.TEXT_NODE));const isAttributeChange=this._watch.attributes&&item.type==="attributes";addedNodes=addedNodes.filter((node=>node.nodeType===Node.ELEMENT_NODE));removedNodes=removedNodes.filter((node=>node.nodeType===Node.ELEMENT_NODE));const isAddedEvent=Boolean(addedNodes.length);const isRemovedEvent=Boolean(removedNodes.length);const isChangedEvent=Boolean(isAttributeChange||isTextChange);if(!isAddedEvent&&!isRemovedEvent&&!isChangedEvent)return changes;const targetNodes=isChangedEvent?[item.target]:Array.from(isAddedEvent?addedNodes:removedNodes).flatMap((node=>this._watch.subtree?[node,...node.querySelectorAll("*")]:[node]));const eventName=isAddedEvent?"added":isRemovedEvent?"removed":"changed";targetNodes.forEach((target=>{const value=changes.get(target)??{eventNames:[],previousAttributes:this._watch.attributes?{}:null};value.eventNames.push(eventName);const shouldRecordAttribute=isChangedEvent&&item.attributeName;if(shouldRecordAttribute)value.previousAttributes[item.attributeName]??=item.oldValue;changes.set(target,value)}));return changes}),new Map);for(let[target,{eventNames:eventNames,previousAttributes:previousAttributes}]of reducedChanges.entries()){eventNames=DOMElementModifications.calculateEventNames(eventNames);eventNames.forEach((eventName=>{const isNodeAdded=eventName==="added";const isNodeRemoved=eventName==="removed";const selectorFilters=isNodeAdded?this._addedFilters:isNodeRemoved?this._removedFilters:this._changedFilters;if(!selectorFilters.length)return;const selectors=selectorFilters.map((filter=>filter(target))).filter(Boolean);if(!selectors.length)return;const changedAttributes=this._watch.attributes?Object.keys(previousAttributes).reduce(((attributes,attrName)=>{attributes[attrName]=target.getAttribute(attrName);return attributes}),{}):null;const EventObject=new DOMElementModificationEventObject({type:eventName,target:target,changedAttributes:changedAttributes,previousAttributes:previousAttributes});selectors.forEach((selector=>{if(selector&&selector!==true){if(eventName!=="changed")this.trigger(`${eventName}:${selector}`,EventObject);this.trigger(`changed:${selector}`,EventObject)}if(eventName!=="changed")this.trigger(`${eventName}`,EventObject);this.trigger("changed",EventObject)}))}))}}stopWatching(){this._calculateElementFilters();if(!this._observer)return this;this._observer.disconnect();this._observer=null;return this}_calculateElementFilters(){const selectorFilter=selector=>{const eventWithNoSelector=selector===undefined;if(eventWithNoSelector)return()=>true;if(Element.prototype.matches){return function(el){return el.matches(selector)&&selector}}return function(el){return $(el).is(selector)&&selector}};const eventNames=Object.keys(this._events);const eventNameParts=eventNames.map((name=>name.split(":")));const changedSelectors=eventNameParts.filter((parts=>parts[0]==="changed")).map((parts=>parts[1]));const addedSelectors=eventNameParts.filter((parts=>parts[0]==="added")).map((parts=>parts[1]));const removedSelectors=eventNameParts.filter((parts=>parts[0]==="removed")).map((parts=>parts[1]));this._changedFilters=changedSelectors.map(selectorFilter);this._addedFilters=addedSelectors.map(selectorFilter).concat(this._changedFilters);this._removedFilters=removedSelectors.map(selectorFilter).concat(this._changedFilters)}on(...args){const rtn=super.on(...args);if(this.shouldListen)this.startWatching();return rtn}once(...args){const rtn=super.once(...args);if(this.shouldListen)this.startWatching();return rtn}listenToOnce(...args){const rtn=super.listenToOnce(...args);if(this.shouldListen)this.startWatching();return rtn}off(...args){const rtn=super.off(...args);if(!this.shouldListen)this.stopWatching();return rtn}stopListening(...args){const rtn=super.stopListening(...args);if(!this.shouldListen)this.stopWatching();return rtn}get shouldListen(){return Boolean(Object.keys(this._events).length||Object.keys(this._listeners).length)}}const documentModifications=new DOMElementModifications({el:document.documentElement,watchImmediateChildrenOnly:false,watchAttributes:true});documentModifications.DOMElementModifications=DOMElementModifications;var documentModifications$1=__AMD("core/js/DOMElementModifications",documentModifications);var TooltipView=__AMD("core/js/views/TooltipView",class TooltipView extends Backbone.View{className(){return"tooltip__container"}attributes(){return{role:"region","aria-live":"assertive"}}initialize(){_.bindAll(this,"onMouseOver","onKeyDown","onMouseOut","onClick");this._tooltipData={};this._tooltips=[];this.listenToOnce(Adapt$1,"adapt:preInitialize",this.onAdaptPreInitialize);this.listenTo(documentModifications$1,"added:[data-tooltip-id]",this.onAdded);this.render()}onAdaptPreInitialize(){if(this.config?._isEnabled===false)return;this.onMouseOver=_.debounce(this.onMouseOver,500);$(document).on("keydown",this.onKeyDown);$(document).on("focus","[data-tooltip-id]",((...args)=>{if(a11y$1.isForcedFocus)return;this.onMouseOver(...args)}));$(document).on("mouseenter","[data-tooltip-id]",this.onMouseOver);$(document).on("mouseleave blur","[data-tooltip-id]",this.onMouseOut);$(document).on("click","[data-tooltip-id]",this.onClick)}get config(){return{_position:"outside bottom middle right",...Adapt$1.course.get("_tooltips")}}onKeyDown(event){if(event.key!=="Escape")return;this.hide()}onMouseOver(event){const $mouseoverEl=$(event.currentTarget);if(!a11y$1.isFocusable($mouseoverEl))return;const id=$mouseoverEl.data("tooltip-id");if(this._currentId===id&&event.name==="focusin")return;this._currentId=id;const tooltip=this.getTooltip(id);if(tooltip?.get("_isStatic"))return;if(!tooltip?.get("_isEnabled"))return this.hide();if(event.ctrlKey&&this.config._allowTest){this.showTest(tooltip,$mouseoverEl)}else{this.show(tooltip,$mouseoverEl)}}onAdded(event){const $addedEl=$(event.target);const id=$addedEl.data("tooltip-id");const tooltip=this.getTooltip(id);if(!tooltip?.get("_isEnabled")||!tooltip?.get("_isStatic"))return;_.defer((()=>this.show(tooltip,$addedEl)))}onMouseOut(){this.onMouseOver.cancel()}onClick(){this.hide()}render(){this.$el.appendTo("body")}show(tooltip,$mouseoverEl){if(this.isShowing(tooltip))return;const tooltipItem=new TooltipItemView({model:tooltip,$target:$mouseoverEl,parent:this});if(!tooltip?.get("_isStatic")){this._tooltips.push(tooltipItem)}this.$el.append(tooltipItem.$el)}isShowing(tooltip){const id=tooltip.get("_id");return this._tooltips.some((tooltipView=>tooltipView.model?.get("_id")===id))}hide(tooltipItem=null){tooltipItem=tooltipItem??this._tooltips.pop();this.removeItem(tooltipItem);if(!tooltipItem)return;tooltipItem.remove()}removeItem(tooltipItem){const currentIndex=this._tooltips.findIndex((item=>tooltipItem===item));if(currentIndex===-1)return;this._tooltips.splice(currentIndex,1)}register(tooltipData){if(!tooltipData._id)return logging$1.warn("Tooltip cannot be registered with no id");this._tooltipData[tooltipData._id]=new TooltipItemModel(tooltipData);return this._tooltipData[tooltipData._id]}getTooltip(id){return this._tooltipData[id]}showTest(tooltip,$target){const produce=parts=>{const lastIndex=parts.length-1;const partIndex=new Array(parts.length).fill(0);const tooltips=[];const json=tooltip.toJSON();while(true){const position=parts.map(((part,index)=>part[partIndex[index]])).join(" ");tooltips.push(new TooltipItemModel({...json,disabledText:`D ${position}`,text:`T ${position}`,_position:position,_classes:"test"}));for(let i=lastIndex;i>=0;i--){partIndex[i]+=1;if(partIndex[i]<parts[i].length)break;if(i===0)break;partIndex[i]=0}if(partIndex[0]>=parts[0].length)break}tooltips.forEach((model=>{const tooltipItem=new TooltipItemView({model:model,$target:$target,parent:this});this._tooltips.push(tooltipItem);this.$el.append(tooltipItem.$el)}))};const areaOutside=["outside"];const areaInside=["inside"];const arrowPosition=["middle","start","end",""];const vertical=["middle","top","bottom",""];const horizontal=["middle","right","left",""];const partsVertical=[areaOutside,vertical,arrowPosition,horizontal];const partsHorizontal=[areaOutside,horizontal,arrowPosition,vertical];const partsVerticalInside=[areaInside,vertical,arrowPosition,horizontal];const partsHorizontalInside=[areaInside,horizontal,arrowPosition,vertical];produce(partsVertical);produce(partsHorizontal);produce(partsVerticalInside);produce(partsHorizontalInside)}});const tooltips=new TooltipView;var tooltips$1=__AMD("core/js/tooltips",tooltips);const DrawerCollection=new Backbone__default["default"].Collection(null,{comparator:"drawerOrder"});class Drawer extends Backbone__default["default"].Controller{initialize(){this.listenTo(Adapt$1,{"adapt:start":this.onAdaptStart,"app:languageChanged":this.onLanguageChanged,"navigation:toggleDrawer":this.toggle,"router:navigate":this.close})}onAdaptStart(){this._drawerView=new DrawerView$1({collection:DrawerCollection});this._drawerView.$el.insertAfter("#shadow")}onLanguageChanged(){tooltips$1.register({_id:"drawer",...Adapt$1.course.get("_globals")?._extensions?._drawer?._navTooltip||{}});this.remove()}toggle(){this.isOpen?this.close():this.open()}get isOpen(){return this._drawerView?.isOpen??false}open(){this._drawerView?.showDrawer(true)}openCustomView(view,hasBackButton,position){this._drawerView?.openCustomView(view,hasBackButton,position)}addItem(drawerObject,eventCallback){if(this.hasItem(eventCallback)){DrawerCollection.remove(DrawerCollection.find((item=>item.eventCallback===eventCallback)))}drawerObject.eventCallback=eventCallback;DrawerCollection.add(drawerObject)}hasItem(eventCallback){return Boolean(DrawerCollection.find((item=>item.eventCallback===eventCallback)))}close($toElement=null){this._drawerView?.hideDrawer($toElement,{force:true})}remove(){this._drawerView?.remove();this._drawerView=null}}var drawer=__AMD("core/js/drawer",new Drawer);var AdaptSubsetCollection=__AMD("core/js/collections/adaptSubsetCollection",class AdaptSubsetCollection extends AdaptCollection{initialize(models,options){super.initialize(models,options);this.parent=options.parent;this.listenTo(this.parent,"reset",this.loadSubset)}loadSubset(){this.set(this.parent.filter((model=>model instanceof this.model)));this._byAdaptID=this.groupBy("_id")}});var ModelEvent=__AMD("core/js/modelEvent",class ModelEvent extends Backbone.Controller{initialize(type,target,value){this.type=type;this.target=target;this.value=value;this.canBubble=true;this.deepPath=[target];this.timeStamp=null}stopPropagation(){this.canBubble=false}addPath(target){this.deepPath.unshift(target)}});function toggleModelClass(model,className,hasClass){const currentClassNames=(model.get("_classes")||"").split(" ").filter(Boolean);const classesObject=currentClassNames.reduce(((classesObject,className)=>({...classesObject,[className]:true})),{});const shouldToggleExisting=hasClass===null||hasClass===undefined;className.split(" ").filter(Boolean).forEach((className=>{classesObject[className]=shouldToggleExisting?!classesObject[className]:Boolean(hasClass)}));const outputClasses=Object.entries(classesObject).filter((([,hasClass])=>hasClass)).map((([className])=>className)).join(" ");model.set("_classes",outputClasses)}var AdaptModel=__AMD("core/js/models/adaptModel",class AdaptModel extends LockingModel{toJSON(){const json={...this.attributes};delete json._children;delete json._parent;return $.extend(true,{},json)}get(name){switch(name){case"_parent":case"_children":logging$1.deprecated("Use model.getChildren() or model.getParent() instead of model.get('_children') or model.get('_parent')")}return super.get(name)}defaults(){return{_canShowFeedback:true,_classes:"",_canReset:true,_canRequestChild:false,_isComplete:false,_isInteractionComplete:false,_isA11yRegionEnabled:false,_isA11yCompletionDescriptionEnabled:true,_requireCompletionOf:-1,_isEnabled:true,_isResetOnRevisit:false,_isAvailable:true,_isOptional:false,_isRendered:false,_isReady:false,_isVisible:true,_isVisited:false,_isLocked:false,_isHidden:false}}lockedAttributes(){return{_isLocked:true}}get trackingPosition(){const firstDescendant=this.getAllDescendantModels(false).concat([this])[0];const nearestTrackingIdModel=[firstDescendant].concat(firstDescendant.getAncestorModels()).find((model=>model.has("_trackingId")));if(!nearestTrackingIdModel)return;const trackingId=nearestTrackingIdModel.get("_trackingId");let trackingIdDescendants=[nearestTrackingIdModel].concat(nearestTrackingIdModel.getAllDescendantModels(true));trackingIdDescendants=trackingIdDescendants.filter((model=>!(model.isTypeGroup("component")&&model.get("_isTrackable")===false)));const indexInTrackingIdDescendants=trackingIdDescendants.findIndex((descendant=>descendant===this));if(indexInTrackingIdDescendants>=0){return[trackingId,indexInTrackingIdDescendants]}const trackingIdAncestors=nearestTrackingIdModel.getAncestorModels();const ancestorDistance=trackingIdAncestors.findIndex((ancestor=>ancestor===this));return[trackingId,-(ancestorDistance+1)]}parse(data){if(data._isResetOnRevisit==="false"){data._isResetOnRevisit=false}return data}trackable(){return["_id","_isComplete","_isInteractionComplete","_isVisited"]}trackableType(){return[String,Boolean,Boolean,Boolean]}bubblingEvents(){return["change:_isComplete","change:_isInteractionComplete","change:_isActive","change:_isVisited"]}toggleClass(className,hasClass){toggleModelClass(this,className,hasClass);return this}setupModel(){if(this.hasManagedChildren){this.setupChildListeners()}this.init();_.defer((()=>{if(this.hasManagedChildren){this.checkCompletionStatus();this.checkInteractionCompletionStatus();this.checkLocking();this.checkVisitedStatus()}this.setupTrackables()}))}setupTrackables(){const originalTrackableStateFunction=this.triggerTrackableState;this.triggerTrackableState=_.compose((()=>{this.triggerTrackableState.isQueued=true}),_.debounce((()=>{originalTrackableStateFunction.apply(this);this.triggerTrackableState.isQueued=false}),17));this.listenTo(this,"change",(({changed:changed})=>{if(this.triggerTrackableState.isQueued||!Adapt$1.attributes._isStarted){return}const trackablePropertyNames=_.result(this,"trackable",[]);const changedPropertyNames=Object.keys(changed);const isTrackable=changedPropertyNames.find((item=>trackablePropertyNames.includes(item)));if(isTrackable){this.triggerTrackableState()}}))}setupChildListeners(){const children=this.getChildren();if(!children.length){return}this.listenTo(children,{all:this.onAll,bubble:this.bubble,"change:_isVisited":this.checkVisitedStatus,"change:_isReady":this.checkReadyStatus,"change:_isComplete":this.onIsComplete,"change:_isInteractionComplete":this.checkInteractionCompletionStatus})}init(){}getTrackableState(){const trackable=this.resultExtend("trackable",[]);const json=this.toJSON();const args=trackable;args.unshift(json);return _.pick(...args)}setTrackableState(state){const trackable=this.resultExtend("trackable",[]);const args=trackable;args.unshift(state);state=_.pick(...args);this.set(state);return this}triggerTrackableState(){Adapt$1.trigger("state:change",this,this.getTrackableState())}reset(type="hard",canReset=this.get("_canReset")){if(!canReset)return false;const isHardReset=type==="hard"||type===true;const isSoftReset=type==="soft";if(!isHardReset&&!isSoftReset)return false;const resetData={_isEnabled:true,_isInteractionComplete:false};if(isHardReset)resetData._isComplete=false;this.set(resetData);this.trigger("reset");return true}checkReadyStatus(model,value){if(value===false){return false}const children=this.getAvailableChildModels();if(children.find((child=>child.get("_isReady")===false&&child.get("_isRendered")))){return false}this.set("_isReady",true);return true}setReadyStatus(){this.set("_isReady",true)}checkVisitedStatus(){const children=this.getAvailableChildModels();const isVisited=children.some((child=>child.get("_isVisited")||child.get("_isComplete")||child.get("_isInteractionComplete")));if(isVisited)this.set("_isVisited",true);return isVisited}setVisitedStatus(){if(!this.get("_isReady")||!this.get("_isRendered"))return;this.set("_isVisited",true)}setCompletionStatus(){if(!this.get("_isVisible"))return;this.set({_isComplete:true,_isInteractionComplete:true,_isVisited:true})}checkCompletionStatus(){Adapt$1.checkingCompletion();_.defer(this.checkCompletionStatusFor.bind(this),"_isComplete")}checkInteractionCompletionStatus(){Adapt$1.checkingCompletion();_.defer(this.checkCompletionStatusFor.bind(this),"_isInteractionComplete")}checkCompletionStatusFor(completionAttribute="_isComplete"){let completed=false;const children=this.getAvailableChildModels();const requireCompletionOf=this.get("_requireCompletionOf");const isOptional=this.get("_isOptional");const isEveryChildOptional=children.every((child=>child.get("_isOptional")));if(isOptional&&isEveryChildOptional){completed=children.every((child=>child.get(completionAttribute)))}else if(requireCompletionOf===-1){completed=children.every((child=>child.get(completionAttribute)||child.get("_isOptional")))}else{completed=children.filter((child=>child.get(completionAttribute)&&!child.get("_isOptional"))).length>=requireCompletionOf}this.set(completionAttribute,completed);Adapt$1.checkedCompletion()}getTypeGroup(){}isTypeGroup(typeGroup){const hasUpperCase=/[A-Z]+/.test(typeGroup);const isPluralized=typeGroup.slice(-1)==="s";const lowerCased=typeGroup.toLowerCase();const singular=isPluralized&&lowerCased.slice(0,-1);const singularLowerCased=(singular||lowerCased).toLowerCase();if(isPluralized||hasUpperCase){logging$1.deprecated(`'${typeGroup}' appears pluralized or contains uppercase characters, suggest using the singular, lowercase type group '${singularLowerCased}'.`)}const pluralizedLowerCaseTypes=[singularLowerCased,!isPluralized&&`${lowerCased}s`].filter(Boolean);const typeGroups=this.getTypeGroups();if(_.intersection(pluralizedLowerCaseTypes,typeGroups).length){return true}return false}getTypeGroups(){if(this._typeGroups)return this._typeGroups;const typeGroups=[this.get("_type")];let parentClass=this;while(parentClass=Object.getPrototypeOf(parentClass)){if(!Object.prototype.hasOwnProperty.call(parentClass,"getTypeGroup"))continue;typeGroups.push(parentClass.getTypeGroup.call(this))}return this._typeGroups=_.uniq(typeGroups.filter(Boolean).map((s=>s.toLowerCase())))}findAncestor(ancestorType){const parent=this.getParent();if(!parent)return;if(!ancestorType||parent.isTypeGroup(ancestorType)){return parent}return parent.findAncestor(ancestorType)}findDescendantModels(descendants,options){const allDescendantsModels=this.getAllDescendantModels();const returnedDescendants=allDescendantsModels.filter((model=>model.isTypeGroup(descendants)));if(!options){return returnedDescendants}if(options.where){return returnedDescendants.filter((descendant=>{for(const property in options.where){const value=options.where[property];if(descendant.get(property)!==value){return false}}return true}))}}getAllDescendantModels(isParentFirst){const descendants=[];if(!this.hasManagedChildren){return descendants}const children=this.getChildren();children.models.forEach((child=>{if(!child.hasManagedChildren){descendants.push(child);return}const subDescendants=child.getAllDescendantModels(isParentFirst);if(isParentFirst===true){descendants.push(child)}descendants.push(...subDescendants);if(isParentFirst!==true){descendants.push(child)}}));return descendants}findRelativeModel(relativeString,options={}){if(!relativeString)return this;let relativeDescriptorObjects=Adapt$1.parseRelativeString(relativeString);if(!Array.isArray(relativeDescriptorObjects))relativeDescriptorObjects=[relativeDescriptorObjects];const find=({type:type,offset:offset,inset:inset})=>{const isInset=inset!==null;const isOffset=offset!==null;const rootModel=options.limitParentId?data$1.findById(options.limitParentId):isInset?this:Adapt$1.course;const increment=isOffset?offset:inset;const searchBackwards=increment<0;let moveBy=Math.abs(increment);let movementCount=0;const hasDescendantsOfType=Boolean(this.findDescendantModels(type).length);if(isInset&&!hasDescendantsOfType)return undefined;if(isOffset&&hasDescendantsOfType){moveBy--}if(isInset&&searchBackwards){moveBy--}const searchDescendants=searchBackwards?[rootModel,...rootModel.getAllDescendantModels(true)].reverse():[...rootModel.getAllDescendantModels(false),rootModel];const modelId=this.get("_id");const searchFromIndex=isInset?0:searchDescendants.findIndex((searchDescendant=>searchDescendant.get("_id")===modelId));const hasFilterFunction=typeof options.filter==="function";if(options.loop){const totalOfType=searchDescendants.reduce(((count,model)=>{if(!model.isTypeGroup(type))return count;return++count}),0);moveBy=moveBy%totalOfType;searchDescendants.push(...searchDescendants.slice(0))}for(let i=searchFromIndex,l=searchDescendants.length;i<l;i++){const descendant=searchDescendants[i];if(!descendant.isTypeGroup(type))continue;const isSelf=i===searchFromIndex;if(!isSelf&&hasFilterFunction&&!options.filter(descendant))continue;if(movementCount>moveBy){break}if(movementCount===moveBy){return descendant}movementCount++}};const nextDescriptor=relativeDescriptorObjects.slice(1).reduce(((output,{type:type,offset:offset,inset:inset})=>{const isInset=inset!==null;const isOffset=offset!==null;if(isOffset)return`${output}@${type}${offset<0?offset:`+${offset}`}`;if(isInset)return`${output}@${type}=${inset}`;return`${output}@${type}`}),"");const foundModel=find(relativeDescriptorObjects[0]);if(nextDescriptor){return foundModel?.findRelativeModel(nextDescriptor)}return foundModel}get hasManagedChildren(){return true}getChildren(){if(this._childrenCollection){return this._childrenCollection}let childrenCollection;if(!this.hasManagedChildren){childrenCollection=new Backbone.Collection}else{const id=this.get("_id");const children=data$1.filter((model=>model.get("_parentId")===id));childrenCollection=new Backbone.Collection(children)}if(this.get("_type")==="block"&&childrenCollection.length===2&&childrenCollection.models[0].get("_layout")!=="left"){childrenCollection.comparator="_layout";childrenCollection.sort()}this.setChildren(childrenCollection);return this._childrenCollection}setChildren(children){this._childrenCollection=children;this.set("_children",children)}getAvailableChildModels(){return this.getChildren().where({_isAvailable:true})}getParent(){if(this._parentModel){return this._parentModel}const parentId=this.get("_parentId");if(!parentId)return;const parent=data$1.findById(parentId);if(!parent){logging$1.warn("adaptModel.getParent(): parent is empty");return}this.setParent(parent);return this._parentModel}setParent(parent){this._parentModel=parent;this.set("_parentId",this._parentModel.get("_id"));this.set("_parent",this._parentModel)}getAncestorModels(shouldIncludeChild){const parents=[];let context=this;if(shouldIncludeChild)parents.push(context);while(context.has("_parentId")){context=context.getParent();parents.push(context)}return parents.length?parents:null}getSiblings(passSiblingsAndIncludeSelf){const id=this.get("_id");const parentId=this.get("_parentId");let siblings;if(!passSiblingsAndIncludeSelf){if(this._hasSiblingsAndSelf===false){return this.get("_siblings")}siblings=data$1.filter((model=>model.get("_parentId")===parentId&&model.get("_id")!==id));this._hasSiblingsAndSelf=false}else{if(this._hasSiblingsAndSelf){return this.get("_siblings")}siblings=data$1.filter((model=>model.get("_parentId")===parentId));this._hasSiblingsAndSelf=true}const siblingsCollection=new Backbone.Collection(siblings);this.set("_siblings",siblingsCollection);return siblingsCollection}setOnChildren(...args){this.set(...args);if(!this.hasManagedChildren)return;const children=this.getChildren();children.models.forEach((child=>child.setOnChildren(...args)))}setOptional(value){logging$1.deprecated("Use model.set('_isOptional', value) as setOptional() may be removed in the future");this.set({_isOptional:value})}checkLocking(){const lockType=this.get("_lockType");if(!lockType)return;switch(lockType){case"sequential":this.setSequentialLocking();break;case"unlockFirst":this.setUnlockFirstLocking();break;case"lockLast":this.setLockLastLocking();break;case"custom":this.setCustomLocking();break;default:logging$1.warn(`AdaptModel.checkLocking: unknown _lockType '${lockType}' found on ${this.get("_id")}`)}}setSequentialLocking(){const children=this.getAvailableChildModels();children.slice(1).forEach(((child,index)=>{const previousChild=children[index];const isLockedByPreviousChild=previousChild.get("_isLocked")||!previousChild.get("_isComplete")&&!previousChild.get("_isOptional");child.set("_isLocked",isLockedByPreviousChild,{pluginName:"adapt"})}),false)}setUnlockFirstLocking(){const children=this.getAvailableChildModels();const firstChild=children.shift();const isLockedByFirstChild=!firstChild.get("_isComplete")&&!firstChild.get("_isOptional");children.forEach((child=>child.set("_isLocked",isLockedByFirstChild,{pluginName:"adapt"})))}setLockLastLocking(){const children=this.getAvailableChildModels();const lastChild=children.pop();const isLockedByChildren=children.some((child=>!child.get("_isComplete")&&!child.get("_isOptional")));lastChild.set("_isLocked",isLockedByChildren,{pluginName:"adapt"})}setCustomLocking(){const children=this.getAvailableChildModels();children.forEach((child=>child.set("_isLocked",this.shouldLock(child),{pluginName:"adapt"})))}shouldLock(child){const lockedBy=child.get("_lockedBy");if(!lockedBy)return false;return lockedBy.some((id=>{try{const anotherModel=data$1.findById(id);return anotherModel.get("_isAvailable")&&(anotherModel.get("_isLocked")||!anotherModel.get("_isComplete")&&!anotherModel.get("_isOptional"))}catch(e){logging$1.warn(`AdaptModel.shouldLock: unknown _lockedBy ID '${id}' found on ${child.get("_id")}`);return false}}))}onIsComplete(){this.checkCompletionStatus();this.checkLocking()}checkIfResetOnRevisit(){const isResetOnRevisit=this.get("_isResetOnRevisit");this.reset(isResetOnRevisit)}deepClone(modifier=null){const ModelClass=this.constructor;const clonedModel=new ModelClass(this.toJSON());clonedModel._lockedAttributes={...this._lockedAttributes};clonedModel._lockedAttributesValues={...this._lockedAttributesValues};if(modifier){modifier(clonedModel,this)}let clonedId=clonedModel.get("_id");const hasId=Boolean(clonedId);const shouldAssignUniqueId=this.get("_id")===clonedId;if(hasId&&shouldAssignUniqueId){const cid=_.uniqueId(ModelClass.prototype.cidPrefix||"c");clonedId=`${clonedId}_${cid}`;clonedModel.set("_id",clonedId)}if(hasId){data$1.add(clonedModel)}if(this.hasManagedChildren){this.getChildren().each((child=>{if(!child.deepClone){throw new Error("Cannot deepClone child.")}child.deepClone(((clone,child)=>{if(hasId){clone.set("_parentId",clonedId)}if(modifier){modifier(clone,child)}}))}))}clonedModel.getParent().getChildren().add(clonedModel);clonedModel.setupModel();return clonedModel}onAll(type,model,value){if(!_.result(this,"bubblingEvents").includes(type))return;const event=new ModelEvent(type,model,value);this.bubble(event)}bubble(event){if(!event.canBubble)return;event.addPath(this);this.trigger(`bubble:${event.type} bubble`,event)}});var ContentObjectModel=__AMD("core/js/models/contentObjectModel",class ContentObjectModel extends AdaptModel{get _parent(){logging$1.deprecated("contentObjectModel._parent, use contentObjectModel.getParent() instead, parent models are defined by the JSON");const isParentCourse=this.get("_parentId")===Adapt$1.course.get("_id");if(isParentCourse){return"course"}return"contentObjects"}get _siblings(){logging$1.deprecated("contentObjectModel._siblings, use contentObjectModel.getSiblings() instead, sibling models are defined by the JSON");return"contentObjects"}get _children(){logging$1.deprecated("contentObjectModel._children, use contentObjectModel.hasManagedChildren instead, child models are defined by the JSON");return null}getTypeGroup(){return"contentobject"}});class ArticleModel extends AdaptModel{get _parent(){logging$1.deprecated("articleModel._parent, use articleModel.getParent() instead, parent models are defined by the JSON");return"contentObjects"}get _siblings(){logging$1.deprecated("articleModel._siblings, use articleModel.getSiblings() instead, sibling models are defined by the JSON");return"articles"}get _children(){logging$1.deprecated("articleModel._children, use articleModel.hasManagedChildren instead, child models are defined by the JSON");return"blocks"}getTypeGroup(){return"article"}}components$1.register("article",{model:ArticleModel});var ArticleModel$1=__AMD("core/js/models/articleModel",ArticleModel);class BlockModel extends AdaptModel{get _parent(){logging$1.deprecated("blockModel._parent, use blockModel.getParent() instead, parent models are defined by the JSON");return"articles"}get _siblings(){logging$1.deprecated("blockModel._siblings, use blockModel.getSiblings() instead, sibling models are defined by the JSON");return"blocks"}get _children(){logging$1.deprecated("blockModel._children, use blockModel.hasManagedChildren instead, child models are defined by the JSON");return"components"}getTypeGroup(){return"block"}}components$1.register("block",{model:BlockModel});var BlockModel$1=__AMD("core/js/models/blockModel",BlockModel);class ComponentModel extends AdaptModel{get _parent(){logging$1.deprecated("componentModel._parent, use componentModel.getParent() instead, parent models are defined by the JSON");return"blocks"}get _siblings(){logging$1.deprecated("componentModel._siblings, use componentModel.getSiblings() instead, sibling models are defined by the JSON");return"components"}getTypeGroup(){return"component"}defaults(){return AdaptModel.resultExtend("defaults",{_isA11yComponentDescriptionEnabled:true,_shouldStoreAttempts:true,_userAnswer:null,_attemptStates:null})}trackable(){return AdaptModel.resultExtend("trackable",["_userAnswer","_attemptStates"])}trackableType(){return AdaptModel.resultExtend("trackableType",[Array,Array])}get hasManagedChildren(){return false}init(){if(Adapt$1.get("_isStarted")){this.onAdaptInitialize();return}this.listenToOnce(Adapt$1,"adapt:initialize",this.onAdaptInitialize)}onAdaptInitialize(){this.restoreUserAnswers()}restoreUserAnswers(){}storeUserAnswer(){}resetUserAnswer(){this.set("_userAnswer",null)}reset(type="hard",canReset=this.get("_canReset")){const wasReset=super.reset(type,canReset);if(!wasReset)return false;this.resetUserAnswer();return true}getAttemptState(object=this.toJSON()){const trackables=this.trackable();const types=this.trackableType();trackables.find(((name,index)=>{if(name!=="_attemptStates")return false;trackables.splice(index,1);types.splice(index,1);return true}));const values=trackables.map((n=>object[n]));const booleans=values.filter(((v,i)=>types[i]===Boolean)).map(Boolean);const numbers=values.filter(((v,i)=>types[i]===Number)).map((v=>Number(v)||0));const arrays=values.filter(((v,i)=>types[i]===Array));return[numbers,booleans,arrays]}getAttemptObject(state=this.getAttemptState()){const trackables=this.trackable();const types=this.trackableType();trackables.find(((name,index)=>{if(name!=="_attemptStates")return false;trackables.splice(index,1);types.splice(index,1);return true}));const numbers=(state[0]||[]).slice(0);const booleans=(state[1]||[]).slice(0);const arrays=(state[2]||[]).slice(0);const object={};trackables.forEach(((n,i)=>{if(n==="_id")return;switch(types[i]){case Number:object[n]=numbers.shift();break;case Boolean:object[n]=booleans.shift();break;case Array:object[n]=arrays.shift();break}}));return object}setAttemptObject(object,silent=true){this.set(object,{silent:silent});this.restoreUserAnswers()}addAttemptObject(object=this.getAttemptObject()){const attemptStates=this.get("_attemptStates")||[];const state=this.getAttemptState(object);attemptStates.push(state);this.set("_attemptStates",attemptStates)}getAttemptObjects(){const states=this.get("_attemptStates")||[];return states.map((state=>this.getAttemptObject(state)))}}components$1.register("component",{model:ComponentModel});var ComponentModel$1=__AMD("core/js/models/componentModel",ComponentModel);class MenuModel extends ContentObjectModel{get _children(){logging$1.deprecated("menuModel._children, use menuModel.hasManagedChildren instead, child models are defined by the JSON");return"contentObjects"}getTypeGroup(){return"menu"}setCustomLocking(){const children=this.getAvailableChildModels();children.forEach((child=>{child.set("_isLocked",this.shouldLock(child),{pluginName:"adapt"});if(!(child instanceof MenuModel))return;child.checkLocking()}))}}components$1.register("menu",{model:MenuModel});var MenuModel$1=__AMD("core/js/models/menuModel",MenuModel);class CourseModel extends MenuModel$1{get _parent(){logging$1.deprecated("courseModel._parent, use courseModel.getParent() instead, parent models are defined by the JSON");return null}get _siblings(){logging$1.deprecated("courseModel._siblings, use courseModel.getSiblings() instead, sibling models are defined by the JSON");return null}getTypeGroup(){return"course"}}components$1.register("course",{model:CourseModel});var CourseModel$1=__AMD("core/js/models/courseModel",CourseModel);class PageModel extends ContentObjectModel{get _children(){logging$1.deprecated("pageModel._children, use menuModel.hasManagedChildren instead, child models are defined by the JSON");return"articles"}getTypeGroup(){return"page"}}components$1.register("page",{model:PageModel});__AMD("core/js/models/pageModel",PageModel);var ChildEvent=__AMD("core/js/childEvent",class ChildEvent extends Backbone.Controller{initialize(type,target,model){this.type=type;this.target=target;this.isForced=false;this.isStoppedImmediate=false;this.isStoppedNext=false;this.hasRequestChild=false;this._model=model}get model(){return this._model}set model(model){if(this.type!=="requestChild"){logging$1.warn(`Cannot change model in ${this.type} event.`);return}if(this._model){logging$1.warn(`Cannot inject two models in one sitting. ${model.get("_id")} attempts to overwrite ${this._model.get("_id")}`);return}this._model=model;this.hasRequestChild=true}reset(){this.isStoppedImmediate=false;this.isStoppedNext=false}force(){this.isForced=true}stop(immediate=true){if(!immediate){return this.stopNext()}this.isStoppedImmediate=true}stopNext(){this.isStoppedNext=true}close(){this.trigger("closed")}});class AdaptView extends Backbone.View{attributes(){return{"data-adapt-id":this.model.get("_id"),role:"presentation"}}initialize(){this._jsxIgnoreChanges=0;this.listenTo(this.model,{"change:_isVisible":this.toggleVisibility,"change:_isHidden":this.toggleHidden,"change:_isComplete":this.onIsCompleteChange});this.isJSX=(this.template||this.constructor.template||"").includes(".jsx");if(this.isJSX){this._classSet=new Set(_.result(this,"className").trim().split(/\s+/));this.listenTo(this.model,"change",this.changed);const children=this.model?.getChildren?.();children&&this.listenTo(children,"change",this.changed);this.listenTo(Adapt$1,"device:changed",this.changed)}this.model.set({_globals:Adapt$1.course.get("_globals"),_isReady:false});this._isRemoved=false;if(location$1._currentId===this.model.get("_id")){Adapt$1.parentView=this}this.preRender();this.render();this.setupOnScreenHandler()}preRender(){}async postRender(){await this.addChildren()}render(){const type=this.constructor.type;Adapt$1.trigger(`${type}View:preRender view:preRender`,this);if(this.isJSX){this.changed()}else{const data=this.model.toJSON();data.view=this;const template=Handlebars.templates[this.constructor.template];this.$el.html(template(data))}Adapt$1.trigger(`${type}View:render view:render`,this);_.defer((async()=>{if(this._isRemoved)return;await this.postRender();Adapt$1.trigger(`${type}View:postRender view:postRender`,this)}));return this}changed(eventName=null){if(this._jsxIgnoreChanges!==0)return;if(!this.isJSX)return;if(typeof eventName==="string"&&eventName.startsWith("bubble")){return}if(!this.model.get("_isRendered"))return;const props={...this,...this.model.toJSON(),_globals:Adapt$1.course.get("_globals")};const Template=templates[(this.template||this.constructor.template).replace(".jsx","")];this.updateViewProperties();ReactDOM__default["default"].render(React__default["default"].createElement(Template,props),this.el)}stopRendering(){this._jsxIgnoreChanges++}startRendering(){this._jsxIgnoreChanges--;if(this._jsxIgnoreChanges<0){this._jsxIgnoreChanges=0}}updateViewProperties(){const classesToAdd=_.result(this,"className").trim().split(/\s+/);classesToAdd.forEach((i=>this._classSet.add(i)));const classesToRemove=[...this._classSet].filter((i=>!classesToAdd.includes(i)));classesToRemove.forEach((i=>this._classSet.delete(i)));this._setAttributes({..._.result(this,"attributes"),id:_.result(this,"id")});this.$el.removeClass(classesToRemove).addClass(classesToAdd)}setupOnScreenHandler(){const onscreen=this.model.get("_onScreen");if(!onscreen?._isEnabled)return;this.$el.addClass(`has-animation ${onscreen._classes}-before`);this.$el.on("onscreen.adaptView",((e,m)=>{if(!m.onscreen)return;const minVerticalInview=onscreen._percentInviewVertical||33;if(m.percentInviewVertical<minVerticalInview)return;this.$el.addClass(`${onscreen._classes}-after`).off("onscreen.adaptView");const type=this.model.get("_type");Adapt$1.trigger(`${type}View:animationStart view:animationStart`,this)}))}async addChildren({returnNewDescendants:returnNewDescendants=false}={}){const newChildren=[];this.nthChild=this.nthChild||0;let addedCount=0;const result=await this.addDescendants({returnNewDescendants:returnNewDescendants});if(Array.isArray(result)){addedCount=result.length;newChildren.push(...result)}else{addedCount=result}while(true){const models=this.model.getAvailableChildModels();const event=this._getAddChildEvent(models[this.nthChild]);if(!event){break}if(event.isForced){event.reset()}if(event.isStoppedImmediate||!event.model){const subsequentModels=models.slice(this.nthChild);subsequentModels.forEach((model=>model.setOnChildren("_isRendered",false)));break}const model=event.model;model.set({_isRendered:true,_nthChild:++this.nthChild});const ChildView=this.constructor.childView||components$1.getViewClass(model);if(!ChildView){throw new Error(`The component '${model.attributes._id}' ('${model.attributes._component}') has not been installed, and so is not available in your project.`)}const childView=new ChildView({model:model});newChildren.push(childView);this.addChildView(childView);addedCount++;if(event.isStoppedNext){break}}if(!addedCount){return returnNewDescendants?[]:addedCount}this.model.set("_isReady",false);return returnNewDescendants?newChildren:addedCount}addChildView(childView){const childModel=childView.model;const type=childModel.get("_type");const childViews=this.getChildViews()||[];childViews.push(childView);this.setChildViews(childViews);const $parentContainer=this.$(this.constructor.childContainer);switch(childModel.get("_renderPosition")){case"outer-append":this.$el.append(childView.$el);break;case"inner-append":default:$parentContainer.append(childView.$el);break}Adapt$1.trigger(`${type}View:childAdded view:childAdded`,this,childView);return childView}async addDescendants({returnNewDescendants:returnNewDescendants=false}={}){let addedDescendantCount=0;const childViews=this.getChildViews();if(!childViews){return returnNewDescendants?[]:addedDescendantCount}const newDescendants=[];for(let i=0,l=childViews.length;i<l;i++){const view=childViews[i];const result=view.addChildren?await view.addChildren({returnNewDescendants:true}):0;if(Array.isArray(result)){addedDescendantCount+=result.length;newDescendants.push(...result)}else{addedDescendantCount+=result}if(addedDescendantCount){break}}if(!addedDescendantCount){this.model.checkReadyStatus();return returnNewDescendants?[]:addedDescendantCount}this.model.set("_isReady",false);return returnNewDescendants?newDescendants:addedDescendantCount}async whenReady(){if(this.model.get("_isReady"))return;return new Promise((resolve=>{const onReadyChange=(model,value)=>{if(!value)return;this.stopListening(this.model,"change:_isReady",onReadyChange);resolve()};this.listenTo(this.model,"change:_isReady",onReadyChange);this.model.checkReadyStatus()}))}_getAddChildEvent(model){const isRequestChild=!model;const event=new ChildEvent(null,this,model);if(isRequestChild){const canRequestChild=this.model.get("_canRequestChild");if(!canRequestChild){return}event.type="requestChild";Adapt$1.trigger("view:requestChild",event);if(!event.hasRequestChild){event.close();return}model=event.model}const type=model.get("_type");event.type="addChild";Adapt$1.trigger(`${type}View:addChild view:addChild`,event);event.close();return event}findDescendantViews(isParentFirst){const descendants=[];const childViews=this.getChildViews();childViews?.forEach((view=>{if(isParentFirst)descendants.push(view);const children=view.findDescendantViews?.(isParentFirst);if(children)descendants.push(...children);if(!isParentFirst)descendants.push(view)}));return descendants}setReadyStatus(){this.model.setReadyStatus()}setCompletionStatus(){this.model.setCompletionStatus()}resetCompletionStatus(type){if(!this.model.get("_canReset"))return;const descendantComponents=this.model.findDescendantModels("component");if(descendantComponents.length===0){this.model.reset(type)}else{descendantComponents.forEach((model=>model.reset(type)))}}preRemove(){const type=this.constructor.type;Adapt$1.trigger(`${type}View:preRemove view:preRemove`,this);this.trigger("preRemove")}remove(){const type=this.constructor.type;this.preRemove();Adapt$1.trigger(`${type}View:remove view:remove`,this);this.trigger("remove");this._isRemoved=true;this.stopListening();wait$1.for((end=>{if(this.isJSX){ReactDOM__default["default"].unmountComponentAtNode(this.el)}this.$el.off("onscreen.adaptView");super.remove();_.defer((()=>{Adapt$1.trigger(`${type}View:postRemove view:postRemove`,this);this.trigger("postRemove")}));end()}));return this}setVisibility(){return this.model.get("_isVisible")?"":"u-visibility-hidden"}toggleVisibility(){this.$el.toggleClass("u-visibility-hidden",!this.model.get("_isVisible"))}setHidden(){return this.model.get("_isHidden")?"u-display-none":""}toggleHidden(){this.$el.toggleClass("u-display-none",this.model.get("_isHidden"))}onIsCompleteChange(model,isComplete){this.$el.toggleClass("is-complete",isComplete)}getChildViews(){if(!this._childViews)return null;return Object.entries(this._childViews).map((([key,value])=>value))}setChildViews(value){this._childViews=value}get childViews(){logging$1.deprecated("view.childViews use view.getChildViews() and view.setChildViews([])");if(Array.isArray(this._childViews)){return _.indexBy(this._childViews,(view=>view.model.get("_id")))}return this._childViews}set childViews(value){logging$1.deprecated("view.childViews use view.getChildViews() and view.setChildViews([])");this.setChildViews(value)}}AdaptView.className="";var AdaptView$1=__AMD("core/js/views/adaptView",AdaptView);var RouterModel=__AMD("core/js/models/routerModel",class RouterModel extends LockingModel{defaults(){return{_canNavigate:true,_shouldNavigateFocus:true}}lockedAttributes(){return{_canNavigate:false,_shouldNavigateFocus:false}}});class Router extends Backbone.Router{routes(){return{"":"handleRoute","id/:id":"handleRoute","preview/:id":"handlePreview",":pluginName(/*location)(/*action)":"handleRoute"}}initialize({model:model}){this.navigateToElement=this.navigateToElement.bind(this);this.model=model;this._navigationRoot=null;this._isBackward=false;this._isInNavigateTo=false;this._shouldIgnoreNextRouteAction=false;this._isCircularNavigationInProgress=false;this.isPreviewMode=false;this.showLoading();this.$wrapper=$("#wrapper");this.$html=$("html");this.listenToOnce(Adapt$1,"app:dataReady",this.setDocumentTitle);this.listenTo(Adapt$1,"router:navigateTo",this.navigateToArguments);this.listenToOnce(Adapt$1,"configModel:dataLoaded",this.onConfigLoaded)}get rootModel(){return this._navigationRoot||Adapt$1.course}set rootModel(model){this._navigationRoot=model}showLoading(){$("html").removeClass("is-loading-hidden").addClass("is-loading-visible");$(".js-loading").show()}hideLoading(){$("html").addClass("is-loading-hidden").removeClass("is-loading-visible");$(".js-loading").hide()}setDocumentTitle(){const currentModel=location$1._currentModel;const hasSubTitle=currentModel&&currentModel!==router.rootModel&&currentModel.get("title");const title=[this.rootModel.get("title"),hasSubTitle&&currentModel.get("title")].filter(Boolean).join(" | ");this.listenToOnce(Adapt$1,"contentObjectView:preRender",(()=>{const escapedTitle=$(`<div>${title}</div>`).text();document.title=escapedTitle}))}navigateToArguments(args){args=args.filter((v=>v!==null));const options={trigger:false,replace:false};if(args.length===1&&data$1.findById(args[0])){this.navigate("#/id/"+args[0],options);return}if(args.length<=3){this.navigate("#/"+args.join("/"),options);return}logging$1.deprecated("Use Backbone.history.navigate or window.location.href instead of Adapt.trigger('router:navigateTo')");this.handleRoute(...args)}handlePreview(...args){this.isPreviewMode=true;this.handleRoute(...args)}handleRoute(...args){if(this._shouldIgnoreNextRouteAction){this._shouldIgnoreNextRouteAction=false;return}args=args.filter((v=>v!==null));if(this.model.get("_canNavigate")){this._isCircularNavigationInProgress=false}if(this._isCircularNavigationInProgress===false){Adapt$1.trigger("router:navigate",args)}if(this.model.get("_canNavigate")){this.model.set("_canNavigate",false,{pluginName:"adapt"});this._isBackward=false;if(args.length<=1){if(this.isPreviewMode){return this.handleIdPreview(...args)}return this.handleId(...args)}return this.handlePluginRouter(...args)}if(this._isCircularNavigationInProgress){this._isCircularNavigationInProgress=false;return}this._isCircularNavigationInProgress=true;Adapt$1.trigger("router:navigationCancelled",args);Backbone.history.history[this._isBackward?"forward":"back"]();this._isBackward=false}async handlePluginRouter(pluginName,location,action){const pluginLocation=[pluginName,location&&`-${location}`,action&&`-${action}`].filter(Boolean).join("");await this.updateLocation(pluginLocation,null,null,null);Adapt$1.trigger("router:plugin:"+pluginName,pluginName,location,action);Adapt$1.trigger("router:plugin",pluginName,location,action);this.model.set("_canNavigate",true,{pluginName:"adapt"})}async handleId(id){const rootModel=router.rootModel;let model=!id?rootModel:data$1.findById(id);if(!model){this.model.set("_canNavigate",true,{pluginName:"adapt"});return}const isContentObject=model.isTypeGroup?.("contentobject")&&!model.isTypeGroup?.("group");const navigateToId=model.get("_id");model=isContentObject?model:model.findAncestor("contentobject");id=model.get("_id");const isRoot=model===rootModel;if(isRoot&&Adapt$1.course.has("_start")){const startController=Adapt$1.course.get("_start");if(startController._isEnabled===true&&startController._isMenuDisabled===true){return}}if(model.get("_isLocked")&&Adapt$1.config.get("_forceRouteLocking")){logging$1.warn("Unable to navigate to locked id: "+id);this.model.set("_canNavigate",true,{pluginName:"adapt"});if(location$1._previousId===undefined){return this.navigate("#/",{trigger:true,replace:true})}return this.navigateBack()}const isNavigateToSubContent=model===location$1._currentModel&&!isContentObject;if(isNavigateToSubContent){this.model.set("_canNavigate",true,{pluginName:"adapt"});await this.navigateToElement("."+navigateToId,{replace:true,duration:400});return}this.showLoading();await Adapt$1.remove();await this.removePreviews();const isCourse=model.isTypeGroup?.("course");const type=isCourse?"menu":model.get("_type");const newLocation=isCourse?"course":`${type}-${id}`;model.set({_isVisited:true,_isRendered:true});await this.updateLocation(newLocation,type,id,model);Adapt$1.trigger(`router:${type} router:contentObject`,model);const ViewClass=components$1.getViewClass(model);const isMenu=model.isTypeGroup?.("menu");if(!ViewClass&&isMenu){logging$1.deprecated(`Using event based menu view instantiation for '${components$1.getViewName(model)}'`);return}if(!isMenu){_.invoke(model.getAllDescendantModels(),"checkIfResetOnRevisit");await Adapt$1.deferUntilCompletionChecked()}this.$wrapper.append(new ViewClass({model:model}).$el);await new Promise((resolve=>Adapt$1.once("contentObjectView:ready",resolve)));this.model.set("_canNavigate",true,{pluginName:"adapt"});if(this._isInNavigateTo||this._isInScroll)return;if(!isContentObject){await this.navigateToElement("."+navigateToId,{replace:true,duration:400});return}this.handleNavigationFocus()}async handleIdPreview(id){const rootModel=router.rootModel;let model=!id?rootModel:data$1.findById(id);if(!model){this.model.set("_canNavigate",true,{pluginName:"adapt"});return}this.showLoading();await Adapt$1.remove();await this.removePreviews();let isContentObject=model.isTypeGroup?.("contentobject");if(!isContentObject){const types=["page","article","block","component"];const type=model.get("_type");const buildTypes=types.slice(0,types.indexOf(type));let parentModel=Adapt$1.course;let _parentId=parentModel.get("_id");const built=buildTypes.map(((_type,index)=>{const ModelClass=components$1.getModelClass({_type:_type});const _id=`preview-${_type}`;const builtModel=new ModelClass({_type:_type,_id:_id,_parentId:_parentId,_isPreview:true});if(index)parentModel.getChildren().add(builtModel);data$1.add(builtModel);parentModel=builtModel;_parentId=_id;return builtModel}));model.deepClone(((clone,orig)=>{clone.set({_isAvailable:true,_isLocked:false});clone.on("change",(function(){const state=this.getAttemptObject?this.getAttemptObject():this.getTrackableState();delete state._id;delete state._isAvailable;delete state._isLocked;if(this.getAttemptObject)orig.setAttemptObject(state);else orig.set(state)}));if(orig!==model)return;clone.set({_parentId:_parentId})}));built.forEach((model=>model.setupModel()));isContentObject=true;model=built[0];model.setOnChildren({_isPreview:true})}const navigateToId=model.get("_id");model=isContentObject?model:model.findAncestor("contentobject");id=navigateToId;const isCourse=model.isTypeGroup?.("course");const type=isCourse?"menu":model.get("_type");const newLocation=isCourse?"course":`${type}-${id}`;model.set({_isVisited:true,_isRendered:true});await this.updateLocation(newLocation,type,id,model);Adapt$1.once("contentObjectView:ready",(()=>{this.model.set("_canNavigate",true,{pluginName:"adapt"});this.handleNavigationFocus()}));Adapt$1.trigger(`router:${type} router:contentObject`,model);const ViewClass=components$1.getViewClass(model);const isMenu=model.isTypeGroup?.("menu");if(!ViewClass&&isMenu){logging$1.deprecated(`Using event based menu view instantiation for '${components$1.getViewName(model)}'`);return}if(!isMenu){_.invoke(model.getAllDescendantModels(),"checkIfResetOnRevisit");await Adapt$1.deferUntilCompletionChecked()}this.$wrapper.append(new ViewClass({model:model}).$el)}async removePreviews(){const previews=data$1.filter((model=>model.get("_isPreview")));previews.forEach((model=>data$1.remove(model)))}async updateLocation(currentLocation,type,id,currentModel){if(location$1._currentId===id&&id===null)return;location$1._previousModel=location$1._currentModel;location$1._previousId=location$1._currentId;location$1._previousContentType=location$1._contentType;location$1._currentModel=currentModel;location$1._currentId=id;location$1._contentType=type;location$1._currentLocation=currentLocation;if(type==="menu"){location$1._lastVisitedType="menu";location$1._lastVisitedMenu=id}else if(type==="page"){location$1._lastVisitedType="page";location$1._lastVisitedPage=id}this.setDocumentTitle();this.setGlobalClasses();Adapt$1.trigger("router:location",location$1);await wait$1.queue()}setGlobalClasses(){const currentModel=location$1._currentModel;const htmlClasses=currentModel?.get("_htmlClasses")||"";const classes=location$1._currentId?`location-${location$1._contentType} location-id-${location$1._currentId}`:`location-${location$1._currentLocation}`;const currentClasses=`${classes} ${htmlClasses}`;this.$html.removeClass(location$1._previousClasses).addClass(currentClasses).attr("data-location",location$1._currentLocation);this.$wrapper.removeClass().addClass(classes).attr("data-location",location$1._currentLocation);location$1._previousClasses=currentClasses}handleNavigationFocus(){if(!this.model.get("_shouldNavigateFocus"))return;a11y$1.focus("body")}navigateBack(){this._isBackward=true;Backbone.history.history.back()}navigateToCurrentRoute(force){if(!this.model.get("_canNavigate")&&!force){return}if(!location$1._currentId){return}const currentId=location$1._currentModel.get("_id");const isRoot=location$1._currentModel===this.rootModel;const route=isRoot?"#/":"#/id/"+currentId;this.navigate(route,{trigger:true,replace:true})}navigateToPreviousRoute(force){if(!this.model.get("_canNavigate")&&!force){return}const currentModel=location$1._currentModel;const previousModel=location$1._previousModel;if(!currentModel){return this.navigateBack()}if(location$1._currentModel?.isTypeGroup("menu")){return this.navigateToParent()}if(previousModel){return this.navigateBack()}this.navigateToParent()}navigateToParent(force){if(!this.model.get("_canNavigate")&&!force){return}const parentId=location$1._currentModel.get("_parentId");const parentModel=data$1.findById(parentId);const isRoot=parentModel===this.rootModel;const route=isRoot?"#/":"#/id/"+parentId;this.navigate(route,{trigger:true})}navigateToHomeRoute(force){if(!this.model.get("_canNavigate")&&!force){return}this.navigate("#/",{trigger:true})}async navigateToElement(selector,settings={}){const currentModelId=typeof selector==="string"&&selector.replace(/\./g,"").split(" ")[0];const isSelectorAnId=data$1.hasId(currentModelId);let currentModel;if(isSelectorAnId){currentModel=data$1.findById(currentModelId);const contentObject=currentModel.isTypeGroup?.("contentobject")&&!currentModel.isTypeGroup?.("group")?currentModel:currentModel.findAncestor("contentobject");const contentObjectId=contentObject.get("_id");const isInCurrentContentObject=contentObjectId===location$1._currentId;if(currentModel&&(!currentModel.get("_isRendered")||!currentModel.get("_isReady")||!isInCurrentContentObject)){const shouldReplace=settings.replace||false;if(!isInCurrentContentObject){this._isInNavigateTo=true;this.navigate(`#/id/${currentModelId}`,{trigger:true,replace:shouldReplace});this.model.set("_shouldNavigateFocus",false,{pluginName:"adapt"});await new Promise((resolve=>Adapt$1.once("contentObjectView:ready",_.debounce((()=>{this.model.set("_shouldNavigateFocus",true,{pluginName:"adapt"});resolve()}),1))));this._isInNavigateTo=false;const shouldFocusOnBody=location$1._currentId===currentModelId;if(shouldFocusOnBody){a11y$1.focusFirst(document.body);return}}await Adapt$1.parentView.renderTo(currentModelId)}if(currentModel&&selector===currentModel.get("_id")){selector=`.${selector}`}}const isElementUnavailable=!$(selector).length;if(isElementUnavailable){logging$1.warn(`router.navigateToElement, selector not found in document: ${selector}`);return}const isSubContent=currentModel&&(!currentModel.isTypeGroup("contentobject")||currentModel.isTypeGroup("group"));const addSubContentRouteToHistory=settings?.addSubContentRouteToHistory&&isSubContent;if(addSubContentRouteToHistory){this.addRouteToHistory(`#/id/${currentModelId}`)}const newLocation=location$1._contentType?location$1._contentType:location$1._currentLocation;this._isInScroll=true;Adapt$1.trigger(`${newLocation}:scrollTo`,selector);const disableScrollToAnimation=Adapt$1.config.has("_disableAnimation")?Adapt$1.config.get("_disableAnimation"):false;if(disableScrollToAnimation){settings.duration=0}else if(!settings.duration){settings.duration=$.scrollTo.defaults.duration}const $wrapper=$("#wrapper");let offsetTop=-parseInt($wrapper.css("padding-top"));if($(selector).hasClass("component")){offsetTop-=$(selector).find(".aria-label").height()||0}if(!settings.offset)settings.offset={top:offsetTop,left:0};if(settings.offset.top===undefined)settings.offset.top=offsetTop;if(settings.offset.left===undefined)settings.offset.left=0;if(settings.offset.left===0)settings.axis="y";if(Adapt$1.get("_canScroll")!==false){$.scrollTo(selector,settings)}await new Promise((resolve=>{_.delay((()=>{a11y$1.focusNext(selector);Adapt$1.trigger(`${newLocation}:scrolledTo`,selector);this._isInScroll=false;resolve()}),settings.duration+300)}))}addRouteToHistory(hash){const isCurrentRoute=window.location.hash===hash;if(isCurrentRoute)return;this._shouldIgnoreNextRouteAction=true;this.navigate(hash,{trigger:false,replace:false})}get(...args){logging$1.deprecated("router.get, please use router.model.get");return this.model.get(...args)}set(...args){logging$1.deprecated("router.set, please use router.model.set");return this.model.set(...args)}onConfigLoaded(){this.listenTo(Adapt$1.config,"change:_activeLanguage",this.onLanguageChange)}onLanguageChange(){this.updateLocation(null,null,null,null)}}const router=new Router({model:new RouterModel(null,{reset:true})});var router$1=__AMD("core/js/router",router);var ContentObjectView=__AMD("core/js/views/contentObjectView",class ContentObjectView extends AdaptView$1{attributes(){return AdaptView$1.resultExtend("attributes",{role:"main"},this)}className(){return[this.constructor.type,"contentobject",this.constructor.className,this.model.get("_id"),this.model.get("_classes"),this.setVisibility(),this.model.get("_isComplete")?"is-complete":"",this.model.get("_isOptional")?"is-optional":""].filter(Boolean).join(" ")}preRender(){$.inview.lock(this.constructor.type+"View");this.disableAnimation=Adapt$1.config.has("_disableAnimation")?Adapt$1.config.get("_disableAnimation"):false;this.$el.css("opacity",0);this.listenTo(this.model,"change:_isReady",this.isReady);this._loadingErrorTimeout=setTimeout((()=>data$1.logReadyError(this)),1e4)}render(){const type=this.constructor.type;Adapt$1.trigger(`${type}View:preRender contentObjectView:preRender view:preRender`,this);if(this.isJSX){this.changed()}else{const data=this.model.toJSON();data.view=this;const template=Handlebars.templates[this.constructor.template];this.$el.html(template(data))}Adapt$1.trigger(`${type}View:render contentObjectView:render view:render`,this);_.defer((()=>{if(this._isRemoved)return;this.postRender();Adapt$1.trigger(`${type}View:postRender contentObjectView:postRender view:postRender`,this)}));return this}async isReady(){if(!this.model.get("_isReady")||this._isTriggeredReady)return;this._isTriggeredReady=true;clearTimeout(this._loadingErrorTimeout);delete this._loadingErrorTimeout;const type=this.constructor.type;const performIsReady=async()=>{Adapt$1.trigger(`${type}View:preReady contentObjectView:preReady view:preReady`,this);await wait$1.queue();router$1.hideLoading();if(Adapt$1.get("_shouldContentObjectScrollTop")!==false){$(window).scrollTop(0)}Adapt$1.trigger(`${type}View:ready contentObjectView:ready view:ready`,this);const styleOptions={opacity:1};if(this.disableAnimation){this.$el.css(styleOptions);$.inview.unlock(`${type}View`);_.defer((()=>{Adapt$1.trigger(`${type}View:postReady contentObjectView:postReady view:postReady`,this)}))}else{this.$el.velocity(styleOptions,{duration:"fast",complete:()=>{$.inview.unlock(`${type}View`);Adapt$1.trigger(`${type}View:postReady contentObjectView:postReady view:postReady`,this)}})}$(window).scroll()};_.defer(performIsReady)}async renderTo(id){const isRenderToSelf=id===this.model.get("_id");if(isRenderToSelf)return;let models=this.model.getAllDescendantModels(true).filter((model=>model.get("_isAvailable")));const index=models.findIndex((model=>model.get("_id")===id));if(index===-1){throw new Error(`Cannot renderTo "${id}" as it isn't a descendant.`)}const model=models[index];if(model.get("_isRendered")&&model.get("_isReady")){return}models=models.slice(0,index+1);const isLocked=models.some((model=>model.get("_isLocked")));if(isLocked)throw new Error(`Cannot renderTo ${id} as it is preceded by locked content`);const ids=_.indexBy(models,(model=>model.get("_id")));const forceUntilId=event=>{const addingId=event.model.get("_id");if(!ids[addingId])return;event.force();if(addingId!==id)return;Adapt$1.off("view:addChild",forceUntilId)};Adapt$1.on("view:addChild",forceUntilId);await this.addChildren();await this.whenReady();if(!model.get("_isRendered")||!model.get("_isReady")){throw new Error(`Cannot renderTo "${id}".`)}}preRemove(){const type=this.constructor.type;Adapt$1.trigger(`${type}View:preRemove contentObjectView:preRemove view:preRemove`,this);this.trigger("preRemove")}remove(){const type=this.constructor.type;this.preRemove();Adapt$1.trigger(`${type}View:remove contentObjectView:remove view:remove`,this);this.trigger("remove");this._isRemoved=true;wait$1.for((end=>{if(this.isJSX){ReactDOM__default["default"].unmountComponentAtNode(this.el)}this.$el.off("onscreen.adaptView");this.findDescendantViews().reverse().forEach((view=>{view.remove()}));this.setChildViews(null);super.remove();_.defer((()=>{Adapt$1.trigger(`${type}View:postRemove contentObjectView:postRemove view:postRemove`,this);this.trigger("postRemove")}));end()}));return this}destroy(){this.remove();if(Adapt$1.parentView===this){Adapt$1.parentView=null}}});class PageView extends ContentObjectView{remove(){if(this.$pageLabel){this.$pageLabel.remove()}super.remove()}}Object.assign(PageView,{childContainer:".article__container",type:"page",template:"page"});components$1.register("page",{view:PageView});__AMD("core/js/views/pageView",PageView);class ArticleView extends AdaptView$1{className(){return["article",this.model.get("_id"),this.model.get("_classes"),this.setVisibility(),this.setHidden(),this.model.get("_isComplete")?"is-complete":"",this.model.get("_isOptional")?"is-optional":""].join(" ")}}Object.assign(ArticleView,{childContainer:".block__container",type:"article",template:"article"});components$1.register("article",{view:ArticleView});var ArticleView$1=__AMD("core/js/views/articleView",ArticleView);class BlockView extends AdaptView$1{className(){return["block",this.model.get("_id"),this.model.get("_classes"),this.setVisibility(),this.setHidden(),this.model.get("_isComplete")?"is-complete":"",this.model.get("_isOptional")?"is-optional":""].join(" ")}}Object.assign(BlockView,{childContainer:".component__container",type:"block",template:"block"});components$1.register("block",{view:BlockView});__AMD("core/js/views/blockView",BlockView);class MPABC extends Backbone.Controller{initialize(){this.listenTo(data$1,{loading:this.waitForDataLoaded,loaded:this.onDataLoaded});this.setupSubsetCollections()}waitForDataLoaded(){wait$1.begin()}onDataLoaded(){wait$1.end()}setupSubsetCollections(){Adapt$1.contentObjects=new AdaptSubsetCollection(null,{parent:data$1,model:ContentObjectModel});Adapt$1.articles=new AdaptSubsetCollection(null,{parent:data$1,model:ArticleModel$1});Adapt$1.blocks=new AdaptSubsetCollection(null,{parent:data$1,model:BlockModel$1});Adapt$1.components=new AdaptSubsetCollection(null,{parent:data$1,model:ComponentModel$1})}}const mpabc=new MPABC;var mpabc$1=__AMD("core/js/mpabc",mpabc);var NotifyPushView=__AMD("core/js/views/notifyPushView",class NotifyPushView extends Backbone.View{tagName(){return"dialog"}className(){const classes=["notify-push",this.model.get("_classes"),this.model.get("_type")==="a11y-push"&&"aria-label"].filter(Boolean).join(" ");return classes}attributes(){return{"aria-labelledby":"notify-push-heading","aria-modal":"false"}}initialize(){_.bindAll(this,"onKeyDown");this.listenTo(Adapt$1,{"notify:pushShown notify:pushRemoved":this.updateIndexPosition,remove:this.remove});this.listenTo(this.model.collection,{remove:this.updateIndexPosition,"change:_index":this.updatePushPosition});this.setupEscapeKey();this.preRender();this.render()}setupEscapeKey(){$(window).on("keydown",this.onKeyDown)}onKeyDown(event){if(event.which!==27)return;const isFocusInPopup=Boolean($(document.activeElement).closest(this.$el).length);if(!isFocusInPopup)return;event.preventDefault();this.closePush()}events(){return{"click .js-notify-push-close-btn":"closePush","click .js-notify-push-inner":"triggerEvent"}}preRender(){this.hasBeenRemoved=false}render(){const data=this.model.toJSON();const template=Handlebars.templates.notifyPush;this.$el.html(template(data));_.defer(this.postRender.bind(this));return this}postRender(){this.$el[0].open=true;this.$el.appendTo(".notify__push-container");this.$el.addClass("is-active");_.delay(this.closePush.bind(this),this.model.get("_timeout"));Adapt$1.trigger("notify:pushShown")}async closePush(event){if(event){event.preventDefault()}if(this.hasBeenRemoved===false){this.hasBeenRemoved=true;this.$el.removeClass("is-active");await transitionsEnded(this.$el);this.$el[0].open=false;a11y$1.gotoPreviousActiveElement();this.model.collection.remove(this.model);Adapt$1.trigger("notify:pushRemoved",this);this.model.close();this.remove()}}triggerEvent(event){Adapt$1.trigger(this.model.get("_callbackEvent"));this.closePush()}updateIndexPosition(){if(this.hasBeenRemoved)return;const models=this.model.collection.models;models.forEach(((model,index)=>{if(!model.get("_isActive"))return;model.set("_index",index);this.updatePushPosition()}))}updatePushPosition(){if(this.hasBeenRemoved){return}if(typeof this.model.get("_index")!=="undefined"){const elementHeight=this.$el.height();const offset=20;const navigationHeight=$(".nav").height();const currentIndex=this.model.get("_index");let flippedIndex=currentIndex===0?1:0;if(this.model.collection.where({_isActive:true}).length===1){flippedIndex=0}const positionLowerPush=(elementHeight+offset)*flippedIndex+navigationHeight+offset;this.$el.css("top",positionLowerPush)}}remove(...args){$(window).off("keydown",this.onKeyDown);super.remove(...args)}});var NotifyModel=__AMD("core/js/models/notifyModel",class NotifyModel extends LockingModel{defaults(){return{_isActive:false,_showIcon:false,_timeout:3e3,_delay:0,_hasClosed:false}}close(){if(this.get("_hasClosed"))return;this.set("_hasClosed",true);this.trigger("closed")}async onClosed(){if(this.get("_hasClosed"))return;return new Promise((resolve=>this.once("closed",resolve)))}});var NotifyPushCollection=__AMD("core/js/collections/notifyPushCollection",class NotifyPushCollection extends Backbone.Collection{initialize(){this.model=NotifyModel;this.listenTo(this,"add",this.onPushAdded);this.listenTo(Adapt$1,"notify:pushRemoved",this.onRemovePush)}onPushAdded(model){this.checkPushCanShow(model)}checkPushCanShow(model){if(!this.canShowPush())return;model.set("_isActive",true);this.showPush(model)}canShowPush(){const availablePushNotifications=this.where({_isActive:true});return availablePushNotifications.length<2}showPush(model){_.delay((()=>{new NotifyPushView({model:model})}),model.get("_delay"))}onRemovePush(view){const inactivePushNotifications=this.where({_isActive:false});if(inactivePushNotifications.length===0)return;this.checkPushCanShow(inactivePushNotifications[0])}});var NotifyPopupView=__AMD("core/js/views/notifyPopupView",class NotifyPopupView extends Backbone__default["default"].View{className(){return`notify ${this.model.get("_classes")||""}`}attributes(){return this.model.get("_attributes")}events(){return{"click .js-notify-btn-alert":"onAlertButtonClicked","click .js-notify-btn-prompt":"onPromptButtonClicked","click .js-notify-close-btn":"onCloseButtonClicked"}}initialize({notify:notify}){this.notify=notify;_.bindAll(this,"onShadowClicked","resetNotifySize","onKeyDown");this.disableAnimation=Adapt$1.config.get("_disableAnimation")??false;this.$el.toggleClass("disable-animation",Boolean(this.disableAnimation));this.isOpen=false;this.hasOpened=false;this.setupEventListeners();this.render();const dialog=this.$(".notify__popup")[0];dialog.addEventListener("mousedown",this.onShadowClicked,{capture:true})}setupEventListeners(){this.listenTo(Adapt$1,{remove:this.closeNotify,"notify:resize device:resize":this.resetNotifySize,"notify:cancel":this.cancelNotify,"notify:close":this.closeNotify});this.setupEscapeKey()}setupEscapeKey(){$(window).on("keydown",this.onKeyDown)}onKeyDown(event){if(event.which!==27)return;const isFocusInPopup=Boolean($(document.activeElement).closest(this.$el).length);if(!isFocusInPopup)return;event.preventDefault();this.cancelNotify()}render(){const data=this.model.toJSON();const template=Handlebars.templates.notifyPopup;this.$el.html(template(data)).appendTo(".notify__popup-container");this.showNotify();return this}onAlertButtonClicked(event){event.preventDefault();this.closeNotify();Adapt$1.trigger(this.model.get("_callbackEvent"),this)}onPromptButtonClicked(event){event.preventDefault();this.closeNotify();Adapt$1.trigger($(event.currentTarget).attr("data-event"),this)}onCloseButtonClicked(event){event.preventDefault();this.cancelNotify()}onShadowClicked(event){const dialog=this.$(".notify__popup")[0];const rect=dialog.getBoundingClientRect();const isInDialog=rect.top<=event.clientY&&event.clientY<=rect.top+rect.height&&rect.left<=event.clientX&&event.clientX<=rect.left+rect.width;if(isInDialog)return;event.preventDefault();if(this.model.get("_closeOnShadowClick")===false)return;this.cancelNotify()}cancelNotify(){if(this.model.get("_isCancellable")===false)return;this.closeNotify();Adapt$1.trigger("notify:cancelled",this)}resetNotifySize(){if(!this.hasOpened)return;this.resizeNotify()}resizeNotify(){const windowHeight=$(window).height();const notifyHeight=this.$(".notify__popup-inner").outerHeight();const isFullWindow=notifyHeight>=windowHeight;this.$(".notify__popup").css({height:isFullWindow?"100%":notifyHeight,"overflow-y":isFullWindow?"scroll":"","-webkit-overflow-scrolling":isFullWindow?"touch":""})}async showNotify(){this.isOpen=true;await this.addSubView();this.notify.stack.push(this);Adapt$1.trigger("notify:opened",this);this.$el.imageready(this.onLoaded.bind(this))}async onLoaded(){this.hasOpened=true;a11y$1.popupOpened(this.$(".notify__popup"));a11y$1.scrollDisable("body");$("html").addClass("notify");this.$el.addClass("anim-show-before");a11y$1.focusFirst(this.$(".notify__popup"),{defer:false});await transitionNextFrame();this.resetNotifySize();await transitionNextFrame();this.$el.addClass("anim-show-after");await transitionsEnded(this.$(".notify__popup, .notify__shadow"))}async addSubView(){this.subView=this.model.get("_view");if(this.model.get("_shouldRenderId")&&this.model.get("_id")){const model=data$1.findById(this.model.get("_id"));const View=components$1.getViewClass(model);this.subView=new View({model:model})}if(!this.subView)return;this.subView.$el.on("resize",this.resetNotifySize);this.$(".notify__content-inner").append(this.subView.$el);if(!(this.subView instanceof AdaptView$1)||this.subView.model.get("_isReady"))return;return new Promise((resolve=>{const check=(model,value)=>{if(!value)return;this.subView.model.off("change:_isReady",check);resolve()};this.subView.model.on("change:_isReady",check)}))}closeNotify(){const stackItem=this.notify.stack[this.notify.stack.length-1];if(this!==stackItem)return;this.notify.stack.pop();if(!this.isOpen)return;this.isOpen=false;if(this.hasOpened){this.onCloseReady();return}this.listenToOnce(Adapt$1,"popup:opened",(()=>{_.defer(this.onCloseReady.bind(this))}))}async onCloseReady(){this.$el.addClass("anim-hide-before");await transitionNextFrame();this.$el.addClass("anim-hide-after");await transitionsEnded(this.$(".notify__popup, .notify__shadow"));this.remove();a11y$1.scrollEnable("body");$("html").removeClass("notify");await a11y$1.popupClosed();Adapt$1.trigger("notify:closed",this)}remove(...args){this.removeSubView();this.el.removeEventListener("mousedown",this.onShadowClicked,{capture:true});$(window).off("keydown",this.onKeyDown);super.remove(...args)}removeSubView(){if(!this.subView)return;this.subView.$el.off("resize",this.resetNotifySize);if(this.subView instanceof AdaptView$1){const views=[...this.subView.findDescendantViews(),this.subView];views.forEach((view=>{view.model.set("_isReady",false);view.remove()}))}else{this.subView.remove()}this.subView=null}});var NotifyView=__AMD("core/js/views/notifyView",class NotifyView extends Backbone.View{className(){return"notify__container"}initialize(){this._stack=[];this.notifyPushes=new NotifyPushCollection;this.listenTo(Adapt$1,{"app:dataReady":this.onDataReady,"notify:popup":this._deprecated.bind(this,"popup"),"notify:alert":this._deprecated.bind(this,"alert"),"notify:prompt":this._deprecated.bind(this,"prompt"),"notify:push":this._deprecated.bind(this,"push")});this.render()}onDataReady(){const notifyDuration=Adapt$1.config.get("_notify")?._duration??400;document.documentElement.style.setProperty("--adapt-notify-duration",`${notifyDuration}ms`)}get stack(){return this._stack}get isOpen(){return this.stack.length>0}_deprecated(type,notifyObject){logging$1.deprecated(`NOTIFY DEPRECATED: Adapt.trigger('notify:${type}', notifyObject); is no longer supported, please use notify.${type}(notifyObject);`);return this.create(notifyObject,{_type:type})}render(){const notifyTemplate=Handlebars.templates.notify;this.$el.html(notifyTemplate());this.$el.appendTo("body")}create(notifyObject,defaults){notifyObject=_.defaults({},notifyObject,defaults,{_type:"popup",_shouldRenderId:false,_isCancellable:true,_showCloseButton:true,_closeOnShadowClick:true});if(notifyObject._type==="a11y-push")notifyObject._showCloseButton=false;switch(notifyObject._type){case"a11y-push":case"push":{const model=new NotifyModel(notifyObject);this.notifyPushes.push(model);return model}}return new NotifyPopupView({model:new NotifyModel(notifyObject),notify:this})}popup(notifyObject){return this.create(notifyObject,{_type:"popup"})}alert(notifyObject){return this.create(notifyObject,{_type:"alert"})}prompt(notifyObject){return this.create(notifyObject,{_type:"prompt"})}push(notifyObject){return this.create(notifyObject,{_type:"push"})}async read(body){const timeSinceLastFocus=a11y$1.timeSinceLastFocus;const delayTime=Math.max(200-timeSinceLastFocus,0);const words=body.split(" ").length;const item=this.create({_type:"a11y-push",_timeout:words*200+150,_delay:delayTime,body:body});await item.onClosed()}});const notify=new NotifyView;var notify$1=__AMD("core/js/notify",notify);class Scrolling extends Backbone.Controller{initialize(){this.scrollTo=this.scrollTo.bind(this);this.$html=$("html");this.isLegacyScrolling=true;Adapt$1.once("configModel:dataLoaded",this._loadConfig.bind(this))}_loadConfig(){const config=Adapt$1.config.get("_scrollingContainer");if(!config?._isEnabled)return;const limitTo=config._limitToSelector;const isIncluded=!limitTo||this.$html.is(limitTo)||this.$html.hasClass(limitTo);if(!isIncluded)return;this.isLegacyScrolling=false;this._windowScrollFix();this._addStyling();this._updateScrollbarWidth();this.listenTo(Adapt$1,"device:resize",this._updateScrollbarWidth)}_addStyling(){this.$html.addClass("adapt-scrolling")}_updateScrollbarWidth(){const $tester=$('<div class="outer" style="overflow:scroll; visibility: hidden; position:fixed; top: 0; left: 0;"><div class="inner"> </div></div>"');$("body").append($tester);const scrollBarWidth=$tester.outerWidth()-$tester.find(".inner").outerWidth();$tester.remove();const documentStyle=document.documentElement.style;documentStyle.setProperty("--adapt-scrollbar-width",`${scrollBarWidth}px`)}_windowScrollFix(){const body=document.body;const html=scrolling.$html[0];const scrollY={get:()=>body.scrollTop,set:value=>body.scrollTop=value};const scrollX={get:()=>body.scrollLeft,set:value=>body.scrollLeft=value};const scrollHeight={get:()=>body.scrollHeight,set:value=>body.scrollHeight=value};const scrollWidth={get:()=>body.scrollWidth,set:value=>body.scrollWidth=value};Object.defineProperties(window,{scrollY:scrollY,scrollX:scrollX,pageYOffset:scrollY,pageXOffset:scrollX});Object.defineProperties(html,{scrollHeight:scrollHeight,scrollWidth:scrollWidth});window.scrollTo=(...args)=>{const isObject=args.length===1&&typeof args[0]==="object"&&args[0]!==null;const left=(isObject?args[0].left:args[0])??null;const top=(isObject?args[0].top:args[1])??null;left!==null&&(body.scrollLeft=left);top!==null&&(body.scrollTop=top)};const MouseEvent=window.MouseEvent;Object.defineProperties(MouseEvent.prototype,{pageX:{get:function(){return this.clientX+scrollX.get()}},pageY:{get:function(){return this.clientY+scrollY.get()}}});const $window=$(window);$(document.body).on("scroll",(()=>$window.scroll()))}async scrollTo(selector,settings={}){logging$1.deprecated("Adapt.scrollTo and Adapt.scrolling.scrollTo, use router.navigateToElement instead.");return router$1.navigateToElement(selector,settings)}}const scrolling=new Scrolling;var scrolling$1=__AMD("core/js/scrolling",scrolling);class StartController extends Backbone.Controller{initialize(...args){super.initialize(...args);this._isSessionInProgress=false;this.model=null;this.setupListeners()}setupListeners(){this.listenTo(Adapt$1,{"adapt:start":this.onAdaptStart,"navigation:returnToStart":this.returnToStartLocation})}loadCourseData(){this.model=new LockingModel(Adapt$1.course.get("_start"))}setStartLocation(){if(!this._isSessionInProgress){this._isSessionInProgress=true;if(!this.isEnabled())return;return window.history.replaceState("","",this.getStartHash())}const hash=this.isEnabled()?this.getStartHash(false):"#/";router$1.navigate(hash,{trigger:true,replace:true})}returnToStartLocation(){const startIds=this.model.get("_startIds");if(startIds){startIds.forEach((startId=>startId._skipIfComplete=false))}window.location.hash=this.getStartHash(true)}getStartHash(alwaysForce){const startId=this.getStartId();const isRouteSpecified=window.location.href.indexOf("#")>-1;const shouldForceStartId=alwaysForce||this.model.get("_force");const shouldNavigateToStartId=startId&&(!isRouteSpecified||shouldForceStartId);if(shouldNavigateToStartId&&startId!==Adapt$1.course.get("_id"))return`#/id/${startId}`;return window.location.hash||"#/"}isEnabled(){return Boolean(this.model?.get("_isEnabled"))}getStartId(){let startId=this.model.get("_id");const startIds=this.model.get("_startIds");if(!startIds?.length)return startId;const $html=$("html");for(let i=0,l=startIds.length;i<l;i++){const item=startIds[i];const className=item._className;const skipIfComplete=item._skipIfComplete;const model=data$1.findById(item._id);if(!model){console.log("startController: cannot find id",item._id);continue}if(skipIfComplete&&model.get("_isComplete"))continue;if(!className||$html.is(className)||$html.hasClass(className)){startId=item._id;break}}return startId}onAdaptStart(){this.loadCourseData();this.setStartLocation()}}const startController=new StartController;var startController$1=__AMD("core/js/startController",startController);const COMPLETION_STATE=ENUM([["NOT ATTEMPTED","NOTATTEMPTED"],"INCOMPLETE","COMPLETED","PASSED","FAILED","UNKNOWN"]);var COMPLETION_STATE$1=__AMD("core/js/enums/completionStateEnum",COMPLETION_STATE);class Tracking extends Backbone.Controller{initialize(){this._config={_requireContentCompleted:true,_requireAssessmentCompleted:false,_submitOnEveryAssessmentAttempt:false,_shouldSubmitScore:false};this._assessmentState=null;Adapt$1.once("configModel:dataLoaded",this.loadConfig.bind(this));Adapt$1.on("app:dataReady",this.setupEventListeners.bind(this))}setupEventListeners(){this.listenTo(Adapt$1,{"assessment:complete":this.onAssessmentComplete,"assessment:restored":this.onAssessmentRestored,"scoring:complete":this.onScoringComplete,"scoring:restored":this.onScoringRestored});if(this._config._requireContentCompleted){this.listenTo(Adapt$1.course,"change:_isComplete",this.checkCompletion)}}submitScore(){const isPassed=Boolean(this._assessmentState?.isPass??this._assessmentState?.isPassed);Adapt$1.course.set("_isAssessmentPassed",isPassed);if(!this._config._shouldSubmitScore)return;offlineStorage$1.set("score",this._assessmentState.score,this._assessmentState.minScore,this._assessmentState.maxScore,this._assessmentState.isPercentageBased)}checkCompletion(){const completionData=this.getCompletionData();if(completionData.status===COMPLETION_STATE$1.INCOMPLETE)return;const canRetry=completionData.assessment?.canRetry;if(!this._config._submitOnEveryAssessmentAttempt&&completionData.status===COMPLETION_STATE$1.FAILED&&canRetry)return;Adapt$1.trigger("tracking:complete",completionData);logging$1.debug("tracking:complete",completionData)}getCompletionData(){const completionData={status:COMPLETION_STATE$1.INCOMPLETE,assessment:null};if(this._config._requireContentCompleted&&!Adapt$1.course.get("_isComplete"))return completionData;if(this._config._requireAssessmentCompleted){if(!this._assessmentState)return completionData;const isPassed=this._assessmentState?.isPass??this._assessmentState?.isPassed;completionData.status=isPassed?COMPLETION_STATE$1.PASSED:COMPLETION_STATE$1.FAILED;completionData.assessment=this._assessmentState;return completionData}completionData.status=COMPLETION_STATE$1.COMPLETED;return completionData}loadConfig(){Object.assign(this._config,Adapt$1.config.get("_completionCriteria"));const newShouldSubmitScore=this._config._shouldSubmitScore;const legacyShouldSubmitScore=Adapt$1.config.get("_spoor")?._tracking?._shouldSubmitScore;if(legacyShouldSubmitScore!==undefined)logging$1.deprecated("config.json:_spoor._tracking._shouldSubmitScore, please use only config.json:_completionCriteria._shouldSubmitScore");this._config._shouldSubmitScore=legacyShouldSubmitScore??newShouldSubmitScore??true}onAssessmentComplete(assessmentState){this.stopListening(Adapt$1,"scoring:complete",this.onScoringComplete);this.onScoringComplete(assessmentState)}onScoringComplete(state){this._assessmentState=state;this.submitScore();if(this._config._requireAssessmentCompleted)this.checkCompletion()}onAssessmentRestored(assessmentState){this.onScoringRestored(assessmentState)}onScoringRestored(state){if(this._assessmentState)return;this._assessmentState=state}}const tracking=new Tracking;var tracking$1=__AMD("core/js/tracking",tracking);const beginWait=()=>{logging$1.deprecated("Use wait.begin() as Adapt.trigger('plugin:beginWait') will be removed in the future");wait$1.begin()};const endWait=()=>{logging$1.deprecated("Use wait.end() as Adapt.trigger('plugin:endWait') will be removed in the future");wait$1.end()};const ready=()=>{if(wait$1.isWaiting()){return}const isEventListening=Adapt$1._events["plugins:ready"];if(!isEventListening){return}logging$1.deprecated("Use wait.queue(callback) as Adapt.on('plugins:ready', callback) will be removed in the future");Adapt$1.trigger("plugins:ready")};Adapt$1.listenTo(wait$1,"ready",ready);Adapt$1.on({"plugin:beginWait":beginWait,"plugin:endWait":endWait});Adapt$1.on({"drawer:remove"(){logging$1.deprecated("Use drawer.remove, Adapt.trigger('drawer:remove') will be removed in the future");drawer.remove()},"drawer:closeDrawer"($toElement){logging$1.deprecated("Use drawer.close, Adapt.trigger('drawer:closeDrawer') will be removed in the future");drawer.close($toElement)},"drawer:triggerCustomView"(){logging$1.deprecated("Use drawer.openCustomView(), Adapt.trigger('drawer:triggerCustomView') will be removed in the future");drawer.openCustomView()}});Object.defineProperties(drawer,{triggerCustomView:{get(){a11y$1.log.deprecated("drawer.triggerCustomView has moved to drawer.openCustomView");return drawer.openCustomView}}});Object.defineProperties(Adapt$1,{accessibility:{get(){a11y$1.log.deprecated("Adapt.accessibility has moved to a11y");return a11y$1}},a11y:{get(){logging$1.deprecated("Adapt.a11y, please use core/js/a11y directly");return a11y$1}},componentStore:{get(){logging$1.deprecated("Adapt.componentStore, please use core/js/components directly");return components$1._register}},data:{get(){logging$1.deprecated("Adapt.data, please use core/js/data directly");return data$1}},device:{get(){logging$1.deprecated("device, please use core/js/device directly");return device$1}},drawer:{get(){logging$1.deprecated("Adapt.drawer, please use core/js/drawer directly");return drawer}},findById:{get(){logging$1.deprecated("Adapt.findById, please use data.findById directly");return data$1.findById}},findViewByModelId:{get(){logging$1.deprecated("Adapt.findViewByModelId, please use data.findViewByModelId directly");return data$1.findViewByModelId}},findByTrackingPosition:{get(){logging$1.deprecated("Adapt.findByTrackingPosition, please use data.findByTrackingPosition directly");return data$1.findByTrackingPosition}},getViewName:{get(){logging$1.deprecated("Adapt.getViewName, please use components.getViewName instead");return components$1.getViewName}},getViewClass:{get(){logging$1.deprecated("Adapt.getViewClass, please use components.getViewClass instead");return components$1.getViewClass}},getModelName:{get(){logging$1.deprecated("Adapt.getModelName, please use components.getModelName instead");return components$1.getModelName}},getModelClass:{get(){logging$1.deprecated("Adapt.getModelClass, please use components.getModelClass instead");return components$1.getModelClass}},location:{get(){logging$1.deprecated("Adapt.location, please use core/js/location directly");return location$1}},log:{get(){logging$1.deprecated("Adapt.log, please use core/js/logging directly");return logging$1}},mpabc:{get(){logging$1.deprecated("Adapt.mpabc, please use core/js/mpabc directly");return mpabc$1}},notify:{get(){logging$1.deprecated("Adapt.notify, please use core/js/notify directly");return notify$1}},offlineStorage:{get(){logging$1.deprecated("offlineStorage, please use core/js/offlineStorage instead");return offlineStorage$1}},navigateToElement:{get(){logging$1.deprecated("Adapt.navigateToElement, please use router.navigateToElement");return router$1.navigateToElement}},register:{get(){logging$1.deprecated("Adapt.register, please use components.register instead");return components$1.register}},router:{get(){logging$1.deprecated("Adapt.router, please use core/js/router directly");return router$1}},scrolling:{get(){logging$1.deprecated("Adapt.scrolling, please use core/js/scrolling directly");return scrolling$1}},scrollTo:{get(){logging$1.deprecated("Adapt.scrollTo, please use router.navigateToElement");return scrolling$1.scrollTo}},startController:{get(){logging$1.deprecated("Adapt.startController, please use core/js/startController directly");return startController$1}},store:{get(){logging$1.deprecated("Adapt.store, please use core/js/components directly");return components$1._register}},tracking:{get(){logging$1.deprecated("Adapt.tracking, please use core/js/tracking directly");return tracking$1}},wait:{get(){logging$1.deprecated("Adapt.wait, please use core/js/wait instead");return wait$1}}});function onRender(cb){const intercept=(object,name,mode,cb)=>object[name]=cb.bind(object,object[name],name,mode);Object.keys(Handlebars.templates).forEach((name=>{intercept(Handlebars.templates,name,"template",cb)}));Object.keys(Handlebars.partials).forEach((name=>{intercept(Handlebars.partials,name,"partial",cb)}))}onRender(((template,name,mode,...args)=>{const preRenderEvent=new TemplateRenderEvent(`${mode}:preRender`,name,mode,null,args);Adapt$1.trigger(preRenderEvent.type,preRenderEvent);const value=template(...preRenderEvent.args);const postRenderEvent=new TemplateRenderEvent(`${mode}:postRender`,name,mode,value,preRenderEvent.args);Adapt$1.trigger(postRenderEvent.type,postRenderEvent);return postRenderEvent.value}));Adapt$1.on("app:dataReady",(()=>{const config=Adapt$1.config.get("_fixes");if(config?._imgLazyLoad===false)return;applyImgLoadingFix()}));function applyImgLoadingFix(){const findImgTag=/<img([^>]*)>/gi;const hasLoadingAttr=/ loading=/gi;Adapt$1.on("template:postRender partial:postRender",(event=>{const imgTagsFound=event.value.match(findImgTag);if(!imgTagsFound){return}event.value=imgTagsFound.reduce(((value,img)=>{if(hasLoadingAttr.test(img)){return value}return value.replace(img,img.replace(findImgTag,'<img loading="eager"$1>'))}),event.value)}));Adapt$1.on("reactElement:preRender",(event=>{if(event.name!=="img")return;const options=event.args[1]=event.args[1]||{};if(options&&Object.prototype.hasOwnProperty.call(options,"loading"))return;options.loading="eager"}))}Adapt$1.on("app:dataReady",(()=>{const config=Adapt$1.config.get("_fixes");if(config?._jsxReactHelpersHTML===false)return;applyReactHelpersHTML()}));function applyReactHelpersHTML(){Adapt$1.on("reactElement:preRender",(event=>{let[tagName,props,...children]=event.args;if(!children)return;if(!Array.isArray(children))children=[children];children=children.filter(Boolean);const hasSomeUnsafeConversions=children.some((c=>c?.__html));if(!hasSomeUnsafeConversions)return;const hasManyChildren=children.length>1;if(hasManyChildren){event.args=event.args.map((child=>{if(!child||!child.__html)return child;const attributes=Object.entries(props).map((([name,value])=>`${name}="${value}"`)).join(" ");logging$1.warnOnce(`html() call should be the only child in its parent <${tagName} ${attributes}>`);return child.__html?HTMLReactParser__default["default"](child.__html):undefined}));return}props=event.args[1]=event.args[1]||{};props.dangerouslySetInnerHTML=children[0];event.args.length=2}))}Adapt$1.on("app:dataReady",(()=>{const config=Adapt$1.config.get("_fixes");if(config?._safariLabelClickBlur===false)return;applySafariLabelClickBlur()}));function onLabelClick(event){const input=document.querySelector(`[id="${event.currentTarget.getAttribute("for")}"]`);if(!input)return;event.preventDefault();input.focus();input.click()}function applySafariLabelClickBlur(){Adapt$1.on("reactElement:preRender",(event=>{const[tagName,props]=event.args;if(tagName!=="label"||!Object.hasOwn(props,"htmlFor")||Object.hasOwn(props,"onClick"))return;props.onClick=onLabelClick}))}const helpers={lowercase(text){return text.toLowerCase()},capitalise(text){return text.charAt(0).toUpperCase()+text.slice(1)},inc(index){return index+1},dec(index){return index-1},odd(index){return(index+1)%2===0?"even":"odd"},equals(value,text,block){return helpers.compare.call(this,value,"==",text,block)},compare(value,operator,text,block){switch(operator){case"===":if(value===text)return block.fn?block.fn(this):true;break;case"=":case"==":if(value==text)return block.fn?block.fn(this):true;break;case">=":if(value>=text)return block.fn?block.fn(this):true;break;case"<=":if(value<=text)return block.fn?block.fn(this):true;break;case">":if(value>text)return block.fn?block.fn(this):true;break;case"<":if(value<text)return block.fn?block.fn(this):true;break}return block.inverse?block.inverse(this):false},math(lvalue,operator,rvalue,options){lvalue=parseFloat(lvalue);rvalue=parseFloat(rvalue);switch(operator){case"+":return lvalue+rvalue;case"-":return lvalue-rvalue;case"*":return lvalue*rvalue;case"/":return lvalue/rvalue;case"%":return lvalue%rvalue}},use(id,block){if(!block.fn)return;try{const model=data$1.findById(id);return block.fn(model.toJSON())}catch(err){}},any(...args){const specified=args.slice(0,-1);const block=args.slice(-1)[0];return specified.some(Boolean)?block.fn?block.fn(this):true:block.inverse?block.inverse(this):false},all(...args){const specified=args.slice(0,-1);const block=args.slice(-1)[0];return specified.every(Boolean)?block.fn?block.fn(this):true:block.inverse?block.inverse(this):false},none(...args){const specified=args.slice(0,-1);const block=args.slice(-1)[0];return!specified.some(Boolean)?block.fn?block.fn(this):true:block.inverse?block.inverse(this):false},compile(template,context){if(!template)return"";if(template instanceof Object)template=template.toString();const data=context?.data?.root?this:context;return Handlebars.compile(template)(data)},compile_a11y_text(template,context){logging$1.deprecated("a11y_text is no longer required. https://tink.uk/understanding-screen-reader-interaction-modes/");return helpers.compile.call(this,template,context)},compile_a11y_normalize(template,context){if(!template){return""}if(template instanceof Object)template=template.toString();return Handlebars.helpers.a11y_normalize.call(this,helpers.compile.call(this,template,context))},compile_a11y_remove_breaks(template,context){if(!template){return""}return Handlebars.helpers.a11y_remove_breaks.call(this,helpers.compile.call(this,template,context))},import_globals(context){if(context.data.root._globals){return""}context.data.root._globals=Adapt$1.course.get("_globals");return""},import_adapt(context){if(context.data.root.Adapt){return}const adapt=context.data.root.Adapt={};let i,l,name;const directImport=["config","course"];for(i=0,l=directImport.length;i<l;i++){name=directImport[i];adapt[name]=Adapt$1[name].toJSON()}const indexedImport=["contentObjects","articles","blocks","components"];for(i=0,l=indexedImport.length;i<l;i++){name=indexedImport[i];const importArray=Adapt$1[name].toJSON();const importIndex={};for(let i1=0,l1=importArray.length;i1<l1;i1++){const item=importArray[i1];importIndex[item._id]=item}adapt[name]=importIndex}return""},component_description(override,context){if(!this._isA11yComponentDescriptionEnabled){return}const isNotDefined=!this._globals._components?.["_"+this._component];if(isNotDefined){return}const hasOverride=arguments.length>1;let description;if(hasOverride){description=override;description=helpers.compile(description,context)}else{description=this._globals._components["_"+this._component].ariaRegion;description=helpers.compile(description,override)}if(!description){return}return new Handlebars.SafeString('<div class="aria-label">'+description+"</div>")},a11y_text(text){logging$1.deprecated("a11y_text is no longer required. https://tink.uk/understanding-screen-reader-interaction-modes/");return text},a11y_normalize(htmls){return a11y$1.normalize.apply(a11y$1,arguments)},a11y_remove_breaks(htmls){return a11y$1.removeBreaks.apply(a11y$1,arguments)},a11y_aria_label(htmls){let values=Array.prototype.slice.call(arguments,0,-1);values=values.filter(Boolean);return new Handlebars.SafeString('<div class="aria-label">'+values.join(" ")+"</div>")},a11y_aria_label_relative(htmls){let values=Array.prototype.slice.call(arguments,0,-1);values=values.filter(Boolean);return new Handlebars.SafeString('<div class="aria-label relative">'+values.join(" ")+"</div>")},a11y_aria_image(texts){let values=Array.prototype.slice.call(arguments,0,-1);values=values.filter(Boolean);return new Handlebars.SafeString('<div class="aria-label" role="img" aria-label="'+values.join(" ")+'"></div>')},a11y_wrap_focus(){const cfg=Adapt$1.config.get("_accessibility");if(cfg._options?._isPopupWrapFocusEnabled===false)return"";return new Handlebars.SafeString('<a class="a11y-focusguard a11y-ignore a11y-ignore-focus" tabindex="0" role="presentation">&nbsp;</a>')},a11y_attrs_heading(level){logging$1.deprecated("a11y_attrs_heading, please use a11y_aria_level or a11y.ariaLevel");const resolvedLevel=a11y$1.ariaLevel({id:this._id??Array.from(arguments).lastItem?.data?.root?._id,level:level,override:this._ariaLevel});return new Handlebars.SafeString(` role="heading" aria-level="${resolvedLevel}" `)},a11y_aria_level(id,level,override=null){const resolvedLevel=a11y$1.ariaLevel({id:id,level:level,override:override});return resolvedLevel},a11y_attrs_tabbable(){logging$1.deprecated("a11y_attrs_tabbable should not be used. tabbable elements should be natively tabbable.");return new Handlebars.SafeString(' role="region" tabindex="0" ')},a11y_alt_text(visible,alternatives){let values=Array.prototype.slice.call(arguments,1,-1);values=values.filter(Boolean);return new Handlebars.SafeString('<span aria-hidden="true">'+visible+'</span><span class="aria-label">'+values.join(" ")+"</span>")}};Object.assign(helpers,{if_value_equals(){logging$1.deprecated("if_value_equals, use equals instead.");return helpers.equals.apply(this,arguments)},numbers(){logging$1.deprecated("numbers, use inc instead.");return helpers.inc.apply(this,arguments)},lowerCase(){logging$1.deprecated("lowerCase, use lowercase instead.");return helpers.lowercase.apply(this,arguments)}});for(const name in helpers){Handlebars.registerHelper(name,helpers[name])}__AMD("core/js/helpers",helpers);class HeadingView extends Backbone.View{initialize({parentView:parentView}){this.listenTo(parentView,"preRemove",this.remove);this.listenTo(Adapt$1.parentView,"postRemove",this.remove);this.listenTo(this.model,"change:_isComplete",this.updateAria);this.render()}render(){const template=Handlebars.templates[this.constructor.template];const data=this.model.toJSON();const customHeadingType=this.$el.attr("data-a11y-heading-type");const isBackwardCompatible=[...this.$el[0].classList].every((name=>!name.includes("-inner")));data._isBackwardCompatible=isBackwardCompatible;if(customHeadingType)data._type=customHeadingType;this.$el.html(template(data));this.checkCompletion()}updateAria(){const template=Handlebars.templates[this.constructor.template];const data=this.model.toJSON();const $rendered=$(`<div>${template(data)}</div>`);this.$(".js-a11y-completion-description").html($rendered.find(".js-a11y-completion-description").html());this.checkCompletion()}checkCompletion(){const isComplete=this.model.get("_isComplete");if(isComplete===undefined)return;this.$el.toggleClass("is-complete",isComplete).toggleClass("is-incomplete",!isComplete)}}HeadingView.template="heading";var HeadingView$1=__AMD("core/js/views/headingView",HeadingView);class Headings extends Backbone.Controller{initialize(){this.listenTo(Adapt$1,"view:render",this.onViewRender)}onViewRender(view){const $headingSeats=view.$(".js-heading");$headingSeats.each(((index,el)=>new HeadingView$1({el:el,model:view.model,parentView:view})))}}__AMD("core/js/headings",new Headings);var NavigationButtonView=__AMD("core/js/views/NavigationButtonView",class NavigationButtonView extends Backbone.View{tagName(){return"button"}events(){return{click:"triggerEvent"}}className(){if(this.isInjectedButton){return[this.model.get("_showLabel")===false&&"hide-label"].filter(Boolean).join(" ")}return["btn-icon nav__btn",this.model.get("_classes"),this.model.get("_showLabel")===false&&"hide-label"].filter(Boolean).join(" ")}attributes(){const attributes=this.model.toJSON();if(this.isInjectedButton){return{name:attributes._id,"data-order":attributes._order,"data-event":attributes._event}}return{name:attributes._id,role:attributes._role==="button"?undefined:attributes._role,"aria-label":attributes.ariaLabel,"data-order":attributes._order,"data-event":attributes._event}}initialize({el:el}){if(el){this.isInjectedButton=true}else{this.isJSX=(this.constructor.template||"").includes(".jsx")}this._classSet=new Set(_.result(this,"className").trim().split(/\s+/));this._attributes=_.result(this,"attributes");this.listenTo(this.model,"change",this.changed);this.render()}static get template(){return"navButton.jsx"}render(){if(this.isInjectedButton){this.changed()}else if(this.isJSX){this.changed()}else{const data=this.model.toJSON();data.view=this;const template=Handlebars.templates[this.constructor.template];this.$el.html(template(data))}return this}updateViewProperties(){const classesToAdd=_.result(this,"className").trim().split(/\s+/);classesToAdd.forEach((i=>this._classSet.add(i)));const classesToRemove=[...this._classSet].filter((i=>!classesToAdd.includes(i)));classesToRemove.forEach((i=>this._classSet.delete(i)));Object.keys(this._attributes).forEach((name=>this.$el.removeAttr(name)));Object.entries(_.result(this,"attributes")).forEach((([name,value])=>this.$el.attr(name,value)));this.$el.removeClass(classesToRemove).addClass(classesToAdd)}injectLabel(){const textLabel=this.$el.find("> .nav__btn-label");const ariaLabel=this.$el.attr("aria-label")??this.$el.find(".aria-label").text();const text=this.model.get("text");const output=compile(text??"",{ariaLabel:ariaLabel});if(!textLabel.length){this.$el.append(`<span class="nav__btn-label" aria-hidden="true">${output}</span>`);return}textLabel.html(output)}changed(eventName=null){if(typeof eventName==="string"&&eventName.startsWith("bubble")){return}if(this.isInjectedButton){this.updateViewProperties();this.injectLabel();return}if(!this.isJSX){this.updateViewProperties();return}const props={...this,...this.model.toJSON(),_globals:Adapt$1.course?.get("_globals")};const Template=templates[this.constructor.template.replace(".jsx","")];this.updateViewProperties();ReactDOM__default["default"].render(React__default["default"].createElement(Template,props),this.el)}triggerEvent(event){event.preventDefault();const currentEvent=$(event.currentTarget).attr("data-event");if(!currentEvent)return;Adapt$1.trigger("navigation:"+currentEvent);switch(currentEvent){case"backButton":router$1.navigateToPreviousRoute();break;case"homeButton":router$1.navigateToHomeRoute();break;case"parentButton":router$1.navigateToParent();break;case"skipNavigation":_.delay((()=>{a11y$1.focusFirst("."+location$1._contentType)}),250);break;case"returnToStart":startController$1.returnToStartLocation();break}}remove(){this._isRemoved=true;this.stopListening();wait$1.for((end=>{if(this.isJSX){ReactDOM__default["default"].unmountComponentAtNode(this.el)}super.remove();end()}));return this}});var NavigationButtonModel=__AMD("core/js/models/NavigationButtonModel",class NavigationButtonModel extends LockingModel{defaults(){return{_id:"",_classes:"",_iconClasses:"",_order:0,_event:"",_showLabel:null,_role:"button",ariaLabel:"",text:"{{ariaLabel}}"}}});class NavigationView$1 extends Backbone.View{className(){return["nav",this.model?.get("_showLabel")===true?"show-label":"hide-label",`show-label-${this.model?.get("_showLabelAtWidth")||"medium"}`,`has-label-${this.model?.get("_labelPosition")||"auto"}`].filter(Boolean).join(" ")}attributes(){return{role:"navigation"}}get buttons(){return this._buttons=this._buttons||[]}set buttons(value){this._buttons=value}initialize(){___default["default"].bindAll(this,"sortNavigationButtons");this._classSet=new Set(___default["default"].result(this,"className").trim().split(/\s+/))}start(model){tooltips$1.register({_id:"back",...Adapt$1.course.get("_globals")?._extensions?._navigation?._backNavTooltip||{}});this.model=model;this.listenTo(model,"change",this.update);this.listenToOnce(Adapt$1,"courseModel:dataLoading",this.remove);this.listenTo(Adapt$1,{"router:contentObject":this.hideNavigationButton,"adapt:preInitialize device:resize":this.onDeviceResize});this.update();this.preRender()}update(){this.updateViewProperties();this.onDeviceResize()}onDeviceResize(){let{_navigationAlignment:_navigationAlignment="top",_isBottomOnTouchDevices:_isBottomOnTouchDevices=false}=this.model.toJSON();const $html=$("html");const isBottomOnTouchDevices=device$1.touch&&_isBottomOnTouchDevices;if(isBottomOnTouchDevices)_navigationAlignment="bottom";$html.removeClass("is-nav-top is-nav-bottom").addClass("is-nav-"+_navigationAlignment)}preRender(){Adapt$1.trigger("navigationView:preRender",this);this.render()}render(){const template=Handlebars.templates[this.constructor.template];this.$el.html(template({_config:Adapt$1.config.toJSON(),_globals:Adapt$1.course.get("_globals"),_accessibility:Adapt$1.config.get("_accessibility")})).insertBefore("#app");this.sortNavigationButtons();___default["default"].defer((()=>{Adapt$1.trigger("navigationView:postRender navigation:ready",this)}));return this}updateViewProperties(){const classesToAdd=___default["default"].result(this,"className").trim().split(/\s+/);classesToAdd.forEach((i=>this._classSet.add(i)));const classesToRemove=[...this._classSet].filter((i=>!classesToAdd.includes(i)));classesToRemove.forEach((i=>this._classSet.delete(i)));this._setAttributes({...___default["default"].result(this,"attributes"),id:___default["default"].result(this,"id")});this.$el.removeClass(classesToRemove).addClass(classesToAdd)}listenForInjectedButtons(){this.observer=this.observer||new MutationObserver(this.sortNavigationButtons);this.observer.observe(this.$(".nav__inner")[0],{childList:true,attributes:true,subtree:true})}sortNavigationButtons(changed){if(Array.isArray(changed)){const changes=Object.entries(changed.reduce(((changes,change)=>{const changeTypeName=`${change.type}.${change.attributeName}`;changes[changeTypeName]=changes[changeTypeName]||0;changes[changeTypeName]++;return changes}),{}));const shouldIgnore=changes.every((([key])=>["attributes.data-a11y-force-focus","attributes.tabindex","attributes.aria-hidden"].includes(key)));if(shouldIgnore)return}this.observer?.disconnect();const $container=this.$(".nav__inner");const items=[...$container[0].children];const identifiers={".js-nav-drawer-btn":"drawer",".js-nav-back-btn":"back",".js-nav-home-btn":"home","*":null};items.forEach((el=>{const $el=$(el);if($el.is(".nav__spacer"))return;const foundId=($el.attr("name")??Object.entries(identifiers).find((([classes])=>$el.is(classes)))?.[1])||$el.attr("class");const attributes={_id:foundId,_order:parseFloat($el.attr("data-order")||0),_event:$el.attr("data-event")};const existingButton=this.getButton(attributes._id);if(existingButton){if(!existingButton.isInjectedButton)return;if(existingButton.el!==el){existingButton.undelegateEvents();existingButton.el=el;existingButton.$el=$(el);existingButton.delegateEvents()}existingButton.model.set(attributes);existingButton.changed();return}const navigationButtonModel=new NavigationButtonModel(attributes);this.addButton(new NavigationButtonView({el:el,model:navigationButtonModel}))}));const focusElement=document.activeElement;const domOrder=[...$container[0].children];items.sort(((a,b)=>parseFloat($(a).attr("data-order")||0)-parseFloat($(b).attr("data-order")||0)));const hasOrderChanged=domOrder.some(((item,index)=>item!==items[index]));if(hasOrderChanged){let indexOfFocused=items.findIndex((el=>el===focusElement));if(indexOfFocused===-1)indexOfFocused=Infinity;const before=items.slice(0,indexOfFocused);const after=items.slice(indexOfFocused+1);before.reverse().forEach((el=>$container.prepend(el)));after.forEach((el=>$container.append(el)))}this.observer?.takeRecords();device$1.setNavigationHeight();this.listenForInjectedButtons()}hideNavigationButton(contentObjectModel){const shouldHide=contentObjectModel.get("_type")==="course";this.$(".nav__back-btn, .nav__home-btn").toggleClass("u-display-none",shouldHide)}showNavigationButton(){this.$(".nav__back-btn, .nav__home-btn").removeClass("u-display-none")}addButton(buttonView){this.buttons.push(buttonView);const container=this.$(".nav__inner");container.append(buttonView.$el);this.listenTo(buttonView.model,"change",this.sortNavigationButtons);if(buttonView.isInjectedButton)return;this.sortNavigationButtons()}getButton(id){return this.buttons.find((button=>button.model.get("_id")===id))}removeButton(buttonView){this.buttons=this.buttons.filter((view=>view!==buttonView));this.stopListening(buttonView.model,"change",this.sortNavigationButtons);if(buttonView.isInjectedButton){buttonView.$el.remove();return}buttonView.remove()}}NavigationView$1.template="nav";var NavigationView$2=__AMD("core/js/views/navigationView",NavigationView$1);var NavigationModel=__AMD("core/js/models/NavigationModel",class NavigationModel extends LockingModel{defaults(){return{_navigationAlignment:"top",_isBottomOnTouchDevices:false,_showLabel:false,_showLabelAtWidth:"medium",_labelPosition:"auto"}}});class NavigationController extends Backbone.Controller{initialize(){this.navigation=new NavigationView$2;this.listenTo(Adapt$1,"adapt:preInitialize",this.addNavigationBar)}addNavigationBar(){const adaptConfig=Adapt$1.course.get("_navigation");if(adaptConfig?._isDefaultNavigationDisabled){Adapt$1.trigger("navigation:initialize");return}this.navigation.start(new NavigationModel(adaptConfig))}}var navigation=__AMD("core/js/navigation",Adapt$1.navigation=(new NavigationController).navigation);class ComponentView extends AdaptView$1{attributes(){if(!this.model.get("_isA11yRegionEnabled")){return AdaptView$1.resultExtend("attributes",{},this)}return AdaptView$1.resultExtend("attributes",{"aria-labelledby":this.model.get("_id")+"-heading",role:"region"},this)}className(){return["component",this.model.get("_component").toLowerCase(),this.model.get("_id"),this.model.get("_classes"),this.setVisibility(),this.setHidden(),"is-"+this.model.get("_layout"),this.model.get("_isComplete")?"is-complete":"",this.model.get("_isOptional")?"is-optional":""].join(" ")}renderState(){logging$1.removed("renderState is removed and moved to item title")}setupInviewCompletion(inviewElementSelector=".component__inner",callback=this.setCompletionStatus){this.$inviewElement=this.$(inviewElementSelector);this.inviewCallback=callback;this.$inviewElement.on("inview.componentView",this.onInview.bind(this))}removeInviewListener(){if(!this.$inviewElement)return;this.$inviewElement.off("inview.componentView");this.$inviewElement=null}onInview(event,visible,visiblePartX,visiblePartY){if(!visible)return;switch(visiblePartY){case"top":this.hasSeenTop=true;break;case"bottom":this.hasSeenBottom=true;break;case"both":this.hasSeenTop=this.hasSeenBottom=true}if(!this.hasSeenTop||!this.hasSeenBottom)return;this.inviewCallback();if(this.model.get("_isComplete")){this.removeInviewListener()}}postRender(){}remove(){this.removeInviewListener();super.remove()}}ComponentView.type="component";var ComponentView$1=__AMD("core/js/views/componentView",ComponentView);const BUTTON_STATE=ENUM(["SUBMIT","CORRECT","INCORRECT","SHOW_CORRECT_ANSWER","HIDE_CORRECT_ANSWER","SHOW_FEEDBACK","RESET"]);var BUTTON_STATE$1=__AMD("core/js/enums/buttonStateEnum",BUTTON_STATE);const textPropertyName={SUBMIT:"submit",CORRECT:"correct",INCORRECT:"incorrect",SHOW_CORRECT_ANSWER:"showCorrectAnswer",HIDE_CORRECT_ANSWER:"hideCorrectAnswer",SHOW_FEEDBACK:"showFeedback",RESET:"reset"};var ButtonsView=__AMD("core/js/views/buttonsView",class ButtonsView extends Backbone.View{initialize(options){this.parent=options.parent;this.listenTo(Adapt$1.parentView,"postRemove",this.remove);this.listenTo(this.model,{"change:_buttonState":this.onButtonStateChanged,"change:feedbackMessage":this.onFeedbackMessageChanged,"change:feedbackTitle":this.onFeedbackMessageChanged,"change:_attemptsLeft":this.onAttemptsChanged,"change:_canSubmit":this.onCanSubmitChange});this.render()}events(){return{"click .js-btn-action":"onActionClicked","click .js-btn-feedback":"onFeedbackClicked"}}render(){const data=this.model.toJSON();const template=Handlebars.templates[data._buttonsTemplate||"buttons"];_.defer((()=>{this.postRender();Adapt$1.trigger("buttonsView:postRender",this)}));this.$el.html(template(data))}postRender(){this.refresh()}checkResetSubmittedState(){const isSubmitted=this.model.get("_isSubmitted");if(isSubmitted){this.$el.addClass("is-submitted");return}this.$(".js-btn-marking, .js-btn-marking-label").removeClass("is-incorrect is-correct").addClass("u-display-none");this.$el.removeClass("is-submitted");this.model.set("feedbackMessage",undefined);this.disableFeedbackButton()}onActionClicked(){const buttonState=BUTTON_STATE$1(this.model.get("_buttonState"));this.trigger("buttons:stateUpdate",buttonState);this.checkResetSubmittedState();if(buttonState===BUTTON_STATE$1.SHOW_CORRECT_ANSWER){const correctAnswer=this.model.getCorrectAnswerAsText?.();this.updateAnswerLiveRegion(correctAnswer)}if(buttonState===BUTTON_STATE$1.HIDE_CORRECT_ANSWER){const userAnswer=this.model.getUserAnswerAsText?.();this.updateAnswerLiveRegion(userAnswer)}}onFeedbackClicked(){this.trigger("buttons:stateUpdate",BUTTON_STATE$1.SHOW_FEEDBACK)}onFeedbackMessageChanged(model,changedAttribute){if(!changedAttribute)return;this.enableFeedbackButton()}enableFeedbackButton(){if(!this.model.get("_canShowFeedback"))return;a11y$1.toggleEnabled(this.$(".js-btn-feedback"),true)}disableFeedbackButton(){a11y$1.toggleEnabled(this.$(".js-btn-feedback"),false)}onCanSubmitChange(){this.onButtonStateChanged(this.model,this.model.get("_buttonState"))}onButtonStateChanged(model,changedAttribute){this.updateAttemptsCount();const $buttonsAction=this.$(".js-btn-action");const buttonState=BUTTON_STATE$1(changedAttribute);if(!buttonState){return logging$1.error(`No button state found for '${changedAttribute}'`)}if(changedAttribute===BUTTON_STATE$1.CORRECT||changedAttribute===BUTTON_STATE$1.INCORRECT){a11y$1.toggleEnabled($buttonsAction,false);return}const propertyName=textPropertyName[buttonState.asString];const ariaLabel=this.model.get("_buttons")["_"+propertyName].ariaLabel;const buttonText=this.model.get("_buttons")["_"+propertyName].buttonText;const isEnabled=buttonState===BUTTON_STATE$1.SUBMIT&&this.model.get("_canSubmit")||buttonState!==BUTTON_STATE$1.SUBMIT;a11y$1.toggleEnabled($buttonsAction,isEnabled);$buttonsAction.html(buttonText).attr("aria-label",ariaLabel)}checkFeedbackState(){const canShowFeedback=this.model.get("_canShowFeedback");const canShowMarking=this.model.get("_canShowMarking");this.$(".js-btn-action, .js-btn-marking").toggleClass("is-full-width",!canShowFeedback);this.$(".js-btn-feedback").toggleClass("u-display-none",!canShowFeedback);this.$(".js-btn-marking, .js-btn-marking-label").toggleClass("u-display-none",!canShowMarking)}updateAttemptsCount(){const isInteractionComplete=this.model.get("_isInteractionComplete");const attemptsLeft=this.model.get("_attemptsLeft")?this.model.get("_attemptsLeft"):this.model.get("_attempts");const shouldDisplayAttempts=this.model.get("_shouldDisplayAttempts");let attemptsString;this.checkResetSubmittedState();if(!isInteractionComplete&&attemptsLeft>=0){attemptsString=attemptsLeft+" ";attemptsString+=attemptsLeft===1?this.model.get("_buttons").remainingAttemptText:this.model.get("_buttons").remainingAttemptsText}else{this.$(".js-display-attempts").addClass("u-visibility-hidden");this.showMarking()}if(shouldDisplayAttempts){this.$(".js-insert-attempts-string").html(attemptsString)}}updateAnswerLiveRegion(answer){if(!answer)return;this.$(".js-answer-live-region").html(answer)}showMarking(){if(!this.model.shouldShowMarking)return;const isCorrect=this.model.get("_isCorrect");const isPartlyCorrect=this.model.get("_isPartlyCorrect");const ariaLabels=Adapt$1.course.get("_globals")._accessibility._ariaLabels;const $marking=this.$(".js-btn-marking, .js-btn-marking-label").removeClass("u-display-none").addClass(isCorrect?"is-correct":"is-incorrect");const $ariaLabel=this.$(".js-btn-marking-label");const hasSpanAriaLabel=Boolean($ariaLabel.length);const correctnessAriaLabel=isCorrect?ariaLabels.answeredCorrectly:isPartlyCorrect?ariaLabels.answeredPartlyCorrect??ariaLabels.answeredIncorrectly:ariaLabels.answeredIncorrectly;if(!hasSpanAriaLabel){$marking.attr("aria-label",correctnessAriaLabel);return}$ariaLabel.html(correctnessAriaLabel)}refresh(){this.updateAttemptsCount();this.checkResetSubmittedState();this.checkFeedbackState();this.onButtonStateChanged(null,this.model.get("_buttonState"));this.onFeedbackMessageChanged(null,this.model.get("_isSubmitted"))}});class QuestionModel extends ComponentModel$1{defaults(){return ComponentModel$1.resultExtend("defaults",{_isQuestionType:true,_shouldDisplayAttempts:false,_shouldShowMarking:false,_canShowCorrectness:false,_canShowModelAnswer:true,_canShowFeedback:true,_canShowMarking:true,_canSubmit:true,_isSubmitted:false,_isCorrectAnswerShown:false,_questionWeight:Adapt$1.config.get("_questionWeight"),_hasItemScoring:false,_items:[]})}trackable(){return ComponentModel$1.resultExtend("trackable",["_isSubmitted","_score","_isCorrect","_attemptsLeft","_isPartlyCorrect"])}trackableType(){return ComponentModel$1.resultExtend("trackableType",[Boolean,Number,Boolean,Number,Boolean])}lockedAttributes(){return ComponentModel$1.resultExtend("lockedAttributes",{_canSubmit:true})}getTypeGroup(){return"question"}init(){this._contextActivities=[];this.setupDefaultSettings();this.updateRawScore();super.init()}setupDefaultSettings(){this.setupWeightSettings();this.setupButtonSettings()}setupButtonSettings(){const globalButtons=Adapt$1.course.get("_buttons");if(!this.has("_buttons")){this.set("_buttons",globalButtons)}else{const componentButtons=this.get("_buttons");for(const key in componentButtons){if(typeof componentButtons[key]==="object"){if(!componentButtons[key].buttonText&&globalButtons[key].buttonText){componentButtons[key].buttonText=globalButtons[key].buttonText}if(!componentButtons[key].ariaLabel&&globalButtons[key].ariaLabel){componentButtons[key].ariaLabel=globalButtons[key].ariaLabel}}if(!componentButtons[key]&&globalButtons[key]){componentButtons[key]=globalButtons[key]}}}}setupWeightSettings(){}canSubmit(){}checkCanSubmit(){this.set("_canSubmit",this.canSubmit(),{pluginName:"adapt"})}updateAttempts(){const attemptsLeft=this.get("_attemptsLeft")||this.get("_attempts");this.set("_attemptsLeft",attemptsLeft-1)}setQuestionAsSubmitted(){this.set({_isEnabled:false,_isSubmitted:true,_shouldShowMarking:this.shouldShowMarking})}markQuestion(){this.set({_isCorrect:this.isCorrect(),_isPartlyCorrect:this.isPartlyCorrect()});this.updateRawScore()}isCorrect(){}isPartlyCorrect(){}setScore(){const questionWeight=this.get("_questionWeight");const answeredCorrectly=this.get("_isCorrect");const score=answeredCorrectly?questionWeight:0;this.set("_score",score)}updateRawScore(){this.set({_rawScore:this.score,_maxScore:this.maxScore,_minScore:this.minScore})}get score(){return this.get("_isCorrect")?this.maxScore:0}get maxScore(){return this.get("_questionWeight")}get minScore(){return 0}checkQuestionCompletion(){const isComplete=this.get("_isCorrect")||this.get("_attemptsLeft")===0;if(isComplete){this.setCompletionStatus()}return isComplete}updateButtons(){const isInteractionComplete=this.get("_isInteractionComplete");const isCorrect=this.get("_isCorrect");const isEnabled=this.get("_isEnabled");const buttonState=this.get("_buttonState");const canShowModelAnswer=this.get("_canShowModelAnswer");const canShowCorrectness=this.get("_canShowCorrectness");if(isInteractionComplete){if(isCorrect||!canShowModelAnswer||canShowCorrectness){this.set("_buttonState",BUTTON_STATE$1.CORRECT)}else{switch(buttonState){case BUTTON_STATE$1.SUBMIT:case BUTTON_STATE$1.HIDE_CORRECT_ANSWER:this.set("_buttonState",BUTTON_STATE$1.SHOW_CORRECT_ANSWER);break;default:this.set("_buttonState",BUTTON_STATE$1.HIDE_CORRECT_ANSWER)}}}else{if(isEnabled){this.set("_buttonState",BUTTON_STATE$1.SUBMIT)}else{this.set("_buttonState",BUTTON_STATE$1.RESET)}}}getFeedback(feedback=this.get("_feedback")){if(!feedback)return{};const isFinal=this.get("_attemptsLeft")===0;const isCorrect=this.get("_isCorrect");const correctness=isCorrect?"correct":this.isPartlyCorrect()?"partlyCorrect":"incorrect";const isLegacyConfig=typeof feedback.correct==="string"||typeof feedback._partlyCorrect==="object"||typeof feedback._incorrect==="object";const getLegacyConfigObject=()=>{const subPart=isFinal?"final":"notFinal";return{body:(isCorrect?feedback.correct:feedback[`_${correctness}`]?.[subPart]||feedback[`_${correctness}`]?.final||feedback._incorrect?.final)||""}};const getConfigObject=()=>{const subPart=isFinal?"Final":"NotFinal";return(isCorrect?feedback._correct:feedback[`_${correctness}${subPart}`]||feedback[`_${correctness}Final`]||feedback._incorrectFinal)||{}};const altFeedbackTitle=Adapt$1.course.get("_globals")._accessibility.altFeedbackTitle;const hasTitle=Boolean(feedback.title||this.get("title"));const isAltTitle=Boolean(feedback.altTitle)||!hasTitle&&altFeedbackTitle;const title=feedback.altTitle||feedback.title||this.get("title")||altFeedbackTitle||"";const feedbackConfig={isAltTitle:isAltTitle,title:Handlebars.compile(title)(this.toJSON()),_classes:feedback._classes,...isLegacyConfig?getLegacyConfigObject():getConfigObject()};if(feedbackConfig._graphic?._src&&!feedbackConfig._imageAlignment){feedbackConfig._imageAlignment="right"}return feedbackConfig}setupFeedback(){if(!this.has("_feedback"))return;const{title:title="",body:body=""}=this.getFeedback();this.set({feedbackTitle:Handlebars.compile(title)(this.toJSON()),feedbackMessage:Handlebars.compile(body)(this.toJSON())})}isInteractive(){return!this.get("_isComplete")||this.get("_isEnabled")&&!this.get("_isSubmitted")}checkIfResetOnRevisit(){super.checkIfResetOnRevisit();this.set("_buttonState",this.get("_isInteractionComplete")?BUTTON_STATE$1.HIDE_CORRECT_ANSWER:BUTTON_STATE$1.SUBMIT)}reset(type="hard",canReset=this.get("_canReset")){const wasReset=super.reset(type,canReset);if(!wasReset)return false;const attempts=this.get("_attempts");this.set({_attemptsLeft:attempts,_isCorrect:undefined,_isPartlyCorrect:undefined,_isCorrectAnswerShown:false,_isSubmitted:false,_buttonState:BUTTON_STATE$1.SUBMIT,_shouldShowMarking:this.shouldShowMarking});this._contextActivities=[];return true}setQuestionAsReset(){this.set({_isEnabled:true,_isSubmitted:false,_shouldShowMarking:this.shouldShowMarking});this.resetQuestion()}resetQuestion(){}refresh(){this.trigger("question:refresh")}getButtonState(){if(this.get("_isCorrect")){return BUTTON_STATE$1.CORRECT}if(this.get("_attemptsLeft")===0){const canShowModelAnswer=this.get("_canShowModelAnswer");const canShowCorrectness=this.get("_canShowCorrectness");return canShowModelAnswer&&!canShowCorrectness?BUTTON_STATE$1.SHOW_CORRECT_ANSWER:BUTTON_STATE$1.INCORRECT}return this.get("_isSubmitted")?BUTTON_STATE$1.RESET:BUTTON_STATE$1.SUBMIT}getInteractionObject(){return{}}addContentObjectContextActivities(){this.getAncestorModels().reverse().filter((model=>model.isTypeGroup("contentobject"))).forEach((model=>{const id=model.get("_id");const type=model.get("_type");const title=model.get("title")||model.get("displayTitle");this.addContextActivity(id,type,title)}))}addContextActivity(id,type,title){const entry={id:id,type:type,title:title};const index=this.contextActivities.findIndex((activity=>activity.id===id));const isIncluded=index!==-1;if(isIncluded){this.contextActivities[index]=entry;return}this.contextActivities.push(entry)}get contextActivities(){return this._contextActivities}getResponse(){}getResponseType(){}onSubmitted(){if(this.get("_shouldStoreAttempts"))this.addAttemptObject();this.set("_shouldShowMarking",this.shouldShowMarking);this.addContentObjectContextActivities()}get shouldShowMarking(){return!this.isInteractive()&&this.get("_canShowMarking")&&this.get("_isInteractionComplete")}}components$1.register("question",{model:QuestionModel});var QuestionModel$1=__AMD("core/js/models/questionModel",QuestionModel);class QuestionView extends ComponentView$1{className(){const canShowCorrectness=this.model.get("_canShowCorrectness");const canShowModelAnswer=this.model.get("_canShowModelAnswer");return["component","is-question",this.model.get("_component").toLowerCase(),this.model.get("_id"),this.model.get("_classes"),this.setVisibility(),"is-"+this.model.get("_layout"),this.model.get("_isComplete")?"is-complete":"",this.model.get("_isOptional")?"is-optional":"",canShowCorrectness?"can-show-correctness":"",canShowModelAnswer&&!canShowCorrectness?"can-show-model-answer":"",this.model.get("_canShowFeedback")?"can-show-feedback":"",this.model.get("_canShowMarking")?"can-show-marking":""].join(" ")}initialize(...args){this.isInteractive=this.isInteractive.bind(this);super.initialize(...args)}isInteractive(){logging$1.deprecated("questionView.isInteractive please use this.model.isInteractive, this.model.get('_shouldShowMarking') or this.model.shouldShowMarking");return this.model.isInteractive()}preRender(){this.listenTo(this.model,{"change:_isEnabled":this.onEnabledChanged,"question:refresh":this.refresh});if(this.checkIfResetOnRevisit!==QuestionView.prototype.checkIfResetOnRevisit){logging$1.deprecated("QuestionView.checkIfResetOnRevisit, please use QuestionModel.checkIfResetOnRevisit")}this.checkIfResetOnRevisit();_.defer((()=>this.ensureLegacyLifecycleState()));this._runModelCompatibleFunction("setupDefaultSettings");this.setupQuestion()}onEnabledChanged(model,changedAttribute){if(!changedAttribute){this.$(".component__widget").addClass("is-disabled");this.disableQuestion()}else{this.$(".component__widget").removeClass("is-disabled");this.enableQuestion()}}disableQuestion(){}enableQuestion(){}checkIfResetOnRevisit(){const canReset=this.model.get("_canReset")!==false;const isResetOnRevisit=this.model.get("_isResetOnRevisit");if(!canReset||!isResetOnRevisit)return;if(this.resetQuestionOnRevisit===QuestionView.prototype.resetQuestionOnRevisit)return;logging$1.deprecated("QuestionView.resetQuestionOnRevisit, please QuestionModel.reset");_.defer((()=>{this.resetQuestionOnRevisit(isResetOnRevisit)}))}ensureLegacyLifecycleState(){if(this.model.get("_isSubmitted")){this.onHideCorrectAnswerClicked();return}this.onResetClicked()}resetQuestionOnRevisit(type){}setupQuestion(){}postRender(){this.addButtonsView();this.onQuestionRendered()}addButtonsView(){this.buttonsView=new ButtonsView({model:this.model,el:this.$(".btn__container")});this.listenTo(this.buttonsView,"buttons:stateUpdate",this.onButtonStateUpdate)}onButtonStateUpdate(buttonState){switch(buttonState){case BUTTON_STATE$1.SUBMIT:this.onSubmitClicked();break;case BUTTON_STATE$1.RESET:this.onResetClicked();break;case BUTTON_STATE$1.SHOW_CORRECT_ANSWER:this.onShowCorrectAnswerClicked();break;case BUTTON_STATE$1.HIDE_CORRECT_ANSWER:this.onHideCorrectAnswerClicked();break;case BUTTON_STATE$1.SHOW_FEEDBACK:this.showFeedback();break}}onQuestionRendered(){}onSubmitClicked(){const canSubmit=this._runModelCompatibleFunction("canSubmit");this.model.toggleClass("has-error",!canSubmit);if(!canSubmit){this.showInstructionError();this.onCannotSubmit();return}this.stopRendering();this._runModelCompatibleFunction("updateAttempts");this._runModelCompatibleFunction("setQuestionAsSubmitted");this._runModelCompatibleFunction("storeUserAnswer");this._runModelCompatibleFunction("markQuestion","isCorrect");this._runModelCompatibleFunction("setScore");this._runModelCompatibleFunction("checkQuestionCompletion");if(this.model.shouldShowMarking){this.showMarking()}this._runModelCompatibleFunction("setupFeedback");this.showFeedback();$(window).resize();this._runModelCompatibleFunction("updateButtons");this.startRendering();this.changed();this.model.onSubmitted();this.onSubmitted();Adapt$1.trigger("questionView:submitted",this);this.recordInteraction()}showInstructionError(){Adapt$1.trigger("questionView:showInstructionError",this)}onCannotSubmit(){}onSubmitted(){}setQuestionAsSubmitted(){this.model.setQuestionAsSubmitted();this.$(".component__widget").addClass("is-submitted")}showMarking(){}checkQuestionCompletion(){const isComplete=this.model.checkQuestionCompletion();if(isComplete){this.$(".component__widget").addClass("is-complete show-user-answer")}}recordInteraction(){if(this.model.get("_recordInteraction")===true||!this.model.has("_recordInteraction")){Adapt$1.trigger("questionView:recordInteraction",this)}}showFeedback(){if(this.model.get("_canShowFeedback")){Adapt$1.trigger("questionView:showFeedback",this)}else{Adapt$1.trigger("questionView:disabledFeedback",this)}}onResetClicked(){this.setQuestionAsReset();this._runModelCompatibleFunction("resetUserAnswer");this.model.checkCanSubmit();this._runModelCompatibleFunction("updateButtons");if(!this.model.get("_isReady"))return;const currentModel=data$1.findById(location$1._currentId);if(!currentModel?.get("_isReady"))return;this.focusAfterReset()}setQuestionAsReset(){this.model.setQuestionAsReset();this.resetQuestion();this.$(".component__widget").removeClass("is-submitted")}focusAfterReset(){a11y$1.focusNext(this.$el)}resetQuestion(){}refresh(){this.model.set("_buttonState",this.model.getButtonState());if(this.model.shouldShowMarking){this.showMarking()}if(this.buttonsView){_.defer(this.buttonsView.refresh.bind(this.buttonsView))}}onShowCorrectAnswerClicked(){this.setQuestionAsShowCorrect();this._runModelCompatibleFunction("updateButtons");this.showCorrectAnswer()}setQuestionAsShowCorrect(){this.$(".component__widget").addClass("is-submitted show-correct-answer").removeClass("show-user-answer")}showCorrectAnswer(){this.model.set("_isCorrectAnswerShown",true)}onHideCorrectAnswerClicked(){this.setQuestionAsHideCorrect();this._runModelCompatibleFunction("updateButtons");this.hideCorrectAnswer()}setQuestionAsHideCorrect(){this.$(".component__widget").addClass("is-submitted show-user-answer").removeClass("show-correct-answer")}hideCorrectAnswer(){this.model.set("_isCorrectAnswerShown",false)}getLatency(){return null}_runModelCompatibleFunction(name,lookForViewOnlyFunction){return this.model[name]()}}QuestionView._isQuestionType=true;class ViewOnlyQuestionViewCompatibilityLayer extends QuestionView{getInteractionObject(){logging$1.deprecated("QuestionView.getInteractionObject, please use QuestionModel.getInteractionObject");return this.model.getInteractionObject()}getResponse(){logging$1.deprecated("QuestionView.getResponse, please use QuestionModel.getResponse");return this.model.getResponse()}getResponseType(){logging$1.deprecated("QuestionView.getResponseType, please use QuestionModel.getResponseType");return this.model.getResponseType()}setupDefaultSettings(){logging$1.deprecated("QuestionView.setupDefaultSettings, please use QuestionModel.setupDefaultSettings");return this.model.setupDefaultSettings()}setupButtonSettings(){logging$1.deprecated("QuestionView.setupButtonSettings, please use QuestionModel.setupButtonSettings");return this.model.setupButtonSettings()}setupWeightSettings(){logging$1.deprecated("QuestionView.setupWeightSettings, please use QuestionModel.setupWeightSettings");return this.model.setupWeightSettings()}canSubmit(){logging$1.deprecated("QuestionView.canSubmit, please use QuestionModel.canSubmit");return this.model.canSubmit()}updateAttempts(){logging$1.deprecated("QuestionView.updateAttempts, please use QuestionModel.updateAttempts");return this.model.updateAttempts()}storeUserAnswer(){logging$1.deprecated("QuestionView.storeUserAnswer, please use QuestionModel.storeUserAnswer");return this.model.storeUserAnswer()}resetUserAnswer(){logging$1.deprecated("QuestionView.resetUserAnswer, please use QuestionModel.resetUserAnswer");return this.model.resetUserAnswer()}markQuestion(){if(this._isInViewOnlyCompatibleMode("isCorrect")){if(this.isCorrect()){this.model.set("_isCorrect",true)}else{this.model.set("_isCorrect",false)}this.model.set({_rawScore:this.model.get("_isCorrect")?this.model.get("_questionWeight"):0,_maxScore:this.model.get("_questionWeight"),_minScore:0})}else{return this.model.markQuestion()}}isCorrect(){logging$1.deprecated("QuestionView.isCorrect, please use QuestionModel.isCorrect");return this.model.isCorrect()}setScore(){logging$1.deprecated("QuestionView.setScore, please use QuestionModel.setScore");return this.model.setScore()}updateButtons(){logging$1.deprecated("QuestionView.updateButtons, please use QuestionModel.updateButtons");return this.model.updateButtons()}setupFeedback(){if(this._isInViewOnlyCompatibleMode("isPartlyCorrect")){if(this.model.get("_isCorrect")){this._runModelCompatibleFunction("setupCorrectFeedback")}else if(this.isPartlyCorrect()){this._runModelCompatibleFunction("setupPartlyCorrectFeedback")}else{this._runModelCompatibleFunction("setupIncorrectFeedback")}}else{this.model.setupFeedback()}}isPartlyCorrect(){logging$1.deprecated("QuestionView.isPartlyCorrect, please use QuestionModel.isPartlyCorrect");return this.model.isPartlyCorrect()}setupCorrectFeedback(){logging$1.deprecated("QuestionView.setupCorrectFeedback, please use QuestionModel.setupCorrectFeedback");return this.model.setupCorrectFeedback()}setupPartlyCorrectFeedback(){logging$1.deprecated("QuestionView.setupPartlyCorrectFeedback, please use QuestionModel.setupPartlyCorrectFeedback");return this.model.setupPartlyCorrectFeedback()}setupIncorrectFeedback(){logging$1.deprecated("QuestionView.setupIncorrectFeedback, please use QuestionModel.setupIncorrectFeedback");return this.model.setupIncorrectFeedback()}_runModelCompatibleFunction(name,lookForViewOnlyFunction){if(this._isInViewOnlyCompatibleMode(name,lookForViewOnlyFunction)){return this[name]()}else{return this.model[name]()}}_isInViewOnlyCompatibleMode(name,lookForViewOnlyFunction){const checkForFunction=lookForViewOnlyFunction||name;if(!this.constructor.prototype[checkForFunction])return false;const hasCompatibleVersion=Object.prototype.hasOwnProperty.call(ViewOnlyQuestionViewCompatibilityLayer.prototype,checkForFunction);const usingCompatibleVersion=this.constructor.prototype[checkForFunction]===ViewOnlyQuestionViewCompatibilityLayer.prototype[checkForFunction];if(hasCompatibleVersion&&usingCompatibleVersion){switch(checkForFunction){case"setupFeedback":case"markQuestion":return true}return false}return true}}var QuestionView$1=__AMD("core/js/views/questionView",ViewOnlyQuestionViewCompatibilityLayer);let dropdownAdapter;jQuery.fn.select2.amd.require(["select2/utils","select2/dropdown","select2/dropdown/attachContainer","select2/dropdown/closeOnSelect"],(function(Utils,DropdownAdapter,AttachContainer,CloseOnSelect){dropdownAdapter=Utils.Decorate(Utils.Decorate(DropdownAdapter,AttachContainer),CloseOnSelect)}));class FillInTheBlanksView extends QuestionView$1{preinitialize(){this.select2=Select2__default["default"];this.listenTo(Adapt$1,{"device:resize":this.onResize})}events(){return{"change .fillintheblanks__item-control":"onItemChange","keyup .fillintheblanks__item-control":"onItemChange"}}onQuestionRendered(){this.setReadyStatus();if(!this.model.get("_isSubmitted")){this.enableQuestion();return}this.disableQuestion()}onItemChange(event){event&&event.preventDefault();if(!this.model.get("_isEnabled")||this.model.get("_isSubmitted")){return}const $target=$(event.currentTarget);const value=$target.val();const index=$target.data("index");this.model.get("_items")[index]._userAnswer=value;this.model.checkCanSubmit()}onResize(){const $selects=this.$(".select2-container");const paddingRight=parseInt(this.$(".fill-in-the-blanks-widget").css("paddingRight"));Array.from($selects).forEach(((select,i)=>{const $select=$(select);const width=$select.outerWidth();const maxWidth=device$1.screenWidth-$select.offset().left-paddingRight;const newWidth=width>maxWidth?maxWidth:this.initialSizes[i];$select.outerWidth(newWidth)}))}resetQuestion(){if(this.model.get("_isInteractionComplete")){this.model.set("_isComplete",true)}this.model.set({_isAtLeastOneCorrectSelection:this.model.get("_isAtLeastOneCorrectSelection")||false,_isCorrect:this.model.get("_isCorrect")||undefined});this.model.get("_items").forEach(((item,index)=>{if(!item._isCorrect&&!this.model.get("_isInteractionComplete")){this.$(".fillintheblanks__item-control").eq(index).removeClass("is-correct").removeClass("is-incorrect")}}))}resetQuestionOnRevisit(){this.resetQuestion()}onSubmitted(){this.disableQuestion()}disableQuestion(){this.setAllItemsEnabled(false)}enableQuestion(){this.model.get("_items").forEach(((item,index)=>{this.setQuestionItemEnabled(item,true,index);this.setItemReveal(item,index);this.$(".fillintheblanks__item-control").eq(index).removeClass("is-correct").removeClass("is-incorrect")}))}setQuestionItemEnabled(item,isEnabled,index){const $itemInput=this.$(".fillintheblanks__item-control").eq(index);if(item._controlType!=="Dropdown"){$itemInput.prop("disabled",!isEnabled);return}this.setItemParams(!isEnabled,$itemInput)}setAllItemsEnabled(isEnabled){this.model.get("_items").forEach(((item,index)=>{this.setQuestionItemEnabled(item,isEnabled,index)}))}onCannotSubmit(){this.showValidationError()}showValidationError(){this.model.get("_items").forEach(((item,i)=>{const $item=this.$(".fillintheblanks__item-control").eq(i);let correctAnswer=item._answers.find((answer=>answer._isCorrect===true));if(correctAnswer){correctAnswer=correctAnswer._answer}if(this.model.isLastAttempt()&&item._userAnswer!==correctAnswer){return $item.addClass("fillintheblanks__has-validation-error")}!$item.val()&&$item.addClass("fillintheblanks__has-validation-error")}))}correctAnswerReveal(answerObj){let correctAnswer=answerObj._answers.find((answer=>answer._isCorrect===true));correctAnswer=correctAnswer&&correctAnswer._answer?correctAnswer._answer:"*****";const numberOfCharactersToReveal=answerObj._characters;const correctAnswerLength=correctAnswer.trim().length;const placeholderCharacters=this.model.get("_placeholderCharacters")||"_";let charactersToReveal=correctAnswer.trim().substring(0,numberOfCharactersToReveal);for(let i=0;i<correctAnswerLength-numberOfCharactersToReveal;i++){charactersToReveal+=placeholderCharacters}return charactersToReveal}setItemParams(isDisabled,$item){const params={placeholder:"",minimumResultsForSearch:Infinity,dir:Adapt$1.config.get("_defaultDirection"),dropdownAdapter:dropdownAdapter};$item.prop("disabled",isDisabled).select2(params);this.initialSizes=this.$(".select2-container").outerWidth();this.onResize()}setItemReveal(item,index){if(this.$(".fillintheblanks__item-control").length===0)return;const $item=this.$(".fillintheblanks__item-control").eq(index);if(item._controlType==="Dropdown"){$item[0].selectedIndex=0;this.setItemParams(false,$item);return}const answerReveal=this.correctAnswerReveal(item);$item.val("");$item.attr("placeholder",answerReveal)}checkQuestionCompletion(){const isComplete=this.model.checkQuestionCompletion();const attempts=this.model.get("_attempts");const attemptsLeft=this.model.get("_attemptsLeft");if(isComplete||attemptsLeft&&attemptsLeft!==attempts){this.showMarking()}}showMarking(){if(!this.model.get("_canShowMarking")){return}this.model.get("_items").forEach(((item,i)=>{const $item=this.$(".fillintheblanks__item-control").eq(i);$item.removeClass("is-correct is-incorrect").addClass(item._isCorrect?"is-correct":"is-incorrect")}))}showCorrectAnswer(){this.model.get("_items").forEach(((item,index)=>{const correctAnswer=item._answers.find((answer=>answer._isCorrect===true))._answer;const $item=this.$(".fillintheblanks__item-control").eq(index);$item.removeClass("is-incorrect").addClass("is-correct");this.setAnswerText(item,$item,correctAnswer,index)}))}hideCorrectAnswer(){this.model.get("_items").forEach(((item,index)=>{const $item=this.$(".fillintheblanks__item-control").eq(index);this.setAnswerText(item,$item,item._userAnswer,index)}));this.showMarking()}setAnswerText(item,$item,answerText){if(item._controlType==="Dropdown"){$item.val(answerText).trigger("change");return}$item.val(answerText)}}FillInTheBlanksView.template="fillInTheBlanks.jsx";var FillInTheBlanksView$1=__AMD("components/adapt-component-fillInTheBlanks/js/fillInTheBlanksView",FillInTheBlanksView);var FillInTheBlanksModel=__AMD("components/adapt-component-fillInTheBlanks/js/fillInTheBlanksModel",class FillInTheBlanksModel extends QuestionModel$1{restoreUserAnswers(){if(!this.get("_isSubmitted"))return;const userAnswer=this.get("_userAnswer");const incorrectAnswerText="********";this.get("_items").forEach(((item,index)=>{const itemUserAnswerIndex=userAnswer[index];item._userAnswer=itemUserAnswerIndex>=0?item._answers[itemUserAnswerIndex]._answer:incorrectAnswerText}));this.setQuestionAsSubmitted();this.markQuestion();this.setScore();this.setupFeedback()}checkAnswerIsCorrect(possibleAnswers,userAnswer){const matched=possibleAnswers.filter((answer=>answer===userAnswer));const answerIsCorrect=matched&&matched.length>0;if(answerIsCorrect){this.set("_hasAtLeastOneCorrectSelection",true)}return answerIsCorrect}cleanUpAnswerText(answerText=""){if(this.get("_allowsAnyCase")){answerText=answerText.toLowerCase()}if(this.get("_allowsPunctuation")){answerText=answerText.replace(/[\.,-\/#!$%\^&\*;:{}=\-_'"`~()]/g,"");answerText=answerText.replace(/(  +)+/g," ")}return $.trim(answerText)}isLastAttempt(){return this.get("_attemptsLeft")===1||this.get("_attempts")===1}canSubmit(){const items=this.get("_items");for(let i=0,length=items.length;i<length;i++){if(!items[i]._userAnswer){return false}}return true}storeUserAnswer(){const userAnswer=this.get("_items").map((item=>{const itemAnswerTexts=this.getItemAnswers(item);const cleanedUpAnswer=this.cleanUpAnswerText(item._userAnswer);return itemAnswerTexts.indexOf(cleanedUpAnswer)}));this.set("_userAnswer",userAnswer)}isCorrect(){this.markAnswers();return this.get("_items").every((item=>item._isCorrect===true))}markAnswers(){let numberOfCorrectAnswers=0;this.get("_items").forEach(((item,index)=>{if(!item._answers){return}item._isCorrect=false;item._answerIndex=-1;const userAnswer=this.cleanUpAnswerText(item._userAnswer);const itemAnswers=this.getItemAnswers(item,true);if(this.checkAnswerIsCorrect(itemAnswers,userAnswer)){numberOfCorrectAnswers++;item._isCorrect=true;item._answerIndex=itemAnswers.findIndex((itemAnswer=>itemAnswer===userAnswer))}}));this.set({_numberOfCorrectAnswers:numberOfCorrectAnswers,_isAtLeastOneCorrectSelection:numberOfCorrectAnswers>0})}setScore(){let score=0;if(this.get("_isCorrect")){const questionWeight=this.get("_questionWeight");const attemptsPermitted=this.get("_attempts");const attemptsLeft=this.get("_attemptsLeft");score=questionWeight*attemptsLeft/attemptsPermitted}this.set("_score",score)}isPartlyCorrect(){return this.get("_isAtLeastOneCorrectSelection")}resetUserAnswer(){this.get("_items").forEach((item=>{item._userAnswer=""}))}getItemAnswers(item,correctOnly){if(!item._answers){return}const itemAnswers=item._answers.map((answer=>{const itemAnswer=this.cleanUpAnswerText(answer._answer);if(!correctOnly||answer._isCorrect){return itemAnswer}return null}));return itemAnswers}getInteractionObject(){const doesCaseMatter=!(this.get("_allowsAnyCase")||false);const caseCharacterString="{case-matters="+doesCaseMatter.toString()+"}";const correctItems=this.get("_items").map((item=>{const correctAnswerIndexes=[];item._answers.forEach(((answer,index)=>{if(answer._isCorrect){correctAnswerIndexes.push(index)}}));return correctAnswerIndexes.join("/")}));const interactions={correctResponsesPattern:[caseCharacterString+"{order-matters=true}"+correctItems.join("[,]")]};return interactions}getResponse(){return this.get("_userAnswer").join("[,]")}getResponseType(){return"fill-in"}});__AMD("components/adapt-component-fillInTheBlanks/js/adapt-contrib-fillInTheBlanks",components$1.register("fillInTheBlanks",{view:FillInTheBlanksView$1,model:FillInTheBlanksModel}));var ItemModel=__AMD("core/js/models/itemModel",class ItemModel extends LockingModel{defaults(){return{_classes:"",_isActive:false,_isVisited:false,_score:0}}toggleClass(className,hasClass){toggleModelClass(this,className,hasClass);return this}reset(){this.set({_isActive:false,_isVisited:false})}toggleActive(isActive=!this.get("_isActive")){this.set("_isActive",Boolean(isActive))}toggleVisited(isVisited=!this.get("_isVisited")){this.set("_isVisited",Boolean(isVisited))}});var ItemsComponentModel=__AMD("core/js/models/itemsComponentModel",class ItemsComponentModel extends ComponentModel$1{toJSON(){const json=super.toJSON();json._items=this.getChildren().toJSON();return json}init(){this.setUpItems();this.listenTo(this.getChildren(),{all:this.onAll,change:this.storeUserAnswer,"change:_isActive":this.setVisitedStatus,"change:_isVisited":this.checkCompletionStatus});super.init()}restoreUserAnswers(){const booleanArray=this.get("_userAnswer");if(!booleanArray)return;this.getChildren().forEach((child=>child.set("_isVisited",booleanArray[child.get("_index")])))}storeUserAnswer(){const items=this.getChildren().slice(0);items.sort(((a,b)=>a.get("_index")-b.get("_index")));const booleanArray=items.map((child=>child.get("_isVisited")));this.set("_userAnswer",booleanArray)}setUpItems(){const items=this.get("_items")||[];items.forEach(((item,index)=>item._index=index));this.setChildren(new Backbone.Collection(items,{model:ItemModel}))}getItem(index){return this.getChildren().findWhere({_index:index})}getVisitedItems(){return this.getChildren().where({_isVisited:true})}getActiveItems(){return this.getChildren().where({_isActive:true})}getActiveItem(){return this.getChildren().findWhere({_isActive:true})}areAllItemsCompleted(){return this.getVisitedItems().length===this.getChildren().length}checkCompletionStatus(){this.setVisitedStatus();if(!this.areAllItemsCompleted())return;this.setCompletionStatus()}reset(type="hard",canReset=this.get("_canReset")){const wasReset=super.reset(type,canReset);if(!wasReset)return false;this.getChildren().each((item=>item.reset()));return true}resetActiveItems(){this.getChildren().each((item=>item.toggleActive(false)))}setActiveItem(index){const item=this.getItem(index);if(!item)return;const activeItem=this.getActiveItem();if(activeItem)activeItem.toggleActive(false);item.toggleActive(true)}});var AccordionModel=__AMD("components/adapt-contrib-accordion/js/AccordionModel",class AccordionModel extends ItemsComponentModel{defaults(){return ItemsComponentModel.resultExtend("defaults",{_shouldCollapseItems:true,_shouldExpandFirstItem:false,_toggleSpeed:200})}checkIfResetOnRevisit(){this.resetActiveItems();super.checkIfResetOnRevisit();this.checkExpandFirstItem()}toggleItemsState(index){const item=this.getItem(index);const previousActiveItem=this.getActiveItem();item.toggleActive();item.toggleVisited(true);if(!previousActiveItem||!this.get("_shouldCollapseItems"))return;previousActiveItem.toggleActive(false)}checkExpandFirstItem(){if(!this.get("_shouldExpandFirstItem"))return;this.toggleItemsState(0)}});class AccordionView extends ComponentView$1{preRender(){this.onClick=this.onClick.bind(this);this.listenTo(this.model.getChildren(),"change:_isActive",this.onItemsActiveChange)}postRender(){this.getItemElement(this.model.getActiveItem())?.find(".js-accordion-item-content")?.css("display","block");this.setReadyStatus();if(this.model.get("_setCompletionOn")!=="inview")return;this.setupInviewCompletion()}onClick(event){this.model.toggleItemsState($(event.currentTarget).parents(".js-accordion-item").data("index"))}onItemsActiveChange(item,isActive){this.toggleItem(item,isActive)}toggleItem(item,shouldExpand){const $item=this.getItemElement(item);const $body=$item.children(".js-accordion-item-content").stop(true,true);if(!shouldExpand){$body.slideUp(this.model.get("_toggleSpeed"));return}$body.slideDown(this.model.get("_toggleSpeed"))}getItemElement(item){if(!item)return;const index=item.get("_index");return this.$(".js-accordion-item").filter(`[data-index="${index}"]`)}}AccordionView.template="accordion.jsx";var AccordionView$1=__AMD("components/adapt-contrib-accordion/js/AccordionView",AccordionView);__AMD("components/adapt-contrib-accordion/js/adapt-contrib-accordion",components$1.register("accordion",{model:AccordionModel,view:AccordionView$1}));var BrightcoveDownloadButtonView$3=__AMD("components/adapt-contrib-brightcovePlayer/js/brightcove__downloadButtonView",class DownloadButtonView extends Backbone.View{el(){return this.model.el}events(){return{click:"handleClick"}}initialize(){this.isDownloadInProgress=false;if(device$1.OS==="ios"){this.model.downloadOption="disabled"}const toolbar=this.model.player.controlBar.el_;const spacer=toolbar.querySelector(".vjs-custom-control-spacer");switch(this.model.downloadOption.toLowerCase()){case"overlay":this.model.player.el_.appendChild(this.el);break;case"toolbar":toolbar.insertBefore(this.el,spacer.nextSibling);break;default:return this.remove()}this.postRender()}postRender(){this.$progressLeft=this.$(".brightcoveplayer__download-progress-left-indicator");this.$progressRight=this.$(".brightcoveplayer__download-progress-right-indicator")}handleClick(){if(this.isDownloadInProgress){return}this.isDownloadInProgress=true;this.$progressRight.css({transform:"rotate(180deg)"});this.$el.addClass("downloading");const src=this.getHighestQualityVideo();this.downloadVideo(src)}getHighestQualityVideo(){const sources=this.model.player.mediainfo.sources;return sources.reduce((function(highestQuality,source){return source.container==="MP4"&&!!source.src&&source.size>highestQuality.size?source:highestQuality}),{size:0}).src}getVideoName(){return this.model.player.mediainfo.name.replace(/\s/g,"_")}downloadVideo(src){const xhr=new XMLHttpRequest;xhr.open("GET",src+"?"+Date.now(),true);xhr.responseType="blob";xhr.onload=this.onDownloadComplete.bind(this,xhr);xhr.onprogress=this.handleProgress.bind(this);xhr.send()}handleProgress(e){const percentageComplete=e.loaded/e.total*100;const degrees=360/100*percentageComplete;if(percentageComplete<=50){this.$progressLeft.hide();this.$progressRight.css({transform:"rotate("+(degrees-180)+"deg)"});return}this.$progressLeft.show();this.$progressLeft.css({transform:"rotate("+degrees+"deg)"});this.$progressRight.css({transform:"rotate(0deg)"})}onDownloadComplete(xhr){const name=this.getVideoName();download__default["default"](xhr.response,name,"video/mp4");this.isDownloadInProgress=false;this.$el.removeClass("downloading");this.$progressLeft.hide();this.model.onDownloadComplete&&this.model.onDownloadComplete()}});class BrightcovePlayer extends ComponentView$1{preinitialize(){this.useBrightcovePlayer=true;this.playerTypeConstants=this.getPlayerTypeConstants()}events(){return{"click div.brightcoveplayer__widget-social-sharing a":"handleSocialLinks"}}getPlayerTypeConstants(){return{Default:"default",Local:"local"}}getSocialSharingConstants(){return{Facebook:{title:"Facebook",href:"https://www.facebook.com/share.php?u={{shareUrl}}",icon:"facebook"},Google:{title:"Google+",href:"https://plus.google.com/share?url={{shareUrl}}",icon:"google-plus"},LinkedIn:{title:"LinkedIn",href:"https://www.linkedin.com/shareArticle?mini=true&url={{shareUrl}}",icon:"linkedin"},Pinterest:{title:"Pinterest",href:"https://pinterest.com/pin/create/button/?url={{shareUrl}}&description={{shareText}}",icon:"pintrest"},Twitter:{title:"Twitter",href:"https://twitter.com/intent/tweet?url={{shareUrl}}",icon:"twitter"},WhatsApp:{title:"WhatsApp",href:"https://api.whatsapp.com/send?text={{shareText}}%20-%20{{shareUrl}}",icon:"whatsapp"}}}initialize(){if(!this.model.get("_brightcovePlayer"))return;this.listenTo(Adapt$1,{"device:resize":this.onDeviceResize,remove:this.remove});this.listenTo(this.model,{"change:_isVisible":this.toggleVisibility,"change:_isHidden":this.toggleHidden,"change:_isComplete":this.onIsCompleteChange});const hasSocialSharing=!!(this.model.get("_socialSharing")&&this.model.get("_socialSharing").length!==0)||this.model.get("_canCopyLinkToVideo");this.model.set({_globals:Adapt$1.course.get("_globals"),_isReady:false,uniqueVideoId:"video-"+this.model.get("_id"),hasSocialSharing:hasSocialSharing});const brightcovePlayer=this.model.get("_brightcovePlayer");if(hasSocialSharing){const shareUrl=["https://players.brightcove.net",brightcovePlayer.account,brightcovePlayer.player+"_default","index.html?videoId="+brightcovePlayer.videoId].join("/");this.model.set({shareText:encodeURIComponent(this.model.get("displayTitle")||this.model.get("title")),shareUrl:encodeURIComponent(shareUrl),copyLinkText:this.model.get("_globals")._components._brightcovePlayer.copyLink||"Copy link"});this.socialSharingConstants=this.getSocialSharingConstants();const socials={};_.values(this.model.get("_socialSharing")).forEach((network=>{socials[network]=this.socialSharingConstants[network];socials[network].href=socials[network].href.replace("{{shareUrl}}",this.model.get("shareUrl"));socials[network].href=socials[network].href.replace("{{shareText}}",this.model.get("shareText"))}));this.model.set({socials:socials})}this._isRemoved=false;this.playerObject=null;if(brightcovePlayer.canPlayLocal){let hasLocalFile=false;const localAssetPath="course/assets/"+brightcovePlayer.videoId+".mp4";this.model.set("localAssetPath",localAssetPath);$.ajax({type:"HEAD",url:localAssetPath}).done(((data,status,jqXHR)=>{hasLocalFile=true})).fail(((jqXHR,status,error)=>{hasLocalFile=false})).always(((jqXHR,status,error)=>{if(hasLocalFile){this.useBrightcovePlayer=false;this.addLocalVideo()}else{this.addBrightcoveVideo()}this.preRender();this.render();this.setupOnScreenHandler()}));return}this.addBrightcoveVideo();this.preRender();this.render();this.setupOnScreenHandler()}handleSocialLinks(event){event&&event.preventDefault();const $target=$(event.currentTarget);const globals=this.model.get("_globals")._components._brightcovePlayer;if($target.attr("target")==="_blank"){window.open($target.attr("href"),"_blank","width=600,height=378");this.triggerMediaEvent("share",{shareType:$target.attr("title")});return}const $copyText=this.$(".brightcoveplayer__widget-copy-link-textbox");const $viewLinkButton=this.$(".brightcoveplayer__widget-view-link-btn");const $copyLinkButton=this.$(".brightcoveplayer__widget-copy-link-btn");if($copyText.hasClass("u-display-none")){$copyText.removeClass("u-display-none").removeAttr("readonly").removeAttr("disabled").focus().select();$viewLinkButton.addClass("u-display-none");$copyLinkButton.removeClass("u-display-none");return}try{if(device$1.OS==="ios"){const range=document.createRange();range.selectNodeContents($copyText[0]);const selection=window.getSelection();selection.removeAllRanges();selection.addRange(range);$copyText[0].setSelectionRange(0,999999)}else{$copyText.focus().select()}const hasCopied=document.execCommand("copy");if(!hasCopied){logging$1.warn("Unable to copy Brightcove URL to clipboard")}this.triggerMediaEvent("share",{shareType:"copy"});notify$1.push({body:globals.linkCopied||"Link copied!",_classes:"link-copied-notification",_timeout:2e3})}catch(e){logging$1.warn("Unable to copy Brightcove URL to clipboard")}_.defer((()=>{$copyText.addClass("u-display-none").attr("readonly","readonly").attr("disabled","true");$viewLinkButton.removeClass("u-display-none");$copyLinkButton.addClass("u-display-none")}))}addBrightcoveVideo(){const playerConfig=this.model.get("_brightcovePlayer");const width=playerConfig.width;const parsedWidth=parseFloat(width);let calculatedWidth="100%";if(width!=="auto"&&!isNaN(parsedWidth)&&parsedWidth>0){calculatedWidth=parseFloat(width)+"px"}const aspectRatio=playerConfig.aspectRatio||"16:9";const ratios=aspectRatio.split(":");const responsiveWidth=ratios[1]/ratios[0]*100+"%";this.model.set({playerType:this.playerTypeConstants.Default,useEmbeddedPlayer:false,videoPlayerID:"Brightcove_"+this.model.get("_id"),calculatedWidth:calculatedWidth,startTimeInSeconds:this.calculateSeconds(playerConfig.startTime),endTimeInSeconds:this.calculateSeconds(playerConfig.endTime),responsiveWidth:responsiveWidth});this.checkIfResetOnRevisit()}addLocalVideo(){this.model.set({hasLocalFile:true,playerType:this.playerTypeConstants.Local});this.checkIfResetOnRevisit()}checkIfResetOnRevisit(){const isResetOnRevisit=this.model.get("_isResetOnRevisit");if(!isResetOnRevisit)return;this.model.reset(isResetOnRevisit)}postRender(){if(this.model.get("playerType")!==this.playerTypeConstants.Local){return this.setupIframe()}this.playerObject=this.$(".brightcoveplayer-local video");this.setPlayerReady()}getEmbedUrl(){const playerConfig=this.model.get("_brightcovePlayer");let url=["//players.brightcove.net",playerConfig.account,playerConfig.player+"_default","index.html?videoId="+playerConfig.videoId].join("/");if(playerConfig.startTime){url=url+"#t="+playerConfig.startTime}return url}setupIframe(){const template=Handlebars.templates.brightcove__document;const html=template(this.model.toJSON());this.$iframe=this.$(".brightcoveplayer__iframe");this.iframe=this.$iframe[0];this.iframe.contentDocument.write(html);const $contentWindow=$(this.iframe.contentWindow);$contentWindow.on("message",function onMessage(e){if(e.originalEvent.data==="playerReady"){this.onPlayerReady();$contentWindow.off("message",onMessage)}}.bind(this))}calculateSeconds(timeAsString){let timeInSeconds=0;const re=/(\d{1,2}[h])?[0-5]?[0-9][m][0-5]?[0-9][s]/g;if(!re.test(timeAsString)){return timeInSeconds}const hours=timeAsString.substr(0,timeAsString.indexOf("h"));timeAsString=timeAsString.slice(timeAsString.indexOf("h")+1,timeAsString.length);timeInSeconds+=hours*3600;const minutes=timeAsString.substr(0,timeAsString.indexOf("m"));timeAsString=timeAsString.slice(timeAsString.indexOf("m")+1,timeAsString.length);timeInSeconds+=minutes*60;const seconds=parseInt(timeAsString);timeInSeconds+=seconds;return timeInSeconds}onPlayerReady(){this.onDeviceResize();this.playerObject=this.iframe.contentWindow.__brightcoveplayer;this.playerObject.on("canplay",this.onDeviceResize.bind(this));const startTimeInSeconds=this.model.get("startTimeInSeconds")||0;const endTimeInSeconds=this.model.get("endTimeInSeconds")||0;if(startTimeInSeconds!==0){this.playerObject.currentTime(startTimeInSeconds)}if(endTimeInSeconds!==0){this.playerObject.on("timeupdate",(event=>{if(parseInt(self.playerObject.currentTime())>=endTimeInSeconds){this.playerObject.pause()}}))}this.playerObject.on("play",this.handlePlayerEvent.bind(this));this.playerObject.on("pause",this.handlePlayerEvent.bind(this));this.playerObject.on("ended",this.handlePlayerEvent.bind(this));Adapt$1.trigger("brightcove:loaded",this);this.setPlayerReady()}setCaptionsLanguage(){let defaultSet=false;const courseLang=Adapt$1.course.get("_language")?.toLowerCase()||Adapt$1.config.get("_defaultLanguage")?.toLowerCase()||"en";const tracks=this.playerObject.textTracks();for(let i=0;i<tracks.length;i++){const trackLang=tracks[i].language?.toLowerCase();if(!trackLang)continue;if(trackLang===courseLang){tracks[i].mode="showing";defaultSet=true}else{tracks[i].mode="disabled"}}if(defaultSet)return;const courseLangShort=courseLang.substring(0,2);for(let i=0;i<tracks.length;i++){const trackLangShort=tracks[i].language?.substring(0,2).toLowerCase();if(!trackLangShort)continue;if(trackLangShort===courseLangShort){tracks[i].mode="showing"}else{tracks[i].mode="disabled"}}}setPlayerReady(){this.setCaptionsLanguage();this.setupCompletion();this.setupDownloadButton();this.setReadyStatus()}setupCompletion(){this.completionEvent=!this.model.get("_setCompletionOn")?"play":this.model.get("_setCompletionOn");if(this.completionEvent==="inview"){this.$(".component__widget").on("inview",_.bind(this.inview,this))}}handlePlayerEvent(event){this.queueMediaEvent(event.type);if(event.type!==this.completionEvent)return;this.onCompletion()}setupDownloadButton(){if(this.model.get("playerType")!==this.playerTypeConstants.Default)return;this.addDownloadButton(this.model.get("_downloadOption")||"")}addDownloadButton(downloadOption){const globals=this.model.get("_globals")?._components?._brightcovePlayer||{};const buttonLabel=globals.downloadVideoText;const buttonModel={player:this.playerObject,downloadOption:downloadOption,label:buttonLabel,el:this.$$(".brightcoveplayer__download-btn")[0],onDownloadComplete:this.triggerMediaEvent.bind(this,"download")};new BrightcoveDownloadButtonView$3({model:buttonModel})}onCompletion(){this.setCompletionStatus();if(this.completionEvent==="inview"){this.$(".component__inner").off("inview");return}this.playerObject.off(this.completionEvent,this.onCompletion)}inview(event,visible,visiblePartX,visiblePartY){if(!visible){return}if(visiblePartY==="top"){this._isVisibleTop=true}else if(visiblePartY==="bottom"){this._isVisibleBottom=true}else{this._isVisibleTop=true;this._isVisibleBottom=true}if(!this._isVisibleTop||!this._isVisibleBottom)return;this.onCompletion()}onDeviceResize(){if(this.model.get("playerType")!==this.playerTypeConstants.Default){return this.stopListening(Adapt$1,"device:resize")}const h=this.$$("video").height();this.$iframe.height(h);this.iframe.contentDocument.body.className=this.getIframeBodyClassName()}getIframeBodyClassName(){let className=device$1.screenSize==="large"?"size-large":"size-small";if(this.model.get("_downloadOption")){className+=" download-"+this.model.get("_downloadOption").toLowerCase()}return className}remove(){if(this.playerObject.el_){this.playerObject.dispose()}Adapt$1.unset("_queuedBrightcoveViews");ComponentView$1.prototype.remove.call(this)}$$(selector){return this.$iframe.contents().find(selector)}queueMediaEvent(eventType){const t=Date.now();const lastEvent=this.lastEvent||{time:0};const timeSinceLastEvent=t-lastEvent.time;const debounceTime=500;this.lastEvent={time:t,type:eventType};clearTimeout(this.eventTimeout);if(eventType==="ended"){return this.triggerMediaEvent(eventType)}if(timeSinceLastEvent<=debounceTime)return;this.eventTimeout=setTimeout(this.triggerMediaEvent.bind(this,eventType),debounceTime)}triggerMediaEvent(eventType,data){Adapt$1.trigger("media",{isVideo:true,type:eventType,src:this.getEmbedUrl(),platform:"brightcove",data:data||{}})}}components$1.register("brightcovePlayer",BrightcovePlayer);__AMD("components/adapt-contrib-brightcovePlayer/js/adapt-contrib-brightcovePlayer",BrightcovePlayer);class GraphicView extends ComponentView$1{className(){return[super.className(),this.model.get("_isScrollable")&&"is-scrollable"].filter(Boolean).join(" ")}events(){return{"click .js-graphic-link":"onClick","keydown .js-graphic-scrollbar":"onKeyDown"}}postRender(){this.$(".graphic__widget").imageready((()=>{this.setReadyStatus();this.setupInviewCompletion(".graphic__widget");this.setupScrollable()}))}setupScrollable(){if(!this.model.get("_isScrollable"))return;this.onScroll=_.debounce(this.onScroll.bind(this),17);const $scrollbar=this.$(".js-graphic-scrollbar");const $scrollContainer=this.$(`#${$scrollbar.attr("aria-controls")}`);$scrollContainer.on("scroll",this.onScroll);this.onKeyDown()}onScroll(event){if(!this.model.get("_isScrollable"))return;const $scrollbar=this.$(".js-graphic-scrollbar");const $scrollContainer=this.$(`#${$scrollbar.attr("aria-controls")}`);const{clientWidth:clientWidth,scrollWidth:scrollWidth}=$scrollContainer[0];const scrollableWidth=scrollWidth-clientWidth;const left=$scrollContainer.scrollLeft();const calculatedScrollPercent=parseInt(left/scrollableWidth*100);this.model.set("_scrollPercent",calculatedScrollPercent)}onKeyDown(event){if(!this.model.get("_isScrollable"))return;const $scrollbar=this.$(".js-graphic-scrollbar");const $scrollContainer=this.$(`#${$scrollbar.attr("aria-controls")}`);const{clientWidth:clientWidth,scrollWidth:scrollWidth}=$scrollContainer[0];const scrollableWidth=scrollWidth-clientWidth;const step=clientWidth*.1;let left=$scrollContainer.scrollLeft();const calculatedScrollPercent=parseInt(left/scrollableWidth*100);const definedScrollPercent=this.model.get("_scrollPercent")??0;if(definedScrollPercent!==calculatedScrollPercent){left=definedScrollPercent/100*scrollableWidth}switch(event?.which){case 37:left-=step;break;case 39:left+=step;break}left=_.max([0,_.min([scrollableWidth,left])]);$scrollContainer.scrollLeft(left)}onClick(event){if(event)event.preventDefault();const item=this.model.get("_graphic");const{_url:url,_target:target="_blank"}=item;const isNewWindow=target!=="_self";if(isNewWindow)return window.open(url,target);const isRouterNavigation=url.substr(0,1)==="#";if(isRouterNavigation)return Backbone.history.navigate(url,{trigger:true});window.location.href=url}preRemove(){if(!this.model.get("_isScrollable"))return;const $scrollbar=this.$(".js-graphic-scrollbar");const $scrollContainer=this.$(`#${$scrollbar.attr("aria-controls")}`);$scrollContainer.off("scroll",this.onScroll)}}GraphicView.template="graphic.jsx";var GraphicView$1=__AMD("components/adapt-contrib-graphic/js/GraphicView",GraphicView);var GraphicModel=__AMD("components/adapt-contrib-graphic/js/GraphicModel",class GraphicModel extends ComponentModel$1{init(){this.set("_scrollPercent",this.get("_defaultScrollPercent"))}});__AMD("components/adapt-contrib-graphic/js/adapt-contrib-graphic",components$1.register("graphic",{model:GraphicModel,view:GraphicView$1}));class McqView extends QuestionView$1{initialize(...args){this.onKeyDown=this.onKeyDown.bind(this);this.onKeyPress=(...args)=>{logging$1.deprecated("McqView onKeyPress is deprecated, please change to onKeyDown");this.onKeyDown(...args)};this.onItemSelect=this.onItemSelect.bind(this);this.onItemFocus=this.onItemFocus.bind(this);this.onItemBlur=this.onItemBlur.bind(this);super.initialize(...args)}setupQuestion(){this.model.setupRandomisation()}onQuestionRendered(){this.setReadyStatus()}onKeyDown(event){if(!["Enter"," "].includes(event.key))return;event.preventDefault();this.onItemSelect(event)}onItemFocus(event){if(!this.model.isInteractive())return;const index=parseInt($(event.currentTarget).data("adapt-index"));const item=this.model.getChildren().findWhere({_index:index});item.set("_isHighlighted",true)}onItemBlur(event){const index=$(event.currentTarget).data("adapt-index");const item=this.model.getChildren().findWhere({_index:index});item.set("_isHighlighted",false)}onItemSelect(event){if(!this.model.isInteractive())return;const index=$(event.currentTarget).data("adapt-index");const itemModel=this.model.getItem(index);let shouldSelect=!itemModel.get("_isActive");if(this.model.isSingleSelect()){shouldSelect=true;this.model.resetActiveItems()}else if(shouldSelect&&this.model.isAtActiveLimit()){this.model.getLastActiveItem().toggleActive(false)}itemModel.toggleActive(shouldSelect)}resetQuestion(){this.model.resetItems()}}McqView.template="mcq.jsx";var McqView$1=__AMD("components/adapt-contrib-mcq/js/McqView",McqView);class BlendedItemsComponentQuestionModel extends QuestionModel$1{init(){ItemsComponentModel.prototype.init.call(this);super.init()}reset(type="hard",canReset=this.get("_canReset")){ItemsComponentModel.prototype.reset.call(this,type,canReset);return super.reset(type,canReset)}}Object.getOwnPropertyNames(ItemsComponentModel.prototype).forEach((name=>{if(name==="constructor"||name==="init"||name==="reset")return;Object.defineProperty(BlendedItemsComponentQuestionModel.prototype,name,{value:ItemsComponentModel.prototype[name]})}));var ItemsQuestionModel=__AMD("core/js/models/itemsQuestionModel",class ItemsQuestionModel extends BlendedItemsComponentQuestionModel{init(){super.init();this.set("_isRadio",this.isSingleSelect());this.listenTo(this.getChildren(),"change:_isActive",this.checkCanSubmit);this.checkCanSubmit()}restoreUserAnswers(){if(!this.get("_isSubmitted"))return;const itemModels=this.getChildren();const userAnswer=this.get("_userAnswer");if(!userAnswer)return;itemModels.each((item=>{item.toggleActive(Boolean(userAnswer[item.get("_index")]))}));this.setQuestionAsSubmitted();this.markQuestion();this.setScore();this.setupFeedback()}setupRandomisation(){if(!this.get("_isRandom")||!this.get("_isEnabled"))return;const children=this.getChildren();children.set(children.shuffle())}canSubmit(){const activeItems=this.getActiveItems();return activeItems.length>0}storeUserAnswer(){const items=this.getChildren().slice(0);items.sort(((a,b)=>a.get("_index")-b.get("_index")));const userAnswer=items.map((itemModel=>itemModel.get("_isActive")));this.set("_userAnswer",userAnswer)}isCorrect(){const allChildren=this.getChildren();const activeChildren=allChildren.filter((itemModel=>itemModel.get("_isActive")));const isItemCorrect=itemModel=>itemModel.get("_shouldBeSelected")&&!itemModel.get("_isPartlyCorrect");const isItemPartlyCorrect=itemModel=>itemModel.get("_isPartlyCorrect");const isItemIncorrect=itemModel=>!itemModel.get("_shouldBeSelected")&&!itemModel.get("_isPartlyCorrect");const sum=(list,predicate)=>list.reduce(((sum,item)=>sum+(predicate(item)?1:0)),0);const props={_numberOfRequiredAnswers:sum(allChildren,isItemCorrect),_numberOfCorrectAnswers:sum(activeChildren,isItemCorrect),_numberOfPartlyCorrectAnswers:sum(activeChildren,isItemPartlyCorrect),_numberOfIncorrectAnswers:sum(activeChildren,isItemIncorrect)};activeChildren.forEach((itemModel=>itemModel.set("_isCorrect",itemModel.get("_shouldBeSelected"))));props._isAtLeastOneCorrectSelection=Boolean(props._numberOfCorrectAnswers||props._numberOfPartlyCorrectAnswers);const numberOfSelectableAnswers=this.get("_selectable");const hasSelectableCorrectAnswers=props._numberOfCorrectAnswers===numberOfSelectableAnswers;const hasAllCorrectAnswers=props._numberOfCorrectAnswers===props._numberOfRequiredAnswers;const hasCorrectAnswers=hasSelectableCorrectAnswers||hasAllCorrectAnswers;const hasIncorrectAnswers=props._numberOfIncorrectAnswers;const hasPartlyCorrectAnswers=props._numberOfPartlyCorrectAnswers;this.set(props);return hasCorrectAnswers&&!hasIncorrectAnswers&&!hasPartlyCorrectAnswers}setScore(){const questionWeight=this.get("_questionWeight");const answeredCorrectly=this.get("_isCorrect");const score=answeredCorrectly?questionWeight:0;this.set("_score",score)}get score(){if(!this.get("_hasItemScoring"))return super.score;const children=this.getChildren()?.toArray()||[];return children.reduce(((score,child)=>score+=child.get("_isActive")?child.get("_score")||0:0),0)}get maxScore(){if(!this.get("_hasItemScoring"))return super.maxScore;const children=this.getChildren()?.toArray()||[];const scores=children.map((child=>child.get("_score")||0));scores.sort(((a,b)=>a-b));return scores.reverse().slice(0,this.get("_selectable")).filter((score=>score>0)).reduce(((maxScore,score)=>maxScore+=score),0)}get minScore(){if(!this.get("_hasItemScoring"))return super.minScore;const children=this.getChildren()?.toArray()||[];const scores=children.map((child=>child.get("_score")||0));scores.sort(((a,b)=>a-b));return scores.slice(0,this.get("_selectable")).filter((score=>score<0)).reduce(((minScore,score)=>minScore+=score),0)}getFeedback(_feedback=this.get("_feedback")){if(!_feedback)return{};const activeItem=this.getActiveItem();const activeItemFeedback=activeItem?.get?.("feedback");const isIndividualFeedback=!this.isCorrect()&&!this.isPartlyCorrect()&&this.isSingleSelect()&&activeItemFeedback;const feedback=super.getFeedback(_feedback);if(!isIndividualFeedback)return feedback;if(typeof activeItemFeedback==="string"){return{...feedback,body:activeItemFeedback||""}}const feedbackConfig={...feedback,...activeItemFeedback};if(feedbackConfig?._graphic?._src&&!feedbackConfig?._imageAlignment){feedbackConfig._imageAlignment="right"}return feedbackConfig}isPartlyCorrect(){return this.get("_isAtLeastOneCorrectSelection")}resetUserAnswer(){this.set("_userAnswer",[])}isAtActiveLimit(){const selectedItems=this.getActiveItems();return selectedItems.length===this.get("_selectable")}isSingleSelect(){return this.get("_selectable")===1}getLastActiveItem(){const selectedItems=this.getActiveItems();return selectedItems[selectedItems.length-1]}resetQuestion(){this.resetItems()}resetItems(){if(this.get("_shouldResetAllAnswers")===false){this.resetIncorrectItems();return}this.resetActiveItems();this.set("_isAtLeastOneCorrectSelection",false)}resetIncorrectItems(){this.getChildren().each((item=>{const isCorrect=item.get("_shouldBeSelected")||item.get("_isCorrect");if(isCorrect)return;item.toggleActive(false)}));this.set("_isAtLeastOneCorrectSelection",Boolean(this.getLastActiveItem()))}getInteractionObject(){const interactions={correctResponsesPattern:[],choices:[]};interactions.choices=this.getChildren().map((itemModel=>({id:(itemModel.get("_index")+1).toString(),description:itemModel.get("text")})));const correctItems=this.getChildren().filter((itemModel=>itemModel.get("_shouldBeSelected")));interactions.correctResponsesPattern=[correctItems.map((itemModel=>String(itemModel.get("_index")+1))).join("[,]")];return interactions}getResponse(){const activeItems=this.getActiveItems();const activeIndexes=activeItems.map((itemModel=>itemModel.get("_index")+1));return activeIndexes.join(",")}getResponseType(){return"choice"}getCorrectAnswerAsText(){const globals=Adapt$1.course.get("_globals")._components["_"+this.get("_component")];const isSingleSelect=this.isSingleSelect();const ariaAnswer=isSingleSelect?globals?.ariaCorrectAnswer:globals?.ariaCorrectAnswers;if(!ariaAnswer)return;const correctOptions=this.getChildren().where({_shouldBeSelected:true});const correctAnswer=isSingleSelect?correctOptions[0]?.get("text"):correctOptions.map((correctOption=>correctOption.get("text"))).join("<br>");return Handlebars.compile(ariaAnswer)({correctAnswer:correctAnswer})}getUserAnswerAsText(){const globals=Adapt$1.course.get("_globals")._components["_"+this.get("_component")];const isSingleSelect=this.isSingleSelect();const ariaAnswer=isSingleSelect?globals?.ariaUserAnswer:globals?.ariaUserAnswers;if(!ariaAnswer)return;const selectedItems=this.getActiveItems();const userAnswer=isSingleSelect?selectedItems[0].get("text"):selectedItems.map((selectedItem=>selectedItem.get("text"))).join("<br>");return Handlebars.compile(ariaAnswer)({userAnswer:userAnswer})}});var McqModel=__AMD("components/adapt-contrib-mcq/js/McqModel",class McqModel extends ItemsQuestionModel{});__AMD("components/adapt-contrib-mcq/js/adapt-contrib-mcq",components$1.register("mcq",{model:McqModel,view:McqView$1}));var NarrativeModel=__AMD("components/adapt-contrib-narrative/js/NarrativeModel",class NarrativeModel extends ItemsComponentModel{restoreUserAnswers(){const numberArray=this.get("_userAnswer");if(!numberArray)return;const children=this.getChildren();const shouldRestoreActiveItem=numberArray.length>children.length;if(shouldRestoreActiveItem){const activeItemIndex=numberArray.pop();this.setActiveItem(activeItemIndex)}children.forEach((child=>child.set("_isVisited",Boolean(numberArray[child.get("_index")]))))}storeUserAnswer(){const items=this.getChildren().slice(0);items.sort(((a,b)=>a.get("_index")-b.get("_index")));const numberArray=items.map((child=>child.get("_isVisited")?1:0));const activeItem=this.getActiveItem();if(activeItem)numberArray.push(activeItem.get("_index"));this.set("_userAnswer",numberArray)}});var MODE=__AMD("components/adapt-contrib-narrative/js/modeEnum",new ENUM(["SMALL","LARGE"]));class NarrativeView extends ComponentView$1{events(){if(this.model.get("_isStackedOnMobile"))return;return{"swipeleft .js-narrative-swipe":"onSwipeLeft","swiperight .js-narrative-swipe":"onSwipeRight"}}initialize(...args){super.initialize(...args);this.model.set("_isInitial",true);this.model.set("_activeItemIndex",0);this._wasInview=false;this.onNavigationClicked=this.onNavigationClicked.bind(this);this.openPopup=this.openPopup.bind(this);this.onInview=this.onInview.bind(this)}preRender(){this.listenTo(Adapt$1,{"device:changed device:resize":this.reRender,"notify:closed":this.closeNotify});this.renderMode();this.listenTo(this.model.getChildren(),"change:_isActive",this.onItemsActiveChange);this.calculateWidths()}async setFocus(itemIndex){const $animatedElement=this.isLargeMode()||this.model.get("_isMobileTextBelowImage")?this.$(".narrative__slider"):this.$(".narrative__strapline-header-inner");await transitionsEnded($animatedElement);requestAnimationFrame((()=>{this.focusOnNarrativeElement(itemIndex)}))}focusOnNarrativeElement(itemIndex){const dataIndexAttr=`[data-index='${itemIndex}']`;const $elementToFocus=this.isLargeMode()||this.model.get("_isMobileTextBelowImage")?this.$(`.narrative__content-item${dataIndexAttr}`):this.$(`.narrative__strapline-btn${dataIndexAttr}`);a11y$1.focusFirst($elementToFocus);this.setupBackNextLabels();this.manageBackNextStates()}onItemsActiveChange(item,_isActive){if(!_isActive)return;if(this.isTextBelowImage()&&this._wasInview){item.toggleVisited(true)}const index=item.get("_index");this.model.set("_activeItemIndex",index);this.setStage(item);if(this.model.get("_isInitial")){this.setupBackNextLabels();this.manageBackNextStates();return}this.setFocus(index)}calculateMode(){const mode=device$1.isScreenSizeMin("medium")?MODE.LARGE:MODE.SMALL;this.model.set("_mode",mode);this.model.set("_isLargeMode",mode===MODE.LARGE);return mode}renderMode(){const mode=this.calculateMode();const isTextBelowImage=this.isTextBelowImage();this.model.set("_isTextBelowImageResolved",isTextBelowImage);const isLargeMode=mode===MODE.LARGE;const isSmallModeAndTextBelowImage=mode===MODE.SMALL&&isTextBelowImage;const hasNavigationInTextArea=this.model.get("_hasNavigationInTextArea")&&(isLargeMode||isSmallModeAndTextBelowImage);this.model.set("_hasNavigationInTextAreaResolved",hasNavigationInTextArea)}isLargeMode(){return this.model.get("_mode")===MODE.LARGE}isTextBelowImage(){const isTextBelowImage=device$1.isScreenSizeMin("medium")?this.model.get("_isTextBelowImage"):this.model.get("_isMobileTextBelowImage");return Boolean(isTextBelowImage)}postRender(){this.renderMode();this.setupNarrative();this.$(".narrative__slider").imageready(this.setReadyStatus.bind(this));this.$(".narrative__slide-container")[0]?.addEventListener("scroll",this.onScroll,true);this.setupInviewCompletion(".component__widget")}setupNarrative(){const items=this.model.getChildren();if(!items||!items.length)return;let activeItem=this.model.getActiveItem();if(!activeItem){activeItem=this.model.getItem(0);activeItem.toggleActive(true)}else{items.trigger("change:_isActive",activeItem,true)}this.calculateWidths();this.model.set("_isInitial",false)}calculateWidths(){const itemCount=this.model.getChildren().length;this.model.set({_totalWidth:100*itemCount,_itemWidth:100/itemCount})}resizeControl(){this.renderMode();this.setupBackNextLabels();const activeItem=this.model.getActiveItem();if(activeItem)this.setStage(activeItem)}reRender(){if(this.model.get("_wasHotgraphic")&&this.isLargeMode()){this.replaceWithHotgraphic();return}this.resizeControl()}closeNotify(){this.evaluateCompletion()}replaceWithHotgraphic(){const HotgraphicView=components$1.getViewClass("hotgraphic");if(!HotgraphicView)return;const model=this.prepareHotgraphicModel();const newHotgraphic=new HotgraphicView({model:model});const parentView=data$1.findViewByModelId(model.get("_parentId"));const $container=parentView.$el.find(".component__container");$container.append(newHotgraphic.$el);const parentChildViews=parentView.getChildViews();const currentIndex=parentChildViews.findIndex((view=>view===this));parentChildViews[currentIndex]=newHotgraphic;parentView.setChildViews(parentChildViews);this.remove();_.defer((()=>{Adapt$1.trigger("device:resize")}))}prepareHotgraphicModel(){const model=this.model;model.resetActiveItems();model.set({_isPopupOpen:false,_component:"hotgraphic",body:model.get("originalBody"),instruction:model.get("originalInstruction")});return model}moveSliderToIndex(itemIndex){let offset=this.model.get("_itemWidth")*itemIndex;if(Adapt$1.config.get("_defaultDirection")==="ltr"){offset*=-1}this.model.set("_translateXOffset",offset)}setStage(item){const index=item.get("_index");if(this.isLargeMode()&&this._wasInview){item.toggleVisited(true)}this.evaluateCompletion();this.shouldShowInstructionError();this.moveSliderToIndex(index)}manageBackNextStates(index=this.model.getActiveItem().get("_index")){const totalItems=this.model.getChildren().length;const shouldEnableBack=index>0;const shouldEnableNext=index<totalItems-1;this.model.set("shouldEnableBack",shouldEnableBack);this.model.set("shouldEnableNext",shouldEnableNext)}setupBackNextLabels(index=this.model.getActiveItem().get("_index")){const totalItems=this.model.getChildren().length;const isAtStart=index===0;const isAtEnd=index===totalItems-1;const _globals=Adapt$1.course.get("_globals");const narrativeGlobals=_globals._components._narrative;const prevItem=isAtStart?null:this.model.getItem(index-1);const nextItem=isAtEnd?null:this.model.getItem(index+1);const prevTitle=prevItem?.get("title")??"";const nextTitle=nextItem?.get("title")??"";const prevItemNumber=isAtStart?null:index;const nextItemNumber=isAtEnd?null:index+2;const backLabel=compile(narrativeGlobals.previous,{_globals:_globals,title:prevTitle,itemNumber:prevItemNumber,totalItems:totalItems,isAtStart:isAtStart});const nextLabel=compile(narrativeGlobals.next,{_globals:_globals,title:nextTitle,itemNumber:nextItemNumber,totalItems:totalItems,isAtEnd:isAtEnd});this.model.set("backLabel",backLabel);this.model.set("nextLabel",nextLabel)}evaluateCompletion(){if(this.model.areAllItemsCompleted()){this.trigger("allItems");this.$(".narrative__instruction").removeClass("has-error")}}onInview(...args){const[,isVisible]=args;if(!isVisible)return;this._wasInview=true;const activeItem=this.model.getActiveItem();if(activeItem)activeItem.toggleVisited(true);if(!this.shouldUseInviewCompletion()){this.removeInviewListener();return}super.onInview(...args)}openPopup(){const globals=Adapt$1.course.get("_globals");const narrativeGlobals=globals._components._narrative;const totalItems=this.model.getChildren().length;const currentItem=this.model.getActiveItem();const index=currentItem.get("_index");const defaultTitle=compile(narrativeGlobals.titleDialog,{itemNumber:index+1,totalItems:totalItems});const title=currentItem.get("title")||currentItem.get("strapline")||defaultTitle;const isAltTitle=Boolean(!currentItem.get("title"));notify$1.popup({isAltTitle:isAltTitle,title:title,body:currentItem.get("body")});Adapt$1.on("popup:opened",(function(){currentItem.toggleVisited(true)}))}onNavigationClicked(e){const $btn=$(e.currentTarget);let index=this.model.getActiveItem().get("_index");$btn.data("direction")==="right"?index++:index--;this.model.setActiveItem(index)}onSwipeLeft(){let index=this.model.getActiveItem().get("_index");this.model.setActiveItem(++index)}onSwipeRight(){let index=this.model.getActiveItem().get("_index");this.model.setActiveItem(--index)}onScroll(event){event.preventDefault();event.target.scrollTo(0,0)}shouldShowInstructionError(){const prevItemIndex=this.model.getActiveItem().get("_index")-1;if(prevItemIndex<0||this.model.getItem(prevItemIndex).get("_isVisited"))return;this.$(".narrative__instruction").addClass("has-error")}shouldUseInviewCompletion(){const config=this.model;const setCompletionOn=config.get("_setCompletionOn");const isMobileAndStacked=config.get("_isStackedOnMobile")&&!config.get("_isLargeMode");if(!isMobileAndStacked&&setCompletionOn!=="inview"){return false}return true}preRemove(){this.$(".narrative__slide-container")[0]?.removeEventListener("scroll",this.onScroll,true)}}NarrativeView.template="narrative.jsx";var NarrativeView$1=__AMD("components/adapt-contrib-narrative/js/NarrativeView",NarrativeView);__AMD("components/adapt-contrib-narrative/js/adapt-contrib-narrative",components$1.register("narrative",{model:NarrativeModel,view:NarrativeView$1}));class TextView extends ComponentView$1{postRender(){this.setReadyStatus();this.setupInview()}setupInview(){const selector=this.getInviewElementSelector();if(!selector)return this.setCompletionStatus();this.setupInviewCompletion(selector)}getInviewElementSelector(){if(this.model.get("body"))return".component__body";if(this.model.get("instruction"))return".component__instruction";if(this.model.get("displayTitle"))return".component__title";return null}}TextView.template="text.jsx";var TextView$1=__AMD("components/adapt-contrib-text/js/TextView",TextView);var TextModel=__AMD("components/adapt-contrib-text/js/TextModel",class TextModel extends ComponentModel$1{});__AMD("components/adapt-contrib-text/js/adapt-contrib-text",components$1.register("text",{model:TextModel,view:TextView$1}));var YESNO_STATE=__AMD("components/adapt-yesNo/js/YesNoStateEnum",ENUM(["NOT_STARTED","CHALLENGE","RESET","REVIEW"]));class YesNoView extends QuestionView$1{initialize(){super.initialize();if(this.model.get("_attemptsLeft")===0)return;this.model.setStateOnPageLoad()}events(){return{"click .yesno__start-btn":"onStartClicked","focus .yesno__start-btn":"onStartFocused","click .yesno__image-buttons button":"onYesNoClicked","click .yesno__prev-btn":"onPrevClicked","click .yesno__next-btn":"onNextClicked","click .yesno__scroll-indicator":"onIndicatorClicked","click .js-btn-feedback":"showClassicFeedback",keyup:"onKeyup"}}preRender(){this.timer={};this.model.setupRandomisation();this.listenTo(Adapt$1,"device:resize",this.setupDimensions);const lastAnswer=_.last(this.model.get("_images"))._userAnswer;this.setStage(0,!lastAnswer);if(!this.model.get("_useClassicFeedback")||!this.model.get("_canShowFeedback"))return;this.model.showClassicFeedback()}showFeedback(){if(this.model.get("_isComplete")){this.startReviewMode();return}this.model.setState(YESNO_STATE.RESET)}showClassicFeedback(){this.model.showClassicFeedback();Adapt$1.trigger("questionView:showFeedback",this)}onQuestionRendered(){if(this.model.get("_attemptsLeft")<this.model.get("_attempts")){this.markQuestionAsSubmittedWithResetAbility()}this.handleImages(this.setImageReady.bind(this));this.model.restoreUserAnswers();this.model.markQuestion();if(this.model.get("_attemptsLeft")>0){this.initialiseTimer();return}const showClassicFeedback=this.model.get("_useClassicFeedback")&&!!this.model.get("_canShowFeedback")&&!!Adapt$1.course.get("_tutor");this.onCompleted(showClassicFeedback)}markQuestionAsSubmittedWithResetAbility(){this.model.checkCanSubmit();this.setQuestionAsSubmitted();this.checkQuestionCompletion();if(this.model.shouldShowMarking){this.showMarking()}this.setupFeedback();this.showFeedback()}setImageReady(){const $imagesContainer=this.$(".yesno__images-container-inner");$imagesContainer.imageready(_.bind(this.onImageReady,this))}handleImages(callback){const lastAnswer=_.last(this.model.get("_images"))._userAnswer;this.setStage(0,!lastAnswer);this.$(".yesno__image").removeClass("is-selected").hide();this.$(".yesno__image").first().addClass("is-selected").show();this.setupImageDimensions();callback()}setupImageDimensions(){if(!this.maxImageWidth)return;const $images=this.$(".yesno__image img");$images.css({maxHeight:this.maxImageHeight,maxWidth:this.maxImageWidth});const $currentImage=$images.eq(this.model.get("_stage"));const $imageContainer=this.$(".yesno__images-container-inner");const checkImageHeight=()=>{const h=$currentImage.height();if(h>0){$imageContainer.height(h)}else{setTimeout(checkImageHeight,100)}};checkImageHeight()}onImageReady(){this.setupDimensions();this.setReadyStatus()}setupDimensions(){const paddingTop=parseInt($("#wrapper").css("paddingTop"));const buttonHeightAllowance=50;const bottomMarginAllowance=180;this.maxImageHeight=device$1.screenHeight-paddingTop-buttonHeightAllowance;if(device$1.screenSize==="large"){this.maxImageHeight-=bottomMarginAllowance}this.maxImageWidth=this.$(".yesno__images-container").width();this.setupImageDimensions()}initialiseTimer(){if(this.model.get("_disableTimer"))return;this.$(".yesno__timer").css("display","inline-block");const timerSeconds=Math.round(this.model.get("timerSeconds"));this.model.set("timeRemaining",timerSeconds);this.updateTimer(timerSeconds)}startTimer(){if(this.model.get("_disableTimer"))return;this.timer.count=setInterval((()=>{if(this.model.get("_isReady")===false){this.stopTimer();return}const timeRemaining=this.model.get("timeRemaining");if(timeRemaining!==0)this.model.set("timeRemaining",timeRemaining-1);this.updateTimer(timeRemaining)}),1e3)}flashTimer(){this.$(".yesno__timer-inner").addClass("blink")}stopFlashTimer(){this.$(".yesno__timer-inner").removeClass("blink")}stopTimer(){this.stopFlashTimer();clearInterval(this.timer.count)}formatTime(timeInSeconds){const minutes=timeInSeconds/60;let mm=Math.floor(minutes);let ss=Math.round((minutes-mm)*60);if(mm<10){mm="0"+mm}if(ss<10){ss="0"+ss}return{mm:mm,ss:ss}}updateTimer(timeInSeconds){const timeObj=this.formatTime(timeInSeconds);const $timer=this.$(".yesno__timer");$timer.find(".minutes").html(timeObj.mm);$timer.find(".seconds").html(timeObj.ss);if(this.model.get("_questionState")===YESNO_STATE.NOT_STARTED)return;if(timeInSeconds===10){if(!this.model.get("_disableFlashingTimer")){this.flashTimer()}this.updateInstruction(this.getGlobals("timeWarning"),"assertive")}if(timeInSeconds===0){this.updateInstruction(this.getGlobals("timeUp"));this.onCompleted()}}updateInstruction(text,type="polite"){this.$(".yesno__instruction").html(text);this.$(".yesno__instruction").attr("aria-live",type)}onStartClicked(){const $imageContainer=this.$(".yesno__image-container");a11y$1.toggleAccessible($imageContainer,true);this.model.setState(YESNO_STATE.CHALLENGE);if(device$1.touch){this.scrollToImages()}a11y$1.focus($imageContainer,{defer:true});this.startTimer()}onStartFocused(){if(this.model.get("_disableTimer"))return;const instruction=this.getGlobals("ariaInstruction").replace("{{timerSeconds}}",this.model.get("timerSeconds"));this.updateInstruction(instruction)}scrollToImages(){const $elScroll=this.model.getParent().getParent().get("_trickle")?$("#wrapper"):$(window);const winHeight=$elScroll.height();const navHeight=$(".nav").height();const scrollTop=$elScroll.scrollTop();const $images=this.$(".yesno__images-container-inner");const top=$images.offset().top;const imgHeight=$images.height();const bottom=top+imgHeight;const isInView=scrollTop<top&&bottom<winHeight-navHeight+scrollTop;if(isInView)return;const newScrollTop=(top-navHeight+bottom-winHeight)/2;$elScroll.scrollTop(newScrollTop)}onYesNoClicked(e){const userAnswer=e.currentTarget.value==="1";this.submitAnswer(userAnswer,true);a11y$1.toggleAccessible(this.$(".yesno__image-container"),true);setTimeout((()=>{a11y$1.focus(this.$(".yesno__image-container"))}),100)}onKeyup(e){if(this.model.get("_questionState")!==YESNO_STATE.REVIEW)return;switch(e.keyCode){case 37:this.onPrevClicked();break;case 39:this.onNextClicked();break}}submitAnswer(userAnswer,isSwipe){const stage=this.model.get("_stage");const image=this.model.get("_images")[stage];image._userAnswer=userAnswer;image._hasUserAnswer=true;const moveRight=isSwipe?!userAnswer:false;this.model.isComplete(stage)?this.onCompleted():this.setStage(stage+1,moveRight)}displayImage(){if(this.prevStage===this.newStage)return;const $images=this.$(".yesno__image");const prevClassName=this.moveRight?"after":"before";const nextClassName=this.moveRight?"before":"after";const numberNewStage=this.newStage;this.removeImage($images.eq(this.prevStage),prevClassName);const $currentImage=$images.eq(numberNewStage);const $inner=this.$(".yesno__images-container-inner");_.defer((()=>{$currentImage.addClass(`${nextClassName} is-selected`).show();this.$(".yesno__image-container").show();a11y$1.focusFirst($currentImage.find("img"));this.$(".yesno__image-container").attr("aria-labelledby",`yesno__image${numberNewStage}`);$currentImage.removeClass(nextClassName);$inner.height($currentImage.height())}))}removeImage($image,className){$image.addClass(className).removeClass("is-selected");$image.removeClass(className).hide();this.$(".yesno__image-container").hide();this.setupImageDimensions()}setStage(newStage,moveRight){if(this._isLocked)return;this._isLocked=true;this.newStage=newStage;this.moveRight=moveRight;this._isLocked=false;this.prevStage=this.model.get("_stage");this.model.set("_stage",this.newStage);this.displayImage()}onCompleted(showingOnRender=false){this.stopTimer();if(this.shouldSubmitAutomatically()){this.onSubmitClicked()}else{const lastAnswer=_.last(this.model.get("_images"))._userAnswer;this.setStage(0,!lastAnswer);this.$(".yesno__image-buttons, .yesno__timer").hide()}setTimeout((()=>{a11y$1.focus(this.$(".yesno__text.yesno__section"))}),100);const isFeedbackPossible=this.model.isFeedbackPossible();this.$(".js-btn-feedback").toggleClass("u-display-none",!isFeedbackPossible);this.model.set("_canShowFeedback",isFeedbackPossible);if(!isFeedbackPossible||showingOnRender)return;this.showClassicFeedback()}shouldSubmitAutomatically(){const article=this.model.getParent().getParent();const assessmentConfig=article.get("_assessment")||{};const singleSubmitConfig=article.get("_assessmentSingleSubmit")||{};return!assessmentConfig._isEnabled||!singleSubmitConfig._isEnabled}startReviewMode(){this.model.setState(YESNO_STATE.REVIEW);this.updateInstruction(this.getGlobals("questionComplete"));this.handleImages(this.setImageReady.bind(this));this.setIndicatorActive();if(!this.model.isFeedbackPossible()){this.showFeedbackInComponent()}this.model.showClassicFeedback();const $markingIcons=this.$(".yesno__image-marking-icon span");a11y$1.toggleAccessible($markingIcons,true)}showFeedbackInComponent(){const feedback=this.model.getFeedbackObject();this.$(".yesno__title").html(feedback.title);this.$(".yesno__body").html(feedback.text);this.$(".yesno__instruction").html(feedback.instruction)}onPrevClicked(){const stage=this.model.get("_stage");const prevStage=stage===0?this.model.get("_images").length-1:stage-1;this.setStage(prevStage,true);this.setIndicatorActive()}onNextClicked(){const stage=this.model.get("_stage");const nextStage=stage===this.model.get("_images").length-1?0:stage+1;this.setStage(nextStage);this.setIndicatorActive()}onIndicatorClicked(e){const $target=$(e.target);const stage=$target.index();const currentStage=this.model.get("_stage");const diff=stage-currentStage;if(diff===0)return;this.setStage(stage,diff<0);this.setIndicatorActive()}setIndicatorActive(){const $indicator=this.$(".yesno__scroll-indicator").eq(this.model.get("_stage"));if(this.$currentIndicator){this.$currentIndicator.removeClass("is-active")}$indicator.addClass("is-active");this.$currentIndicator=$indicator}resetQuestion(){this.model.setState(YESNO_STATE.NOT_STARTED);this.model.resetUserAnswer();this.initialiseTimer();this.model.setupRandomisation();const shouldAutoStart=true;this.reRender(shouldAutoStart)}reRender(shouldAutoStart){this.$(".yesno__review").remove();this.handleImages(this.setImageReady.bind(this));if(shouldAutoStart)$(".yesno__start-btn").trigger("click")}getGlobals(key){const globals=this.model.get("_globals")._components._yesNo;if(key===undefined){return globals}return globals[key]}}YesNoView.template="yesNo.jsx";var YesNoView$1=__AMD("components/adapt-yesNo/js/YesNoView",YesNoView);var YesNoModel=__AMD("components/adapt-yesNo/js/YesNoModel",class YesNoModel extends QuestionModel$1{init(){super.init();const _feedback=this.get("_feedback");_feedback.correct=_feedback._correct?.text||"";this.set("_feedback",_feedback);this.set("_attemptsLeft",this.get("_attempts"))}setStateOnPageLoad(){const previouslyAttempted=this.get("_attemptsLeft")<this.get("_attempts");if(previouslyAttempted){this.setState(YESNO_STATE.RESET);this.set("_isEnabled",false);this.updateButtons();return}this.setState(YESNO_STATE.NOT_STARTED)}setState(state){const className=state.asLowerCase.replace("_","-");this.set("_questionState",state);if(!className)return;this.set("stateClass",className)}setupButtonSettings(){const buttons=this.get("_buttons");["_yes","_no"].forEach((key=>{if(buttons[key].buttonText===""){buttons[key].buttonText=" "}}));this.set("_buttons",_.extend(_.clone(Adapt$1.course.get("_buttons")),buttons))}setAttemptSpecificFeedback(feedback){const modelFeedback=this.get("_feedback");let body=modelFeedback._incorrect.text;if(this.isCorrect()){body=modelFeedback._correct.text}else if(this.isPartlyCorrect()){body=modelFeedback._partlyCorrect.text}if(!body){body=this.get("_attemptsLeft")&&feedback.notFinal||feedback.final||""}this.set({feedbackTitle:this.getFeedbackTitle(),feedbackMessage:Handlebars.compile(body)(this.toJSON())})}getFeedbackTitle(){const modelFeedback=this.get("_feedback");let title=modelFeedback._incorrect.title;if(this.isCorrect()){title=modelFeedback._correct.title}else if(this.isPartlyCorrect()){title=modelFeedback._partlyCorrect.title}if(!title){title=modelFeedback.title||this.get("displayTitle")||this.get("title")||""}return Handlebars.compile(title)(this.toJSON())}isCorrect(){const images=this.get("_images");return _.where(images,{_isCorrect:true}).length===images.length}isPartlyCorrect(){return this.get("_isAtLeastOneCorrectSelection")}canSubmit(){const images=this.get("_images");const answeredImages=_.filter(images,{_hasUserAnswer:true});return answeredImages.length===images.length||this.get("timeRemaining")===0||this.get("_buttonState")?.asLowerCase==="reset"}markQuestion(){const images=this.get("_images");let numCorrectAnswers=0;let isCorrect=true;const feedback=this.get("_feedback");const correctIcon=feedback._correct.icon;const incorrectIcon=feedback._incorrect.icon;const labels=this.get("_globals")._accessibility._ariaLabels;images.forEach((image=>{image._isCorrect=image._userAnswer===image._shouldBeSelected;if(image._isCorrect){numCorrectAnswers++;image.iconSrc=correctIcon;image.label=labels.correct}else{image.iconSrc=incorrectIcon;image.label=labels.incorrect;isCorrect=false}}));this.set({_isCorrect:isCorrect,_numCorrectAnswers:numCorrectAnswers,_isAtLeastOneCorrectSelection:numCorrectAnswers>0})}storeUserAnswer(){const userAnswer=[];this.get("_images").forEach((image=>{userAnswer[image.index]=image._userAnswer}));this.set("_userAnswer",userAnswer)}restoreUserAnswers(){const userAnswer=this.get("_userAnswer");if(!userAnswer)return;this.get("_images").forEach((image=>{image._userAnswer=userAnswer[image.index]}))}resetUserAnswer(){this.get("_images").forEach((image=>{image._userAnswer=!image._shouldBeSelected;image._hasUserAnswer=false}));this.unset("_userAnswer")}setScore(){const images=this.get("_images");const numCorrectAnswers=images.filter((item=>item._isCorrect)).length;const score=numCorrectAnswers/images.length;this.set("_score",score)}isComplete(stage){return stage+1===this.get("_images").length}getResponseType(){return"choice"}getInteractionObject(){const interactionObj={correctResponsesPattern:[],choices:[]};const buttons=this.get("_buttons");const createChoice=(image,index,isYes)=>{const buttonKey=isYes?"_yes":"_no";const id=isYes?index:index+1;const yesNoText=buttons[buttonKey].buttonText;const desc=image._graphic.alt||image.feedback;return{id:id.toString(),description:desc?desc+" | "+yesNoText:yesNoText}};return _.sortBy(this.get("_images"),"index").reduce(((currentObj,image,i)=>{const index=i*2+1;const correctIndex=image._shouldBeSelected?index:index+1;currentObj.choices=currentObj.choices.concat(createChoice(image,index,true),createChoice(image,index,false));currentObj.correctResponsesPattern=[currentObj.correctResponsesPattern.concat(correctIndex).join("[,]")];return currentObj}),interactionObj)}getResponse(){return _.sortBy(this.get("_images"),"index").reduce(((response,image,i)=>{const yesIndex=i*2+1;const noIndex=yesIndex+1;let userIndex=image._shouldBeSelected?noIndex:yesIndex;if(image._hasUserAnswer){userIndex=image._userAnswer?yesIndex:noIndex}return response.concat(userIndex)}),[]).join(",")}getFeedback(){const feedback=this.getFeedbackObject();const template=_.template('<div style="font-size: 2rem; margin-bottom: 1rem"><%= score %></div><div><%= text %></div>');return{title:feedback.title,body:template(feedback)}}getFeedbackObject(){const feedbackConfig=this.get("_feedback");const feedbackKey=this.getFeedbackKey();return _.extend({},feedbackConfig[feedbackKey],{instruction:feedbackConfig.instruction,score:this.get("_numCorrectAnswers")+"/<small>"+this.get("_images").length+"</small>"})}getFeedbackKey(){if(this.get("_isCorrect")){return"_correct"}return this.isPartlyCorrect()?"_partlyCorrect":"_incorrect"}showClassicFeedback(){if(!this.isFeedbackPossible())return;this.getFeedback()}isFeedbackPossible(){return this.get("_useClassicFeedback")&&this.get("_canShowFeedback")&&Adapt$1.course.get("_tutor")}setupRandomisation(){const images=this.get("_images");if(!this.get("_isRandomApplied")){images.forEach(((image,i)=>{image.index=i}))}if(this.get("_isRandom")){this.set("_images",_.shuffle(this.get("_images")))}this.set("_isRandomApplied",true)}});__AMD("components/adapt-yesNo/js/adapt-yesNo",components$1.register("yesNo",{view:YesNoView$1,model:YesNoModel}));class ConfirmExit{constructor(){_.extend(this,Backbone__default["default"].Events)}initialize(){this.listenTo(Adapt$1,"navigationExit",exitCourse);this.listenTo(Adapt$1,"cancelExit",cancelExit);$("html").addClass("confirm-exit");function exitCourse(){window.top.close()}function cancelExit(){$(".notify").remove()}}}Adapt$1.once("menuView:ready",(function(page){displayExitButton();addCourseExitListener()}));Adapt$1.once("pageView:ready",(function(page){displayExitButton();addCourseExitListener()}));function addCourseExitListener(){$(".nav-course__exit-btn").click((function(){showPrompt()}))}function showPrompt(){const strings=Adapt$1.course.get("_globals")._extensions._confirmExit;const promptObject={title:strings.confirmExitTitle,body:strings.confirmExitBody,_prompts:[{promptText:strings.confirmExitYes,_callbackEvent:"navigationExit"},{promptText:strings.confirmExitNo,_callbackEvent:"cancelExit"}],_showIcon:true};Adapt$1.trigger("notify:prompt",promptObject)}function displayExitButton(){$(".nav__exit-btn").remove();if($(".nav-course__exit-btn").length==0){const strings=Adapt$1.course.get("_globals")._extensions._confirmExit;const exitButton='<button class="nav-course__exit-btn icon element-color-control" data-event="exitButton" role="button" aria-label="'+strings.confirmExitButtonLabel+'"><i class="fa fa-sign-out"></i></button>';$(".nav__inner").append(exitButton);if($("#ir-styles").length>0){const $styleString=$("#ir-styles")[0].innerHTML;if($styleString.includes(".nav-course__exit-btn")){$("i.fa-sign-out").addClass("u-display-none")}}}}const confirmExit=new ConfirmExit;__AMD("extensions/adapt-confirmExit/js/adapt-confirmExit",confirmExit.initialize());class AnonTracking extends Backbone.Controller{initialize(){this.setupListeners()}setupListeners(){this.listenToOnce(Adapt$1,{"app:dataReady":this.sendLaunchedStatement,"tracking:complete":this.sendCompletedStatement})}sendLaunchedStatement(){this.sendStatement("launched")}sendCompletedStatement(){this.sendStatement("completed")}async sendStatement(statement){const config=Adapt$1.config.get("anonymousTracking");if(!config?._isEnabled)return;const{apiKey:apiKey,url:url}=config;const data={statement:statement,courseId:Adapt$1.config.get("_courseId"),tenantId:Adapt$1.course.get("_tenantId")};try{fetch(url,{body:JSON.stringify(data),headers:{"Content-Type":"application/json","x-api-key":apiKey},method:"POST",mode:"cors"}).then((response=>{if(response.status===403){logging$1.warn("Permission to view this course has been denied. Please contact your administrator");Adapt$1.config=null;Adapt$1.course=null;window.close();return}}))}catch(e){logging$1.warn(e)}}}__AMD("extensions/adapt-contrib-anonymousTracking/js/adapt-contrib-anonymousTracking",new AnonTracking);const AssessmentView={postRender(){ArticleView$1.prototype.postRender.call(this);if(this.model.isAssessmentEnabled()){this._setupEventListeners();const config=this.model.getConfig();if(config?._questions?._canShowMarking===false){this.$el.addClass("has-no-marking")}}this.$el.addClass("is-assessment")},_setupEventListeners(){this.listenTo(Adapt$1,{"assessments:complete":this._onAssessmentComplete,"assessments:reset":this._onAssessmentReset,remove:this._onRemove})},_removeEventListeners(){this.stopListening(Adapt$1,{"assessments:complete":this._onAssessmentComplete,"assessments:reset":this._onAssessmentReset})},_onAssessmentComplete(state,model){if(state.id!==this.model.get("_assessment")._id)return;logging$1.info("assessment complete",state,model)},_onAssessmentReset(state,model){if(state.id!==this.model.get("_assessment")._id)return;logging$1.info("assessment reset",state,model)},_onRemove(){this._removeEventListeners()}};var AdaptAssessmentArticleView=__AMD("extensions/adapt-contrib-assessment/js/adapt-assessmentArticleView",AssessmentView);class QuestionBank{constructor(quizBankId,articleId){this._bankId=quizBankId;this._articleId=articleId;this._unusedQuestionBlocks=null;this._count=null}calculateAvailableQuestionBlocks(count){this._count=parseInt(count);const articleModel=data$1.findById(this._articleId);const children=articleModel.getAvailableChildModels();this._availableQuestionBlocks=children.map((blockModel=>{if(blockModel.get("_assessment")?._quizBankID!==this._bankId)return null;return blockModel})).filter(Boolean);const availableQuestionBlockIds=this._availableQuestionBlocks?.map((block=>block.get("_id")))||[];const unusedQuestionBlockIds=this._unusedQuestionBlocks?.map((block=>block.get("_id")))||[];const haveBlocksChanged=Boolean(_.difference(unusedQuestionBlockIds,availableQuestionBlockIds).length);if(!haveBlocksChanged)return;this._unusedQuestionBlocks=null}getRandomQuestionBlocks(){let count=this._count;if(count>this.unusedQuestionBlocks.length){logging$1.warn(`Bank ID ${this._bankId}: Attempting to display ${count} question(s), but only ${this.unusedQuestionBlocks.length} available`);count=this.unusedQuestionBlocks.length}const questionBlocks=[];let i=0;while(i++<count){const nextBlock=this.unusedQuestionBlocks.shift();questionBlocks.push(nextBlock)}return questionBlocks}get unusedQuestionBlocks(){const hasUnusedQuestion=Boolean(this._unusedQuestionBlocks?.length);if(!hasUnusedQuestion){this._unusedQuestionBlocks=_.shuffle(this._availableQuestionBlocks.slice(0))}return this._unusedQuestionBlocks}}var QuestionBank$1=__AMD("extensions/adapt-contrib-assessment/js/adapt-assessmentQuestionBank",QuestionBank);let givenIdCount=0;const assessmentConfigDefaults={_isEnabled:true,_questions:{_resetType:"soft",_canShowFeedback:false,_canShowMarking:false,_canShowModelAnswer:false},_suppressMarking:false,_isPercentageBased:true,_scoreToPass:100,_correctToPass:100,_includeInTotalScore:true,_assessmentWeight:1,_isResetOnRevisit:true,_reloadPageOnReset:true,_attempts:"infinite",_allowResetIfPassed:false};const AssessmentModel={_getCurrentQuestionComponents(){return this.findDescendantModels("block").filter((block=>block.get("_isAvailable"))).reduce(((questions,block)=>questions.concat(block.findDescendantModels("question"))),[])},_getAllQuestionComponents(){return this.findDescendantModels("question")},_postInitialize(){if(!this.isAssessmentEnabled())return;const assessmentConfig=this.getConfig();Object.assign(this,{_originalChildModels:null,_questionBanks:null,_forceResetOnRevisit:false});let attemptsLeft;switch(assessmentConfig._attempts){case"infinite":case 0:case undefined:case-1:case null:attemptsLeft="infinite";break;default:attemptsLeft=assessmentConfig._attempts;break}this.set({_assessmentCompleteInSession:false,_attemptInProgress:false,_isAssessmentComplete:false,_numberOfQuestionsAnswered:0,_lastAttemptScoreAsPercent:0,_attempts:attemptsLeft,_attemptsLeft:attemptsLeft,_attemptsSpent:0});this.listenToOnce(Adapt$1,"app:dataReady",this._onDataReady);this.listenTo(Adapt$1,"remove",this._onRemove)},init(){Object.defineProperty(this,"_originalChildModels",{get(){if(this._originalChildModelsStore){this._originalChildModelsStore=this._originalChildModelsStore.filter((model=>data$1.hasId(model.get("_id"))));return this._originalChildModelsStore}this._originalChildModelsStore=this.getChildren().models;this._setAssessmentOwnershipOnChildrenModels(this._originalChildModelsStore);return this._originalChildModelsStore}});this.setupCurrentQuestionComponents();this._updateQuestionsState()},setupCurrentQuestionComponents(){const assessmentQuestionsConfig=this.getConfig()._questions;this._getAllQuestionComponents().forEach((component=>{component.set({_canShowFeedback:assessmentQuestionsConfig._canShowFeedback,_canShowMarking:assessmentQuestionsConfig._canShowMarking,_canShowModelAnswer:assessmentQuestionsConfig._canShowModelAnswer})}))},_setAssessmentOwnershipOnChildrenModels(childModels){const assessmentConfig=this.get("_assessment");const childConfig={_isPartOfAssessment:true,_assessmentId:assessmentConfig._id};for(const childModel of childModels){childModel.set(childConfig);childModel.setOnChildren(childConfig)}},checkIfResetOnRevisit(){},_onDataReady(){Adapt$1.assessment.register(this);const questions=this._getCurrentQuestionComponents();if(this.get("_attemptInProgress")&&questions.every((q=>q.get("_isSubmitted")))&&this.get("_requireCompletionOf")!==Number.POSITIVE_INFINITY){this.set("_attemptInProgress",false);logging$1.warn(`Assessment ${this.get("_id")} _attemptInProgress corrected as all questions are submitted`)}},_setupAssessmentData(force,callback){const assessmentConfig=this.getConfig();const state=this.getState();const hasAttemptsLeft=state.attemptsLeft>0||state.attemptsLeft==="infinite";const isFirstAttempt=state.attemptsSpent===0;const shouldResetOnRevisit=(isFirstAttempt||assessmentConfig._isResetOnRevisit)&&!this.get("_attemptInProgress");const shouldResetAssessment=shouldResetOnRevisit&&!state.isPass&&hasAttemptsLeft||force===true;const shouldResetQuestions=shouldResetOnRevisit&&(state.allowResetIfPassed||!state.isPass)||force===true;if(shouldResetAssessment||shouldResetQuestions){Adapt$1.trigger("assessments:preReset",this.getState(),this)}let quizModels;if(shouldResetAssessment){if(isFirstAttempt||assessmentConfig?._questions?._resetType==="hard"){this.set({_numberOfQuestionsAnswered:0,_isAssessmentComplete:false,_assessmentCompleteInSession:false,_score:0})}else{this.set({_assessmentCompleteInSession:false,_isAssessmentComplete:false})}this.getChildren().reset(this._originalChildModels);this._resetFilter();if(assessmentConfig?._banks._isEnabled&&assessmentConfig?._banks._split.length>1){quizModels=this._setupBankedAssessment()}else if(assessmentConfig?._randomisation._isEnabled){quizModels=this._setupRandomisedAssessment()}}if(!quizModels){quizModels=this.getChildren().models}else if(quizModels.length===0){quizModels=this.getChildren().models;logging$1.warn("assessment: Not enough unique questions to create a fresh assessment, using last selection")}else{const outsideModels=this._originalChildModels.filter((model=>model.get("_type")!=="block"));quizModels=quizModels.concat(outsideModels)}this.getChildren().reset(quizModels);this._setAssessmentOwnershipOnChildrenModels(quizModels);this.setupCurrentQuestionComponents();if(shouldResetAssessment||shouldResetQuestions){this._resetFilter();this._resetQuestions();this.set("_attemptInProgress",true);Adapt$1.trigger("assessments:reset",this.getState(),this)}if(!state.isComplete){this.set("_attemptInProgress",true)}this._overrideQuestionComponentSettings();this._setupQuestionListeners();this._checkNumberOfQuestionsAnswered();this._updateQuestionsState();Adapt$1.assessment.saveState();this.trigger("reset");if(shouldResetAssessment||shouldResetQuestions){Adapt$1.trigger("assessments:postReset",this.getState(),this)}},_setupBankedAssessment(){const assessmentConfig=this.getConfig();this._setupBanks();let blockModels=this._questionBanks.flatMap((questionBank=>questionBank.getRandomQuestionBlocks()));if(assessmentConfig._banks._randomisation){blockModels=_.shuffle(blockModels)}return blockModels},_setupBanks(){const assessmentConfig=this.getConfig();const bankSplits=assessmentConfig._banks._split.split(",");this.findDescendantModels("block").filter((block=>block.get("_isAvailable")&&block.findDescendantModels("question").length>0)).forEach((block=>{const quizBankId=block.get("_assessment")?._quizBankID;const isInvalidNumber=isNaN(quizBankId)||quizBankId<1;const isOutOfBounds=quizBankId>bankSplits.length;if(isInvalidNumber)logging$1.warn(`Bank ID ${quizBankId} is not a valid number`);if(isOutOfBounds)logging$1.warn(`Bank ID ${quizBankId} exceeds the number of available splits (${bankSplits.length})`)}));const hasBankSplitsChanged=bankSplits.length!==this._questionBanks?.length;if(hasBankSplitsChanged){this._questionBanks=[]}bankSplits.forEach(((count,index)=>{const bankId=index+1;const articleId=this.get("_id");this._questionBanks[bankId]=this._questionBanks[bankId]||new QuestionBank$1(bankId,articleId);this._questionBanks[bankId].calculateAvailableQuestionBlocks(count)}))},_setupRandomisedAssessment(){const assessmentConfig=this.getConfig();const randomisationModel=assessmentConfig._randomisation;const blockModels=this.findDescendantModels("block");let questionModels=_.shuffle(blockModels);if(randomisationModel._blockCount>0){questionModels=questionModels.slice(0,randomisationModel._blockCount)}return questionModels},_overrideQuestionComponentSettings(){const newSettings=this._getMarkingSettings();const questionConfig=this.getConfig()._questions;if(Object.prototype.hasOwnProperty.call(questionConfig,"_canShowFeedback")){newSettings._canShowFeedback=questionConfig._canShowFeedback}if(!_.isEmpty(newSettings)){const questionComponents=this._getAllQuestionComponents();questionComponents.forEach((model=>model.set(newSettings,{pluginName:"_assessment"})))}},_setupQuestionListeners(){this._removeQuestionListeners();this.listenTo(this,"bubble:change:_isInteractionComplete",this._onCompletionEvent)},_checkNumberOfQuestionsAnswered(){const questionComponents=this._getCurrentQuestionComponents();const numberOfQuestionsAnswered=questionComponents.filter((model=>model.get("_isInteractionComplete"))).length;this.set("_numberOfQuestionsAnswered",numberOfQuestionsAnswered)},_removeQuestionListeners(){this.stopListening(this,"bubble:change:_isInteractionComplete",this._onCompletionEvent)},_onCompletionEvent(event){if(event.target?.isTypeGroup("block"))return this._onBlockCompleted(event.target,event.value);if(event.target?.isTypeGroup("question"))return this._onQuestionCompleted(event.target,event.value)},_onBlockCompleted(blockModel,value){if(value===false)return;const questionModels=blockModel.findDescendantModels("question");questionModels.forEach((questionModel=>{this._onQuestionCompleted(questionModel,value)}));if(!blockModel.get("_isInteractionComplete"))return;this._checkAssessmentComplete()},_onQuestionCompleted(questionModel,value){if(value===false)return;if(!questionModel.get("_isInteractionComplete"))return;const numberOfQuestionsAnswered=this._getCurrentQuestionComponents().reduce(((count,question)=>count+=question.get("_isSubmitted")?1:0),0);this.set("_numberOfQuestionsAnswered",numberOfQuestionsAnswered);this._updateQuestionsState();Adapt$1.assessment.saveState();this._checkAssessmentComplete()},_checkAssessmentComplete(){const allQuestionsAdded=this.get("_requireCompletionOf")!==Number.POSITIVE_INFINITY;if(!allQuestionsAdded)return;const numberOfQuestionsAnswered=this.get("_numberOfQuestionsAnswered");const allQuestionsAnswered=numberOfQuestionsAnswered>=this._getCurrentQuestionComponents().length;if(!allQuestionsAnswered)return;this._onAssessmentComplete()},_onAssessmentComplete(){const wasAttemptInProgess=this.get("_attemptInProgress");if(!wasAttemptInProgess)return;this.set("_attemptInProgress",false);this._spendAttempt();const _scoreAsPercent=this._getScoreAsPercent();const _score=this._getScore();const _maxScore=this._getMaxScore();const _minScore=this._getMinScore();const _correctCount=this._getCorrectCount();const _correctAsPercent=this._getCorrectAsPercent();const _questionCount=this._getQuestionCount();this.set({_scoreAsPercent:_scoreAsPercent,_score:_score,_maxScore:_maxScore,_minScore:_minScore,_correctAsPercent:_correctAsPercent,_correctCount:_correctCount,_questionCount:_questionCount,_lastAttemptScoreAsPercent:_scoreAsPercent,_assessmentCompleteInSession:true,_isAssessmentComplete:true});this._updateQuestionsState();this._checkIsPass();this._removeQuestionListeners();if(this._isMarkingSuppressionEnabled()&&(!this._isAttemptsLeft()||this._isPassed())){_.defer((()=>{this._overrideMarkingSettings();this._refreshQuestions()}))}Adapt$1.trigger("assessments:complete",this.getState(),this)},_updateQuestionsState(){const questionComponents=this._getCurrentQuestionComponents();const questions=questionComponents.map((model=>({_id:model.get("_id"),_isCorrect:model.get("_isCorrect")??null})));this.set("_questions",questions)},_checkIsPass(){const assessmentConfig=this.getConfig();const isPercentageBased=assessmentConfig._isPercentageBased;const scoreToPass=assessmentConfig._scoreToPass;const correctToPass=assessmentConfig._correctToPass||0;const scoreAsPercent=this.get("_scoreAsPercent");const score=this.get("_score");const correctAsPercent=this.get("_correctAsPercent");const correctCount=this.get("_correctCount");const isPass=isPercentageBased?scoreAsPercent>=scoreToPass&&correctAsPercent>=correctToPass:score>=scoreToPass&&correctCount>=correctToPass;this.set("_isPass",isPass)},_getMarkingSettings(){let markingSettings={};if(this._shouldSuppressMarking()){markingSettings={_canShowMarking:false,_canShowModelAnswer:false}}else{const questionConfig=this.getConfig()._questions;if(Object.prototype.hasOwnProperty.call(questionConfig,"_canShowModelAnswer")){markingSettings._canShowModelAnswer=questionConfig._canShowModelAnswer}if(Object.prototype.hasOwnProperty.call(questionConfig,"_canShowMarking")){markingSettings._canShowMarking=questionConfig._canShowMarking}}return markingSettings},_overrideMarkingSettings(){const newMarkingSettings=this._getMarkingSettings();const questionComponents=this._getAllQuestionComponents();questionComponents.forEach((model=>model.set(newMarkingSettings,{pluginName:"_assessment"})))},_refreshQuestions(){const questionComponents=this._getCurrentQuestionComponents();questionComponents.forEach((model=>model.refresh()))},_shouldSuppressMarking(){return this._isMarkingSuppressionEnabled()&&this._isAttemptsLeft()&&!this._isPassed()},_isMarkingSuppressionEnabled(){const assessmentConfig=this.getConfig();return assessmentConfig._suppressMarking},_isAttemptsLeft(){if(this.get("_attemptsLeft")===0)return false;return true},_isPassed(){return this.get("_isAssessmentComplete")&&this.get("_isPass")},_spendAttempt(){if(!this._isAttemptsLeft())return false;let attemptsSpent=this.get("_attemptsSpent");this.set("_attemptsSpent",++attemptsSpent);if(this.get("_attempts")==="infinite")return true;let attemptsLeft=this.get("_attemptsLeft");this.set("_attemptsLeft",--attemptsLeft);return true},_getScore(){const questionComponents=this._getCurrentQuestionComponents();const score=questionComponents.reduce(((score,model)=>score+=model.score||0),0);return score},_getMaxScore(){const questionComponents=this._getCurrentQuestionComponents();const maxScore=questionComponents.reduce(((maxScore,model)=>maxScore+=model.maxScore||0),0);return maxScore},_getMinScore(){const questionComponents=this._getCurrentQuestionComponents();const minScore=questionComponents.reduce(((minScore,model)=>minScore+=model.minScore||0),0);return minScore},_getScoreAsPercent(){const minScore=this._getMinScore();const maxScore=this._getMaxScore();const score=this._getScore();const range=maxScore-minScore;return range===0?0:Math.round((score-minScore)/range*100)},_getCorrectCount(){return this._getCurrentQuestionComponents().reduce(((count,model)=>count+=model.get("_isCorrect")?1:0),0)},_getQuestionCount(){return this._getCurrentQuestionComponents().length},_getCorrectAsPercent(){const questionCount=this._getQuestionCount();return questionCount===0?0:Math.round(this._getCorrectCount()/questionCount*100)},_getLastAttemptScoreAsPercent(){return this.get("_lastAttemptScoreAsPercent")},_checkReloadPage(){if(!this.canResetInPage())return false;const parentId=this.getParent().get("_id");const currentLocation=location$1._currentId;if(currentLocation!==parentId)return false;if(!this.get("_isReady"))return false;return true},_reloadPage(callback){const assessmentConfig=this.getConfig();this._forceResetOnRevisit=true;this.listenToOnce(Adapt$1,"pageView:ready",(async()=>{if(assessmentConfig._scrollToOnReset){await router$1.navigateToElement(this.get("_id"))}callback()}));_.delay((()=>{Backbone.history.navigate("#/id/"+location$1._currentId,{replace:true,trigger:true})}),250)},_resetFilter(){const assessmentConfig=this.getConfig();if(!assessmentConfig?._questions?._resetIncorrectOnly)return;let blocks=this.getChildren().models;blocks=blocks.filter((model=>{const questions=model.findDescendantModels("question");if(!questions.length)return true;return questions.every((model=>!model.isCorrect()))}));this.getChildren().reset(blocks)},_resetQuestions(){const assessmentConfig=this.getConfig();const questionModels=this._getCurrentQuestionComponents();questionModels.forEach((model=>{if(assessmentConfig?._questions?._resetIncorrectOnly&&model?.isCorrect())return;model.reset(assessmentConfig._questions._resetType,true)}))},_onRemove(){this._removeQuestionListeners()},_setCompletionStatus(){this.set({_isComplete:true,_isInteractionComplete:true})},_checkIfQuestionsWereRestored(){if(this.get("_assessmentCompleteInSession"))return;if(!this.get("_isAssessmentComplete"))return;let wereQuestionsRestored=true;const questions=this.get("_questions");for(const question of questions){const questionModel=data$1.findById(question._id);if(questionModel.get("_isAvailable")&&!questionModel.get("_isSubmitted")){wereQuestionsRestored=false;break}}if(!wereQuestionsRestored){this.set("_assessmentCompleteInSession",true);return true}return false},isAssessmentEnabled(){if(this.get("_assessment")?._isEnabled)return true;return false},canResetInPage(){const assessmentConfig=this.getConfig();if(assessmentConfig._reloadPageOnReset===false)return false;return true},reset(force,callback){const assessmentConfig=this.getConfig();force=this._forceResetOnRevisit||force===true;this._forceResetOnRevisit=false;const isPageReload=this._checkReloadPage();if(this.get("_assessmentCompleteInSession")&&!assessmentConfig._isResetOnRevisit&&!isPageReload&&!force){if(typeof callback==="function")callback(false);return false}const wereQuestionsRestored=this._checkIfQuestionsWereRestored();force=force||wereQuestionsRestored;if(force&&!this._isAttemptsLeft()){this.set({_attemptsLeft:this.get("_attempts"),_attemptsSpent:0})}const allowResetIfPassed=this.get("_assessment")._allowResetIfPassed;if(!this._isAttemptsLeft()&&!force&&!allowResetIfPassed){if(typeof callback==="function")callback(false);return false}if(!isPageReload){this._setupAssessmentData(force);if(typeof callback==="function")callback(true)}else{this._reloadPage((()=>{if(typeof callback==="function")callback(true)}))}return true},getSaveState(){const state=this.getState();let blocks;const cfg=this.getConfig();const banksActive=cfg._banks?._isEnabled&&cfg._banks._split.length>1;const randomisationActive=cfg._randomisation?._isEnabled;if(!banksActive&&!randomisationActive){blocks=this.findDescendantModels("block")}else{blocks=state.questions.map((question=>data$1.findById(question._id).getParent()))}blocks=[...new Set(blocks)].filter((block=>block.trackingPosition));const blockTrackingPositions=blocks.map((block=>block.trackingPosition));const blockCompletion=blocks.map((block=>{const questions=block.findDescendantModels("question");return questions.map((question=>question.get("_isCorrect")||false))}));const blockData=[blockTrackingPositions,blockCompletion];const saveState=[state.isComplete?1:0,state.attemptsSpent,state.maxScore||0,state.score,state.attemptInProgress?1:0,state.minScore||0,state.correctAsPercent||0,state.correctCount||0,state.questionCount||0];const dataPackage=[saveState,blockData];return dataPackage},setRestoreState(dataPackage){const restoreState=dataPackage[0];const blockData=dataPackage[1];const _isAssessmentComplete=restoreState[0]===1;const attempts=this.get("_attempts");const _attemptsSpent=restoreState[1];const maxScore=restoreState[2];const score=restoreState[3];const _scoreAsPercent=score?Math.round(score/maxScore*100):0;const _attemptInProgress=restoreState[4]===1;const minScore=restoreState[5];const correctAsPercent=restoreState[6];const correctCount=restoreState[7];const questionCount=restoreState[8];const blocks=blockData[0].map((trackingPosition=>{if(typeof trackingPosition==="number"){return data$1.findWhere({_trackingId:trackingPosition})}return data$1.findByTrackingPosition(trackingPosition)}));if(blocks.length){const nonBlockChildren=this.getChildren().models.filter((model=>!model.isTypeGroup("block")));this.getChildren().reset(blocks.concat(nonBlockChildren))}const _questions=[];blocks.forEach(((block,blockIndex)=>{const blockQuestions=block.findDescendantModels("question");blockQuestions.forEach(((question,questionIndex)=>{_questions.push({_id:question.get("_id"),_isCorrect:blockData[1][blockIndex][questionIndex]})}))}));this.set({_isAssessmentComplete:_isAssessmentComplete,_assessmentCompleteInSession:false,_attemptsSpent:_attemptsSpent,_attemptInProgress:_attemptInProgress,_attemptsLeft:attempts==="infinite"?attempts:attempts-_attemptsSpent,_maxScore:maxScore||this._getMaxScore(),_minScore:minScore||this._getMinScore(),_score:score||0,_scoreAsPercent:_scoreAsPercent,_correctAsPercent:correctAsPercent||0,_correctCount:correctCount||0,_questions:_questions,_questionCount:questionCount||0,_lastAttemptScoreAsPercent:_scoreAsPercent});if(_isAssessmentComplete)this._checkIsPass();this._setAssessmentOwnershipOnChildrenModels(blocks);Adapt$1.trigger("assessments:restored",this.getState(),this)},getState(){const assessmentConfig=this.getConfig();const state={id:assessmentConfig._id,type:"article-assessment",pageId:this.getParent().get("_id"),articleId:this.get("_id"),isEnabled:assessmentConfig._isEnabled,isComplete:this.get("_isAssessmentComplete"),isPercentageBased:assessmentConfig._isPercentageBased,scoreToPass:assessmentConfig._scoreToPass,score:this.get("_score"),scoreAsPercent:this.get("_scoreAsPercent"),maxScore:this.get("_maxScore"),minScore:this.get("_minScore"),correctCount:this.get("_correctCount"),correctAsPercent:this.get("_correctAsPercent"),correctToPass:assessmentConfig._correctToPass,questionCount:this.get("_questionCount"),isPass:this.get("_isPass"),includeInTotalScore:assessmentConfig._includeInTotalScore,assessmentWeight:assessmentConfig._assessmentWeight,attempts:this.get("_attempts"),attemptsSpent:this.get("_attemptsSpent"),attemptsLeft:this.get("_attemptsLeft"),attemptInProgress:this.get("_attemptInProgress"),lastAttemptScoreAsPercent:this.get("_lastAttemptScoreAsPercent"),questions:this.get("_questions"),resetType:assessmentConfig._questions._resetType,allowResetIfPassed:assessmentConfig._allowResetIfPassed,questionModels:new Backbone.Collection(this._getCurrentQuestionComponents())};return state},getConfig(){let assessmentConfig=this.get("_assessment");if(!assessmentConfig){assessmentConfig=$.extend(true,{},assessmentConfigDefaults)}else{assessmentConfig=$.extend(true,{},assessmentConfigDefaults,assessmentConfig)}if(assessmentConfig._id===undefined){assessmentConfig._id="givenId"+givenIdCount++}this.set("_assessment",assessmentConfig);return assessmentConfig}};var AdaptAssessmentArticleModel=__AMD("extensions/adapt-contrib-assessment/js/adapt-assessmentArticleModel",AssessmentModel);const assessmentsConfigDefaults={_isPercentageBased:true,_scoreToPass:100,_isDefaultsLoaded:true};class Assessment extends Backbone.Controller{initialize(){this._assessments=Object.assign([],{_byPageId:{},_byAssessmentId:{}});this.listenTo(Adapt$1,{"assessments:complete":this._onAssessmentsComplete,"router:location":this._checkResetAssessmentsOnRevisit,"router:plugin":this._handleRoute,"app:dataReady":this._onDataReady});this.triggerAssessmentsRestored()}async triggerAssessmentsRestored(){await data$1.whenReady();Adapt$1.trigger("assessment:restored",this.getState())}_onAssessmentsComplete(state){const assessmentId=state.id;state.isComplete=true;if(assessmentId===undefined)return;if(!this._getStateByAssessmentId(assessmentId)){logging$1.warn("assessments: state was not registered when assessment was created")}this.saveState();this._setPageProgress();this._checkAssessmentsComplete()}_restoreModelState(assessmentModel){if(!this._saveStateModel){this._saveStateModel=offlineStorage$1.get("a")}if(this._saveStateModel){const state=assessmentModel.getState();if(this._saveStateModel[state.id]){assessmentModel.setRestoreState(offlineStorage$1.deserialize(this._saveStateModel[state.id]))}}}_handleRoute(plugin,id){if(plugin!=="assessment"&&plugin!=="article-assessment"||id===undefined){return}if(!data$1.findById(id)){const assessment=Adapt$1.assessment._assessments._byAssessmentId[id];if(assessment){id=assessment.get("_id")}else{logging$1.warn("Assessment not found with _id: "+id);return}}_.defer((()=>{Backbone.history.navigate("#/id/"+id,{trigger:true,replace:true})}))}_checkResetAssessmentsOnRevisit(toObject){if(toObject._contentType!=="page")return;const pageAssessmentModels=this._getAssessmentByPageId(toObject._currentId);if(pageAssessmentModels===undefined)return;wait$1.for((function resetAllAssessments(allAssessmentHaveReset){const numberOfAssessments=pageAssessmentModels.length;let numberOfResetAssessments=0;const forceAssessmentReset=false;pageAssessmentModels.forEach((model=>{model.reset(forceAssessmentReset,(()=>{numberOfResetAssessments++;const haveAllModelsReset=numberOfResetAssessments===numberOfAssessments;if(!haveAllModelsReset){return}allAssessmentHaveReset()}))}))}));this._setPageProgress()}_onDataReady(){this._assessments=Object.assign([],{_byPageId:{},_byAssessmentId:{}});this._saveStateModel=null;this._restoredCount=0}_checkAssessmentsComplete(){let allAssessmentsComplete=true;let assessmentToPostBack=0;const states=this._getStatesByAssessmentId();const assessmentStates=[];for(const id in states){const state=states[id];if(!state.includeInTotalScore)continue;if(!state.isComplete){allAssessmentsComplete=false;break}assessmentToPostBack++;assessmentStates.push(state)}if(!allAssessmentsComplete||assessmentToPostBack===0)return false;if(assessmentToPostBack===1){this._setupSingleAssessmentConfiguration(assessmentStates[0])}_.defer((()=>Adapt$1.trigger("assessment:complete",this.getState())));return true}_setupSingleAssessmentConfiguration(assessmentState){const assessmentsConfig=Adapt$1.course.get("_assessment");$.extend(true,assessmentsConfig,{_isPercentageBased:assessmentState.isPercentageBased,_scoreToPass:assessmentState.scoreToPass});Adapt$1.course.set("_assessment",assessmentsConfig)}_getAssessmentByPageId(pageId){return this._assessments._byPageId[pageId]}_getStateByAssessmentId(assessmentId){if(assessmentId===undefined){return null}return this._assessments._byAssessmentId[assessmentId].getState()}_getStatesByAssessmentId(){const states={};for(const assessmentModel of this._assessments){if(!assessmentModel.get("_isAvailable"))continue;const state=assessmentModel.getState();states[state.id]=state}return states}_setPageProgress(){for(const[id,assessments]of Object.entries(this._assessments._byPageId)){const availableAssessments=assessments.filter((model=>model.get("_isAvailable")));const assessmentsTotal=availableAssessments.length;let assessmentsPassed=0;for(const assessment of availableAssessments){const assessmentState=assessment.getState();if(assessmentState.includeInTotalScore&&!assessmentState.isPass)continue;if(assessmentState.isComplete){assessmentsPassed++}}const pageModel=data$1.findById(id);pageModel?.set({_subProgressTotal:assessmentsTotal,_subProgressComplete:assessmentsPassed})}}_addToAssessmentIdMap(id,model){if(id===undefined){logging$1.warn('An assessment has been registered with an undefined value for "_id"');return}if(id===""){logging$1.warn('An assessment has been registered with an empty value for "_id"')}if(!this._assessments._byAssessmentId[id]){this._assessments._byAssessmentId[id]=model}else{logging$1.warn('An assessment with an _id of "'+id+'" already exists!')}}_setupQuestionNumbering(){const getRelatedQuestions=data=>{const currentAssessmentId=data._assessmentId;const currentAssessment=Adapt$1.assessment.get(currentAssessmentId);return currentAssessment.getState().questions};Handlebars.registerHelper("questionNumber",(function getQuestionNumber(){const data=this.view?.model.toJSON()||this;if(!data._isPartOfAssessment)return;const related=_.pluck(getRelatedQuestions(data),"_id");return related.indexOf(data._id)+1}));Handlebars.registerHelper("questionCount",(function getTotalQuestions(){const data=this.view?this.view.model.toJSON():this;if(!data._isPartOfAssessment)return;return getRelatedQuestions(data).length}))}register(assessmentModel){const state=assessmentModel.getState();const assessmentId=state.id;const pageId=state.pageId;if(this._assessments._byPageId[pageId]===undefined){this._assessments._byPageId[pageId]=[]}this._assessments._byPageId[pageId].push(assessmentModel);this._addToAssessmentIdMap(assessmentId,assessmentModel);this._assessments.push(assessmentModel);this._restoreModelState(assessmentModel);this._restoredCount++;Adapt$1.trigger("assessments:register",state,assessmentModel);this._setPageProgress();this._setupQuestionNumbering()}get(id){return id===undefined?this._assessments.slice(0):this._assessments._byAssessmentId[id]}saveState(){this._saveStateModel={};for(const assessmentModel of this._assessments){const state=assessmentModel.getState();this._saveStateModel[state.id]=offlineStorage$1.serialize(assessmentModel.getSaveState())}offlineStorage$1.set("a",this._saveStateModel)}getConfig(){let assessmentsConfig=Adapt$1.course.get("_assessment");if(assessmentsConfig?._isDefaultsLoaded){return assessmentsConfig}if(assessmentsConfig===undefined){assessmentsConfig=$.extend(true,{},assessmentsConfigDefaults)}else{assessmentsConfig=$.extend(true,{},assessmentsConfigDefaults,assessmentsConfig)}Adapt$1.course.set("_assessment",assessmentsConfig);return assessmentsConfig}getState(){const assessmentsConfig=this.getConfig();let score=0;let maxScore=0;let minScore=0;let correctCount=0;let questionCount=0;let assessments=0;const states=this._getStatesByAssessmentId();let assessmentsComplete=0;for(const id in states){const state=states[id];if(!state.includeInTotalScore)continue;if(state.isComplete)assessmentsComplete++;assessments++;maxScore+=state.maxScore/state.assessmentWeight;minScore+=state.minScore/state.assessmentWeight;score+=state.score/state.assessmentWeight;correctCount+=state.correctCount/state.assessmentWeight;questionCount+=state.questionCount/state.assessmentWeight}const isComplete=assessmentsComplete===assessments;const scoreRange=maxScore-minScore;const scoreAsPercent=scoreRange===0?0:Math.round((score-minScore)/scoreRange*100);const correctAsPercent=questionCount===0?0:Math.round(correctCount/questionCount*100);if(assessmentsConfig._correctToPass===undefined){logging$1.warnOnce("Assessment course config is missing _correctToPass")}const scoreToPass=assessmentsConfig._scoreToPass;const correctToPass=assessmentsConfig._correctToPass||scoreToPass;const isPercentageBased=assessmentsConfig._isPercentageBased;const isPass=isComplete&&(isPercentageBased?scoreAsPercent>=scoreToPass&&correctAsPercent>=correctToPass:score>=scoreToPass&&correctCount>=correctToPass);const canRetry=Object.values(states).some((state=>{const isFailed=!state.isPass;const hasAttemptsLeft=state.attemptsLeft>0||state.attemptsLeft==="infinite";return isFailed&&hasAttemptsLeft}));return{isComplete:isComplete,isPercentageBased:isPercentageBased,isPass:isPass,maxScore:maxScore,minScore:minScore,score:score,scoreToPass:scoreToPass,scoreAsPercent:scoreAsPercent,correctCount:correctCount,correctAsPercent:correctAsPercent,correctToPass:correctToPass,questionCount:questionCount,assessmentsComplete:assessmentsComplete,assessments:assessments,canRetry:canRetry}}}__AMD("extensions/adapt-contrib-assessment/js/assessment",Adapt$1.assessment=new Assessment);const ArticleViewInitialize=ArticleView$1.prototype.initialize;ArticleView$1.prototype.initialize=function(options){if(this.model.get("_assessment")?._isEnabled===true){Object.assign(this,AdaptAssessmentArticleView)}return ArticleViewInitialize.apply(this,arguments)};const ArticleModelInitialize=ArticleModel$1.prototype.initialize;ArticleModel$1.prototype.initialize=function(options){if(this.get("_assessment")?._isEnabled===true){Object.assign(this,AdaptAssessmentArticleModel);const returnValue=ArticleModelInitialize.apply(this,arguments);this._postInitialize();return returnValue}return ArticleModelInitialize.apply(this,arguments)};var AssessmentSingleSubmitView=__AMD("extensions/adapt-contrib-assessmentSingleSubmit/js/AssessmentSingleSubmitView",class AssessmentSingleSubmitView extends Backbone.View{className(){return"submit-view"}events(){return{"click .btn__action":"onActionClicked","click .btn__feedback":"onShowFeedbackClicked"}}initialize(options){this.options=options;this.assessmentSettings=this.options.parent.assessmentSettings;this.settings=this.options.parent.settings;this.listenTo(Adapt$1,{remove:this.remove,"assessments:complete":this.onAssessmentsComplete,"assessments:reset":this.onAssessmentsReset});this.render()}render(){const template=Handlebars.templates["assessmentSingleSubmit"];const data=_.extend(this.settings,{_buttons:Adapt$1.course.get("_buttons")});this.$el.html(template(data));if(!this.assessmentSettings._questions._canShowFeedback){this.$el.addClass("no-feedback single-btn")}this.postRender()}postRender(){this.refreshDisplay();this.handleInstructionRendering(true,true);this.displayMarkingIcons()}renderInstructionText(){const text=this.settings.instructionText||"Click 'Submit' if you're happy with your answers above";this.$(".btn__instruction").text(text).removeClass("has-error")}removeInstructionText(){this.$(".btn__instruction").html("&nbsp;").removeClass("has-error")}renderInstructionError(){const text=this.settings.submissionError||"Please answer all the above questions before clicking 'Submit'";this.$(".btn__instruction").text(text).addClass("has-error")}setButtonStates(){const isSubmitted=this.options.parent.isSubmitted;const isAttemptsLeft=this.getAssessment()._isAttemptsLeft();const isPassed=this.getAssessment()._isPassed();const questionConfig=this.assessmentSettings._questions;const $actionButton=this.$el.find(".btn__action").first();let actionText=this.getButtonText("_submit","Submit");let isActionEnabled=true;if(isSubmitted){if(isAttemptsLeft&&!isPassed){actionText=this.getButtonText("_reset","Reset")}else if(questionConfig._canShowModelAnswer&&!this.isAssessmentCompletelyCorrect()){const args=this.options.parent.displayUserAnswer?["_showCorrectAnswer","Show correct answer"]:["_hideCorrectAnswer","Show user answer"];actionText=this.getButtonText.apply(this,args)}else{isActionEnabled=false}}$actionButton.text(actionText);this.setButtonEnabled($actionButton,isActionEnabled);if(questionConfig._canShowFeedback){const $feedbackButton=this.$el.find(".btn__feedback").first();this.setButtonEnabled($feedbackButton,isSubmitted)}}getButtonText(key,fallback){const buttonsConfig=Adapt$1.course.get("_buttons");return buttonsConfig&&buttonsConfig[key]&&buttonsConfig[key].buttonText||fallback}setButtonEnabled($button,isEnabled){isEnabled?$button.removeClass("is-disabled"):$button.addClass("is-disabled");$button.attr("disabled",!isEnabled)}refreshDisplay(){this.setButtonStates();this.displayMarkingIcons();this.updateAttemptsCount();this.setupFeedback()}displayMarkingIcons(){const singleSubmitModel=this.options.parent;const markingIconElement=this.$el.find(".btn__marking").first();if(!markingIconElement)return;markingIconElement.find(".icon").removeClass("icon-tick");markingIconElement.find(".icon").removeClass("icon-cross");if(!singleSubmitModel["isSubmitted"]){markingIconElement.addClass("u-display-none");return}let addedClass="icon-cross";if(this.isAssessmentPassed()){addedClass="icon-tick"}markingIconElement.find(".icon").addClass(addedClass);markingIconElement.removeClass("u-display-none")}updateAttemptsCount(){const assessment=this.getAssessment();const attemptsElement=this.$el.find(".btn__display-inner").first();const attemptsLeft=assessment.get("_attemptsLeft");const shouldDisplayAttempts=this.settings["_shouldDisplayAttempts"];if(!attemptsElement)return;if(shouldDisplayAttempts){attemptsElement.show();if(attemptsLeft==="infinite"){const unlimitedAttemptsRemaining=this.settings["unlimitedAttemptsRemaining"];attemptsElement.html(unlimitedAttemptsRemaining);return}if(attemptsLeft===0){const noAttemptsRemaining=this.settings["noAttemptsRemaining"];attemptsElement.html(noAttemptsRemaining);return}let attemptsString;if(attemptsLeft>1){if(!_.isEmpty(Adapt$1.course.get("_buttons"))&&!_.isEmpty(Adapt$1.course.get("_buttons")["remainingAttemptsText"])){attemptsString=Adapt$1.course.get("_buttons")["remainingAttemptsText"]}else{attemptsString="attempts remaining"}}else{if(!_.isEmpty(Adapt$1.course.get("_buttons"))&&!_.isEmpty(Adapt$1.course.get("_buttons")["remainingAttemptText"])){attemptsString=Adapt$1.course.get("_buttons")["remainingAttemptText"]}else{attemptsString="final attempt"}}attemptsElement.html(attemptsLeft+" "+attemptsString);return}attemptsElement.html("");attemptsElement.hide()}setupFeedback(){const assessment=this.getAssessment();let feedbackMessage;const feedbackConfig=this.settings._feedback||{};if(this.isAssessmentPassed()){feedbackMessage=feedbackConfig.pass}else{const isAttemptsLeft=assessment._isAttemptsLeft();const failConfig=feedbackConfig.fail||{};feedbackMessage=isAttemptsLeft?failConfig.attemptsRemaining:failConfig.noAttemptsRemaining}const questionCount=assessment.get("_questions").length;const correctCount=assessment._getScore();const incorrectCount=questionCount-correctCount;let correctness=this.settings._feedback.correctness||"";if(_.isString(correctness)&&!_.isEmpty(correctness)){const placeholders={"{{correctCount}}":correctCount,"{{incorrectCount}}":incorrectCount,"{{questionCount}}":questionCount};correctness=correctness.replace(/{{\w+}}/g,(function(placeholder){return placeholders[placeholder]}))}assessment.set("feedbackTitle",correctness);assessment.set("feedbackMessage",feedbackMessage||"");if(!this.settings._canShowFeedback)return;this.options.parent.view.model.findDescendantModels("question").forEach((question=>question.set("_canShowFeedback",false)))}onActionClicked(){this.handleInstructionRendering();if(this.getAssessment().get("_attemptInProgress"))return;this.setButtonStates()}onAssessmentsComplete(){this.refreshDisplay();if(!this.settings._canShowFeedback||!this.assessmentSettings._questions._canShowFeedback)return;const parent=this.options.parent;if(!parent.isSubmitted||!parent.canSubmit())return;this.onShowFeedbackClicked()}onAssessmentsReset(){this.setButtonStates();this.setupFeedback()}handleInstructionRendering(onRender=false,fromPageLoad=false){const parent=this.options.parent;const isSubmitted=parent.isSubmitted;if(isSubmitted){if(fromPageLoad){this.setupFeedback();return}const shouldReset=this.getAssessment()?.getConfig()?._isResetOnRevisit&&this.getAssessment()?._isAttemptsLeft();if(shouldReset){parent.resetAssessment();this.renderInstructionText();return}this.$el.parents(".article").find(".component__widget").toggleClass("singlesubmit-show-answer",this.options.parent.displayUserAnswer);parent.toggleShowCorrectAnswer();return}if(parent.canSubmit()){parent.onSubmit();this.removeInstructionText();return}if(onRender){this.renderInstructionText();return}this.renderInstructionError()}onShowFeedbackClicked(){const alertObject={title:this.getAssessment().get("feedbackTitle"),body:this.getAssessment().get("feedbackMessage")};if(this.isAssessmentCompletelyCorrect()){alertObject._classes="is-correct"}else if(this.isAssessmentPartlyCorrect()){alertObject._classes="is-partially-correct"}else{alertObject._classes="is-incorrect"}Adapt$1.notify.popup(alertObject)}getAssessment(){return this.options.parent.view.model}isAssessmentPassed(){this.getAssessment()._checkIsPass();return this.getAssessment().get("_isPass")}isAssessmentCompletelyCorrect(){return this.getAssessment()._getScoreAsPercent()===100}isAssessmentPartlyCorrect(){return this.getAssessment()._getScoreAsPercent()<100&&this.getAssessment()._getScoreAsPercent()>0}isAssessmentCompletelyIncorrect(){return this.getAssessment()._getScoreAsPercent()===0}});class AssessmentSingleSubmit extends Backbone.View{setup(view){this.view=view;this.view.$el.addClass("assessmentsinglesubmit");this.components=Adapt$1.course.findDescendantModels("component").filter((component=>component.get("_isQuestionType")===true));this.componentViews={};this.assessmentSettings=view.model.get("_assessment");this.settings=view.model.get("_assessmentSingleSubmit");this.isSubmitted=view.model.get("_isAssessmentComplete");this.displayUserAnswer=true}appendSubmitView(){this.buttonView=new AssessmentSingleSubmitView({parent:this});this.view.$el.find(".article__inner").append(this.buttonView.$el)}onSubmit(){if(!this.canSubmit()){return false}this.isSubmitted=true;_.each(this.componentViews,(componentView=>{setTimeout((()=>{this.handleIndividualView(componentView)}),200)}))}handleIndividualView(componentView){componentView.model.set({_attempts:this.view.model.get("_attempts"),_attemptsLeft:1});componentView.onSubmitClicked();this.showComponentMarkingIcons(componentView,this)}toggleShowCorrectAnswer(){this.displayUserAnswer=!this.displayUserAnswer;const componentMethod=this.displayUserAnswer?"hideCorrectAnswer":"showCorrectAnswer";_.each(this.componentViews,(componentView=>{componentView[componentMethod]()}))}resetAssessment(){this.isSubmitted=false;const assessment=this.view.model;if(!assessment._isAttemptsLeft()){return false}assessment.set({_numberOfQuestionsAnswered:0,_isAssessmentComplete:false,_assessmentCompleteInSession:false,_score:0,_attemptInProgress:true});let componentsToReset=this.components;if(this.settings._resetIncorrectOnly){componentsToReset=_.filter(componentsToReset,(component=>component.get("_isCorrect")===false))}componentsToReset.forEach((component=>{const componentView=this.componentViews[component.get("_id")];if(componentView){componentView.$(".component__widget").removeClass("is-submitted is-complete show-user-answer");componentView.model.set({_isSubmitted:false,_isComplete:false,_isCorrect:false,_isInteractionComplete:false,_attempts:this.view.model.get("_attempts"),_attemptsLeft:1});componentView.onResetClicked();this.hideComponentMarkingIcons(componentView)}}));assessment._overrideQuestionComponentSettings();assessment._setupQuestionListeners();assessment._checkNumberOfQuestionsAnswered();assessment._updateQuestionsState();Adapt$1.trigger("assessments:reset",assessment.getState(),assessment);Adapt$1.assessment.saveState()}canSubmit(){let canSubmit=false;if(!_.isEmpty(this.componentViews)){canSubmit=_.every(this.componentViews,(view=>view.model.canSubmit&&view.model.canSubmit()))}return canSubmit}isAssessmentSingleSubmitEnabled(assessmentArticleModel){const singleSubmitConfig=assessmentArticleModel.get("_assessmentSingleSubmit");if(!singleSubmitConfig||!singleSubmitConfig._isEnabled){return false}const assessment=assessmentArticleModel.get("_assessment");const assessmentSingleSubmit=assessmentArticleModel.get("_assessmentSingleSubmit");if(!assessment||assessment._isEnabled!==true||!assessmentSingleSubmit||assessmentSingleSubmit._isEnabled!==true){return false}return true}setupComponentMarkingIcons(componentView){const $markingIcon=componentView.$el.find(".btn__marking").first();if($markingIcon){$markingIcon.detach().appendTo(componentView.$el.find(".component__inner").first());$markingIcon.removeClass("btn__marking");$markingIcon.addClass("btn__marking-icon")}componentView.$el.find(".btn__container").remove()}showComponentMarkingIcons(componentView,context){if(!context.assessmentSettings["_questions"]["_canShowMarking"]||context.assessmentSettings["_questions"]["_canShowMarking"]!==true){return false}const feedbackType=context.settings["questionComponentFeedbackType"];const $genericMarkingIcon=$(".btn__marking-icon",componentView.$el.find(".component__inner").first());const $specificMarkingIcons=componentView.$("div[class*=__item-icon]:not(div[class*=__item-answer-icon]) .icon, div[class*=__select-icon] .icon");if(feedbackType&&feedbackType==="specific"){$genericMarkingIcon.addClass("u-display-none");componentView.showMarking();$specificMarkingIcons.removeClass("u-display-none")}else{if($genericMarkingIcon){if(componentView.model.get("_isCorrect")){$genericMarkingIcon.find(".icon").addClass("icon-tick")}else{$genericMarkingIcon.find(".icon").addClass("icon-cross")}}$genericMarkingIcon.removeClass("u-display-none");$specificMarkingIcons.addClass("u-display-none")}}hideComponentMarkingIcons(componentView){const $genericMarkingIcon=$(".btn__marking-icon",componentView.$el.find(".component__inner").first());const $specificMarkingIcons=$("div[class*=__item-icon]:not(div[class*=__item-answer-icon])").find(".icon");const $submitViewMarkingIcon=$(".submit-view").find(".btn__marking");$genericMarkingIcon.find(".icon").removeClass("icon-cross");$genericMarkingIcon.find(".icon").removeClass("icon-tick");$genericMarkingIcon.addClass("u-display-none");$specificMarkingIcons.addClass("u-display-none");$submitViewMarkingIcon.addClass("u-display-none")}}Adapt$1.on("articleView:preRender",(articleView=>{if(!assessmentSingleSubmit.isAssessmentSingleSubmitEnabled(articleView.model))return;articleView.model.set("AssessmentSingleSubmit",new AssessmentSingleSubmit);articleView.model.get("AssessmentSingleSubmit").setup(articleView)}));Adapt$1.on("articleView:postRender",(articleView=>{if(!assessmentSingleSubmit.isAssessmentSingleSubmitEnabled(articleView.model))return;articleView.model.get("AssessmentSingleSubmit").appendSubmitView()}));Adapt$1.on("componentView:postRender",(componentView=>{const componentId=componentView.model.get("_id");const blockId=componentView.model.get("_parentId");const articleId=data$1.findById(blockId).get("_parentId");const articleModel=data$1.findById(articleId);if(!assessmentSingleSubmit.isAssessmentSingleSubmitEnabled(articleModel))return;const singleSubmit=articleModel.get("AssessmentSingleSubmit");if(_.isUndefined(_.find(singleSubmit.components,(component=>component.get("_id")===componentId)))){return}singleSubmit.componentViews[componentId]=componentView;assessmentSingleSubmit.setupComponentMarkingIcons(componentView);const shouldShowCorrectMarking=singleSubmit.settings._resetIncorrectOnly&&componentView.model.get("_isCorrect");if(singleSubmit.isSubmitted||shouldShowCorrectMarking){assessmentSingleSubmit.showComponentMarkingIcons(componentView,singleSubmit)}}));const assessmentSingleSubmit=new AssessmentSingleSubmit;__AMD("extensions/adapt-contrib-assessmentSingleSubmit/js/adapt-contrib-assessmentSingleSubmit",assessmentSingleSubmit);var BookmarkingModel=__AMD("extensions/adapt-contrib-bookmarking/js/BookmarkingModel",class BookmarkingModel extends Backbone.Model{defaults(){return{label:"",ariaLabel:"",_location:"previous"}}});var BookmarkingView=__AMD("extensions/adapt-contrib-bookmarking/js/BookmarkingView",class BookmarkingView extends Backbone.View{get config(){return Adapt$1.course.get("_bookmarking")}className(){return classes(["bookmarking-resume"])}events(){return{"click .js-bookmarking-resume-button":"onResumeClicked"}}initialize(){this._classSet=new Set(_.result(this,"className").trim().split(/\s+/));this.render()}render(){const Template=templates.bookmarkingResume;this.updateViewProperties();ReactDOM__default["default"].render(React__default["default"].createElement(Template,this.model.toJSON()),this.el)}updateViewProperties(){const classesToAdd=_.result(this,"className").trim().split(/\s+/);classesToAdd.forEach((i=>this._classSet.add(i)));const classesToRemove=[...this._classSet].filter((i=>!classesToAdd.includes(i)));classesToRemove.forEach((i=>this._classSet.delete(i)));this._setAttributes({..._.result(this,"attributes"),id:_.result(this,"id")});this.$el.removeClass(classesToRemove).addClass(classesToAdd)}onResumeClicked(){Adapt$1.trigger("bookmarking:resume",this.model.get("_location"))}});const selfClosingCustomTag=/<((bookmarking)[^>]*)\/>/gi;const o2=Handlebars.compile;Handlebars.compile=html=>o2(html.replace(selfClosingCustomTag,"<$1></$2>"));class Bookmarking extends Backbone.Controller{initialize(){this.bookmarkLevel=null;this.restoredLocationID=null;this.currentLocationID=null;this.listenToOnce(Adapt$1,"router:location",this.onAdaptInitialize)}get globals(){return Adapt$1.course.get("_globals")}get config(){return Adapt$1.course.get("_bookmarking")}get location(){return this.config._location||"previous"}get isEnabled(){return Boolean(this.config?._isEnabled)}getLocationId(location=this.location){const id=location==="furthest"?this.furthestIncompleteModel?.get?.("_id"):this.restoredLocationID;return id}get furthestIncompleteModel(){const bookmarkLevel=this.config._level||"component";const getIncompleteModels=Adapt$1.course.findDescendantModels(bookmarkLevel,{where:{_isComplete:false,_isAvailable:true,_isOptional:false}});const furthestIncompleteModel=getIncompleteModels.at(0);return furthestIncompleteModel}onAdaptInitialize(){if(!this.checkCourseIsEnabled())return;this.setupEventListeners();this.checkRestoreLocation()}checkCourseIsEnabled(){const courseBookmarkModel=this.config;if(!courseBookmarkModel||!courseBookmarkModel._isEnabled)return false;return true}setupEventListeners(){this._onInview=this.onInview.bind(this);this._debouncedCheckLocation=_.debounce(this.checkLocation.bind(this),250);this.listenTo(Adapt$1,{"menuView:ready":this.setupMenu,"pageView:preRender":this.setupPage,"view:childAdded":this.onChildViewAdded,"view:preRemove":this.onChildViewPreRemove,"bookmarking:resume":this.navigateTo});this.listenTo(documentModifications$1,{"added:bookmarking":this.onAdd,"removed:div.bookmarking":this.onRemove})}onAdd(event){if(!this.isEnabled)return;const{resumeButtonText:resumeButtonText,resumeButtonAriaLabel:resumeButtonAriaLabel}=this.globals._extensions._bookmarking;const $target=$(event.target);const label=$target.attr("label")||$target.html()||resumeButtonText||null;const ariaLabel=$target.attr("aria-label")||resumeButtonAriaLabel||null;const _location=$target.attr("location")||this.location;const id=this.getLocationId(_location);const isDisabled=["",undefined,"current"].includes(id);const model=new BookmarkingModel({label:label,ariaLabel:ariaLabel,_location:_location,isDisabled:isDisabled});const view=new BookmarkingView({model:model});$target.replaceWith(view.$el)}onRemove(event){if(!this.isEnabled)return;const view=event.target._view;view.remove();delete view.el._view}checkRestoreLocation(){this.restoredLocationID=offlineStorage$1.get("location");if(!this.restoredLocationID||this.restoredLocationID==="undefined"||!data$1.findById(this.restoredLocationID))return;this.listenToOnce(Adapt$1,"pageView:ready menuView:ready",this.restoreLocation)}restoreLocation(){this.stopListening(Adapt$1,"pageView:ready menuView:ready",this.restoreLocation);_.delay((()=>{if(this.config._autoRestore===false)return;if(this.isAlreadyOnScreen(this.restoredLocationID))return;if(this.config._showPrompt===false){this.navigateTo();return}this.showPrompt()}),500)}isAlreadyOnScreen(id){if(id===location$1._currentId)return true;const type=data$1.findById(id).getTypeGroup();if(type==="menu"||type==="page")return false;const measurements=$(`.${id}`).onscreen();const isLocationOnscreen=measurements?.onscreen??false;const isLocationFullyInview=measurements?.percentInview===100??false;return isLocationOnscreen&&isLocationFullyInview}showPrompt(){const buttons=this.config._buttons||{yes:"Yes",no:"No"};this.listenToOnce(Adapt$1,{"bookmarking:continue":this.navigateTo,"bookmarking:cancel":this.navigateCancel});notify$1.prompt({_classes:"is-bookmarking",_showIcon:true,title:this.config.title,body:this.config.body,_prompts:[{promptText:buttons.yes||"Yes",_callbackEvent:"bookmarking:continue"},{promptText:buttons.no||"No",_callbackEvent:"bookmarking:cancel"}]})}resolveLocking(id){const model=data$1.findById(id);const isCourse=model.isTypeGroup("course");if(isCourse)return id;const isContentObject=model.isTypeGroup("contentobject");const isLockedContentObject=isContentObject&&model.get("_isLocked");const descendants=isContentObject?Adapt$1.course.getAllDescendantModels(true).filter((descendant=>descendant.isTypeGroup("contentobject"))):model.findAncestor("page").getAllDescendantModels(true);const precedingModels=descendants.slice(0,descendants.indexOf(model));const isPrecededByLockedContent=precedingModels.some((precedingModel=>precedingModel.get("_isLocked")));if(!isPrecededByLockedContent&&!isLockedContentObject)return id;const nearestUnlockedIndex=precedingModels.reverse().findIndex((precedingModel=>!precedingModel.get("_isLocked")));return precedingModels[nearestUnlockedIndex]?.get("_id")}navigateTo(location=this.location){const id=this.getLocationId(location);if(["",undefined,"current"].includes(id))return;const target=this.resolveLocking(id);if(!target)return;_.defer((async()=>{try{const isSinglePage=Adapt$1.contentObjects.models.length===1;await router$1.navigateToElement(target,{trigger:true,replace:isSinglePage,duration:400})}catch(err){logging$1.warn(`Bookmarking cannot navigate to id: ${target}\n`,err)}}));this.stopListening(Adapt$1,"bookmarking:cancel")}navigateCancel(){this.stopListening(Adapt$1,"bookmarking:continue")}resetLocationID(){this.setLocationID("")}setupMenu(menuView){const menuModel=menuView.model;if(!menuModel.get("_parentId")){this.resetLocationID();return}this.setLocationID(menuModel.get("_id"))}getBookmarkLevel(pageModel){const defaultLevel=this.config._level||"component";const bookmarkModel=pageModel.get("_bookmarking");const isInherit=!bookmarkModel||!bookmarkModel._level||bookmarkModel._level==="inherit";return isInherit?defaultLevel:bookmarkModel._level}setupPage(pageView){const pageBookmarkModel=pageView.model.get("_bookmarking");if(pageBookmarkModel?._isEnabled===false){this.resetLocationID();return}this.setLocationID(pageView.model.get("_id"));this.bookmarkLevel=this.getBookmarkLevel(pageView.model)}setLocationID(id){if(this.currentLocationID===id)return;offlineStorage$1.set("location",id);this.currentLocationID=id}checkLocation(){const contentObjectBookmarkModel=Adapt$1.parentView?.model?.get("_bookmarking");if(contentObjectBookmarkModel?._isEnabled===false){this.resetLocationID();return}const currentModel=location$1._currentModel;if(!currentModel||!this.bookmarkLevel)return;const possibleViewIds=currentModel.findDescendantModels(this.bookmarkLevel).filter((desc=>desc.get("_isTrackable")!==false)).map((desc=>desc.get("_id")));let highestOnscreen=0;let highestOnscreenLocation="";possibleViewIds.forEach((id=>{const element=$(`[data-adapt-id=${id}]`);if(!element.length)return;const measurements=element.onscreen();if(!measurements.onscreen)return;if(measurements.percentInview<=highestOnscreen)return;highestOnscreen=measurements.percentInview;highestOnscreenLocation=id}));if(highestOnscreenLocation)this.setLocationID(highestOnscreenLocation)}onChildViewAdded(view,childView){if(!this.bookmarkLevel||!childView.model.isTypeGroup(this.bookmarkLevel))return;childView.$el.on("inview",this._onInview)}onChildViewPreRemove(childView){if(!this.bookmarkLevel||!childView.model.isTypeGroup(this.bookmarkLevel))return;childView.$el.off("inview",this._onInview)}onInview(event,visible){if(!visible)return;this._debouncedCheckLocation()}}__AMD("extensions/adapt-contrib-bookmarking/js/adapt-contrib-bookmarking",new Bookmarking);class FontAwesomeIcons extends Backbone.Controller{initialize(){this.setupListeners()}setupListeners(){this.listenToOnce(Adapt$1,"configModel:dataLoaded",this.loadCDN)}loadCDN(){const styleSheet='<link rel="stylesheet" href="https://kit.fontawesome.com/4ed4a33a82.css" crossorigin="anonymous">';$("head").append(styleSheet);$("html").addClass("fontawesome")}}__AMD("extensions/adapt-contrib-fontawesomeIcons/js/adapt-contrib-fontawesomeIcons",new FontAwesomeIcons);var PluginsView=__AMD("extensions/adapt-contrib-interactiveVideo/js/plugins/pluginsView",class PluginsView extends Backbone__default["default"].View{initialize(){_.bindAll(this,"onPlay","onPause","onEnded");this.$el.css({left:this.model._left+"%",top:this.model._top+"%"});this.$parent=$("#"+this.model.interactiveVideoId);this.preRender();this.render()}preRender(){}render(){const template=Handlebars.templates[this.template];this.$el.html(template(this.model));this.$parent.append(this.$el);_.defer(_.bind(this.postRender,this))}postRender(){const externalMedia=this.model._interactiveVideo;this.$video=this.model.videoElement;const self=this;if(externalMedia&&externalMedia.source){this.$parent.on({"video:playing":self.onPlay,"video:paused":self.onPause,"video:ended":self.onEnded})}else{this.$video.on({play:self.onPlay,pause:self.onPause,ended:self.onEnded})}if(this.model.pauseVideo){this.$video.pause()}this.remaining=this.model.duration*1e3;this.resumeTimer()}onPlay(event){this.resumeTimer()}onPause(event){this.pauseTimer()}onEnded(event){this.$plugin.remove()}removePlugin(event){$(event.currentTarget).remove();this.$video.play()}pauseTimer(){window.clearTimeout(this.timerId);this.remaining-=new Date-this.start}resumeTimer(){this.start=new Date;window.clearTimeout(this.timerId);const callback=()=>{this.remove();Adapt$1.off({"video:playing":self.onPlay,"video:paused":self.onPause,"video:ended":self.onEnded})};this.timerId=_.delay(callback,this.remaining)}});var LabelView=__AMD("extensions/adapt-contrib-interactiveVideo/js/plugins/labelView",class LabelView extends PluginsView{events(){return{click:"removePlugin"}}className(){return"interactivevideo__label plugins"}get template(){return"interactiveVideoLabel"}});var ImageView=__AMD("extensions/adapt-contrib-interactiveVideo/js/plugins/imageView",class ImageView extends PluginsView{className(){const baseClassName="interactivevideo__image plugins";return this.model.display==="sticker"?baseClassName+" sticker":baseClassName}events(){return{"click .interactivevideo__image-icon":"toggleItem"}}get template(){return"interactiveVideoImage"}preRender(){this.toggleSpeed=100;this.listenTo(Adapt$1,"device:resize",this.resizeImage);this.model.showBody=this.model.display==="open"||this.model.display==="sticker";this.model.enableBody=this.model._graphic.large!==""||this.model._graphic.small!==""}postRender(){this.resizeImage();PluginsView.prototype.postRender.call(this)}resizeImage(){const imageWidth=device$1.screenSize==="medium"?"small":device$1.screenSize==="xlarge"?"large":device$1.screenSize;const imageSrc=this.model._graphic?this.model._graphic[imageWidth]:"";const img=this.$("img")[0];if(img.src!==imageSrc){img.src=imageSrc}const fullWidth=this.$parent.width();const offsetX=fullWidth*this.model._left/100;const maxWidth=fullWidth-offsetX;const userWidth=parseInt(this.model._imgWidth);const calculatedWidth=userWidth>maxWidth?maxWidth:this.model._imgWidth;this.$(".interactivevideo__image-inner").width(calculatedWidth);const fullHeight=this.$parent.height();const offsetY=fullHeight*this.model._top/100;const controlsOffset=this.model.pauseVideo?70:0;const maxHeight=fullHeight-offsetY-controlsOffset;img.style.maxHeight=maxHeight+"px"}toggleItem(event){event.preventDefault();const $toggleButton=$(event.currentTarget);const $imageItem=$toggleButton.parent(".interactivevideo__image");const isCurrentlyExpanded=$toggleButton.hasClass("is-selected");if(!isCurrentlyExpanded){this.openItem($imageItem)}else{this.closeItem($imageItem)}}closeItem($itemEl){if(!$itemEl){return false}const $body=$(".interactivevideo__image-body",$itemEl);const $button=$("button",$itemEl);const $icon=$(".interactivevideo__image-title-icon",$itemEl);$body.stop(true,true).slideUp(this.toggleSpeed);$button.removeClass("is-selected");$icon.addClass("icon-plus");$icon.removeClass("icon-minus")}openItem($itemEl){if(!$itemEl){return false}let $body=$(".interactivevideo__image-body",$itemEl);const $button=$("button",$itemEl);const $icon=$(".interactivevideo__image-title-icon",$itemEl);if($body.hasClass("u-display-none")){$body.removeClass("u-display-none")}$body=$body.stop(true,true).slideDown(this.toggleSpeed,(function(){a11y$1.focusFirst($body,{defer:true})}));$button.addClass("is-selected");$icon.removeClass("icon-plus");$icon.addClass("icon-minus")}});var ExternalPlayer=__AMD("extensions/adapt-contrib-interactiveVideo/js/plugins/externalPlayer",class ExternalPlayer{constructor(){_.extend(this,Backbone.Events)}initialize(){this.player=null;this.timer=0;this.playerType="";this.interactionsModel="";this.state="";this.canTriggerEvent=true;this.isPaused=true}init(iframe,pType,model){this.playerType=pType;this.interactionsModel=model;switch(pType){case"youtube":this.player=new YT.Player(iframe,{events:{onReady:this.onPlayerReady.bind(this),onStateChange:this.onPlayerStateChange.bind(this)}});break;case"vimeo":this.player=new Vimeo__default["default"](iframe);this.onPlayerReady();break}}onPlayerReady(event){switch(this.playerType){case"youtube":this.onLoadedData();break;case"vimeo":this.bindVimeoEvents();break}}onPlayerStateChange(event){switch(event.data){case YT.PlayerState.UNSTARTED:this.state="unstarted";break;case YT.PlayerState.PLAYING:this.state="playing";this.onPlay();this.timeUpdate();break;case YT.PlayerState.PAUSED:this.state="paused";this.onPause();break;case YT.PlayerState.ENDED:this.state="ended";this.onEnded();break;case YT.PlayerState.BUFFERING:this.state="buffering";break}}timeUpdate(){this.timer=setInterval((()=>{if(this.state==="playing"){this.onPlayProgress({seconds:this.player.getCurrentTime()})}else{this.stopTimeUpdate()}}),100)}stopTimeUpdate(){clearInterval(this.timer)}bindVimeoEvents(){this.player.on("play",(()=>this.onPlay()));this.player.on("loaded",(()=>this.onLoadedData()));this.player.on("pause",(()=>this.onPause()));this.player.on("ended",(()=>this.onEnded()));this.player.on("timeupdate",(data=>this.onPlayProgress(data)))}unbindVimeoEvents(){this.player.off("play",(()=>this.onPlay()));this.player.off("pause",(()=>this.onPause()));this.player.off("ended",(()=>this.onEnded()));this.player.off("loaded",(()=>this.onLoadedData()));this.player.off("timeupdate",(data=>this.onPlayProgress(data)))}onPlay(){this.isPaused=false;this.triggerEvent("play",true)}onPause(){this.isPaused=true;this.triggerEvent("pause",true)}onEnded(){this.isPaused=true;this.triggerEvent("ended",true)}onPlayProgress(data){this.triggerEvent("timeupdate",true,data.seconds)}onLoadedData(){this.triggerEvent("loadeddata")}triggerEvent(eventType,force,data){if(this.canTriggerEvent||force){this.trigger(eventType,{type:eventType},data)}}muteEvent(){this.canTriggerEvent=false;clearTimeout(this.muteTimeout);this.muteTimeout=setTimeout((()=>{this.canTriggerEvent=true}),1e3)}play(){switch(this.playerType){case"youtube":this.player.playVideo();break;case"vimeo":this.player.play();break}}pause(){switch(this.playerType){case"youtube":this.player.pauseVideo();break;case"vimeo":this.player.pause();break}}stop(){switch(this.playerType){case"youtube":this.player.stopVideo();break;case"vimeo":this.player.pause();break}}getDuration(cb){let duration=0;switch(this.playerType){case"youtube":duration=this.player.getDuration();break;case"vimeo":this.player.getDuration().then((videoDuration=>{duration=videoDuration})).catch((function(error){console.log(error)}));break}return duration}seekTo(time){switch(this.playerType){case"youtube":this.muteEvent();this.player.seekTo(time,true);break;case"vimeo":this.player.setCurrentTime(time);break}}getIframe(){return this.player.element||this.player.getIframe()||this.player.el_}remove(){switch(this.playerType){case"youtube":this.stopTimeUpdate();if(this.player){this.player.destroy()}break;case"vimeo":this.unbindVimeoEvents();break}}getPlayer(){return this.player}});var Bookmark=__AMD("extensions/adapt-contrib-interactiveVideo/js/plugins/bookmark",class BookmarkView extends Backbone__default["default"].View{className(){return"interactivevideo__bookmark plugins"}get template(){return"interactiveVideoBookmark"}initialize(){this.preRender()}events(){return{"click .interactivevideo__bookmark-item":"onItemClick","click .toggle-btn":"onBookmarkToggle"}}preRender(){if(this.model.bookmark.display==="collapsed"){this.model.bookmark.isCollapsed=true}this.model.videoElement.on({play:_.bind(this.showBookmark,this),ended:_.bind(this.hideBookmark,this)});this.render()}onItemClick(event){const currentIndex=$(event.currentTarget);const currentTime=this.model.bookmark._items[currentIndex.index()].updatedTime;if(!currentIndex.hasClass("visited")){currentIndex.addClass("visited")}if(this.model.videoElement[0]){this.model.videoElement[0].currentTime=currentTime}else{this.model.videoElement.seekTo(currentTime,true)}}onBookmarkToggle(event){const $ele=this.$(event.currentTarget);const $itemContainer=$ele.siblings().eq(0);$itemContainer.slideToggle("fast",(()=>{if($itemContainer.is(":hidden")){$ele.find(".toggle-btn-icon").removeClass("icon-minus").addClass("icon-bookmark")}else{$ele.find(".toggle-btn-icon").removeClass("icon-bookmark").addClass("icon-minus")}a11y$1.focusFirst($itemContainer,{defer:true})}))}hideBookmark(){this.$el.hide()}showBookmark(){if(this.$el.is(":hidden")){this.$el.show()}}setBookmarkPosition(){const parentElement=$("#"+this.model.interactiveVideoId);const parentHeight=parentElement.height();const heightPXRatio=parentHeight/100;const positionTop=this.model.bookmark._position.top||0;const positionLeft=this.model.bookmark._position.left||0;if(positionTop>=60){this.$el.css({bottom:100-positionTop+"%"})}else{this.$el.css({top:positionTop+"%"})}if(positionLeft>=60){this.$el.css({right:100-positionLeft+"%"})}else{this.$el.css({left:positionLeft+"%"})}if(this.model.bookmark._position.left*heightPXRatio>parentHeight/2){this.$(".interactivevideo__bookmark-inner").css("left","-"+this.$(".interactivevideo__bookmark-inner").width()+"px")}if(positionTop*heightPXRatio>parentHeight/2){this.$(".interactivevideo__bookmark-inner").css("bottom",this.$(".toggle-btn").height())}}render(){const template=Handlebars.templates[this.template];this.$el.append(template(this.model));_.defer((()=>{this.setBookmarkPosition()}));return this}});var BrightcoveVideoView$2=__AMD("extensions/adapt-contrib-interactiveVideo/js/plugins/BrightcoveVideoView",class BrightcoveVideoView extends Backbone.View{preinitialize(){this.template="brightcoveVideo";this.className="brightcoveplayer__widget preload"}events(){return{"click div.brightcoveplayer__widget-social-sharing a":"handleSocialLinks"}}getSocialSharingConfig(){const whatsappSubdomain="api";const isMobile=_.contains(["ios","android"],device$1.OS);const isSpecialBrowser=_.contains(["firefox","safari"],device$1.browser);if(!isMobile&&isSpecialBrowser){whatsappSubdomain="web"}return{Facebook:{title:"Facebook",href:"https://www.facebook.com/share.php?u={{shareUrl}}",icon:"facebook"},Google:{title:"Google+",href:"https://plus.google.com/share?url={{shareUrl}}",icon:"google-plus"},LinkedIn:{title:"LinkedIn",href:"https://www.linkedin.com/shareArticle?mini=true&url={{shareUrl}}",icon:"linkedin"},Pinterest:{title:"Pinterest",href:"https://pinterest.com/pin/create/button/?url={{shareUrl}}&description={{shareText}}",icon:"pintrest"},Twitter:{title:"Twitter",href:"https://twitter.com/intent/tweet?url={{shareUrl}}",icon:"twitter"},WhatsApp:{title:"WhatsApp",href:"https://"+whatsappSubdomain+".whatsapp.com/send?text={{shareText}}%20-%20{{shareUrl}}",icon:"whatsapp"}}}initialize(){this.model.brightcoveSource=this.getBrightcoveSource();this.model._downloadOption=DOWNLOAD_OPTION$1(this.model._downloadOption)||"disabled";this.setupSocialSharingLinks();if(!this.model._brightcovePlayer.canPlayLocal){this.render()}else{this.setupLocalFile()}}setupSocialSharingLinks(){const hasSocialSharing=this.model._socialSharing&&this.model._socialSharing.length>0;this.model.hasSocialSharing=hasSocialSharing||this.model._canCopyLinkToVideo;if(!hasSocialSharing){return}const socialSharingConfig=this.getSocialSharingConfig();this.model.socials=this.model._socialSharing.map((function(socialIdentifier){const social=socialSharingConfig[socialIdentifier];if(!social){return null}social.href=social.href.replace("{{shareUrl}}",encodeURIComponent(this.model.brightcoveSource));social.href=social.href.replace("{{shareText}}",this.model.title);return social}),this)}setupLocalFile(){const self=this;const localSource="course/assets/"+this.model._brightcovePlayer.videoId+".mp4";$.ajax({type:"HEAD",url:localSource}).done((function(){self.model.localVideoSource=localSource;self.render()})).fail((function(){self.model._brightcovePlayer.canPlayLocal=false;self.render()}))}render(){const template=Handlebars.templates[this.template];this.$el.html(template(this.model));const width=this.model.width||this.model._brightcovePlayer.width;if(width){this.$el.width(width)}_.defer(this.initialiseHeight.bind(this));if(!this.canPlayLocal){this.loadBrightcovePlayer()}}initialiseHeight(){const aspectRatio=this.model._brightcovePlayer.aspectRatio||"16:9";const ratios=aspectRatio.split(":").map((function(str){return parseInt(str)}));const $widgetInner=this.$(".brightcoveplayer__widget-inner");const h=$widgetInner.width()/ratios[0]*ratios[1];$widgetInner.height(h)}loadBrightcovePlayer(){this.$iframe=this.$("iframe");this.iframe=this.$iframe[0];this.checkIfPresentInDocument()}checkIfPresentInDocument(){if(this.iframe.contentDocument){this.loadIframeContent()}else{const pollInterval=200;return setTimeout(this.checkIfPresentInDocument.bind(this),pollInterval)}}loadIframeContent(){const template=Handlebars.templates.brightcoveDocument;const html=template(this.model);this.iframe.contentDocument.write(html);$(this.iframe.contentWindow).one("message",(e=>{if(e.originalEvent.data==="playerReady"){this.onPlayerLoaded(this.iframe.contentWindow.__brightcoveplayer)}}))}onPlayerLoaded(player){this.player=player;this.videoElement=this.$$("video")[0];this.setupEventListeners();this.setupDownloadButton();this.onDeviceResize();this.player.on("canplay",this.onDeviceResize.bind(this));_.defer((()=>{this.$el.removeClass("preload");this.trigger("playerReady",player)}))}setupEventListeners(){this.listenTo(Adapt$1,{"device:resize":this.onDeviceResize,remove:this.onRemove})}setupDownloadButton(){const buttonModel={downloadOption:this.model._downloadOption,label:this.model.globals.download,player:this.player,el:this.$$(".brightcoveplayer__download-btn")[0],onDownloadComplete:this.triggerMediaEvent.bind(this,"download")};new BrightcoveDownloadButtonView$2({model:buttonModel})}handleSocialLinks(event){event&&event.preventDefault();const $target=$(event.currentTarget);if($target.attr("target")==="_blank"){window.open($target.attr("href"),"_blank","width=600,height=600");this.triggerMediaEvent("share",{shareType:$target.attr("title")})}else{this.handleCopyLink()}}handleCopyLink(){const $copyText=$(".brightcoveplayer__widget-copy-link-textbox");const $viewLinkButton=$(".brightcoveplayer__widget-view-link-btn");const $copyLinkButton=$(".brightcoveplayer__widget-copy-link-btn");if($copyText.hasClass("u-display-none")){$copyText.removeClass("u-display-none").removeAttr("readonly").removeAttr("disabled").focus().select();$viewLinkButton.addClass("u-display-none");$copyLinkButton.removeClass("u-display-none");return}try{if(device$1.OS==="ios"){const range=document.createRange();range.selectNodeContents($copyText[0]);const selection=window.getSelection();selection.removeAllRanges();selection.addRange(range);$copyText[0].setSelectionRange(0,999999)}else{$copyText.focus().select()}const hasCopied=document.execCommand("copy");if(hasCopied){this.triggerMediaEvent("share",{shareType:"copy"});notify$1.push({body:this.model.globals.linkCopied,_classes:"link-copied-notification",_timeout:2e3})}else{logging$1.warn("Unable to copy Brightcove URL to clipboard")}}catch(e){logging$1.warn("Unable to copy Brightcove URL to clipboard")}_.defer((()=>{$copyText.addClass("u-display-none").attr("readonly","readonly").attr("disabled","true");$viewLinkButton.removeClass("u-display-none");$copyLinkButton.addClass("u-display-none")}))}onDeviceResize(){const $video=$(this.videoElement);const $widgetInner=this.$(".brightcoveplayer__widget-inner");$video.css({maxHeight:"none"});_.delay((()=>{const videoHeight=$video.height()||$widgetInner.height();const maxHeight=$(window).outerHeight()-this.$(".brightcoveplayer__footer").height();const height=videoHeight>maxHeight?maxHeight:videoHeight;$widgetInner.height(height);this.iframe.contentDocument.body.className=this.getIframeBodyClassName();$video.css({maxHeight:"100%"})}),500)}onRemove(){if(this.player){this.player.dispose()}this.remove()}validateTimeString(timeAsString){return new RegExp(/(\d{1,2}[h])?[0-5]?[0-9][m][0-5]?[0-9][s]/g).test(timeAsString)}getBrightcoveSource(){const playerConfig=this.model._brightcovePlayer;let url=["https://players.brightcove.net",playerConfig.account,playerConfig.player+"_default","index.html?videoId="+playerConfig.videoId].join("/");if(this.validateTimeString(playerConfig.startTime)){url+="#t="+playerConfig.startTime}return url}getIframeBodyClassName(){let className=device$1.screenSize==="large"?"size-large":"size-small";if(this.model._downloadOption){className+=" download-"+this.model._downloadOption.asLowerCase}return className}$$(selector){return this.$iframe.contents().find(selector)}triggerMediaEvent(eventType,data){Adapt$1.trigger("media",{isVideo:true,type:eventType,src:this.getBrightcoveSource(),platform:"brightcove",data:data||{}})}});class BrightcoveDownloadButtonView$2 extends Backbone.View{el(){return this.model.el}events(){return{click:"handleClick"}}initialize(){this.isDownloadInProgress=false;this.model.downloadOption=device$1.OS==="ios"?"disabled":this.model.downloadOption;switch(this.model.downloadOption){case DOWNLOAD_OPTION$1.OVERLAY:this.model.player.el_.appendChild(this.el);break;case DOWNLOAD_OPTION$1.TOOLBAR:const toolbar=this.model.player.controlBar.el_;const spacer=this.model.player.el_.querySelector(".vjs-custom-control-spacer");toolbar.insertBefore(this.el,spacer.nextSibling);break;default:return this.remove()}this.postRender()}postRender(){this.$progressLeft=this.$(".brightcoveplayer__download-progress-left-indicator");this.$progressRight=this.$(".brightcoveplayer__download-progress-right-indicator")}handleClick(){if(this.isDownloadInProgress){return}this.isDownloadInProgress=true;this.$progressRight.css({transform:"rotate(180deg)"});this.$el.addClass("downloading");const src=this.getHighestQualityVideo();this.downloadVideo(src)}getHighestQualityVideo(){const sources=this.model.player.mediainfo.sources;return sources.reduce(((highestQuality,source)=>source.container==="MP4"&&!!source.src&&source.size>highestQuality.size?source:highestQuality),{size:0}).src}getVideoName(){return this.model.player.mediainfo.name.replace(/\s/g,"_")}downloadVideo(src){const xhr=new XMLHttpRequest;xhr.open("GET",src+"?"+Date.now(),true);xhr.responseType="blob";xhr.onload=this.onDownloadComplete.bind(this,xhr);xhr.onprogress=this.handleProgress.bind(this);xhr.send()}handleProgress(e){const percentageComplete=e.loaded/e.total*100;const degrees=360/100*percentageComplete;if(percentageComplete<=50){this.$progressLeft.hide();this.$progressRight.css({transform:"rotate("+(degrees-180)+"deg)"})}else{this.$progressLeft.show();this.$progressLeft.css({transform:"rotate("+degrees+"deg)"});this.$progressRight.css({transform:"rotate(0deg)"})}}onDownloadComplete(xhr){const name=this.getVideoName();download__default["default"](xhr.response,name,"video/mp4");this.isDownloadInProgress=false;this.$el.removeClass("downloading");this.$progressLeft.hide();this.model.onDownloadComplete&&this.model.onDownloadComplete()}}var DOWNLOAD_OPTION$1=ENUM(["OVERLAY","TOOLBAR"],(value=>typeof value==="string"?value.toUpperCase():value));class InteractiveVideoView extends Backbone__default["default"].View{className(){return"extension-interactivevideo"}events(){return{"click .video-fullscreen-mask":"showFullscreenNotification"}}get template(){return"interactiveVideo"}initialize(options){_.mixin({inArray(value,array){if(array instanceof Array){return array.indexOf(value)>-1?array.indexOf(value):false}else{return false}}});this.articleView=options.articleView;this.interactions=this.model.get("_interactiveVideo").interactions;this.interactiveBlocks=this.model.findDescendantModels("block");this.timeLabelShowTime=null;this.timeImageShowTime=null;this.listenTo(Adapt$1,"remove",this.remove);this.listenTo(this.model.getChildren(),"change:_isComplete",this.onBlockCompletion);this.listenTo(Adapt$1,"tutor:closed",this.tutorClosed);this.preRender();this.render()}preRender(){const blockArray=[];const interactiveVideoModel=this.model.get("_interactiveVideo");const labelArray=interactiveVideoModel.interactions.label;const imageArray=interactiveVideoModel.interactions.image;const bookmarkArray=interactiveVideoModel.interactions.bookmark._items;interactiveVideoModel._interactiveVideoId=this.model.get("_id")+"-interactiveVideo";if(labelArray!==undefined){this.labelTime=this.extractTimeInSeconds(labelArray)}if(imageArray!==undefined){this.imageTime=this.extractTimeInSeconds(imageArray)}if(bookmarkArray!==undefined){this.bookmarkTime=this.extractTimeInSeconds(bookmarkArray)}this.interactiveBlocks.forEach((block=>{const props=block.get("_interactiveVideo");if(props&&props._isEnabled===true&&!_.isEmpty(props.time)){blockArray.push(block.get("_interactiveVideo"))}}));if(blockArray!==undefined){this.blockTime=this.extractTimeInSeconds(blockArray)}this.previousLabel=this.previousImage=this.previousBlock="";this.setupSource()}render(){const data=_.extend({},this.model.toJSON()._interactiveVideo,{globals:Adapt$1.course.get("_globals")._extensions._interactiveVideo});const template=Handlebars.templates[this.template];this.$el.append(template(data));_.defer(_.bind(this.postRender,this))}remove(){$(document).off("webkitfullscreenchange mozfullscreenchange fullscreenchange MSFullscreenChange",this.onFullscreenChange);this.$video&&this.$video.remove();_.defer(Backbone__default["default"].View.prototype.remove.bind(this))}postRender(){const interactiveVideoId=this.model.get("_interactiveVideo")._interactiveVideoId;const externalMedia=this.model.get("_interactiveVideo")._media.external;const self=this;if(externalMedia._isBrightcove){this.renderBrightcove(externalMedia)}else if(externalMedia.source){this.$("#iframePlayer-"+interactiveVideoId).on("load",(function(){self.onIframeAPIReady(this,externalMedia.type)}))}else{this.setupVideoElement(this.$("video"))}$(document).on("webkitfullscreenchange mozfullscreenchange fullscreenchange MSFullscreenChange",_.bind(this.onFullscreenChange,this));this.setListenerOnBlock()}renderBrightcove(externalMedia){const model=_.extend({},externalMedia._brightcove,{globals:Adapt$1.course.get("_globals")._extensions._interactiveVideo,_cc:this.getSubtitles()});const view=new BrightcoveVideoView$2({model:model});externalMedia.brightcoveSource=view.getBrightcoveSource();this.$(".video-container").append(view.$el);this.listenToOnce(view,"playerReady",(()=>{view.$$(".vjs-fullscreen-control").attr("disabled","true").css({opacity:.3});this.setupVideoElement($(view.videoElement))}))}setupVideoElement($video){if($video instanceof $){this.setupJqueryVideoElement($video)}this.$video=$video;this.$video.on({play:this.onPlay.bind(this),pause:this.onPause.bind(this),ended:this.onEnded.bind(this),timeupdate:this.onTimeUpdate.bind(this)});if(this.interactions.bookmark._isEnabled&&this.interactions.bookmark._items.length>0){this.interactions.videoElement=this.$video;this.onVideoReady()}}setupJqueryVideoElement($video){const videoElement=$video[0];_.extend($video,{play:videoElement.play.bind(videoElement),pause:videoElement.pause.bind(videoElement)})}setListenerOnBlock(){this.interactiveBlocks.forEach(((block,index)=>{this.listenTo(block,"change:_isComplete",this.setBlockVisitStatus)}))}setupSource(){const interactiveVideo=this.model.get("_interactiveVideo");const externalMedia=interactiveVideo._media.external;if(this.hasExternalMedia(externalMedia)){externalMedia.isActive=true;this.setExternalVideoSource(externalMedia)}else{this.setInternalSource(interactiveVideo._media.internal)}}getSubtitles(){const interactiveVideo=this.model.get("_interactiveVideo");const cc=interactiveVideo._media._cc||[];return interactiveVideo._useClosedCaptions?cc:[]}hasExternalMedia(externalMediaConfig){if(externalMediaConfig.source){return true}try{const bcConfig=externalMediaConfig._brightcove._brightcovePlayer;return!!bcConfig.videoId&&!!bcConfig.account&&!!bcConfig.player&&externalMediaConfig.type==="brightcove"}catch(e){return false}}setInternalSource(internalMedia){if(internalMedia.type===""&&internalMedia.source!==""){internalMedia.type=internalMedia.source.split(".").pop()}if(internalMedia.type.toLowerCase()==="ogv"){internalMedia.type="ogg"}const validTypes=["mp4","webm","ogg"];if(validTypes.indexOf(internalMedia.type)===-1){internalMedia.type="mp4"}}setExternalVideoSource(externalMedia){this.$el.addClass(externalMedia.type);let queryString="";const interactiveVideoId=this.model.get("_interactiveVideo")._interactiveVideoId;switch(externalMedia.type){case"youtube":queryString="?enablejsapi=1&fs=0&playsinline=1&"+window.location.origin;if(externalMedia.source.indexOf("https://youtu.be")===0){externalMedia.source=externalMedia.source.replace("https://youtu.be","https://www.youtube.com/embed")}if(externalMedia.source.indexOf("?")===-1){externalMedia.source=externalMedia.source+queryString}break;case"vimeo":queryString="?playsinline=1&player_id=iframePlayer-"+interactiveVideoId;if(externalMedia.source.indexOf("?")===-1){externalMedia.source=externalMedia.source+queryString}break;case"brightcove":_.extend(externalMedia,{_isBrightcove:true,source:null});break}}onIframeAPIReady(iframe,playerType,src){const model=this.model.get("_interactiveVideo");const $video=new ExternalPlayer;$video.init(iframe,playerType,model);this.setupVideoElement($video)}setUpBookmarkModel(){const interactiveVideoId=this.model.get("_interactiveVideo")._interactiveVideoId;const bookmarkModel=this.interactions.bookmark._items;bookmarkModel.forEach(((item,index)=>{item.updatedTime=this.bookmarkTime[index]}));this.interactions.interactiveVideoId=interactiveVideoId;this.$el.find(".video-container").append(new Bookmark({model:this.interactions}).$el)}onVideoReady(){if(this.isBookmarkSet)return;this.isBookmarkSet=true;this.setUpBookmarkModel()}extractTimeInSeconds(pluginArray){const pluginTime=_.pluck(pluginArray,"time");const pluginTimeArray=[];pluginTime.forEach((time=>{let seconds=0;if(time.indexOf("h")>-1){const hour=time.split("h")[0];time=time.split("h")[1];seconds+=parseInt(hour)*60}if(time.indexOf("m")>-1){const min=time.split("m")[0];time=time.split("m")[1];seconds+=parseInt(min)*60}if(time.indexOf("s")>-1){const sec=time.split("s")[0];seconds+=parseInt(sec)}pluginTimeArray.push(seconds)}));return pluginTimeArray}tutorClosed(){a11y$1.focus(this.currentDisplayedBlock.children(".component__close-button"),{defer:true})}notifyClosed(){this.enableVideo();this.stopListening(Adapt$1,"notify:cancelled",this.notifyClosed)}onBlockCompletion(){this.addCloseButton()}enableVideo(){this.$video.play();this.$(".overlay").addClass("u-display-none")}disableVideo(){this.$video.pause();this.$(".overlay").removeClass("u-display-none")}addCloseButton(){const $button=$("<button/>");$button.append('<i class="icon icon-cross">');$button.addClass("component__close-button");const ariaLabelClose=Adapt$1.course.get("_globals")._accessibility._ariaLabels.closePopup;$button.attr({"aria-label":ariaLabelClose});$button.on("click",_.bind(this.onCloseComponentClick,this));$button.on("keydown",_.bind(this.onCloseComponentKeyDown,this));this.currentDisplayedBlock.append($button)}onCloseComponentKeyDown(event){if(event.type!=="keydown")return;if(["Enter","Escape"].indexOf(event.originalEvent?.key)<0)return;this.onCloseComponentClick()}onCloseComponentClick(){this.currentDisplayedBlock.addClass("u-display-none");this.enableVideo();const $videoContainer=this.$(".video-container");a11y$1.toggleAccessibleEnabled($videoContainer,true);_.defer((()=>{a11y$1.popupClosed($videoContainer)}))}onPlay(event){this.queueMediaEvent(event.type)}onPause(event){this.queueMediaEvent(event.type)}onFullscreenChange(event){if(this.isFullscreen()&&this.shouldPreventFullscreen()){this.cancelFullscreen()}}showFullscreenNotification(){const globals=Adapt$1.course.get("_globals")._extensions||{};const globalText=globals._interactiveVideo&&globals._interactiveVideo.fullscreenDisabled;const defaultText="Fullscreen is not enabled for this exension";const notifyObj={body:globalText||defaultText};Adapt$1.trigger("notify:push",notifyObj)}isFullscreen(){return document.fullscreenElement||document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement}shouldPreventFullscreen(){const fullscreenElement=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;return this.$el.find(fullscreenElement).length>0}cancelFullscreen(){const cancelMethod=document.exitFullscreen||document.webkitExitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen;cancelMethod&&cancelMethod.call(document)}onTimeUpdate(event,seconds){let currentTime=event.currentTarget?event.currentTarget.currentTime:event;if(isNaN(currentTime)){currentTime=seconds}const currentTimeFloor=Math.floor(currentTime);if(this.interactions.label.length>0&&currentTimeFloor!==this.timeLabelShowTime){this.createLabel(currentTimeFloor);this.timeLabelShowTime=currentTimeFloor}if(this.interactions.image.length>0&&currentTimeFloor!==this.timeImageShowTime){this.createImage(currentTimeFloor);this.timeImageShowTime=currentTimeFloor}if(this.interactiveBlocks.length>0){this.displayBlock(currentTimeFloor);if(!this.currentDisplayedBlock||this.currentDisplayedBlock.hasClass("u-display-none")||this.$el.find(".video-container").is("[tabindex]"))return;const $blockContainer=this.$el.find(".block__container");a11y$1.popupOpened($blockContainer);a11y$1.focusFirst($blockContainer)}}onEnded(event){this.queueMediaEvent(event.type)}createLabel(currentTimeFloor){const labelArray=this.interactions.label;const index=_.inArray(currentTimeFloor,this.labelTime);const currentInteraction=labelArray[index];if(currentInteraction!==undefined&&this.labelTime[index]===currentTimeFloor){const interactiveVideoId=this.model.get("_interactiveVideo")._interactiveVideoId;currentInteraction.interactiveVideoId=interactiveVideoId;currentInteraction._interactiveVideo=this.model.get("_interactiveVideo")._media.external;currentInteraction.videoElement=this.$video;new LabelView({model:currentInteraction});this.previousLabel=currentInteraction}else{if(this.previousLabel!==undefined){this.previousLabel=""}}}createImage(currentTimeFloor){const imageArray=this.interactions.image;const index=_.inArray(currentTimeFloor,this.imageTime);const currentInteraction=imageArray[index];if(currentInteraction!==undefined&&this.imageTime[index]===currentTimeFloor){const interactiveVideoId=this.model.get("_interactiveVideo")._interactiveVideoId;currentInteraction.interactiveVideoId=interactiveVideoId;currentInteraction._interactiveVideo=this.model.get("_interactiveVideo")._media.external;currentInteraction.videoElement=this.$video;new ImageView({model:currentInteraction});this.previousImage=currentInteraction}else{if(this.previousImage!==undefined){this.previousImage=""}}}displayBlock(currentTimeFloor){const index=_.inArray(currentTimeFloor,this.blockTime);const currentInteraction=this.interactiveBlocks[index];if(this.blockTime[index]===currentTimeFloor){if(this.previousBlock===""){this.disableVideo();this.currentDisplayedBlock=this.articleView.$(".block."+currentInteraction.get("_id"));this.currentDisplayedBlock.removeClass("component-hide u-no-select u-display-none");_.defer((()=>{Adapt$1.trigger("device:resize");a11y$1.focusFirst(this.currentDisplayedBlock);if(currentInteraction.get("_isComplete")){this.addCloseButton()}}));this.previousBlock=currentInteraction}}else{this.previousBlock=""}}setBlockVisitStatus(block){if(block.get("_interactiveVideo").displayBlock){block.set("_isVisited",false);return}block.set("_isVisited",true)}queueMediaEvent(eventType){const t=Date.now();const lastEvent=this.lastEvent||{time:0};const timeSinceLastEvent=t-lastEvent.time;const debounceTime=500;this.lastEvent={time:t,type:eventType};clearTimeout(this.eventTimeout);if(eventType==="ended"){return this.triggerMediaEvent(eventType)}if(timeSinceLastEvent>debounceTime){this.eventTimeout=setTimeout(this.triggerMediaEvent.bind(this,eventType),debounceTime)}}triggerMediaEvent(eventType){Adapt$1.trigger("media",_.extend({isVideo:true,type:eventType},this.getVideoConfig()))}getVideoConfig(){const externalMedia=this.model.get("_interactiveVideo")._media.external;if(externalMedia.isActive){return{platform:externalMedia.type,src:externalMedia.type==="brightcove"?externalMedia.brightcoveSource:externalMedia.source}}else{return{platform:"native",src:this.$video[0].currentSrc}}}}const articles=[];const onArticleViewPreRender=article=>{if(!article.model.get("_interactiveVideo")?._isEnabled)return;const id=article.model.get("_id");if(!_.contains(articles,id)){articles.push(id)}};const onArticleViewPostRender=article=>{if(!article.model.get("_interactiveVideo")?._isEnabled)return;const $articleInner=article.$el.find(".article__inner");$articleInner.append(new InteractiveVideoView({model:article.model,articleView:article}).$el);const $blockContainer=$articleInner.find(".block__container");article.$el.addClass("interactivevideo");$(article.$el.find(".extension-interactivevideo")).append($blockContainer)};const onBlockViewPostRender=block=>{if(!_.contains(articles,block.model.get("_parentId")))return;const components=block.model.getChildren();if(components.length===1&&components.models[0].get("_layout")==="left"){block.$el.addClass("left-component__close")}block.$el.addClass("component-hide u-no-select").css({"background-color":"transparent"})};const onDataReady=()=>{if(!Adapt$1.course.get("_interactiveVideo")?._isEnabled)return;Adapt$1.on({"articleView:preRender":onArticleViewPreRender,"articleView:postRender":onArticleViewPostRender,"blockView:postRender":onBlockViewPostRender})};Adapt$1.once("app:dataReady",onDataReady);var NavigationView=__AMD("extensions/adapt-contrib-languagePicker/js/languagePickerNavigationView",class NavigationView extends Backbone.View{className(){return"nav"}attributes(){return{role:"navigation"}}initialize(){this.template="languagePickerNavigation";this.setupHelpers();this.preRender()}preRender(){Adapt$1.trigger("navigationView:preRender",this);this.render()}render(){const template=Handlebars.templates[this.template];this.$el.html(template({_config:this.model.get("_accessibility"),_accessibility:Adapt$1.config.get("_accessibility")})).insertBefore("#app");_.defer((()=>Adapt$1.trigger("navigationView:postRender",this)));return this}setupHelpers(){Handlebars.registerHelper("a11y_aria_label",(text=>`<div class="aria-label">${text}</div>`))}});var LanguagePickerView=__AMD("extensions/adapt-contrib-languagePicker/js/languagePickerView",class LanguagePickerView extends Backbone.View{get template(){return"languagePickerView"}events(){return{"click .js-languagepicker-btn-click":"onLanguageClick"}}className(){return"languagepicker"}initialize(){this.initializeNavigation();$("html").addClass("in-languagepicker");this.listenTo(Adapt$1,"remove",this.remove);this.render()}render(){const data=this.model.toJSON();const template=Handlebars.templates[this.template];this.$el.html(template(data));this.$el.addClass(data._classes);document.title=this.model.get("title")||"";_.defer(this.postRender.bind(this))}postRender(){router$1.hideLoading()}onLanguageClick(event){this.destroyNavigation();const lang=event.currentTarget.value;this.model.setLanguage(lang)}initializeNavigation(){this.navigationView=new NavigationView({model:this.model})}destroyNavigation(){this.navigationView.remove()}remove(){$("html").removeClass("in-languagepicker");super.remove()}});var LanguagePickerDrawerView=__AMD("extensions/adapt-contrib-languagePicker/js/languagePickerDrawerView",class LanguagePickerDrawerView extends Backbone.View{get template(){return"languagePickerDrawerView"}events(){return{"click .js-languagepicker-item-btn":"onButtonClick"}}initialize(){this.listenTo(Adapt$1,"remove",this.remove);this.render()}render(){const data=this.model.toJSON();const template=Handlebars.templates[this.template];this.$el.html(template(data))}onButtonClick(event){const newLanguage=this.$(event.currentTarget).attr("data-language");this.model.set("newLanguage",newLanguage);this.promptObject=this.getPromptObject(newLanguage);this.listenToOnce(Adapt$1,"drawer:closed",this.onDrawerClosed);Adapt$1.trigger("drawer:closeDrawer")}onDrawerClosed(){_.delay((()=>{this.listenToOnce(Adapt$1,{"popup:opened":this.onPopupOpened,"languagepicker:changelanguage:yes":this.onDoChangeLanguage,"languagepicker:changelanguage:no":this.onDontChangeLanguage});notify$1.prompt(this.promptObject)}),250)}onPopupOpened(){this.$finishFocus=a11y$1.setPopupCloseTo($("#a11y-focuser"))}onDoChangeLanguage(){const newLanguage=this.model.get("newLanguage");this.model.setTrackedData();this.model.setLanguage(newLanguage);this.remove()}onDontChangeLanguage(){this.remove();_.delay((()=>a11y$1.focusFirst(this.$finishFocus)),500)}getPromptObject(newLanguage){const data=this.model.getLanguageDetails(newLanguage);return{_attributes:{lang:newLanguage},_classes:`is-lang-${newLanguage} ${data._direction==="rtl"?"is-rtl":"is-ltr"}`,title:data.warningTitle,body:data.warningMessage,_prompts:[{promptText:data._buttons.yes,_callbackEvent:"languagepicker:changelanguage:yes"},{promptText:data._buttons.no,_callbackEvent:"languagepicker:changelanguage:no"}],_showIcon:true}}});var LanguagePickerNavigationButton=__AMD("extensions/adapt-contrib-languagePicker/js/languagePickerNavigationButton",class LanguagePickerNavigationButton extends NavigationButtonView{attributes(){return{...super.attributes(),"data-tooltip-id":this.model.get("_id"),"aria-haspopup":"dialog"}}events(){return{click:"onClick"}}initialize(options){super.initialize(options);this.drawerModel=options.drawerModel;this.setupEventListeners();tooltips$1.register({_id:this.model.get("_id"),...this.model.get("_navTooltip")})}setupEventListeners(){this.listenTo(Adapt$1,{remove:this.remove})}static get template(){return"languagePickerNavigationButton.jsx"}onClick(event){drawer.openCustomView(new LanguagePickerDrawerView({model:this.drawerModel}).$el,false,this.model.get("_drawerPosition"))}});var LanguagePickerModel=__AMD("extensions/adapt-contrib-languagePicker/js/languagePickerModel",class LanguagePickerModel extends Backbone.Model{preinitialize(){this.trackedData={components:[],blocks:[]};this.locationId=null}defaults(){return{_isEnabled:false,displayTitle:"",body:"",_languages:[]}}initialize(){this.listenTo(Adapt$1.config,"change:_activeLanguage",this.markLanguageAsSelected);this.listenTo(Adapt$1,"app:dataLoaded",this.onDataLoaded)}getLanguageDetails(language){return this.get("_languages").find((({_language:_language})=>_language===language))}setLanguage(language,{canReset:canReset=true}={}){this.locationId=offlineStorage$1.get("location")||null;Adapt$1.config.set({_activeLanguage:language,_defaultDirection:this.getLanguageDetails(language)._direction});if(canReset)this.checkResetOnLanguageChange()}checkResetOnLanguageChange(){const shouldReset=!this.get("_restoreStateOnLanguageChange");const hasOfflineStorageClear=Boolean(offlineStorage$1.clear);if(!shouldReset||!hasOfflineStorageClear)return;offlineStorage$1.clear();this.locationId=null}markLanguageAsSelected(model,language){this.get("_languages").forEach((item=>{item._isSelected=item._language===language}))}onDataLoaded(){const shouldReset=!this.get("_restoreStateOnLanguageChange");const hasOfflineStorageClear=Boolean(offlineStorage$1.clear);if(hasOfflineStorageClear||shouldReset)return;_.defer((()=>{this.locationId=offlineStorage$1.get("location")||null;this.restoreState()}))}restoreLocation(){if(!data$1.findById(this.locationId))return;_.defer((()=>router$1.navigateToElement("."+this.locationId)))}restoreState(){if(this.isTrackedDataEmpty())return;this.trackedData.components?.forEach(this.setTrackableState);this.trackedData.blocks?.forEach(this.setTrackableState)}isTrackedDataEmpty(){return _.isEqual(this.trackedData,{components:[],blocks:[]})}getTrackableState(){return{components:this.getState(Adapt$1.components.models).filter(Boolean),blocks:this.getState(Adapt$1.blocks.models).filter(Boolean)}}getState(models){return models.map((model=>model.get("_isComplete")&&model.getTrackableState()))}setTrackedData(){if(!this.get("_restoreStateOnLanguageChange")){return}this.listenToOnce(Adapt$1,"contentObjectView:ready",this.restoreLocation);this.trackedData=this.getTrackableState()}setTrackableState(stateObject){const restoreModel=data$1.findById(stateObject._id);if(!restoreModel){logging$1.warn("LanguagePicker unable to restore state for: "+stateObject._id);return}restoreModel.setTrackableState(stateObject)}});class LanguagePicker extends Backbone.Controller{initialize(){this.listenTo(Adapt$1,"configModel:dataLoaded",this.onConfigLoaded)}onConfigLoaded(){const config=Adapt$1.config.get("_languagePicker");if(!config?._isEnabled)return;this.languagePickerModel=new LanguagePickerModel(config);this.listenTo(Adapt$1,"router:menu router:page",this.setupNavigationView);const params=new URLSearchParams(window.location.search);const paramLang=params.get("lang");if(paramLang&&Adapt$1.build.get("availableLanguageNames").includes(paramLang))return;Adapt$1.config.set("_canLoadData",false);if(offlineStorage$1.ready){this.onOfflineStorageReady();return}this.listenToOnce(Adapt$1,"offlineStorage:ready",this.onOfflineStorageReady)}async onOfflineStorageReady(){await Adapt$1.wait.queue();const storedLanguage=offlineStorage$1.get("lang");if(storedLanguage){this.languagePickerModel.setLanguage(storedLanguage,{canReset:false});return}if(this.languagePickerModel.get("_showOnCourseLoad")===false){this.languagePickerModel.setLanguage(Adapt$1.config.get("_defaultLanguage"),{canReset:false});return}this.showLanguagePickerView()}showLanguagePickerView(){const languagePickerView=new LanguagePickerView({model:this.languagePickerModel});languagePickerView.$el.appendTo("#wrapper")}setupNavigationView(){const globalsConfig=Adapt$1.course.get("_globals")?._extensions?._languagePicker;const{_navOrder:_navOrder=0,_showLabel:_showLabel=true,navigationBarLabel:navigationBarLabel="",_drawerPosition:_drawerPosition="auto",_navTooltip:_navTooltip={}}=globalsConfig??{};const model=new NavigationButtonModel({_id:"languagepicker",_order:_navOrder,_showLabel:_showLabel,_classes:"nav__languagepicker-btn languagepicker__nav-btn",_iconClasses:this.languagePickerModel.get("_languagePickerIconClass")||"icon-language-2",_role:"button",ariaLabel:navigationBarLabel,text:navigationBarLabel,_drawerPosition:_drawerPosition,_navTooltip:_navTooltip});navigation.addButton(new LanguagePickerNavigationButton({model:model,drawerModel:this.languagePickerModel}))}}__AMD("extensions/adapt-contrib-languagePicker/js/adapt-languagePicker",new LanguagePicker);var PageFooterNavigationView=__AMD("extensions/adapt-contrib-pageFooterNavigation/js/adapt-contrib-pageFooterNavigationView",class PageFooterNavigationView extends Backbone.View{preinitialize(){this.className="pagefooternavigation"}events(){return{"click .pagefooternavigation__btn":"onNavigationButtonClicked"}}initialize(){this.listenTo(Adapt$1,{remove:this.cleanupView,"pageView:ready":this.onPageViewReady,"paginator:resize":this.applyStyles});this.preRender();this.render()}preRender(){this.data=this.model.toJSON();const currentId=location$1._currentId;const currentContentObject=Adapt$1.contentObjects.findWhere({_id:currentId});if(!currentContentObject)return;const _parentId=currentContentObject.get("_parentId");const contentObjects=Adapt$1.contentObjects.where({_parentId:_parentId,_isAvailable:true});for(let i=0;i<contentObjects.length;i+=1){if(currentId===contentObjects[i].get("_id")){this.currentIndex=i;break}}if(this.currentIndex===undefined)return;this.data.contentObjects=contentObjects;this.data._shouldShowPrevious=this.shouldShowPrevious();this.data._shouldShowNext=this.shouldShowNext();this.data._shouldShowUp=this.shouldShowUp();if(this.data._shouldShowPrevious){const prevModel=this.data.contentObjects[this.currentIndex-1];this.data._isPreviousLocked=prevModel.get("_isLocked");if(this.data._isPreviousLocked){this.listenTo(prevModel,"change:_isLocked",_.bind(this.onLockChanged,this,"prev"))}}if(this.data._shouldShowNext){const nextModel=this.data.contentObjects[this.currentIndex+1];this.data._isNextLocked=nextModel.get("_isLocked");if(this.data._isNextLocked){this.listenTo(nextModel,"change:_isLocked",_.bind(this.onLockChanged,this,"next"))}}}onLockChanged(selectorSuffix,model,isLocked){if(isLocked)return;this.$(`[data-destination=${selectorSuffix}]`).removeClass("is-locked")}shouldShowPrevious(){const previousContentObject=this.data.contentObjects[this.currentIndex-1];const previousIsAMenu=previousContentObject&&previousContentObject.get("_type")==="menu";return this.currentIndex!==0&&!previousIsAMenu}shouldShowNext(){const nextContentObject=this.data.contentObjects[this.currentIndex+1];const nextIsAMenu=nextContentObject&&nextContentObject.get("_type")==="menu";return this.currentIndex!==this.data.contentObjects.length-1&&!nextIsAMenu}shouldShowUp(){const currentContentObject=this.data.contentObjects[this.currentIndex];return currentContentObject.getParent().get("_type")==="menu"}render(){const template=Handlebars.templates.pageFooterNavigation;this.$el.html(template(this.data));return this}cleanupView(){$(".article:last-child").off("inview");this.remove()}onPageViewReady(){this.applyStyles();if(this.model.get("_displayOptions")==="scrollToBottom")return;this.$el.addClass("display-fixed")}applyStyles(){const $footer=this.$el;if(this.model.get("_displayOptions")!=="scrollToBottom"){$footer.addClass("show");return}const articleCount=$(".article").length;const blockCount=$(".block").length;if($("html").hasClass("paginator-half-active")){if(articleCount){$(`.article.nth-child-${articleCount}`).addClass("last-child")}}$footer.removeClass("show");if($("html").hasClass("paginator-active")){if(articleCount){$(`.article.nth-child-${articleCount}`).addClass("last-child").on("inview",((event,isInView,visiblePartX,visiblePartY)=>{if(isInView&&visiblePartY!=="top"){$footer.addClass("show")}else{$footer.removeClass("show")}}))}}else if(articleCount===1&&blockCount===1){$footer.addClass("show")}}onNavigationButtonClicked(event){if(event&&event.preventDefault)event.preventDefault();let href="#/";$(".screen-wipe").removeClass("open");switch(event.currentTarget.getAttribute("data-destination")){case"prev":href=`#/id/${this.data.contentObjects[this.currentIndex-1].get("_id")}`;break;case"next":href=`#/id/${this.data.contentObjects[this.currentIndex+1].get("_id")}`;break;case"up":const parentId=this.data.contentObjects[this.currentIndex].get("_parentId");if(parentId==="course"){href="#/"}else{href=`#/id/${parentId}`}break;default:href="#/"}setTimeout((()=>{if(href==="#/"){router$1.navigateToHomeRoute()}else{Backbone.history.navigate(href,{trigger:true})}}),800)}});class PageFooterNav extends Backbone.Controller{initialize(){this.listenTo(Adapt$1,{"pageView:postRender":this.appendPageFooterNav,"trickle:started":this.hidePageFooterNav,"trickle:finished":this.showPageFooterNav})}appendPageFooterNav(){const config=Adapt$1.course.get("_pageFooterNavigation")||{};if(!config._isEnabled)return;const pageView=Adapt$1.parentView;const model=new Backbone.Model(config);this.view=new PageFooterNavigationView({model:model});const $parent=model.get("_displayOptions")==="scrollToBottom"?pageView.$(".page__inner"):pageView.$el.parent();$parent.append(this.view.$el);const startController=Adapt$1.course.get("_start")||null;if(startController?._isEnabled&&startController._isMenuDisabled){$(".pagefooternavigation__btn-home").hide()}}hidePageFooterNav(){_.defer((()=>{this.view?.$el?.addClass("u-display-none")}))}showPageFooterNav(){_.defer((()=>{this.view?.$el?.removeClass("u-display-none")}))}}__AMD("extensions/adapt-contrib-pageFooterNavigation/js/adapt-contrib-pageFooterNavigation",new PageFooterNav);class Completion extends Backbone.Controller{initialize(){___default["default"].bindAll(this,"calculatePercentageComplete");this.subProgressCompleted=0;this.subProgressTotal=0;this.nonAssessmentCompleted=0;this.nonAssessmentTotal=0;this.assessmentCompleted=0;this.assessmentTotal=0}calculateCompletion(contentObjectModel,setGlobal=false){const completion={};const perform=contentObjectModel=>{const viewType=contentObjectModel.get("_type");const isComplete=contentObjectModel.get("_isComplete")?1:0;let children;switch(viewType){case"page":{children=contentObjectModel.getAllDescendantModels().filter((model=>model.get("_isAvailable")&&!model.get("_isOptional")));const availableChildren=this.filterAvailableChildren(children);const components=this.getPageLevelProgressEnabledModels(availableChildren);const nonAssessmentComponents=this.getNonAssessmentComponents(components);completion.nonAssessmentTotal+=nonAssessmentComponents.length;completion.nonAssessmentCompleted+=this.getComponentsCompleted(nonAssessmentComponents).length;const assessmentComponents=this.getAssessmentComponents(components);completion.assessmentTotal+=assessmentComponents.length;completion.assessmentCompleted+=this.getComponentsInteractionCompleted(assessmentComponents).length;if(contentObjectModel.get("_pageLevelProgress")?._excludeAssessments!==true){completion.subProgressCompleted+=contentObjectModel.get("_subProgressComplete")||0;completion.subProgressTotal+=contentObjectModel.get("_subProgressTotal")||0}const showPageCompletionCourse=Adapt$1.course.get("_pageLevelProgress")?._showPageCompletion!==false;const showPageCompletionPage=contentObjectModel.get("_pageLevelProgress")?._showPageCompletion!==false;if(showPageCompletionCourse&&showPageCompletionPage){completion.nonAssessmentCompleted+=isComplete;completion.nonAssessmentTotal+=1}break}case"menu":case"course":{children=contentObjectModel.getChildren().models;children.forEach(perform);break}}};completion.subProgressCompleted=0;completion.subProgressTotal=0;completion.nonAssessmentTotal=0;completion.nonAssessmentCompleted=0;completion.assessmentTotal=0;completion.assessmentCompleted=0;perform(contentObjectModel);if(setGlobal)Object.assign(Adapt$1.completion,completion);return completion}getNonAssessmentComponents(models){return models.filter((model=>!model.get("_isPartOfAssessment")))}getAssessmentComponents(models){return models.filter((model=>model.get("_isPartOfAssessment")))}getComponentsCompleted(models){return models.filter((item=>item.get("_isComplete")))}getComponentsInteractionCompleted(models){return models.filter((item=>item.get("_isComplete")))}getPageLevelProgressEnabledModels(models){return models.filter((model=>{const config=model.get("_pageLevelProgress");return config?._isEnabled}))}unavailableInHierarchy(parents){if(!parents)return;return parents.some((parent=>!parent.get("_isAvailable")))}filterAvailableChildren(children){const availableChildren=[];for(let i=0,count=children.length;i<count;i++){const parents=children[i].getAncestorModels();if(this.unavailableInHierarchy(parents))continue;availableChildren.push(children[i])}return availableChildren}calculatePercentageComplete(model,setGlobal=false){const completionObject=this.calculateCompletion(model,setGlobal);const completed=completionObject.nonAssessmentCompleted+completionObject.assessmentCompleted+completionObject.subProgressCompleted;const total=completionObject.nonAssessmentTotal+completionObject.assessmentTotal+completionObject.subProgressTotal;const percentageComplete=Math.floor(completed/total*100);return percentageComplete}}var completionCalculations=__AMD("extensions/adapt-contrib-pageLevelProgress/js/completionCalculations",Adapt$1.completion=new Completion);var PageLevelProgressView=__AMD("extensions/adapt-contrib-pageLevelProgress/js/PageLevelProgressView",class PageLevelProgressView extends Backbone.View{className(){const config=Adapt$1.course.get("_pageLevelProgress");return["pagelevelprogress",config._showAtCourseLevel===true&&"is-course-level"].filter(Boolean).join(" ")}events(){return{"click .js-pagelevelprogress-item-click":"scrollToPageElement"}}initialize(){this.listenTo(Adapt$1,"remove",this.remove);this.render()}async scrollToPageElement(event){if(event&&event.preventDefault)event.preventDefault();const $target=$(event.currentTarget);if($target.is(".is-disabled"))return;const id=$target.attr("data-pagelevelprogress-id");const model=data$1.findById(id);const isNavigateToContentObject=model.isTypeGroup("contentobject");if(isNavigateToContentObject){router$1.navigateToElement(id,{duration:400});Adapt$1.trigger("drawer:closeDrawer");return}if(!model.get("_isRendered")){try{await Adapt$1.parentView.renderTo(id)}catch(err){return}}const currentComponentSelector=`.${id}`;Adapt$1.once("drawer:closed",(()=>{router$1.navigateToElement(currentComponentSelector,{duration:400})})).trigger("drawer:closeDrawer",$(currentComponentSelector))}render(){const Component=templates.pageLevelProgress;ReactDOM__default["default"].render(React__default["default"].createElement(Component,{_items:Array.isArray(this.collection)&&this.collection,_item:!Array.isArray(this.collection)&&this.collection,_globals:Adapt$1.course.get("_globals")}),this.el)}});class PageLevelProgressIndicatorView extends Backbone.View{tagName(){return"span"}initialize(options){options=options||{};this.parent=options.parent;this.calculatePercentage=options.calculatePercentage||this.calculatePercentage;this.ariaLabel=options.ariaLabel||"";this.type=options.type||this.model.get("_type");this.addClasses();this.setUpEventListeners();this.setPercentageComplete();this.render()}addClasses(){this.$el.addClass(["pagelevelprogress__indicator-outer","is-"+this.type].join(" "))}setUpEventListeners(){if(this.parent){this.listenToOnce(this.parent,"postRemove",this.remove)}else{this.listenTo(Adapt$1,"remove",this.remove)}this.listenTo(Adapt$1.course,"bubble:change:_isComplete bubble:change:_isVisited",this.render)}setPercentageComplete(){const percentage=this.calculatePercentage();this.model.set("percentageComplete",percentage);this.$el.css({"--adapt-pagelevelprogress-percentage":percentage+"%"});return percentage}calculatePercentage(){const isContentObject=this.model.isTypeGroup("contentobject");if(isContentObject)return completionCalculations.calculatePercentageComplete(this.model);const isComplete=this.model.get("_isComplete");if(isComplete)return 100;const isPresentationComponentWithItems=!this.model.isTypeGroup("question")&&this.model instanceof ItemsComponentModel;if(isPresentationComponentWithItems){const children=this.model.getChildren();const visited=children.filter((child=>child.get("_isVisited")));return Math.round(visited.length/children.length*100)}return 0}render(){this.checkCompletion();this.checkAriaHidden();const data=this.getRenderData();const Component=templates.pageLevelProgressIndicator;ReactDOM__default["default"].render(React__default["default"].createElement(Component,data),this.el)}refresh(){this.render()}checkCompletion(){const percentage=this.setPercentageComplete();const isComplete=percentage===100;const canShowMarking=Boolean(this.model.get("_canShowMarking"));const isCorrect=canShowMarking&&isComplete&&this.model.get("_isCorrect")===true;const isPartlyCorrect=canShowMarking&&isComplete&&this.model.get("_isCorrect")===false&&this.model.get("_isAtLeastOneCorrectSelection");const isIncorrect=canShowMarking&&isComplete&&this.model.get("_isCorrect")===false&&!this.model.get("_isAtLeastOneCorrectSelection");this.$el.toggleClass("is-complete",isComplete).toggleClass("is-incomplete",!isComplete).toggleClass("is-correct",isCorrect).toggleClass("is-partially-correct",isPartlyCorrect).toggleClass("is-incorrect",isIncorrect)}checkAriaHidden(){if(this.ariaLabel)return;this.$el.attr("aria-hidden",true)}getRenderData(){const data=this.model.toJSON();data.ariaLabel=this.ariaLabel;data.type=this.type;return data}}PageLevelProgressIndicatorView.template="pageLevelProgressIndicator.jsx";var PageLevelProgressIndicatorView$1=__AMD("extensions/adapt-contrib-pageLevelProgress/js/PageLevelProgressIndicatorView",PageLevelProgressIndicatorView);var getPageLevelProgressItems=__AMD("extensions/adapt-contrib-pageLevelProgress/js/getPageLevelProgressItems",(function getPageLevelProgressItemsJSON(parentModel){const{_showAtCourseLevel:_showAtCourseLevel}=Adapt$1.course.get("_pageLevelProgress");const isInAPage=parentModel.isTypeGroup("page");function addChildren(model){const allDescendants=model.getAllDescendantModels(true);const currentPageItems=allDescendants.filter((descendant=>{const isDescendantContentObject=descendant.isTypeGroup("contentobject");const isDescendantCurrentPage=model===parentModel;if(!isInAPage&&!isDescendantContentObject)return false;if(isInAPage&&!isDescendantCurrentPage&&!isDescendantContentObject)return false;const descendantParentModel=descendant.getParent();const isParentModelShown=Boolean(descendantParentModel.get("_pageLevelProgress")?._isEnabled);const isChildOfModel=descendantParentModel===model;if(isDescendantContentObject&&isParentModelShown&&!isChildOfModel)return false;return descendant.get("_isAvailable")===true}));const availableItems=completionCalculations.filterAvailableChildren(currentPageItems);const enabledProgressItems=completionCalculations.getPageLevelProgressEnabledModels(availableItems);const modelPLP=model.get("_pageLevelProgress");if(modelPLP?.title){model.set("altTitle",modelPLP.title)}if(!enabledProgressItems.length){return{...model.toJSON(),_children:null}}const _children=enabledProgressItems.map((model=>addChildren(model)));return{...model.toJSON(),_children:_children}}const jsonOutput=_showAtCourseLevel?addChildren(Adapt$1.course):addChildren(parentModel)._children;return jsonOutput}));var PageLevelProgressNavigationView=__AMD("extensions/adapt-contrib-pageLevelProgress/js/PageLevelProgressNavigationView",class PageLevelProgressNavigationView extends NavigationButtonView{events(){return{click:"onProgressClicked"}}attributes(){const attributes=this.model.toJSON();return{name:attributes._id,role:attributes._role==="button"?undefined:attributes._role,"data-order":attributes._order,"data-tooltip-id":"pagelevelprogress","aria-haspopup":"dialog"}}static get template(){return"pageLevelProgressNavigationButton.jsx"}initialize(options){super.initialize(options);this.pageModel=options.pageModel;_.bindAll(this,"updateProgressBar");this.refreshProgressBar=_.debounce(this.refreshProgressBar.bind(this),16);this.setUpEventListeners();this.render();this.addIndicator();this.refreshProgressBar();this.deferredUpdate();tooltips$1.register({_id:"pagelevelprogress",...Adapt$1.course.get("_globals")?._extensions?._pageLevelProgress?._navTooltip||{}});this.tooltip=tooltips$1.getTooltip("pagelevelprogress")}setUpEventListeners(){this.listenTo(Adapt$1,{remove:this.remove,"router:location":this.updateProgressBar,"view:childAdded pageLevelProgress:update":this.refreshProgressBar});this.listenTo(data$1,"change:_isLocked change:_isVisible change:_isComplete",this.refreshProgressBar)}addIndicator(){const{_useCourseProgressInNavigationButton:_useCourseProgressInNavigationButton=false}=Adapt$1.course.get("_pageLevelProgress")??{};this.indicatorView=new PageLevelProgressIndicatorView$1({model:_useCourseProgressInNavigationButton?Adapt$1.course:this.pageModel,calculatePercentage:this._getPageCompletionPercentage.bind(this),ariaLabel:this.model.get("ariaLabel")});const $wrapper=this.$el.find(".pagelevelprogress__indicator-wrapper");$wrapper.prepend(this.indicatorView.$el)}_getPageCompletionPercentage(){const{_useCourseProgressInNavigationButton:_useCourseProgressInNavigationButton=false}=Adapt$1.course.get("_pageLevelProgress")??{};return _useCourseProgressInNavigationButton?completionCalculations.calculatePercentageComplete(Adapt$1.course):completionCalculations.calculatePercentageComplete(this.pageModel,true)}deferredUpdate(){_.defer(this.updateProgressBar)}updateProgressBar(){this.indicatorView.refresh()}refreshProgressBar(){const percentageComplete=this._getPageCompletionPercentage();this.model.set("percentageComplete",percentageComplete);this.tooltip.set("percentageComplete",percentageComplete);this.collection=getPageLevelProgressItems(this.pageModel);this.updateProgressBar()}onProgressClicked(event){if(event&&event.preventDefault)event.preventDefault();drawer.openCustomView(new PageLevelProgressView({collection:this.collection}).$el,false,this.model.get("_drawerPosition"));Adapt$1.trigger("pageLevelProgress:toggleDrawer")}remove(){super.remove()}});class PageLevelProgress extends Backbone.Controller{initialize(){this.listenTo(Adapt$1,{"app:dataReady":this.onDataReady,"app:languageChanged":this.onLanguageChange})}static get globalsConfig(){return Adapt$1.course.get("_globals")?._extensions?._pageLevelProgress}static get courseConfig(){return Adapt$1.course.get("_pageLevelProgress")}onDataReady(){const coursePLPConfig=PageLevelProgress.courseConfig;if(!coursePLPConfig?._isEnabled)return;this.setUpEventListeners()}onLanguageChange(){this.stopListening();this.initialize()}setUpEventListeners(){const headerIndicatorTypes=["menu","menuItem","page","article","block","component"];const headerIndicatorEventNames=headerIndicatorTypes.concat([""]).join("View:render ");this.listenTo(Adapt$1,headerIndicatorEventNames,this.renderHeaderIndicatorView);this.listenTo(Adapt$1,{"menuItemView:postRender":this.renderMenuItemIndicatorView,"router:contentObject":this.renderNavigationView});this.listenTo(Adapt$1.course,"bubble:change:_isComplete bubble:change:_isVisited",this.onCompletionChange)}onCompletionChange(event){if(!location$1._currentId)return;const currentModel=data$1.findById(location$1._currentId);const completionState={currentLocation:completionCalculations.calculatePercentageComplete(currentModel),course:completionCalculations.calculatePercentageComplete(Adapt$1.course)};const hasChanged=!_.isMatch(this._previousCompletionState,completionState);if(!hasChanged)return;this._previousCompletionState=completionState;Adapt$1.trigger("pageLevelProgress:percentageCompleteChange",completionState)}renderHeaderIndicatorView(view){const model=view.model;const config=model.get("_pageLevelProgress");if(!config?._isEnabled||!config?._isCompletionIndicatorEnabled)return;const pageModel=model.findAncestor("contentobject");const pageConfig=pageModel&&pageModel.get("_pageLevelProgress");if(!pageConfig?._isEnabled)return;const $headings=view.$(".js-heading");$headings.each(((index,el)=>{const $el=$(el);const indicatorView=new PageLevelProgressIndicatorView$1({parent:view,model:model});const isBackwardCompatible=[...$el[0].classList].every((name=>!name.includes("-inner")));if(isBackwardCompatible){indicatorView.$el.insertAfter($el);return}indicatorView.$el.insertBefore($el)}))}renderMenuItemIndicatorView(view){if(view.model.get("_id")===location$1._currentId)return;const viewType=view.model.get("_type");if(viewType==="course")return;const pageLevelProgress=view.model.get("_pageLevelProgress");if(!pageLevelProgress?._isEnabled)return;view.$el.find(".js-menu-item-progress").append(new PageLevelProgressIndicatorView$1({parent:view,model:view.model,type:"menu-item",ariaLabel:PageLevelProgress.globalsConfig?.pageLevelProgressMenuBar}).$el)}renderNavigationView(pageModel){const navigationConfig=Adapt$1.course.get("_navigation");if(navigationConfig?._isDefaultNavigationDisabled)return;const coursePLPConfig=PageLevelProgress.courseConfig;if(coursePLPConfig?._isShownInNavigationBar===false)return;const pagePLPConfig=pageModel.get("_pageLevelProgress");if(!pagePLPConfig?._isEnabled)return;const viewType=pageModel.get("_type");if(viewType==="course"&&coursePLPConfig._showAtCourseLevel!==true)return;const collection=getPageLevelProgressItems(pageModel);if(!collection)return;const{_navOrder:_navOrder=0,_showLabel:_showLabel=true,navLabel:navLabel="",pageLevelProgressIndicatorBar:pageLevelProgressIndicatorBar="",_drawerPosition:_drawerPosition="auto"}=PageLevelProgress.globalsConfig??{};const model=new NavigationButtonModel({_id:"pagelevelprogress",_order:_navOrder,_showLabel:_showLabel,_classes:"nav__pagelevelprogress-btn pagelevelprogress__nav-btn",_iconClasses:"",_role:"button",ariaLabel:pageLevelProgressIndicatorBar,text:navLabel,_drawerPosition:_drawerPosition});navigation.addButton(new PageLevelProgressNavigationView({model:model,pageModel:pageModel,collection:collection}))}}__AMD("extensions/adapt-contrib-pageLevelProgress/js/adapt-contrib-pageLevelProgress",Adapt$1.pageLevelProgress=new PageLevelProgress);var ResourcesView=__AMD("extensions/adapt-contrib-resources/js/ResourcesView",class ResourcesView extends Backbone.View{className(){return"resources"}initialize(){this.onResourceItemClicked=this.onResourceItemClicked.bind(this);this.listenTo(Adapt$1,"remove",this.remove);this.render()}render(){const data={...this,model:this.model.toJSON(),resources:this.model.get("_resources"),resourceTypes:this.model.get("_resourceTypes"),_showFilters:this.model.get("_showFilters"),_filterColumnCount:this.model.get("_filterColumnCount"),_canDownload:this.model.get("_canDownload")};ReactDOM__default["default"].render(React__default["default"].createElement(templates.resources,data),this.el);_.defer((()=>{Adapt$1.trigger("view:render",this);this.listenTo(Adapt$1,"drawer:closed",this.remove)}));return this}onResourceItemClicked(e){const index=$(e.currentTarget).attr("data-index");const resourceItemData=this.model.get("_resourcesItems")[index];Adapt$1.trigger("resources:itemClicked",resourceItemData)}});class Resources extends Backbone.Controller{initialize(){this.listenTo(Adapt$1,"adapt:start",this.initResources)}initResources(){const courseResources=Adapt$1.course.get("_resources");if(!courseResources||courseResources._isEnabled===false)return;const drawerObject={title:courseResources.title,description:courseResources.description,className:"is-resources",drawerOrder:courseResources._drawerOrder||0};drawer.addItem(drawerObject,"resources:showResources");Object.assign(courseResources,{_isA11yComponentDescriptionEnabled:true,_id:"resources",_extension:"resources",_ariaLevel:1});this.setupResources(courseResources)}setupResources(resourcesData){this.listenTo(Adapt$1,"resources:showResources",(()=>{const model=new Backbone.Model(resourcesData);let resources=model.get("_resourcesItems");const contentObjectModel=Adapt$1.parentView?.model;const contentObjectConfig=contentObjectModel?.get("_resources");const isContentObjectNotCourseModel=contentObjectModel!==Adapt$1.course;const contentObjectResourceItems=isContentObjectNotCourseModel&&contentObjectConfig?._isEnabled&&contentObjectConfig?._resourcesItems;if(contentObjectResourceItems)resources=resources.concat(contentObjectResourceItems??[]);if(isContentObjectNotCourseModel){resources=resources.filter((resource=>resource._isGlobal!==false))}model.set("_resources",resources);this.setupTypes(model,resourcesData);this.setupFilters(model,resources);this.setupCanDownload(model);drawer.openCustomView(new ResourcesView({model:model}).$el)}))}setupTypes(model,resourcesData){const configuredTypes=Object.keys(resourcesData._filterButtons).filter((type=>type!=="all"));const typesWithItems=configuredTypes.filter((type=>resourcesData._resourcesItems.some(_.matcher({_type:type}))));model.set("_resourceTypes",["all",...typesWithItems])}setupFilters(model,resources){const hasMultipleResources=resources.length>1;const hasMultipleTypes=!resources.every(_.matcher({_type:resources[0]?._type}));const enableFilters=model.get("_enableFilters")??true;const showFilters=hasMultipleResources&&hasMultipleTypes&&enableFilters;model.set("_showFilters",showFilters);const filterColumnCount=_.uniq(_.pluck(resources,"_type")).length+1;model.set("_filterColumnCount",filterColumnCount)}setupCanDownload(model){const canEnableDownloads=device$1.browser!=="internet explorer"&&device$1.OS!=="ios";model.set("_canDownload",canEnableDownloads)}}__AMD("extensions/adapt-contrib-resources/js/adapt-contrib-resources",new Resources);Adapt$1.on("adapt:start",(function(){const config=Adapt$1.course.get("_scriptInjector")||{};if(!config._isEnabled)return;if(!config.customScript)return;const scriptTag=$("<script><\/script>").html(config.customScript);$("head").append(scriptTag)}));function _deepDefaults(original,...defaultObjects){defaultObjects.reverse();defaultObjects.forEach((defaults=>{const keyValuePairs=Object.entries(defaults);keyValuePairs.forEach((([key,defaultValue])=>{const isRecursiveObject=typeof defaultValue==="object"&&!Array.isArray(defaultValue)&&defaultValue!==null;if(isRecursiveObject){original[key]=_deepDefaults(original[key]||{},defaultValue);return}const isValueAlreadySet=Object.prototype.hasOwnProperty.call(original,key);if(isValueAlreadySet)return;original[key]=defaultValue}))}));return original}const configDefaults={_isEnabled:false,_isInherited:false,_autoScroll:true,_scrollTo:"@block +1",_onChildren:false,_button:{_isEnabled:true,_isFullWidth:true,_autoHide:false,_hasIcon:false,_styleBeforeCompletion:"hidden",_styleAfterClick:"hidden",_component:"trickle-button",_className:"",text:"Continue",ariaLabel:"",startText:"",startAriaLabel:"",finalText:"",finalAriaLabel:""},_stepLocking:{_isEnabled:true,_isCompletionRequired:true,_isLockedOnRevisit:false}};function isModelArticleWithOnChildren(model){const type=model.get("_type");const trickleConfig=model.get("_trickle");return type==="article"&&trickleConfig?._onChildren!==false}function isModelBlockWithArticleNotChildren(model){const type=model.get("_type");const parentTrickleConfig=model.getParent()?.get("_trickle");return type==="block"&&parentTrickleConfig?._isEnabled===true&&parentTrickleConfig?._onChildren===false}function getModelConfigDefaults(model){const type=model.get("_type");const config={};_deepDefaults(config,configDefaults,{_onChildren:type==="article"});if(config._onChildren){config._button.startText=config._button.startText??"Begin";config._button.startAriaLabel=config._button.startAriaLabel??"";config._button.finalText=config._button.finalText??"Finish";config._button.finalAriaLabel=config._button.finalAriaLabel??""}if(config._button._isFullWidth){config._stepLocking._isEnabled=true}return config}function getModelInheritanceChain(configModel){if(!data$1.isReady)throw new Error("Trickle cannot resolve inheritance chains until data is ready");const type=configModel.get("_type");if(type==="block"){const parentModel=configModel.getParent();const parentConfig=parentModel.get("_trickle");const blockConfig=configModel.get("_trickle");const isParentEnabledNotOnChildren=parentConfig?._isEnabled&&parentConfig._onChildren===false;const isNoChildConfig=!blockConfig?._isEnabled;if(isParentEnabledNotOnChildren&&isNoChildConfig){return null}return[configModel,parentModel].filter((ancestor=>{const config=ancestor.get("_trickle");return config&&!config._isInherited}))}if(type==="article"){return[configModel]}return null}function getModelConfig(model){const inheritance=getModelInheritanceChain(model);if(!inheritance?.length||isModelArticleWithOnChildren(model)||isModelBlockWithArticleNotChildren(model))return null;const config=$.extend(true,{},...inheritance.reverse().map(((inheritModel,index,arr)=>{const isLast=index===arr.length-1;const defaults=isLast?getModelConfigDefaults(inheritModel):null;return $.extend(true,{},defaults,inheritModel.get("_trickle"))})));if(!config._isEnabled)return null;return config}function getModelContainer(model){const inheritance=getModelInheritanceChain(model);return inheritance?.find((inheritModel=>{const defaults=getModelConfigDefaults(inheritModel);const config=$.extend(true,{},defaults,inheritModel.get("_trickle"));return config._onChildren}))??inheritance?.[0]}function getCompletionAttribute(model=null){return getModelConfig(model)?._completionAttribute||Adapt$1.config.get("_trickle")?._completionAttribute||"_isComplete"}function checkApplyLocks(model){if(!data$1.isReady)return;const completionAttribute=getCompletionAttribute(model);const hasCompletionChanged=Object.prototype.hasOwnProperty.call(model.changed,completionAttribute);const hasAvailabilityChanged=Object.prototype.hasOwnProperty.call(model.changed,"_isAvailable");if(!hasCompletionChanged&&!hasAvailabilityChanged)return;debouncedApplyLocks()}function applyLocks(){if(!data$1.isReady)return;const locks={};const modelsById={};const TrickleButtonModel=components$1.getModelClass("trickle-button");const setDescendantLocks=(model,id)=>{model.getAllDescendantModels().forEach((descendant=>{const descendantId=descendant.get("_id");modelsById[descendantId]=descendant;locks[descendantId]=locks[id]}))};Adapt$1.course.getAllDescendantModels(true).filter((model=>model.get("_isAvailable"))).forEach((siteModel=>{const trickleConfig=getModelConfig(siteModel);if(!isEnabled(siteModel,{trickleConfig:trickleConfig}))return;const isModelLocked=isLocked(siteModel,{trickleConfig:trickleConfig});const id=siteModel.get("_id");modelsById[id]=siteModel;locks[id]=locks[id]||false;if(!locks[id])setDescendantLocks(siteModel,id);const subsequentLockingModels=_getAncestorNextSiblings(siteModel);subsequentLockingModels.forEach(((model,index)=>{const id=model.get("_id");const isButtonModel=model instanceof TrickleButtonModel;const isTrickled=model.get("_isTrickled");if(isTrickled!==isButtonModel)model.set("_isTrickled",!isButtonModel);modelsById[id]=model;locks[id]=locks[id]||isModelLocked;if(model.get("_lockType"))return;setDescendantLocks(model,id)}))}));Object.entries(locks).forEach((([id,isModelLocked])=>{const model=modelsById[id];const wasLocked=model.get("_isLocked");if(wasLocked===isModelLocked)return;model.set("_isLocked",isModelLocked,{pluginName:"trickle"})}));logTrickleState()}function isEnabled(model,{trickleConfig:trickleConfig=getModelConfig(model)}={}){return trickleConfig?._isEnabled===true}function isLocked(model,{trickleConfig:trickleConfig=getModelConfig(model)}={}){const isStepLocked=Boolean(trickleConfig?._stepLocking?._isEnabled);if(!isStepLocked)return false;const isCompletionRequired=Boolean(trickleConfig?._stepLocking?._isCompletionRequired);const completionAttribute=getCompletionAttribute(model);if(!isCompletionRequired){const TrickleModel=components$1.getModelClass("trickle-button");const trickleButton=model.getAvailableChildModels().find((model=>model instanceof TrickleModel));const isTrickleButtonComplete=Boolean(trickleButton?.get(completionAttribute));return!isTrickleButtonComplete}const isModelLocked=!model?.get(completionAttribute)&&!model?.get("_isOptional");return isModelLocked}const debouncedApplyLocks=_.debounce(applyLocks,1);function _getAncestorNextSiblings(fromModel){if(!fromModel)return[];const allSiblings=fromModel.getParent().getAvailableChildModels();const subsequentSiblings=allSiblings.slice(allSiblings.findIndex((sibling=>sibling===fromModel))+1);const allAncestors=fromModel.getAncestorModels();const inPageAncestors=allAncestors.slice(0,allAncestors.findIndex((parent=>parent instanceof ContentObjectModel))+1);const subsequentInPageAncestors=[];inPageAncestors.slice(1).forEach(((grandParent,previousIndex)=>{const parent=inPageAncestors[previousIndex];const allGrandParentChildren=grandParent.getAvailableChildModels();const subsequentAncestorSiblings=allGrandParentChildren.slice(allGrandParentChildren.findIndex((child=>child===parent))+1);subsequentInPageAncestors.push(...subsequentAncestorSiblings)}));const subsequentContentObjectDescendantModels=subsequentSiblings.concat(subsequentInPageAncestors);return subsequentContentObjectDescendantModels}function addButtonComponents(){const TrickleButtonModel=components$1.getModelClass("trickle-button");let uid=0;data$1.forEach((buttonModelSite=>{if(buttonModelSite instanceof CourseModel$1)return;const trickleConfig=getModelConfig(buttonModelSite);if(!trickleConfig||!trickleConfig?._isEnabled||buttonModelSite.get("_isTrickleSiteConfigured"))return;buttonModelSite.set("_isTrickleSiteConfigured",true);const parentId=buttonModelSite.get("_id");const trickleButtonModel=new TrickleButtonModel({_id:`trickle-${uid++}`,_type:"component",_component:"trickle-button",_parentId:parentId,_isAvailable:true,_layout:"full",_trickle:{_isEnabled:true},_renderPosition:"outer-append",_isTrackable:false});trickleButtonModel.setupModel();buttonModelSite.getChildren().add(trickleButtonModel);data$1.add(trickleButtonModel)}))}function logTrickleState(){const trickleConfig=Adapt$1.config.get("_trickle");if(!trickleConfig?._logState||logging$1._config?._level!=="debug")return;if(!Adapt$1.parentView?.model?.isTypeGroup("page")){logging$1.debug("TRICKLE GLOBAL STATE");Adapt$1.course.getAllDescendantModels(true).filter((model=>model.get("_isAvailable"))).forEach((model=>{const isLocked=model.get("_isLocked");const isTrickled=model.get("_isTrickled");logging$1.debug(`${" ".repeat(model.getAncestorModels().length)}${model.get("_type")} ${model.get("_id")} isLocked: ${isLocked} isTrickled: ${isTrickled}`)}));return}logging$1.debug("TRICKLE STATE");Adapt$1.parentView.model.getAllDescendantModels(true).filter((model=>model.get("_isAvailable"))).forEach((model=>{const isLocked=model.get("_isLocked");const isTrickled=model.get("_isTrickled");logging$1.debug(`${" ".repeat(model.getAncestorModels().length)}${model.get("_type")} ${model.get("_id")} isLocked: ${isLocked} isTrickled: ${isTrickled}`)}))}__AMD("extensions/adapt-contrib-trickle/js/models",{_deepDefaults:_deepDefaults,configDefaults:configDefaults,getModelConfigDefaults:getModelConfigDefaults,getModelInheritanceChain:getModelInheritanceChain,getModelConfig:getModelConfig,getModelContainer:getModelContainer,getCompletionAttribute:getCompletionAttribute,checkApplyLocks:checkApplyLocks,applyLocks:applyLocks,debouncedApplyLocks:debouncedApplyLocks,_getAncestorNextSiblings:_getAncestorNextSiblings,addButtonComponents:addButtonComponents,logTrickleState:logTrickleState});class TrickleController extends Backbone.Controller{initialize(){this.checkIsFinished=_.debounce(this.checkIsFinished,1);this.listenTo(Adapt$1,{"adapt:start":this.onAdaptStart})}async onAdaptStart(){const trickleConfig=Adapt$1.config.get("_trickle");if(trickleConfig?._isEnabled===false)return;this.setUpEventListeners();wait$1.for((done=>{addButtonComponents();applyLocks();done()}))}setUpEventListeners(){this.stopListening();this.listenTo(data$1,{"change:_isInteractionComplete change:_isComplete change:_isAvailable add remove":checkApplyLocks,"change:_isLocked":this.checkIsFinished});this.listenTo(Adapt$1,{"adapt:start":this.onAdaptStart,"assessments:reset":this.onAssessmentReset,"contentObjectView:preRender":this.reset,"view:addChild":this.onAddChildView,"trickle:kill":this.kill})}onAssessmentReset(){const isMidRender=!Adapt$1.parentView?.model.get("_isReady");if(isMidRender)return applyLocks();debouncedApplyLocks()}get isStarted(){return Boolean(Adapt$1.parentView?.model.get("_isTrickleStarted"))}set isStarted(value){if(!Adapt$1.parentView)return;Adapt$1.parentView.model.set("_isTrickleStarted",value);if(!value)return;Adapt$1.trigger("trickle:started")}onAddChildView(event){if(this.isKilled)return;if(event.hasRequestChild)applyLocks();const isManagedByTrickleAndLocked=event.model.get("_isTrickled")&&event.model.get("_isLocked");if(!isManagedByTrickleAndLocked)return;event.stop()}get isTrickling(){const currentDescendants=Adapt$1.parentView.model.getAllDescendantModels();const isDescendantBlockedByTrickle=currentDescendants.some((model=>model.get("_isAvailable")&&model.get("_isTrickled")&&model.get("_isLocked")));if(isDescendantBlockedByTrickle)return true;const TrickleModel=components$1.getModelClass("trickle-button");const lastDescendant=currentDescendants[currentDescendants.length-1];const lastTrickleButton=currentDescendants.reverse().find((model=>model instanceof TrickleModel));const isLastDescendantExpectingMoreChildren=lastDescendant.get("_requireCompletionOf")===Number.POSITIVE_INFINITY&&lastDescendant.get("_canRequestChild");const isLastTrickleButtonWaiting=!lastTrickleButton?.get("_isComplete");return isLastDescendantExpectingMoreChildren&&isLastTrickleButtonWaiting}async continue(){applyLocks();await Adapt$1.parentView.addChildren();await Adapt$1.parentView.whenReady()}async scroll(fromModel){const trickleConfig=getModelConfig(fromModel);if(!trickleConfig?._isEnabled)return false;if(isModelArticleWithOnChildren(fromModel))return false;const isAutoScrollOff=!trickleConfig._autoScroll;const hasTrickleButton=trickleConfig._button._isEnabled;if(isAutoScrollOff&&!hasTrickleButton){return}const getScrollToId=()=>{const scrollTo=trickleConfig._scrollTo;const firstCharacter=scrollTo.substr(0,1);switch(firstCharacter){case"@":{const relativeModel=fromModel.findRelativeModel(scrollTo,{filter:model=>model.get("_isAvailable")});if(relativeModel===undefined)return;return relativeModel.get("_id")}case".":return scrollTo.substr(1,scrollTo.length-1);default:return scrollTo}};let scrollToId=getScrollToId();if(!scrollToId){logging$1.error(`Cannot scroll to the next id as none was found at id: "${fromModel.get("_id")}" with _scrollTo: "${trickleConfig._scrollTo}". Suggestion: Set _showEndOfPage to false.`);return}const isDescendant=Adapt$1.parentView.model.getAllDescendantModels().some((model=>model.get("_id")===scrollToId));if(!isDescendant){applyLocks();const model=data$1.findById(scrollToId);const contentObject=model.isTypeGroup("contentobject")?model:model.findAncestor("contentobject");await router$1.navigateToElement(contentObject.get("_id"));scrollToId=getScrollToId();await router$1.navigateToElement(scrollToId);return}await Adapt$1.parentView.renderTo(scrollToId);if(hasTrickleButton){a11y$1.focusFirst($("."+scrollToId),{preventScroll:true})}if(isAutoScrollOff)return false;const duration=trickleConfig._scrollDuration||500;router$1.navigateToElement("."+scrollToId,{duration:duration})}get isFinished(){if(!Adapt$1.parentView)return false;return Boolean(!this.isStarted||Adapt$1.parentView.model.get("_isTrickleFinished")||this.isKilled)}set isFinished(value){if(!Adapt$1.parentView)return;Adapt$1.parentView.model.set("_isTrickleFinished",value);if(!value)return;Adapt$1.trigger("trickle:finished")}checkIsFinished(){if(!this.isStarted)return;if(this.isKilled||this.isFinished)return;if(this.isTrickling)return;this.isFinished=true}async kill(){const TrickleModel=components$1.getModelClass("trickle-button");this.isKilled=true;Adapt$1.parentView.model.getAllDescendantModels().forEach((model=>{const isButtonModel=model instanceof TrickleModel;if(isButtonModel){model.setCompletionStatus()}if(!model.get("_isTrickled"))return;model.set("_isLocked",false,{pluginName:"trickle"})}));await this.continue()}get isKilled(){if(!Adapt$1.parentView)return false;return!this.isStarted||Adapt$1.parentView.model.get("_isTrickleKilled")}set isKilled(value){if(!Adapt$1.parentView)return;Adapt$1.parentView.model.set("_isTrickleKilled",value);if(!value)return;Adapt$1.trigger("trickle:killed")}async reset(){await wait$1.queue();this.isKilled=false;this.isStarted=this.isTrickling;this.isFinished=false}}var controller=__AMD("extensions/adapt-contrib-trickle/js/controller",new TrickleController);class TrickleButtonView extends ComponentView$1{className(){const config=getModelConfig(this.model.getParent());return["trickle",this.model.get("_id"),config?._button._component,config?._button._isFullWidth&&"is-full-width",config?._button._className].filter(Boolean).join(" ")}events(){return{"click .js-trickle-btn":"onButtonClick"}}initialize(){this.openPopupCount=0;this.isAwaitingPopupClose=false;this.wasButtonClicked=false;this.calculateButtonState();this.model.calculateButtonText();this.setupEventListeners();this.render();if(!this.model.isEnabled()){this.setCompletionStatus()}_.defer(this.setReadyStatus.bind(this))}calculateButtonState(){const isDisabledByPopups=this.openPopupCount>0;this.model.calculateButtonState(isDisabledByPopups,this.wasButtonClicked)}render(){const data=this.model.toJSON();data._globals=Adapt$1.course.get("_globals");data._trickle=getModelConfig(this.model.getParent());this.$el.html(Handlebars.templates[TrickleButtonView.template](data))}setupEventListeners(){this.tryButtonAutoHide=this.tryButtonAutoHide.bind(this);const onParentComplete=this.onParentComplete.bind(this);this.onParentComplete=(...args)=>_.delay((()=>onParentComplete(...args)),100);this.listenTo(Adapt$1.parentView,"postRemove",this.onRemove);this.listenTo(Adapt$1,"trickle:killed",this.updateButtonState);if(this.model.isStepUnlocked()&&this.model.isFinished()){return}this.$el.on("onscreen",this.tryButtonAutoHide);this.listenTo(Adapt$1,{"popup:opened":this.onPopupOpened,"popup:closed":this.onPopupClosed});const parentModel=this.model.getParent();const completionAttribute=getCompletionAttribute(parentModel);this.listenTo(parentModel,{"change:_requireCompletionOf":this.onStepUnlocked,[`bubble:change:${completionAttribute}`]:this.onStepUnlocked,[`change:${completionAttribute}`]:this.onParentComplete})}onPopupOpened(){this.openPopupCount++;const shouldUserInteractWithButton=this.model.isStepUnlocked()&&!this.model.isFinished();if(!shouldUserInteractWithButton)return;this.updateButtonState()}async onPopupClosed(){this.openPopupCount--;if(this.openPopupCount)return;if(this.isAwaitingPopupClose){return this.finish()}const shouldUserInteractWithButton=this.model.isStepUnlocked()&&!this.model.isFinished();if(!shouldUserInteractWithButton)return;this.updateButtonState();await Adapt$1.parentView.addChildren()}updateButtonState(){this.calculateButtonState();const isButtonHidden=!(this.model.get("_isButtonVisible")&&!this.model.get("_isButtonAutoHidden"));this.$(".js-trickle-btn-container").toggleClass("u-display-none",isButtonHidden);const isButtonDisabled=this.model.get("_isButtonDisabled");const $button=this.$(".js-trickle-btn");const $ariaLabel=this.$(".aria-label");a11y$1.toggleEnabled($button,!isButtonDisabled);if(!isButtonDisabled){if(document.activeElement instanceof HTMLElement&&document.activeElement.isSameNode($ariaLabel[0])){a11y$1.focusNext($ariaLabel)}a11y$1.toggleAccessibleEnabled($ariaLabel,false)}const isButtonLocked=this.model.get("_isButtonVisible")&&isButtonDisabled;$button.toggleClass("is-locked",isButtonLocked);const $buttonText=this.$(".js-trickle-btn-text");this.model.calculateButtonText();const text=this.model.get("buttonText");const ariaLabel=this.model.get("buttonAriaLabel");$buttonText.html(text);$button.attr("aria-label",ariaLabel)}async onStepUnlocked(event){if(event.value===false)return;_.defer(this.updateButtonState.bind(this))}async onButtonClick(){const wasComplete=this.model.get("_isComplete");this.model.setCompletionStatus();this.wasButtonClicked=true;const isStepLockingCompletionRequired=this.model.isStepLockingCompletionRequired();if(isStepLockingCompletionRequired&&!wasComplete)return;await this.continue()}async onParentComplete(model,value){if(!value)return;const parentModel=this.model.getParent();const completionAttribute=getCompletionAttribute(parentModel);this.stopListening(parentModel,{[`bubble:change:${completionAttribute}`]:this.onStepUnlocked,[`change:${completionAttribute}`]:this.onParentComplete});if(controller.isKilled)return;if(this.openPopupCount>0){this.isAwaitingPopupClose=true;return}await this.finish()}async finish(){this.stopListening(Adapt$1,{"popup:opened":this.onPopupOpened,"popup:closed":this.onPopupClosed});this.updateButtonState();const isStepLockingCompletionRequired=this.model.isStepLockingCompletionRequired();if(!isStepLockingCompletionRequired)return;await this.continue()}async continue(){const parent=this.model.getParent();await controller.continue();await controller.scroll(parent)}tryButtonAutoHide(){if(!this.model.get("_isButtonVisible"))return;const trickleConfig=getModelConfig(this.model.getParent());if(!trickleConfig._button._autoHide){this.model.set("_isButtonAutoHidden",false);return}const measurements=this.$el.onscreen();const isJustOffscreen=measurements.bottom>-100;const isButtonAutoHidden=!measurements.onscreen&&!isJustOffscreen;this.model.set("_isButtonAutoHidden",isButtonAutoHidden);this.updateButtonState()}onRemove(){this.$el.off("onscreen",this.tryButtonAutoHide);this.remove()}}TrickleButtonView.template="trickle-button";var TrickleButtonView$1=__AMD("extensions/adapt-contrib-trickle/js/TrickleButtonView",TrickleButtonView);var TrickleButtonModel=__AMD("extensions/adapt-contrib-trickle/js/TrickleButtonModel",class TrickleButtonModel extends ComponentModel$1{init(){super.init();if(!this.isStepComplete())return;this.setCompletionStatus()}isEnabled(){const trickleConfig=getModelConfig(this.getParent());if(!trickleConfig)return false;const isEnabled=trickleConfig._isEnabled&&trickleConfig._button?._isEnabled;return isEnabled}isStepLocking(){const config=getModelConfig(this.getParent());if(!config)return false;const isStepLocking=config._stepLocking?._isEnabled;return isStepLocking}isStepLockingCompletionRequired(){const config=getModelConfig(this.getParent());if(!config)return false;const isStepLockingCompletionRequired=config._stepLocking&&config._stepLocking._isEnabled&&config._stepLocking._isCompletionRequired;return isStepLockingCompletionRequired}isStepUnlocked(){const parentModel=this.getParent();const completionAttribute=getCompletionAttribute(parentModel);const isCompletionBlocked=parentModel.get("_requireCompletionOf")===Number.POSITIVE_INFINITY;if(isCompletionBlocked)return;return this.getParent().getChildren().every((sibling=>{if(sibling===this){return true}return sibling.get(completionAttribute)||sibling.get("_isOptional")||!sibling.get("_isAvailable")}))}isStepComplete(){const parentModel=this.getParent();const completionAttribute=getCompletionAttribute(parentModel);const isParentComplete=parentModel.get(completionAttribute);return isParentComplete}isStepLockedOnRevisit(){const trickleConfig=getModelConfig(this.getParent());return Boolean(trickleConfig._stepLocking._isLockedOnRevisit)}isFinished(){const isStepUnlocked=this.isStepUnlocked();const isStepLockingCompletionRequired=this.isStepLockingCompletionRequired();const isButtonComplete=this.get("_isComplete");const isFinished=(isStepUnlocked||!isStepLockingCompletionRequired)&&isButtonComplete;return isFinished}isLastInContentObject(){const contentObject=this.findAncestor("contentobject");const allDescendants=contentObject.getAllDescendantModels(true);const lastDescendant=allDescendants[allDescendants.length-1];const parentModel=this.getParent();const trickleParent=getModelContainer(parentModel);const isParentFinished=trickleParent.get("_requireCompletionOf")!==Number.POSITIVE_INFINITY;return isParentFinished&&this===lastDescendant}calculateButtonText(){const parentModel=this.getParent();const trickleConfig=getModelConfig(parentModel);if(!trickleConfig)return;let isStart=false;let isFinal=false;const isDisabled=this.get("_isButtonDisabled");if(trickleConfig._onChildren){const parentId=parentModel.get("_id");const trickleParent=getModelContainer(parentModel);const trickleSiblings=trickleParent.getAllDescendantModels(true).filter((model=>model.get("_isAvailable")&&model.get("_isTrickled")));const index=trickleSiblings.findIndex((model=>model.get("_id")===parentId));isStart=index===0;isFinal=index===trickleSiblings.length-1&&!trickleParent.get("_canRequestChild")}const text=isDisabled&&trickleConfig._button.disabledText?trickleConfig._button.disabledText:isStart&&trickleConfig._button.startText?trickleConfig._button.startText:isFinal&&trickleConfig._button.finalText?trickleConfig._button.finalText:trickleConfig._button.text;const ariaLabel=isDisabled&&trickleConfig._button.disabledAriaLabel?trickleConfig._button.disabledAriaLabel:isStart&&trickleConfig._button.startAriaLabel?trickleConfig._button.startAriaLabel:isFinal&&trickleConfig._button.finalAriaLabel?trickleConfig._button.finalAriaLabel:trickleConfig._button.ariaLabel;this.set({buttonText:text,buttonAriaLabel:ariaLabel})}checkIfResetOnRevisit(){if(this.isFinished()&&!this.isStepLockedOnRevisit())return;if(!this.get("_isComplete")&&!this.get("_isInteractionComplete"))return;this.set({_isComplete:false,_isInteractionComplete:false});applyLocks()}calculateButtonState(isButtonDisableForced=false,isButtonHiddenForced=false){if(!this.isEnabled()){this.set({_isButtonVisible:false,_isButtonDisabled:!this.isStepUnlocked()});return}const trickleConfig=getModelConfig(this.getParent());if(this.isLastInContentObject()&&trickleConfig._button._showEndOfPage===false){return this.set({_isButtonVisible:false,_isButtonDisabled:true})}const isTrickleKilled=controller.isKilled;const isStepUnlocked=this.isStepUnlocked()||isTrickleKilled;const isFinished=this.isFinished()||isTrickleKilled;const isButtonVisibleBeforeCompletion=trickleConfig._button._styleBeforeCompletion!=="hidden";const isButtonVisibleAfterCompletion=trickleConfig._button._styleAfterClick!=="hidden"&&!trickleConfig._button._isFullWidth;const isStepLockingCompletionRequired=this.isStepLockingCompletionRequired();const isNoCompletionRequiredAndLockedVisible=!isStepLockingCompletionRequired&&!isFinished&&isButtonVisibleBeforeCompletion;const isNoCompletionRequiredAndUnlockedVisible=!isStepLockingCompletionRequired&&isStepUnlocked&&!isFinished;const isNoCompletionRequiredAndFinishedVisible=!isStepLockingCompletionRequired&&isFinished&&isButtonVisibleAfterCompletion;const isStepLockedAndVisibleBeforeCompletion=isStepLockingCompletionRequired&&!isStepUnlocked&&isButtonVisibleBeforeCompletion&&!isButtonHiddenForced;const isFinishedAndVisibleAfterCompletion=isStepLockingCompletionRequired&&isFinished&&isButtonVisibleAfterCompletion;const isStepUnlockedAndButtonIncomplete=isStepLockingCompletionRequired&&isStepUnlocked&&!isFinished;const isButtonVisible=isNoCompletionRequiredAndLockedVisible||isNoCompletionRequiredAndUnlockedVisible||isNoCompletionRequiredAndFinishedVisible||isStepLockedAndVisibleBeforeCompletion||isFinishedAndVisibleAfterCompletion||isStepUnlockedAndButtonIncomplete;const isButtonEnabledBeforeCompletion=trickleConfig._button._styleBeforeCompletion!=="disabled";const isButtonEnabledAfterCompletion=trickleConfig._button._styleAfterClick!=="disabled";const isNoCompletionRequiredAndLockedEnabled=!isStepLockingCompletionRequired&&!isFinished&&isButtonEnabledBeforeCompletion;const isNoCompletionRequiredAndUnlockedEnabled=!isStepLockingCompletionRequired&&isStepUnlocked&&!isFinished;const isNoCompletionRequiredAndFinishedEnabled=!isStepLockingCompletionRequired&&isFinished&&isButtonEnabledAfterCompletion;const isStepUnlockedAndButtonIncompleteWithoutButtonDisabledForced=isStepLockingCompletionRequired&&isStepUnlockedAndButtonIncomplete&&!isButtonDisableForced;const isFinishedAndEnabledAfterCompletion=isStepLockingCompletionRequired&&isFinished&&isButtonEnabledAfterCompletion;const isButtonEnabled=isNoCompletionRequiredAndLockedEnabled||isNoCompletionRequiredAndUnlockedEnabled||isNoCompletionRequiredAndFinishedEnabled||isStepUnlockedAndButtonIncompleteWithoutButtonDisabledForced||isFinishedAndEnabledAfterCompletion||false;this.set({_isButtonVisible:isButtonVisible,_isButtonDisabled:!isButtonEnabled})}});__AMD("extensions/adapt-contrib-trickle/js/trickleButton",components$1.register("trickle-button",{view:TrickleButtonView$1,model:TrickleButtonModel}));__AMD("extensions/adapt-contrib-trickle/js/adapt-contrib-trickle",Adapt$1.trickle=controller);const TUTOR_TYPE=ENUM(["NOTIFY","INLINE","OVERLAY","NONE"]);var TUTOR_TYPE$1=__AMD("extensions/adapt-contrib-tutor/js/TUTOR_TYPE",TUTOR_TYPE);var TutorModel=__AMD("extensions/adapt-contrib-tutor/js/TutorModel",class TutorModel extends Backbone.Model{defaults(){return{_type:TUTOR_TYPE$1.NOTIFY.asLowerCase,_classes:"",_hasNotifyBottomButton:false,_button:{text:"{{_globals._extensions._tutor.hideFeedback}}",ariaLabel:"{{_globals._extensions._tutor.hideFeedback}}"},...Adapt$1.course.get("_tutor")}}initialize(data,parentModel){data=$.extend(true,this.defaults(),data?._isInherited===true?null:data,{_attributes:{"data-adapt-id":parentModel.get("_id")},_id:parentModel.get("_id"),_shouldRenderId:false,...parentModel.getFeedback?.()||{altTitle:parentModel.get("altFeedbackTitle"),title:parentModel.get("feedbackTitle"),body:parentModel.get("feedbackMessage")}});data._classes+=` tutor ${this.getOriginClasses(parentModel)}`;this.set(data)}getOriginClasses(model){const component=model.get("_component");const extension=model.get("_extension");return[model.get("_isCorrect")?"is-correct":model.get("_isAtLeastOneCorrectSelection")?"is-partially-correct":"is-incorrect",component&&`is-component is-${component}`,extension&&`is-extension is-${extension}`].filter(Boolean).join(" ")}});var TutorNotify=__AMD("extensions/adapt-contrib-tutor/js/TutorNotify",class TutorNotify extends Backbone.Controller{initialize(options){this.parentView=options.parentView;this.listenToOnce(Adapt$1,"notify:closed",this.onNotifyClosed);this.triggerNotify()}triggerNotify(){const{_hasNotifyBottomButton:isButtonEnabled,_button:{text:promptText}}=this.model.toJSON();this.notifyOptions={...this.model.toJSON(),_prompts:isButtonEnabled&&[{promptText:Handlebars.compile(promptText)({_globals:Adapt$1.course.get("_globals")})}],_type:isButtonEnabled?"prompt":"popup"};notify$1.create(this.notifyOptions);Adapt$1.trigger("tutor:opened",this.parentView,this.notifyOptions)}onNotifyClosed(){Adapt$1.trigger("tutor:closed",this.parentView,this.notifyOptions)}});var TutorView=__AMD("extensions/adapt-contrib-tutor/js/TutorView",class TutorView extends Backbone.View{className(){return["tutor",`tutor-type-${this.model.get("_type")}`,this.model.get("_classes")].join(" ")}events(){return{"click .js-tutor-btn":"onCloseClick"}}initialize(options){this.parentView=options.parentView;this.buttonsView=this.parentView.buttonsView;this.listenTo(this.parentView,"postRemove",this.onTutorClosed);this.listenTo(this.buttonsView,"buttons:stateUpdate",this.onButtonsStateUpdate);this.render()}render(){this.$el.html(Handlebars.templates.tutor(this.model.toJSON()));_.defer(this.postRender.bind(this))}postRender(){this.toggleFeedback({shouldOpen:true})}toggleFeedback({shouldOpen:shouldOpen,shouldManageFocus:shouldManageFocus=true}={}){const animation=this.model.get("_type")==="inline"?"slide":"fade";const onAnimationEnd=shouldOpen?this.onTutorOpened.bind(this,shouldManageFocus):this.onTutorClosed.bind(this,shouldManageFocus);if(shouldManageFocus){a11y$1.toggleEnabled(this.buttonsView.$(".js-btn-feedback"),!shouldOpen)}this.$(".tutor__inner").stop()[`${animation}Toggle`](200,onAnimationEnd)}onCloseClick(){this.toggleFeedback({shouldOpen:false})}onTutorOpened(shouldManageFocus){if(shouldManageFocus){a11y$1.focus(this.$(".tutor__inner"),{defer:true,preventScroll:true})}Adapt$1.trigger("tutor:opened",this.parentView,this.model.toJSON())}onTutorClosed(shouldManageFocus){if(shouldManageFocus){const $showFeedbackButton=this.buttonsView.$(".js-btn-feedback");a11y$1.focus($showFeedbackButton,{defer:true,preventScroll:true})}Adapt$1.trigger("tutor:closed",this.parentView,this.model.toJSON());this.remove()}onButtonsStateUpdate(state){if(state!==BUTTON_STATE$1.RESET)return;this.toggleFeedback({shouldOpen:false,shouldManageFocus:false})}});class Tutor extends Backbone.Controller{initialize(){this.listenTo(Adapt$1,{"componentView:postRender":this.onComponentViewPostRender,"questionView:showFeedback":this.onQuestionViewShowFeedback,"buttonsView:postRender":this.onButtonsViewPostRender})}getTutorType(model){const config=model.get("_tutor")?._isInherited??true?Adapt$1.course.get("_tutor"):model.get("_tutor");if(!config)return;return TUTOR_TYPE$1(config._type?.toUpperCase())}onComponentViewPostRender(view){const{model:model}=view;if(!model.isTypeGroup("question"))return;const type=this.getTutorType(model);if(!type)return;const shouldShowFeedback=model.get("_canShowFeedback")&&model.get("_isSubmitted")&&type===TUTOR_TYPE$1.INLINE;if(!shouldShowFeedback)return;model.setupFeedback();Adapt$1.trigger("questionView:showFeedback",view)}onButtonsViewPostRender(view){const{model:model}=view;const type=this.getTutorType(model);if(type!==TUTOR_TYPE$1.INLINE)return;const $btnAction=view.$(".js-btn-action");const $btnFeedback=view.$(".js-btn-feedback");const $btnMarking=view.$(".js-btn-marking");$btnAction.addClass("is-full-width");$btnFeedback.addClass("u-display-none");$btnMarking.addClass("is-full-width")}onQuestionViewShowFeedback(view){const parentModel=view.model;const tutorModel=new TutorModel(parentModel.get("_tutor"),parentModel);const options={model:tutorModel,parentView:view};switch(TUTOR_TYPE$1(tutorModel.get("_type").toUpperCase())){case TUTOR_TYPE$1.NOTIFY:new TutorNotify(options);break;case TUTOR_TYPE$1.INLINE:case TUTOR_TYPE$1.OVERLAY:view.$(".component__inner").append(new TutorView(options).$el);break;case TUTOR_TYPE$1.NONE:}}}__AMD("extensions/adapt-contrib-tutor/js/adapt-contrib-tutor",Adapt$1.tutor=new Tutor);class IconReplacement extends Backbone.Controller{initialize(){this.setupEventListeners()}setupEventListeners(){this.listenTo(Adapt$1,"adapt:start",this.setupCSS)}setupCSS(){const model=Adapt$1.config.get("_iconReplacement");if(!model)return;if(model._isEnabled===false)return;const items=model._items;if(_.isEmpty(items))return;let stylesheet='<style id="ir-styles">';const iconSelectors=[];_.each(items,(function(item){const iconsToReplace=item.icon_to_replace.split(",");_.each(iconsToReplace,(function(iconToReplace){let iconSelector=this.setIconClass(item.icon_class,iconToReplace);if(item.icon_to_replace===".nav__exit-btn"&&$("html").hasClass("confirm-exit")){iconSelector=".nav-course__exit-btn"}stylesheet+=iconSelector+':before{background-image:url("'+item.src+'");}';iconSelectors.push(iconSelector);if(item.icon_to_replace===".hotgraphic__pin .icon"){stylesheet+=".hotgraphic .hotgraphic__pin,.hotgraphic .hotgraphic__pin:hover,.hotgraphic .hotgraphic__pin.is-visited{background-color:transparent!important;border:none!important;}";stylesheet+=iconSelector+":before{left:0.3125rem!important;height:2.5rem!important;transform:none!important;width:2.5rem!important;}";stylesheet+=iconSelector+":after{display:none!important;}";stylesheet+="@media only screen and (min-width: 47.5rem){"+iconSelector+":before{height:3.125rem!important;width:3.125rem!important;}}"}}),this)}),this);const iconStyles=iconSelectors.join(",")+"{font-size:0!important;line-height:3.125rem;margin:0!important;padding:0!important;text-align:center;}";const iconPsuedoStyles=iconSelectors.join(":before,")+':before{background-position:center center;background-repeat:no-repeat;background-size:cover;box-sizing:border-box;content:""!important;display:inline-block!important;height:1.875rem;margin:0;vertical-align:middle;width:1.875rem;}';const iconMediaStyles="@media only screen and (min-width: 47.5rem){"+iconSelectors.join(":before,")+":before{height:2.5rem;margin:0;width:2.5rem;}}";stylesheet+=iconStyles+iconPsuedoStyles+iconMediaStyles+"</style>";if($("#ir-styles").length>0){return}$("head").append(stylesheet);$("html").addClass("has-icon-replacements")}setIconClass(itemClass,iconToReplace){if(itemClass!==""){return itemClass}if(iconToReplace===".nav__drawer-btn"){return".nav__drawer-btn .icon"}return iconToReplace}}__AMD("extensions/adapt-iconReplacement/js/iconReplacement",new IconReplacement);class IntroOutroTranscriptView extends Backbone__default["default"].View{className(){return"introoutro__transcript-container"}events(){return{"click button":"onClose"}}get template(){return"introOutroTranscriptView"}initialize(){_.bindAll(this,"postRender","setupDimensions","remove");this.setupDimensions();this.initialiseTranscriptPosition();this.listenTo(Adapt$1,"device:resize",this.onDeviceResize);this.render()}setupDimensions(){let $video=$("#introoutro__video");if($video[0].tagName!=="VIDEO"){$video=$video.find("iframe")}const hVideo=$video.height();const hWin=Adapt$1.device.screenHeight;this.videoHeight=hVideo>hWin/2?hWin/2:hVideo;this.videoOffset=this.model.get("_isFullscreen")?0:(Adapt$1.device.screenHeight-this.videoHeight)/2}initialiseTranscriptPosition(){if(this.model.get("_isFullscreen")){return}this.$el.css({top:this.videoOffset,bottom:Adapt$1.device.screenHeight-(this.videoHeight+this.videoOffset)})}onDeviceResize(){if(this.model.get("_isFullscreen")){return}this.setupDimensions();this.$el.css("top",this.videoHeight)}render(){const template=Handlebars.templates[this.template];const data=this.model.toJSON();this.$el.html(template(data));_.delay(this.postRender,32)}postRender(){if(this.model.get("_isFullscreen")){return}this.$el.css({top:this.videoHeight,bottom:0})}onClose(){if(!this.model.get("_isComplete")){this.initialiseTranscriptPosition()}Adapt$1.trigger("introOutro:closeTranscript");_.delay(this.remove,300)}removeTranscript(){this.remove()}}var IntroOutroTranscriptView$1=__AMD("extensions/adapt-introOutro/js/introOutroTranscriptView",IntroOutroTranscriptView);var DOWNLOAD_OPTION=__AMD("extensions/adapt-introOutro/js/enums/downloadOptionEnum",ENUM(["OVERLAY","TOOLBAR"],(function(value){if(typeof value==="string"){return value.toUpperCase()}return value})));class BrightcoveDownloadButtonView extends Backbone.View{el(){return this.model.el}events(){return{click:"handleClick"}}initialize(){this.isDownloadInProgress=false;this.model.downloadOption=Adapt$1.device.OS==="ios"?"disabled":this.model.downloadOption;switch(this.model.downloadOption){case DOWNLOAD_OPTION.OVERLAY:this.model.player.el_.appendChild(this.el);break;case DOWNLOAD_OPTION.TOOLBAR:const toolbar=this.model.player.controlBar.el_;const spacer=this.model.player.el_.querySelector(".vjs-custom-control-spacer");toolbar.insertBefore(this.el,spacer.nextSibling);break;default:return this.remove()}this.postRender()}postRender(){this.$progressLeft=this.$(".brightcoveplayer__download-progress-left-indicator");this.$progressRight=this.$(".brightcoveplayer__download-progress-right-indicator")}handleClick(){if(this.isDownloadInProgress){return}this.isDownloadInProgress=true;this.$progressRight.css({transform:"rotate(180deg)"});this.$el.addClass("downloading");var src=this.getHighestQualityVideo();this.downloadVideo(src)}getHighestQualityVideo(){var sources=this.model.player.mediainfo.sources;return sources.reduce((function(highestQuality,source){return source.container==="MP4"&&!!source.src&&source.size>highestQuality.size?source:highestQuality}),{size:0}).src}getVideoName(){return this.model.player.mediainfo.name.replace(/\s/g,"_")}downloadVideo(src){var xhr=new XMLHttpRequest;xhr.open("GET",src+"?"+Date.now(),true);xhr.responseType="blob";xhr.onload=this.onDownloadComplete.bind(this,xhr);xhr.onprogress=this.handleProgress.bind(this);xhr.send()}handleProgress(e){var percentageComplete=e.loaded/e.total*100;var degrees=360/100*percentageComplete;if(percentageComplete<=50){this.$progressLeft.hide();this.$progressRight.css({transform:"rotate("+(degrees-180)+"deg)"})}else{this.$progressLeft.show();this.$progressLeft.css({transform:"rotate("+degrees+"deg)"});this.$progressRight.css({transform:"rotate(0deg)"})}}onDownloadComplete(xhr){var name=this.getVideoName();download__default["default"](xhr.response,name,"video/mp4");this.isDownloadInProgress=false;this.$el.removeClass("downloading");this.$progressLeft.hide();this.model.onDownloadComplete&&this.model.onDownloadComplete()}}var BrightcoveDownloadButtonView$1=__AMD("extensions/adapt-introOutro/js/BrightcoveDownloadButtonView",BrightcoveDownloadButtonView);class BrightcoveVideoView extends Backbone.View{className(){return"brightcoveplayer__widget preload"}events(){return{"click div.brightcoveplayer__widget-social-sharing a":"handleSocialLinks"}}get template(){return"brightcoveVideo"}getSocialSharingConfig(){const isMobile=_.contains(["ios","android"],Adapt$1.device.OS);const isSpecialBrowser=_.contains(["firefox","safari"],Adapt$1.device.browser);const whatsappSubdomain=!isMobile&&isSpecialBrowser?"web":"api";return{Facebook:{title:"Facebook",href:"https://www.facebook.com/share.php?u={{shareUrl}}",icon:"facebook"},Google:{title:"Google+",href:"https://plus.google.com/share?url={{shareUrl}}",icon:"google-plus"},LinkedIn:{title:"LinkedIn",href:"https://www.linkedin.com/shareArticle?mini=true&url={{shareUrl}}",icon:"linkedin"},Pinterest:{title:"Pinterest",href:"https://pinterest.com/pin/create/button/?url={{shareUrl}}&description={{shareText}}",icon:"pintrest"},Twitter:{title:"Twitter",href:"https://twitter.com/intent/tweet?url={{shareUrl}}",icon:"twitter"},WhatsApp:{title:"WhatsApp",href:"https://"+whatsappSubdomain+".whatsapp.com/send?text={{shareText}}%20-%20{{shareUrl}}",icon:"whatsapp"}}}initialize(){this.model.brightcoveSource=this.getBrightcoveSource();this.model._downloadOption=DOWNLOAD_OPTION(this.model._downloadOption)||"disabled";this.setupSocialSharingLinks();if(!this.model._brightcovePlayer.canPlayLocal){return this.render()}this.setupLocalFile()}setupSocialSharingLinks(){const hasSocialSharing=this.model._socialSharing&&this.model._socialSharing.length>0;this.model.hasSocialSharing=hasSocialSharing||this.model._canCopyLinkToVideo;if(!hasSocialSharing){return}const socialSharingConfig=this.getSocialSharingConfig();this.model.socials=this.model._socialSharing.map((function(socialIdentifier){const social=socialSharingConfig[socialIdentifier];if(!social){return null}social.href=social.href.replace("{{shareUrl}}",encodeURIComponent(this.model.brightcoveSource));social.href=social.href.replace("{{shareText}}",this.model.title);return social}),this)}setupLocalFile(){const self=this;const localSource="course/assets/"+this.model._brightcovePlayer.videoId+".mp4";$.ajax({type:"HEAD",url:localSource}).done((function(){self.model.localVideoSource=localSource;self.render()})).fail((function(){self.model._brightcovePlayer.canPlayLocal=false;self.render()}))}render(){const template=Handlebars.templates[this.template];this.$el.html(template(this.model));const width=this.model.width||this.model._brightcovePlayer.width;if(width){this.$el.width(width)}_.defer(this.initialiseHeight.bind(this));if(!this.canPlayLocal){this.loadBrightcovePlayer()}}initialiseHeight(){const aspectRatio=this.model._brightcovePlayer.aspectRatio||"16:9";const ratios=aspectRatio.split(":").map((function(str){return parseInt(str)}));const $widgetInner=this.$(".brightcoveplayer__widget-inner");const h=$widgetInner.width()/ratios[0]*ratios[1];$widgetInner.height(h)}loadBrightcovePlayer(){this.$iframe=this.$("iframe");this.iframe=this.$iframe[0];this.checkIfPresentInDocument()}checkIfPresentInDocument(){if(this.iframe.contentDocument){this.loadIframeContent()}else{const pollInterval=200;return setTimeout(this.checkIfPresentInDocument.bind(this),pollInterval)}}loadIframeContent(){const template=Handlebars.templates.brightcoveDocument;const html=template(this.model);this.iframe.contentDocument.write(html);$(this.iframe.contentWindow).one("message",function(e){if(e.originalEvent.data==="playerReady"){this.onPlayerLoaded(this.iframe.contentWindow.__brightcoveplayer)}}.bind(this))}onPlayerLoaded(player){this.player=player;this.videoElement=this.$$("video")[0];this.setupEventListeners();this.setupDownloadButton();this.onDeviceResize();this.player.on("canplay",this.onDeviceResize.bind(this));_.defer(function(){this.$el.removeClass("preload");this.trigger("playerReady",player)}.bind(this))}setupEventListeners(){this.listenTo(Adapt$1,{"device:resize":this.onDeviceResize,remove:this.onRemove})}setupDownloadButton(){const buttonModel={downloadOption:this.model._downloadOption,label:this.model.globals.download,player:this.player,el:this.$$(".brightcoveplayer__download-btn")[0],onDownloadComplete:this.triggerGlobalEvent.bind(this,"download")};new BrightcoveDownloadButtonView$1({model:buttonModel})}handleSocialLinks(event){event&&event.preventDefault();const $target=$(event.currentTarget);if($target.attr("target")==="_blank"){window.open($target.attr("href"),"_blank","width=600,height=600");this.triggerGlobalEvent("share",{shareType:$target.attr("title")})}else{this.handleCopyLink()}}handleCopyLink(){const $copyText=$(".brightcoveplayer__widget-copy-link-textbox");const $viewLinkButton=$(".brightcoveplayer__widget-view-link-btn");const $copyLinkButton=$(".brightcoveplayer__widget-copy-link-btn");if($copyText.hasClass("u-display-none")){$copyText.removeClass("u-display-none").removeAttr("readonly").removeClass("is-disabled").focus().select();$viewLinkButton.addClass("u-display-none");$copyLinkButton.removeClass("u-display-none");return}try{if(Adapt$1.device.OS==="ios"){const range=document.createRange();range.selectNodeContents($copyText[0]);const selection=window.getSelection();selection.removeAllRanges();selection.addRange(range);$copyText[0].setSelectionRange(0,999999)}else{$copyText.focus().select()}const hasCopied=document.execCommand("copy");if(hasCopied){this.triggerGlobalEvent("share",{shareType:"copy"});Adapt$1.notify.push({body:this.model.globals.linkCopied,_classes:"link-copied-notification",_timeout:2e3})}else{Adapt$1.log.warn("Unable to copy Brightcove URL to clipboard")}}catch(e){Adapt$1.log.warn("Unable to copy Brightcove URL to clipboard")}_.defer((()=>{$copyText.addClass("u-display-none").attr("readonly","readonly").addClass("is-disabled");$viewLinkButton.removeClass("u-display-none");$copyLinkButton.addClass("u-display-none")}))}onDeviceResize(){const $video=$(this.videoElement);const $widgetInner=this.$(".brightcoveplayer__widget-inner");$video.css({maxHeight:"none"});_.delay(function(){const videoHeight=$video.height()||$widgetInner.height();const maxHeight=$(window).outerHeight()-this.$(".brightcoveplayer__footer").height();const height=videoHeight>maxHeight?maxHeight:videoHeight;$widgetInner.height(height);this.iframe.contentDocument.body.className=this.getIframeBodyClassName();$video.css({maxHeight:"100%"})}.bind(this),500)}onRemove(){if(this.player){this.player.dispose()}this.remove()}validateTimeString(timeAsString){return new RegExp(/(\d{1,2}[h])?[0-5]?[0-9][m][0-5]?[0-9][s]/g).test(timeAsString)}getBrightcoveSource(){const playerConfig=this.model._brightcovePlayer;let url=["https://players.brightcove.net",playerConfig.account,playerConfig.player+"_default","index.html?videoId="+playerConfig.videoId].join("/");if(this.validateTimeString(playerConfig.startTime)){url+="#t="+playerConfig.startTime}return url}getIframeBodyClassName(){this.className=Adapt$1.device.screenSize==="large"?"size-large":"size-small";if(this.model._downloadOption){this.className+=" download-"+this.model._downloadOption.asLowerCase}return this.className}$$(selector){return this.$iframe.contents().find(selector)}triggerGlobalEvent(eventType,data){Adapt$1.trigger("media",{isVideo:true,type:eventType,src:this.getBrightcoveSource(),platform:"brightcove",data:data||{}})}}var BrightcoveVideoView$1=__AMD("extensions/adapt-introOutro/js/BrightcoveVideoView",BrightcoveVideoView);var OUTRO_EVENT_TRIGGER=__AMD("extensions/adapt-introOutro/js/enums/eventOutroTriggerEnum",ENUM(["COURSE","ASSESSMENT","LEARNINGOBJECTIVES"],(function(value){if(typeof value==="string"){return value.toUpperCase()}return value})));var SOURCE_TYPE=__AMD("extensions/adapt-introOutro/js/enums/sourceTypeEnum",ENUM(["FILE","VIMEO","BRIGHTCOVE"],(function(value){if(typeof value==="string"){return value.toUpperCase()}return value})));class IntroOutroView extends Backbone.View{events(){return{"click button.introoutro__skip":"onSkipButtonClicked","click button.introoutro__transcript-open":"onTranscriptOpenButtonClicked","click button.introoutro__transcript-link":"onTranscriptLinkButtonClicked"}}initialize(){this.id="introoutro";this.className="introoutro";this.transcriptTransitionTime=300;this.maxTime=0;this.lastEvent={time:0,type:""};Adapt$1.a11y.scrollDisable($("body"));_.bindAll(this,"resizeVideo","onVideoStarted","onVideoComplete","onVideoError","onVideoTimeUpdate","onVideoSeeking");this.setupModel();this.setupTranscript();this.setupEventListeners();this.render()}setupModel(){const isDevice=Adapt$1.device.OS==="ios"||Adapt$1.device.OS==="android";this.model.set({_sourceConfig:this.getSourceConfig(),_shouldUseIcons:isDevice&&this.model.get("_buttons")._shouldUseIconsOnDevices,_isFullscreen:this.getTypeProperty("PlayFullscreen"),_isComplete:false})}setupTranscript(){const transcript=this.getTypeProperty("Transcript");if(transcript.inlineTranscript||transcript.transcriptLink){this.model.set({transcript:transcript})}else{this.model.unset("transcript")}}setupEventListeners(){this.listenTo(Adapt$1,{"device:resize":_.debounce(this.resizeVideo,250),"introOutro:closeTranscript":this.closeTranscript})}sourceError(){console.log("Cannot create "+this.constructor.name+". Either no video sources have been supplied, or none of those suppiled are compatible with this browser");_.defer(_.bind(this.remove,this));return false}getSourceConfig(){const fileSources=this.getAvailableVideoFileSources();if(fileSources.length>0){return{sourceType:SOURCE_TYPE.FILE,sources:fileSources}}const externalSrc=this.getTypeProperty("Video_ext");if(externalSrc){return this.getExternalSourceConfig(externalSrc)}const bcConfig=this.getTypeProperty("Video_bc")||{};const playerConfig=bcConfig._brightcovePlayer;if(playerConfig&&playerConfig.videoId&&playerConfig.account&&playerConfig.player){const globals=Adapt$1.course.get("_globals");let title=Adapt$1.course.get("displayTitle")||Adapt$1.course.get("title");if(this.model.get("_type")==="outro"){title+=" - "+globals._accessibility._ariaLabels.complete}return _.extend({},bcConfig,{sourceType:SOURCE_TYPE.BRIGHTCOVE,globals:globals._extensions._introOutro,title:title,_cc:this.getSubtitles()})}return this.sourceError()}getSourceType(){return this.model.get("_sourceConfig").sourceType}getSubtitles(){const propName="_"+this.model.get("_type")+"Transcript";return this.model.get(propName)._cc||null}getExternalSourceConfig(url){const re={youTube:/(?:https?:\/\/)?(?:www\.)?(?:youtu\.be\/|youtube\.com(?:\/embed\/|\/v\/|\/watch\?v=|\/watch\?.+&v=))([\w-]{11})(?:.+)?$/,vimeo:/https?:\/\/(?:www\.)?(player.)?vimeo.com\/(video\/)?(?:channels\/(?:\w+\/)?|groups\/([^\/]*)\/videos\/|album\/(\d+)\/video\/|)(\d+)(?:$|\/|\?)/};const matches=url.match(re.vimeo);if(matches){if(Adapt$1.device.browser.toLowerCase()==="internet explorer"&&parseInt(Adapt$1.device.version)<=9){return this.sourceError()}if(matches[3]){return{sourceType:SOURCE_TYPE.VIMEO,playerId:matches[3],url:url}}if(matches[5]){return{sourceType:SOURCE_TYPE.VIMEO,playerId:matches[5],url:url}}}return false}getAvailableVideoFileSources(){const sources=[];_.each(this.getSupportedVideoExtensions(),(function(ext){const source=this.getTypeProperty("Video_"+ext);if(source){sources.push({src:source,type:"video/"+ext})}}),this);return sources}getSupportedVideoExtensions(){return["ogv","mp4","webm"]}isVideoExtensionSupported(extension){return _.contains(this.getSupportedVideoExtensions(),extension)}getExtensionFromSrc(src){const re=/(?:\.([^.]+))?$/;return re.exec(src)[1]}setupPlayerType(sourceConfig){const setPlayer=_.bind((function(player){this.player=player;if(this.player&&this.player.autoplay===true){this.player.play().catch(this.onAutoplayBlocked.bind(this,sourceConfig.sourceType))}else{this.onAutoplayBlocked(sourceConfig.sourceType)}this.setupListenersOnPlayer(sourceConfig.sourceType);return player}),this);switch(sourceConfig.sourceType){case SOURCE_TYPE.BRIGHTCOVE:const view=new BrightcoveVideoView$1({model:sourceConfig});view.$el.appendTo("#introoutro__video");this.listenToOnce(view,"playerReady",(function(){setPlayer(view.videoElement);if(Adapt$1.device.OS==="android"||Adapt$1.device.OS==="ios"){const delayTime=600;setTimeout(function(){window.scrollTo(0,this.$(".brightcoveplayer__widget").offset().top)}.bind(this),delayTime)}}));this.brightcoveView=view;break;case SOURCE_TYPE.VIMEO:const options={autoplay:true,id:this.model.get("_sourceConfig").playerId,width:1920};if(Adapt$1.device.browser.toLowerCase()==="internet explorer"&&!this.model.get("_canSkip")){$(".introoutro__iframe-container").append('<div class="introoutro__seek-overlay"></div>')}require(["libraries/player.min"],(function(Player){setPlayer(new Player("introoutro__video",options))}));break;case SOURCE_TYPE.FILE:setPlayer(document.getElementById("introoutro__video"));break}}getTypeProperty(prop){const type=this.model.get("_type");return this.model.get("_"+type+prop)}resizeVideo(){let $video=$("#introoutro__video");if(this.model.get("_isFullscreen")&&!this.model.get("_isTranscriptOpen")){$video.width($(window).width()).height(Adapt$1.device.screenHeight)}else{$video[0].removeAttribute("style")}}render(){const template=Handlebars.templates.introOutroView;const data=this.getTemplateData();this.$el.addClass(this.getClasses(data));this.$el.html(template(data));_.defer(this.postRender.bind(this,data))}getTemplateData(){let data=this.model.toJSON();data[data._sourceConfig.sourceType.asString]=true;return _.extend(data,{hasButtons:!!data.transcript||this.model.get("_canSkip"),captions:this.getTypeProperty("Transcript")._cc||[]})}getClasses(templateData){const classes=[this.className,templateData._type," source-"+templateData._sourceConfig.sourceType.asLowerCase];const fullscreenClassName=this.model.get("_isFullscreen")?"fullscreen":"fullscreen-disabled";const transcript=this.model.get("transcript");classes.push(fullscreenClassName);if(transcript){classes.push("has-transcript")}if(templateData.captions&&templateData.captions.length>0){classes.push("has-captions")}return classes.join(" ")}postRender(data){this.setupPlayerType(data._sourceConfig);this.resizeVideo();this.model.get("_shouldUseIcons")&&this.setupIcons()}onAutoplayBlocked(sourceType){if(sourceType===SOURCE_TYPE.BRIGHTCOVE){return}const $playButton=$("<button class='introoutro__play-btn base'></button>");$playButton.click(function(){this.player.play()}.bind(this));this.$el.append($playButton);this.listenToOnce(Adapt$1,"introOutro:videoStarted",(function(){$playButton.remove()}))}setupIcons(){$("button.introoutro__action").each((function(){this.setAttribute("aria-label",this.innerHTML);this.innerHTML="";this.className+=" icon"}))}setupListenersOnPlayer(sourceType){const player=sourceType===SOURCE_TYPE.FILE||sourceType===SOURCE_TYPE.BRIGHTCOVE?$(this.player):this.player;const events=this.getEventMap(sourceType);player.on(events.play,this.onVideoStarted);player.on(events.pause,this.queueMediaEvent.bind(this,"pause"));player.on(events.ended,this.onVideoComplete);player.on(events.error,this.onVideoError);if(!this.model.get("_canSkip")){player.on(events.timeupdate,_.debounce((e=>{this.onVideoTimeUpdate(e)})));player.on(events.seek,this.onVideoSeeking)}}getEventMap(sourceType){const isVimeo=sourceType===SOURCE_TYPE.VIMEO;const seek=isVimeo?"seeked":"seeking";return{play:"play",pause:"pause",ended:"ended",error:"error",timeupdate:"timeupdate",seek:seek}}onVideoStarted(e){this.queueMediaEvent("play");Adapt$1.trigger("introOutro:videoStarted",this)}onVideoComplete(e){this.queueMediaEvent("ended");this.model.set("_isComplete",true);if(this.model.get("_isTranscriptOpen")){this.listenToOnce(this.model,"change:_isTranscriptOpen",this.onVideoComplete)}else{Adapt$1.trigger("introOutro:videoCompleted",this)}}onVideoError(e){console.log("An unexpected error occurred: "+e.message)}onVideoTimeUpdate(e){const t=this.getEventTime(e);if(t-this.maxTime<1&&!this.model.get("_canSkip")){this.maxTime=t}}onVideoSeeking(e){const t=this.getEventTime(e);if(t-this.maxTime>1&&!this.model.get("_canSkip")){this.setCurrentTime(this.maxTime)}}getEventTime(e){switch(this.getSourceType()){case SOURCE_TYPE.VIMEO:return e.seconds;case SOURCE_TYPE.BRIGHTCOVE:case SOURCE_TYPE.FILE:return this.player.currentTime}}setCurrentTime(t){switch(this.getSourceType()){case SOURCE_TYPE.VIMEO:this.player.setCurrentTime(t).then(function(){this.player.play()}.bind(this));break;case SOURCE_TYPE.FILE:default:this.player.currentTime=t}}onSkipButtonClicked(){Adapt$1.trigger("introOutro:hideVideo",this)}onTranscriptLinkButtonClicked(){const url=this.model.get("transcript").transcriptLink;window.open(url,"_blank");if(this.model.get("transcript")._setCompletionOnView){this.revealSkipButton()}}onTranscriptOpenButtonClicked(){this.model.get("_isTranscriptOpen")?this.closeTranscript():this.openTranscript()}openTranscript(){this.model.set("_isTranscriptOpen",true);this.transcriptTransition(this.transcriptTransitionTime);this.$el.addClass("show-transcript");new IntroOutroTranscriptView$1({model:this.model}).$el.appendTo(this.$el);const isMobile=_.contains(["ios","android"],Adapt$1.device.OS);if(isMobile&&this.brightcoveView){this.$(".brightcoveplayer__widget-inner").css("height","")}if(this.model.get("_canSkip")||!this.model.get("transcript")._setCompletionOnView){return}setTimeout(this.revealSkipButton,this.transcriptTransitionTime/2)}closeTranscript(){this.model.set("_isTranscriptOpen",false);if(this.model.get("_isComplete")){return}this.transcriptTransition(this.transcriptTransitionTime);this.$el.removeClass("show-transcript");this.resizeVideo()}transcriptTransition(transitionTime){const video=document.getElementById("introoutro__video");video.removeAttribute("style");video.controls=false;const $el=this.$el;const transitionClassName="transition-in-progress";$el.addClass(transitionClassName);_.delay((()=>{video.controls=true;$el.removeClass(transitionClassName)}),transitionTime)}revealSkipButton(){const $skip=this.$(".introoutro__skip-container");$skip.width($skip.children().outerWidth(true))}queueMediaEvent(eventType){const t=Date.now();const timeSinceLastEvent=t-this.lastEvent.time;const debounceTime=500;this.lastEvent={time:t,type:eventType};clearTimeout(this.eventTimeout);if(eventType==="ended"){return this.triggerMediaEvent(eventType)}if(timeSinceLastEvent>debounceTime){this.eventTimeout=setTimeout(this.triggerMediaEvent.bind(this,eventType),debounceTime)}}triggerMediaEvent(eventType){const sourceConfig=this.model.get("_sourceConfig");const sourceType=sourceConfig.sourceType;if(!sourceType){return}Adapt$1.trigger("media",{isVideo:true,type:eventType,src:this.getSrc(sourceConfig),platform:sourceType===SOURCE_TYPE.FILE?"native":sourceType.asLowerCase})}getSrc(sourceConfig){switch(sourceConfig.sourceType){case SOURCE_TYPE.FILE:return this.player.currentSrc;case SOURCE_TYPE.VIMEO:return sourceConfig.url;case SOURCE_TYPE.BRIGHTCOVE:return this.brightcoveView.getBrightcoveSource();default:return null}}remove(){if(this.brightcoveView){this.brightcoveView.remove()}Backbone.View.prototype.remove.apply(this,arguments);Adapt$1.a11y.scrollEnable($("body"))}outroTriggerConditionMet(){const outroTriggerConfig=Adapt$1.course.get("_introOutro").get("_triggerOutroVideo")||"course";const outroTrigger=OUTRO_EVENT_TRIGGER(outroTriggerConfig);switch(outroTrigger){case OUTRO_EVENT_TRIGGER.COURSE:{return Adapt$1.course.get("_isComplete")}case OUTRO_EVENT_TRIGGER.ASSESSMENT:{return Adapt$1.assessment._assessments.every((assessment=>assessment.get("_isPass")&&assessment.get("_isComplete")))}case OUTRO_EVENT_TRIGGER.LEARNINGOBJECTIVES:{return Adapt$1.course.get("_introOutro").outroVideoShown||false}}}}var IntroOutroView$1=__AMD("extensions/adapt-introOutro/js/introOutroView",IntroOutroView);class IntroOutroViewHelper{static canShowVideo(type,config){if(!_.contains(["intro","outro"],type)){throw new Error("'type' parameter must be either 'intro' or 'outro'")}if(!(config instanceof Backbone__default["default"].Model)){throw new Error("'config' parameter must be a Backbone.Model instance")}if(!config.get("_"+type+"IsEnabled")){return false}if(config.get("_"+type+"Video_mp4")||config.get("_"+type+"Video_webm")||config.get("_"+type+"Video_ogv")){return true}if(config.get("_"+type+"Video_ext")){return true}var bcConfig=config.get("_"+type+"Video_bc")||{};var playerConfig=bcConfig._brightcovePlayer;return playerConfig&&playerConfig.videoId&&playerConfig.account&&playerConfig.player}}var IntroOutroViewHelper$1=__AMD("extensions/adapt-introOutro/js/introOutroViewHelper",IntroOutroViewHelper);class IntroOutroReplayDrawerView extends Backbone__default["default"].View{events(){return{"click button.replay-intro-video":"onReplayIntroClick","click button.replay-outro-video":"onReplayOutroClick"}}get template(){return"introOutroReplayDrawerView"}initialize(options){this.tagName="div";this.className="introoutro__replay-drawer";this.model=options.model;const outroTriggerConfig=Adapt$1.course.get("_introOutro")._triggerOutroVideo||"course";this.outroTrigger=OUTRO_EVENT_TRIGGER(outroTriggerConfig);this.render();this.listenTo(Adapt$1,"remove",this.remove)}render(){const data={shouldShowIntro:this.shouldShowIntro(),shouldShowOutro:this.shouldShowOutro()};if(!data.shouldShowIntro&&!data.shouldShowOutro){return}data._globals=Adapt$1.course.get("_globals")._extensions._introOutro||{};const template=Handlebars.templates[this.template];this.$el.html(template(data))}onReplayIntroClick(){Adapt$1.trigger("introOutro:replayIntroVideo",true,true)}onReplayOutroClick(){Adapt$1.trigger("introOutro:replayOutroVideo")}shouldShow(type){let introOutroConfig=Adapt$1.course.get("_introOutro");if(!(introOutroConfig instanceof Backbone__default["default"].Model)){introOutroConfig=new Backbone__default["default"].Model(Adapt$1.course.get("_introOutro"))}return IntroOutroViewHelper$1.canShowVideo(type,introOutroConfig)}shouldShowIntro(){return this.shouldShow("intro")}shouldShowOutro(){if(this.shouldShow("outro")){return IntroOutroView$1.prototype.outroTriggerConditionMet()}return false}}var IntroOutroReplayDrawerView$1=__AMD("extensions/adapt-introOutro/js/introOutroReplayDrawerView",IntroOutroReplayDrawerView);class IntroOutroNavigationView extends Backbone__default["default"].View{attributes(){return{"aria-hidden":"false","aria-label":Adapt$1.course.get("_globals")._extensions._introOutro.replayVideoDrawer,tabindex:"0"}}className(){return"nav__btn introoutro__replay-icon base icon"}events(){return{click:"onClick"}}tagName(){return"button"}initialize(){this.listenTo(Adapt$1,"remove",this.remove);this.render()}render(){this.$el.insertAfter(".js-nav-drawer-btn");return this}onClick(){Adapt$1.drawer.triggerCustomView(new IntroOutroReplayDrawerView$1({model:this.model}).$el,false)}}var IntroOutroNavigationView$1=__AMD("extensions/adapt-introOutro/js/introOutroNavigationView",IntroOutroNavigationView);class IntroOutro extends Backbone.Controller{initialize(){if(this.initialised){return}this.config=new Backbone.Model(Adapt$1.course.get("_introOutro"));this.config.on("change",this.onConfigChange.bind(this));if(!this.config){return}this.globals=Adapt$1.course.get("_globals")._extensions._introOutro||{};Adapt$1.on("introOutro:videoStarted",(()=>{this.setVideoViewed(this.config.get("_type"))}));Adapt$1.on("introOutro:videoCompleted",(()=>{Adapt$1.trigger("introOutro:hideVideo")}));Adapt$1.on("introOutro:replayIntroVideo",((force,canSkip)=>{if(force===true){this.config.set({_introIsEnabled:true})}canSkip=canSkip===true?true:null;this.showVideo("intro",canSkip)}));Adapt$1.on("introOutro:replayOutroVideo",(()=>{this.showVideo("outro")}));Adapt$1.on("introOutro:hideVideo",(()=>{this.hideVideo()}));this.listenTo(Adapt$1,"pageView:ready menuView:ready router:plugin",this.setupReplayButtons);this.listenToOnce(Adapt$1,{"introOutro:outro-play":this.triggerOutroVideo,"change:_isStarted":this.setupTriggerForOutroVideo});this.setupTriggerForOutroVideo();this.initialised=true;this.showIntroVideo()}onConfigChange(){this.setupReplayButtons();Adapt$1.course.set("_introOutro",this.config)}showVideo(type,canSkip,shouldFadeIn){if(!_.contains(["intro","outro"],type)){throw new Error("'type' parameter must be either 'intro' or 'outro'")}try{canSkip=_.isBoolean(canSkip)?canSkip:this.canSkipVideo(type);shouldFadeIn=_.isBoolean(shouldFadeIn)?shouldFadeIn:true;if(this.view){return}this.config.set({_type:type,_canSkip:canSkip||false});this.view=new IntroOutroView$1({model:this.config});const show=function(){$("html").append(this.view.$el).addClass("adapt-introoutro");if(canSkip){setTimeout((function(){$(".introoutro__skip").focus()}),500)}};if(shouldFadeIn){this.view.$el.css("display","none");_.bind(show,this)();this.view.$el.fadeIn(400)}else{_.bind(show,this)()}}catch(err){console.log("error",err)}this.toggleAccessibleContent(false,1e3)}toggleAccessibleContent(accessible,time){setTimeout((function(){a11y$1.toggleAccessibleEnabled(".menu-item__link",accessible);a11y$1.toggleAccessibleEnabled(".nav__inner button",accessible)}),time)}showIntroVideo(){if(!IntroOutroViewHelper$1.canShowVideo("intro",this.config)){return}this.showVideo("intro")}showOutroVideo(){if(!IntroOutroViewHelper$1.canShowVideo("outro",this.config)){return}Adapt$1.course.get("_introOutro").outroVideoShown=true;this.showVideo("outro")}canSkipVideo(type){if(type==="outro"){return true}if(!this.getVideoViewed(type)&&this.config.get("_introForceViewing")){return false}return true}hideVideo(shouldFadeOut){this.config.set("_isTranscriptOpen",false);if(!this.view){return}shouldFadeOut=_.isBoolean(shouldFadeOut)?shouldFadeOut:true;const hide=function(){this.view.remove();$("html").removeClass("adapt-introoutro");this.view=null;this.initialised=false};if(shouldFadeOut){this.view.$el.fadeOut(400,_.bind(hide,this))}else{_.bind(hide,this)()}this.toggleAccessibleContent(true,50)}setupReplayButtons(){if(!this.config.get("_showReplayButtons")||!_.contains(["navigation-bar"],this.config.get("_showReplayButtons"))){return}if(!IntroOutroViewHelper$1.canShowVideo("intro",this.config)&&!IntroOutroViewHelper$1.canShowVideo("outro",this.config)){return}if(!this.config.get("_showReplayButtons")==="navigation-bar"){return}this.setupNavigationView()}getVideoViewed(type){if(!Adapt$1.offlineStorage){return false}return Adapt$1.offlineStorage.get(Adapt$1.course.get("_language")+"_"+type+"_video_viewed")||false}setVideoViewed(type){if(!Adapt$1.offlineStorage){return}Adapt$1.offlineStorage.set(Adapt$1.course.get("_language")+"_"+type+"_video_viewed",true)}triggerOutroVideo(){if(!IntroOutroViewHelper$1.canShowVideo("outro",this.config)){return}let outroDelay=this.config.get("_outroDelay");if(!_.isNumber(outroDelay)||outroDelay<0){outroDelay=0}else if(outroDelay>30){outroDelay=30}if(outroDelay==0){return this.showOutroVideo()}let delayTimeout;const showVideo=_.bind((function(){clearTimeout(delayTimeout);window.clearInterval(this.updateInterval);this.showOutroVideo()}),this);delayTimeout=_.delay((function(){showVideo()}),outroDelay*1e3);Adapt$1.on("introOutro:pushNotify:clicked",(function(){showVideo()}));this.showNotification(outroDelay)}showNotification(outroDelay){const getPushMessage=_.bind((function(){const message=this.globals.outroDelayCountdown;return message.replace(/{{number}}/i,outroDelay)}),this);this.listenTo(Adapt$1,"notify:pushShown",_.bind((function(){this.stopListening(Adapt$1,"notify:pushShown");$(".notify-push").append(`<span aria-live="polite">${this.globals.outroDelayAriaLabel}</span>`);const areMultipleNotificationsVisible=$(".notify-push").length>1;if(areMultipleNotificationsVisible){$(".notify-push:last").addClass("outro__notify")}const updateToast=function(){outroDelay--;const selector=areMultipleNotificationsVisible?".outro__notify":"";$(selector+".notify-push .notify-push__body-inner").html(getPushMessage())};this.updateInterval=setInterval(updateToast,1e3)}),this));Adapt$1.notify.push({body:getPushMessage(),_callbackEvent:"introOutro:pushNotify:clicked",_timeout:outroDelay*1e3})}uninitialize(){if(this.view instanceof Backbone.View){this.view.remove()}this.view=null;if(this.navigationView instanceof Backbone.View){this.navigationView.remove()}this.navigationView=null;this.stopListening(Adapt$1,"pageView:ready menuView:ready router:plugin")}setupNavigationView(){this.navigationView&&this.navigationView.remove();this.navigationView=new IntroOutroNavigationView$1({model:this.config})}objectiveCompleted(objective){const triggerObjectiveIndex=_.findIndex(this.objectivesToComplete,(function(objectiveTrigger){return objectiveTrigger._learningObjectiveCode===objective._code}));if(triggerObjectiveIndex<0){return}this.objectivesToComplete.splice(triggerObjectiveIndex,1);if(this.objectivesToComplete.length===0){_.defer((()=>{Adapt$1.trigger("introOutro:outro-play")}))}}setupTriggerForOutroVideo(){if(!this.config.get("_outroIsEnabled"))return;if(!Adapt$1.get("_isStarted"))return;if(Adapt$1.get("_outstandingCompletionChecks")!==0)return;const outroTriggerConfig=this.config.get("_triggerOutroVideo")||"course";const outroTrigger=OUTRO_EVENT_TRIGGER(outroTriggerConfig);switch(outroTrigger){case OUTRO_EVENT_TRIGGER.COURSE:{this.listenTo(Adapt$1.course,"change:_isComplete",this.handleCoursePropChange);break}case OUTRO_EVENT_TRIGGER.ASSESSMENT:{Adapt$1.on("assessments:complete",this.handleAssessmentChange.bind(this));break}case OUTRO_EVENT_TRIGGER.LEARNINGOBJECTIVES:{this.objectivesToComplete=this.config.get("outroVideoLearningObjectivesTrigger");if(this.objectivesToComplete.length>0){this.listenTo(Adapt$1,"learningObjective:complete",this.objectiveCompleted);return}}}}handleAssessmentChange(state,model){if(state.id!==model.get("_assessment")._id)return;if(!model.get("_isPass"))return;this.triggerOutroVideo()}handleCoursePropChange(model,value){if(value===true)this.triggerOutroVideo()}}Adapt$1.on("app:dataReady",(()=>{const config=Adapt$1.course.get("_introOutro");Adapt$1.on("introOutro:initialize",(()=>{const introOutro=new IntroOutro;const init=()=>{introOutro.uninitialize();introOutro.initialize()};Adapt$1.on("app:languageChanged",init)}));if(!config||!config._introIsEnabled&&!config._outroIsEnabled){return}Adapt$1.trigger("introOutro:initialize")}));__AMD("extensions/adapt-introOutro/js/index",IntroOutro);var SearchDrawerItemView=__AMD("extensions/adapt-search/js/searchDrawerItemView",class SearchDrawerItemView extends Backbone.View{className(){return"search"}events(){return{"click .js-search-textbox-change":this.onSearch,"keyup .js-search-textbox-change":this.onSearch}}initialize(options){this.listenTo(Adapt$1,"drawer:empty",this.remove);this.render();this.search=_.debounce(this.onSearch.bind(this),1e3);if(!options.query)return;this.$(".js-search-textbox-change").val(options.query)}render(){const data=this.model.toJSON();const template=Handlebars.templates.searchBox;this.$el.html(template(data));return this}onSearch(event){if(event&&event.preventDefault)event.preventDefault();const query=this.$(".js-search-textbox-change").val();Adapt$1.trigger("search:query",query)}});const WORD_CHARACTERS=["A-Z","0-9","a-z","","","","-","-","-","-","-","","","-","","","-","","-","","-","-","-","-","-","","-","-","-","-","","","-","","","","","","-","","","-","-","","-","","","","-","","","","-","","-","-","","","-","-","-","-","","","-","-","","-","","","","","-","","","-","","","-","-","","","","","","","-","","-","-","-","-","-","","","-","","","","","-","","","-","-","","","-","","","","-","","","-","-","-","","","","","","","","-","-","","-","-","-","-","-","","","","","","-","-","-","-","-","","","","","","","-","-","-","","","","","-","-","-","-","","-","-","","","-","","","","","","","","-","-","-","","","","","-","","","","-","","-","","-","-","-","-","","-","-","","","","-","-","","-","","","-","-","-","-","","-","-","-","-","-","-","","-","-","-","-","-","-","-","-","-","-","-","-","-","-","-","-","-","-","","","-","-","","-","-","-","-","-","-","-","-","","-","-","-","","","-","-","-","-","-","-","","","-","-","-","-","-","-","","","","-","-","-","","-","-","-","-","-","-","-","","","-","","","-","","-","","","","-","-","-","-","","","","-","-","-","-","","","-","","","-","","-","-","-","-","-","-","-","-","-","","","","-","","","-","-","-","-","-","-","-","-","-","-","-","-","-","-","","","-","-","-","-","-","-","-","-","-","-","-","-","-","-","-","","-","-","-","-","","-","-","-","-","","-","","","","-","","","-","-","-","-","-","-","-","-","-","-","-","-","-","-","-","-","","-","-","-","","","","","","-","-","-","-","-","-","-","-","-","-","-","-","-","-"].join("");var WORD_CHARACTERS$1=__AMD("extensions/adapt-search/js/WORD_CHARACTERS",WORD_CHARACTERS);var escapeRegExp=__AMD("extensions/adapt-search/js/escapeRegExp",(function escapeRegExp(str){return str.replace(/[-[\]/{}()*+?.\\^$|]/g,"\\$&")}));const accentedCharacterMap=[{base:"A",letters:"A"},{base:"AA",letters:""},{base:"AE",letters:""},{base:"AO",letters:""},{base:"AU",letters:""},{base:"AV",letters:""},{base:"AY",letters:""},{base:"B",letters:"B"},{base:"C",letters:"C"},{base:"D",letters:"D"},{base:"DZ",letters:""},{base:"Dz",letters:""},{base:"E",letters:"E"},{base:"F",letters:"F"},{base:"G",letters:"G"},{base:"H",letters:"H"},{base:"I",letters:"I"},{base:"J",letters:"J"},{base:"K",letters:"K"},{base:"L",letters:"L"},{base:"LJ",letters:""},{base:"Lj",letters:""},{base:"M",letters:"M"},{base:"N",letters:"N"},{base:"NJ",letters:""},{base:"Nj",letters:""},{base:"O",letters:"O"},{base:"OI",letters:""},{base:"OO",letters:""},{base:"OU",letters:""},{base:"P",letters:"P"},{base:"Q",letters:"Q"},{base:"R",letters:"R"},{base:"S",letters:"S"},{base:"T",letters:"T"},{base:"TZ",letters:""},{base:"U",letters:"U"},{base:"V",letters:"V"},{base:"VY",letters:""},{base:"W",letters:"W"},{base:"X",letters:"X"},{base:"Y",letters:"Y"},{base:"Z",letters:"Z"},{base:"a",letters:"a"},{base:"aa",letters:""},{base:"ae",letters:""},{base:"ao",letters:""},{base:"au",letters:""},{base:"av",letters:""},{base:"ay",letters:""},{base:"b",letters:"b"},{base:"c",letters:"c"},{base:"d",letters:"d"},{base:"dz",letters:""},{base:"e",letters:"e"},{base:"f",letters:"f"},{base:"g",letters:"g"},{base:"h",letters:"h"},{base:"hv",letters:""},{base:"i",letters:"i"},{base:"j",letters:"j"},{base:"k",letters:"k"},{base:"l",letters:"l"},{base:"lj",letters:""},{base:"m",letters:"m"},{base:"n",letters:"n"},{base:"nj",letters:""},{base:"o",letters:"o"},{base:"oi",letters:""},{base:"ou",letters:""},{base:"oo",letters:""},{base:"p",letters:"p"},{base:"q",letters:"q"},{base:"r",letters:"r"},{base:"s",letters:"s"},{base:"t",letters:"t"},{base:"tz",letters:""},{base:"u",letters:"u"},{base:"v",letters:"v"},{base:"vy",letters:""},{base:"w",letters:"w"},{base:"x",letters:"x"},{base:"y",letters:"y"},{base:"z",letters:"z"}];const flattedAccentedCharacters=accentedCharacterMap.reduce(((flattedAccentedCharacters,item)=>{item.letters.split("").forEach((letter=>{flattedAccentedCharacters[letter]=item.base;return flattedAccentedCharacters}));return flattedAccentedCharacters}),{});var replaceAccents=__AMD("extensions/adapt-search/js/replaceAccents",(function replaceAccents(str){const accentReplacer=function(chr){return flattedAccentedCharacters[chr]||chr};return str.replace(/\S/g,accentReplacer)}));var SearchResultsView=__AMD("extensions/adapt-search/js/searchResultsView",class SearchResultsView extends Backbone.View{className(){return"search__items-container is-inactive"}events(){return{"click [data-id]":"navigateToResultPage"}}initialize({searchObject:searchObject=null}={}){this.listenTo(Adapt$1,{"drawer:empty":this.remove,"search:queried":this.updateResults});this.render();if(!searchObject)return;this.updateResults(searchObject)}render(){const template=Handlebars.templates.searchResults;$(this.el).html(template());return this}updateResults(searchObject){this.$el.removeClass("is-inactive");const formattedResults=this.formatResults(searchObject);this.renderResults(formattedResults)}formatResults(searchObject){const stripHTMLAndHandlebars=text=>{const replaceTagsRegEx=/<{1}[^>]+>/g;const replaceEscapedTagsRegEx=/&lt;[^&gt;]+&gt;/g;const replaceEndTagsRegEx=/<{1}\/{1}[^>]+>/g;const replaceEscapedEndTagsRegEx=/&lt;\/[^&gt;]+&gt;/g;const replaceHandlebarsRegEx=/{{[^}}]*/g;const replaceHandlebarsEndRegEx=/}}/g;text=$(`<span>${text}</span>`).html();return text.replace(replaceEndTagsRegEx," ").replace(replaceTagsRegEx,"").replace(replaceEscapedEndTagsRegEx," ").replace(replaceEscapedTagsRegEx,"").replace(replaceHandlebarsRegEx," ").replace(replaceHandlebarsEndRegEx,"").trim()};const checkSkipTitlePhrases=(title,result)=>result.foundPhrases.find((foundPhrase=>{const lowerPhrase=stripHTMLAndHandlebars(foundPhrase.phrase).toLowerCase();const lowerTitle=title.toLowerCase();const isNotTitle=lowerPhrase!==lowerTitle;return isNotTitle}))||result.foundPhrases[result.foundPhrases.length-1];const makeTextPreview=result=>{const numberOfPreviewCharacters=this.model.get("_previewCharacters");const numberOfPreviewWords=this.model.get("_previewWords");const bodyPrettify=new RegExp(`(([^${WORD_CHARACTERS$1}]*[${WORD_CHARACTERS$1}]{1}){1,${numberOfPreviewWords*2}}|.{0,${numberOfPreviewCharacters*2}})`,"i");const title=stripHTMLAndHandlebars(result.model.get("_search")?.title||"")||stripHTMLAndHandlebars(result.model.get("title"))||stripHTMLAndHandlebars(result.model.get("displayTitle"))||"No title found";const safeTitle=replaceAccents(title);const body=stripHTMLAndHandlebars(result.model.get("body"))||"";const hasNoFoundPhrases=result.foundPhrases.length===0;if(hasNoFoundPhrases){const textPreview=body.match(bodyPrettify)[0]+"...";return[title,textPreview]}const foundPhrase=checkSkipTitlePhrases(title,result);const phrase=stripHTMLAndHandlebars(foundPhrase.phrase);const safePhrase=stripHTMLAndHandlebars(foundPhrase.safePhrase);const lowerPhrase=safePhrase.toLowerCase();const lowerTitle=safeTitle.toLowerCase();if(lowerPhrase===lowerTitle){const textPreview=body.match(bodyPrettify)[0]+"...";return[title,textPreview]}const word=result.foundWords.slice(0).sort(((a,b)=>a.count-b.count)).find((({word:word})=>lowerPhrase.includes(word))).word;const snippetMatcher=new RegExp(`(([^${WORD_CHARACTERS$1}]*[${WORD_CHARACTERS$1}]{1}){1,${numberOfPreviewWords}}|.{0,${numberOfPreviewCharacters}})${escapeRegExp(word)}(([${WORD_CHARACTERS$1}]{1}[^${WORD_CHARACTERS$1}]*){1,${numberOfPreviewWords}}|.{0,${numberOfPreviewCharacters}})`,"i");const snippet=safePhrase.match(snippetMatcher)[0];const snippetIndexInPhrase=safePhrase.indexOf(snippet);const snippetEndInPhrase=snippetIndexInPhrase+snippet.length;const isSnippetAtPhraseStart=snippetIndexInPhrase===0;const isSnippetAtPhraseEnd=snippetEndInPhrase===phrase.length;const unsafeSnippet=phrase.slice(snippetIndexInPhrase,snippetEndInPhrase);const textPreview=`${isSnippetAtPhraseStart?"":"..."}${unsafeSnippet}${isSnippetAtPhraseEnd?"":"..."}`;return[title,textPreview]};const wrapWordsWithSpan=(words,text)=>{const tagWords=words.map((({word:word})=>word));const initial=[];while(text){const lowerCaseText=text.toLowerCase();const wordTextPositions=tagWords.map((word=>lowerCaseText.indexOf(word)));const firstWordIndex=wordTextPositions.reduce(((firstWordIndex,wordTextPosition,wordIndex)=>{if(wordTextPosition===-1)return firstWordIndex;if(firstWordIndex===-1)return wordIndex;const firstWordTextPosition=wordTextPositions[firstWordIndex];if(wordTextPosition>=firstWordTextPosition)return firstWordIndex;return wordIndex}),-1);if(firstWordIndex===-1)break;const word=tagWords[firstWordIndex];const wordTextPosition=wordTextPositions[firstWordIndex];initial.push(text.slice(0,wordTextPosition));initial.push(`<span class='is-found'>${text.slice(wordTextPosition,wordTextPosition+word.length)}</span>`);text=text.slice(wordTextPosition+word.length,text.length)}initial.push(text);return initial.join("")};const resultsLimit=Math.min(5,searchObject.searchResults.length);const formattedResults=searchObject.searchResults.slice(0,resultsLimit).map((result=>{const[title,textPreview]=makeTextPreview(result);return{title:title,textPreview:textPreview,titleTagged:wrapWordsWithSpan(result.foundWords,title),textPreviewTagged:wrapWordsWithSpan(result.foundWords,textPreview),foundWords:result.foundWords.map((({word:word})=>word)).join(" "),id:result.model.get("_id")}}));searchObject.formattedResults=formattedResults;return searchObject}renderResults(results){const template=Handlebars.templates.searchResultsContent;this.$(".search__items-container-inner").html(template(results))}navigateToResultPage(event){event&&event.preventDefault();const blockID=$(event.currentTarget).attr("data-id");Adapt$1.navigateToElement("."+blockID);Adapt$1.trigger("drawer:closeDrawer")}});const SEARCH_DEFAULTS={title:"Search",placeholder:"",noResultsMessage:"Sorry, no results were found",awaitingResultsMessage:"Formulating results...",_previewWords:15,_previewCharacters:30,_showHighlights:true,_showFoundWords:true,_searchAttributes:[{_attributeName:"_search",_level:1,_allowTextPreview:false},{_attributeName:"_keywords",_level:1,_allowTextPreview:false},{_attributeName:"keywords",_level:1,_allowTextPreview:false},{_attributeName:"displayTitle",_level:2,_allowTextPreview:true},{_attributeName:"title",_level:2,_allowTextPreview:false},{_attributeName:"body",_level:3,_allowTextPreview:true},{_attributeName:"alt",_level:4,_allowTextPreview:false},{_attributeName:"_alt",_level:4,_allowTextPreview:false},{_attributeName:"_items",_level:5,_allowTextPreview:false},{_attributeName:"_options",_level:5,_allowTextPreview:false},{_attributeName:"items",_level:5,_allowTextPreview:false},{_attributeName:"text",_level:5,_allowTextPreview:true}],_hideComponents:["blank","assessmentResults"],_hideTypes:[],_ignoreWords:["a","an","and","are","as","at","be","by","for","from","has","he","in","is","it","its","of","on","that","the","to","was","were","will","wish",""],_matchOn:{_contentWordBeginsPhraseWord:false,_contentWordContainsPhraseWord:false,_contentWordEqualsPhraseWord:true,_phraseWordBeginsContentWord:true},_scoreQualificationThreshold:20,_minimumWordLength:2,_frequencyImportance:5};var SEARCH_DEFAULTS$1=__AMD("extensions/adapt-search/js/SEARCH_DEFAULTS",SEARCH_DEFAULTS);const matchNotWordBoundaries=new RegExp(`[${WORD_CHARACTERS$1}]+`,"g");const trimReplaceNonWordCharacters=new RegExp(`^([^${WORD_CHARACTERS$1}])+|([^${WORD_CHARACTERS$1}])+$`,"g");var SearchablePhrase=__AMD("extensions/adapt-search/js/SearchablePhrase",class SearchablePhrase{constructor({phrase:phrase,score:score=null,level:level=null,allowTextPreview:allowTextPreview=null,searchAttribute:searchAttribute=null}={}){this.name=searchAttribute?._attributeName??null;this.phrase=phrase;this.safePhrase=replaceAccents(phrase).toLowerCase();this.level=level??searchAttribute?._level??null;this.score=score??(this.level!==null?1/this.level:null);this.allowTextPreview=allowTextPreview??searchAttribute?._allowTextPreview??null;const config=Adapt$1.course.get("_search");const ignoreWords=Array.isArray(config._ignoreWords)?config._ignoreWords:config._ignoreWords.split(",");const minimumWordLength=config._minimumWordLength;this.words={};const matchedWords=this.safePhrase.match(matchNotWordBoundaries);if(matchedWords===null)return;this.words=matchedWords.map((chunk=>chunk.replace(trimReplaceNonWordCharacters,""))).filter((word=>word.length>=minimumWordLength)).reduce(((wordCounts,word)=>{word=word.toLowerCase();if(ignoreWords.includes(word))return wordCounts;wordCounts[word]=wordCounts[word]||0;wordCounts[word]++;return wordCounts}),{})}static allFromModel(model){const htmlToText=html=>$(`<div>${html.trim()}</div>`).text().trim();const searchAttributes=Adapt$1.course.get("_search")._searchAttributes;const searchablePhrases=[];const processValue=(value,searchAttribute,level)=>{if(typeof value==="object")return _recursivelyCollectPhrases(value,searchAttribute._level);if(typeof value!=="string")return;const phrase=htmlToText(value);if(!phrase)return;searchablePhrases.push(new SearchablePhrase({phrase:phrase,level:level,searchAttribute:searchAttribute}))};const _recursivelyCollectPhrases=(json=model.toJSON(),level=1)=>{for(const searchAttribute of searchAttributes){const attributeName=searchAttribute._attributeName;const attributeValue=json[attributeName];if(!attributeValue)continue;if(Array.isArray(attributeValue)){for(const attributeValueItem of attributeValue){processValue(attributeValueItem,searchAttribute,level)}continue}processValue(attributeValue,searchAttribute,level)}};_recursivelyCollectPhrases();return searchablePhrases}});var SearchableWord=__AMD("extensions/adapt-search/js/SearchableWord",class SearchableWord{constructor({word:word,score:score,count:count}={}){this.word=word;this.score=score;this.count=count}});var SearchableModel=__AMD("extensions/adapt-search/js/SearchableModel",class SearchableModel{constructor({model:model}={}){this.model=model;this._phrases=null;this._words=null}get isSearchable(){const modelConfig=this.model.get("_search");if(modelConfig?._isEnabled===false)return false;const isUnavailableInPage=this.model.getAncestorModels(true).some((model=>model.get("_search")?._isEnabled===false||!model.get("_isAvailable")||model.get("_isLocked")||model.get("_isPartOfAssessment")));if(isUnavailableInPage)return false;const config=Adapt$1.course.get("_search");const hideComponents=config._hideComponents;const hideTypes=config._hideTypes;const component=this.model.get("_component");const type=this.model.get("_type");const shouldIgnore=hideTypes.includes(type)||type==="component"&&hideComponents.includes(component);if(shouldIgnore)return false;const displayTitle=this.model.get("displayTitle")?.trim();const title=this.model.get("title")?.trim();const hasTitleOrDisplayTitle=Boolean(displayTitle||title);return hasTitleOrDisplayTitle}get phrases(){if(this._phrases)return this._phrases;return this._phrases=SearchablePhrase.allFromModel(this.model)}get words(){if(this._words)return this._words;const config=Adapt$1.course.get("_search");const minimumWordLength=config._minimumWordLength;const ignoreWords=config._ignoreWords;const phrases=this.phrases;const indexedSearchableWords={};for(const phrase of phrases){for(const word in phrase.words){const count=phrase.words[word];const searchableWord=indexedSearchableWords[word]=indexedSearchableWords[word]||new SearchableWord({word:word,count:0,score:0});searchableWord.count+=count;searchableWord.score=Math.max(searchableWord.score,phrase.score)}}const words=Object.values(indexedSearchableWords).filter((({word:word})=>word.length>=minimumWordLength&&!ignoreWords.includes(word)));return this._words=words}static get all(){return Adapt$1.data.map((model=>new SearchableModel({model:model}))).filter((({isSearchable:isSearchable})=>isSearchable))}});var SearchObject=__AMD("extensions/adapt-search/js/SearchObject",class SearchObject{constructor(shouldSearch,searchPhrase,searchResults){const searchConfig=Adapt$1.course.get("_search");Object.assign(this,searchConfig,{query:searchPhrase,searchResults:searchResults,isAwaitingResults:searchPhrase.length!==0&&!shouldSearch,isBlank:searchPhrase.length===0})}});var SearchResult=__AMD("extensions/adapt-search/js/SearchResult",class SearchResult{constructor({searchableModel:searchableModel,score:score=0,foundWords:foundWords=[],foundPhrases:foundPhrases=[]}={}){this.searchableModel=searchableModel;this.model=this.searchableModel.model;this.score=score;this.foundWords=foundWords;this.foundPhrases=foundPhrases}addFoundWord(word,isFullMatch,partMatchRatio){if(this.foundWords.find((({word:matchWord})=>matchWord===word)))return;const config=Adapt$1.course.get("_search");const frequencyImportance=config._frequencyImportance;const searchableWord=this.searchableModel.words.find((({word:matchWord})=>matchWord===word));this.foundWords.push(searchableWord);const frequencyBonus=searchableWord.score*searchableWord.count/frequencyImportance;const wordFrequencyHitBonus=searchableWord.score+frequencyBonus;this.score+=isFullMatch?wordFrequencyHitBonus:wordFrequencyHitBonus*partMatchRatio;const foundWords=this.foundWords.map((({word:word})=>word));const phrases=this.searchableModel.phrases;this.foundPhrases=[];for(const phrase of phrases){if(!phrase.allowTextPreview)continue;if(!_.intersection(foundWords,Object.keys(phrase.words)).length>0)continue;this.foundPhrases.push(phrase)}}});var Searcher=__AMD("extensions/adapt-search/js/Searcher",class Searcher{constructor(){this.searchableModels=SearchableModel.all;this.wordIndex=this.searchableModels.reduce(((wordIndex,searchableModel)=>{searchableModel.words.forEach((({word:word})=>{wordIndex[word]=wordIndex[word]||[];wordIndex[word].push(searchableModel)}));return wordIndex}),{})}query(searchPhrase){const config=Adapt$1.course.get("_search");const wordIndex=this.wordIndex;const scoreQualificationThreshold=config._scoreQualificationThreshold;const matchOn=config._matchOn||{};const findWords=new SearchablePhrase({phrase:searchPhrase}).words;const indexedSearchResults={};for(const findWord in findWords){for(const indexWord in wordIndex){const rIndexWordBegins=new RegExp("^"+escapeRegExp(indexWord),"g");const rFindWordContains=new RegExp(escapeRegExp(findWord),"g");const rFindWordBegins=new RegExp("^"+escapeRegExp(findWord),"g");const isIndexBeginsMatch=matchOn._contentWordBeginsPhraseWord===false?false:rIndexWordBegins.test(findWord);const isFindContainsMatch=matchOn._contentWordContainsPhraseWord===false?false:rFindWordContains.test(indexWord);const isFindBeginsMatch=matchOn._phraseWordBeginsContentWord===false?false:rFindWordBegins.test(indexWord);const isFullMatch=matchOn._contentWordEqualsPhraseWord===false?false:findWord===indexWord;const isPartMatch=isIndexBeginsMatch||isFindContainsMatch||isFindBeginsMatch;if(!isFullMatch&&!isPartMatch)continue;const partMatchRatio=isFullMatch?1:findWord.length>indexWord.length?indexWord.length/findWord.length:findWord.length/indexWord.length;wordIndex[indexWord].forEach((searchableModel=>{const id=searchableModel.model.get("_id");indexedSearchResults[id]=indexedSearchResults[id]||new SearchResult({searchableModel:searchableModel});indexedSearchResults[id].addFoundWord(indexWord,isFullMatch,partMatchRatio)}))}}const searchResults=Object.values(indexedSearchResults);const qualifyingScoreThreshold=1/scoreQualificationThreshold;const qualifyingSearchResults=searchResults.filter((item=>item.score>=qualifyingScoreThreshold)).sort(((a,b)=>b.score-a.score));return qualifyingSearchResults}search(searchPhrase){const config=Adapt$1.course.get("_search");const shouldSearch=searchPhrase.length>=config._minimumWordLength;const searchResults=shouldSearch?this.query(searchPhrase):[];return new SearchObject(shouldSearch,searchPhrase,searchResults)}});class Search extends Backbone.Controller{initialize(){this.isSetup=false;this.lastSearchQuery=null;this.lastSearchObject=null;this.reIndex=_.debounce(this.reIndex.bind(this),10);this.listenTo(Adapt$1,{"app:dataReady":this.onDataReady,"search:query":this.query,"resources:showSearch":this.onShowSearch,"drawer:openedItemView search:draw":this.onOpenedItemView,"drawer:closed":this.onDrawerClosed,"drawer:noItems":this.onNoItems,"change:_isStarted":this.onAdaptIsStartedChange})}onAdaptIsStartedChange(model,value){if(value)return;this.onPreLanguageChange()}onPreLanguageChange(){this.isSetup=false;this.stopListening(data$1,{"add remove change:_isAvailable change:_isLocked":this.reIndex})}onDataReady(){const config=Adapt$1.course.get("_search");if(!config||config._isEnabled===false)return;this.setupConfig()}setupConfig(){const model=Adapt$1.course.get("_search")||{};const modelWithDefaults=$.extend(true,{},SEARCH_DEFAULTS$1,model);Adapt$1.course.set("_search",modelWithDefaults);this.isSetup=true;this.listenTo(data$1,{"add remove change:_isAvailable change:_isLocked":this.reIndex});this.reIndex();this.clearSearchResults();this.addDrawerItem()}reIndex(){if(!this.isSetup)return;window.search=this.searcher=new Searcher}clearSearchResults(){this.lastSearchQuery=null;this.lastSearchObject=null}addDrawerItem(){const searchConfig=Adapt$1.course.get("_search");searchConfig.title=searchConfig.title||"Search";const drawerObject={title:searchConfig.title,className:"is-search",drawerOrder:searchConfig._drawerOrder||0};Adapt$1.drawer.addItem(drawerObject,"resources:showSearch")}onShowSearch(){if(this.isSearchShown)return;const searchConfig=Adapt$1.course.get("_search");const template=Handlebars.templates.searchSingleItem;const $element=$(template(searchConfig));Adapt$1.drawer.triggerCustomView($element,true);Adapt$1.trigger("search:draw")}onOpenedItemView(){this.isSearchShown=true;const searchConfigModel=new Backbone.Model(Adapt$1.course.get("_search"));const $searchDrawerButton=$(".is-search");if($searchDrawerButton.is(":not(div)")){const $replacementButton=$("<div></div>");$replacementButton.attr("class",$searchDrawerButton.attr("class"));$searchDrawerButton.children().appendTo($replacementButton);$searchDrawerButton.replaceWith($replacementButton)}if(this.lastSearchObject&&this.lastSearchObject.searchResults&&this.lastSearchObject.searchResults.length===0){this.lastSearchObject=null;this.lastSearchQuery=null}$(".drawer__holder .is-search").append(new SearchDrawerItemView({model:searchConfigModel,query:this.lastSearchQuery}).el).append(new SearchResultsView({model:searchConfigModel,searchObject:this.lastSearchObject}).el)}onDrawerClosed(){this.isSearchShown=false}query(query){if(!this.isSetup)return;this.lastSearchQuery=query;const searchObject=this.searcher.search(query);this.lastSearchObject=searchObject;Adapt$1.trigger("search:queried",searchObject)}onNoItems(){$(".nav-drawer-btn").removeClass("u-display-none")}}__AMD("extensions/adapt-search/js/adapt-search",Adapt$1.search=new Search);class MenuItemView extends AdaptView$1{attributes(){return AdaptView$1.resultExtend("attributes",{role:"listitem","aria-labelledby":this.model.get("_id")+"-heading"},this)}className(){return["menu-item",this.constructor.className,this.model.get("_id"),this.model.get("_classes"),this.setVisibility(),this.setHidden(),this.model.get("_isVisited")?"is-visited":"",this.model.get("_isComplete")?"is-complete":"",this.model.get("_isLocked")?"is-locked":"",this.model.get("_isOptional")?"is-optional":""].join(" ")}preRender(){this.model.checkCompletionStatus();this.model.checkInteractionCompletionStatus()}postRender(){this.$el.imageready(this.setReadyStatus.bind(this))}}MenuItemView.type="menuItem";var MenuItemView$1=__AMD("core/js/views/menuItemView",MenuItemView);class MenuView extends ContentObjectView{}Object.assign(MenuView,{childContainer:".js-children",childView:MenuItemView$1,type:"menu",template:"menu"});var MenuView$1=__AMD("core/js/views/menuView",MenuView);class CoreMenuItemView extends MenuItemView$1{events(){return{"click button":"onClickMenuItemButton"}}className(){const inherited=super.className();const nthChild=this.model.get("_nthChild");return[inherited,"menu-item__"+this.model.get("_id"),"nth-child-"+nthChild,nthChild%2===0?"nth-child-even":"nth-child-odd"].join(" ")}preRender(){super.preRender();if(!this.model.get("_isLocked"))return;const lockedGlobal=this.model.get("_globals")?._accessibility?._ariaLabels?.locked||"Locked";const _lockedLabel=`${this.model.get("displayTitle")} - ${lockedGlobal}`;this.model.set("_lockedLabel",_lockedLabel)}postRender(){const graphic=this.model.get("_graphic");if(graphic?.src?.length>0){this.$el.imageready(_.bind((function(){this.setReadyStatus()}),this));return}this.setReadyStatus()}onClickMenuItemButton(event){if(event&&event.preventDefault)event.preventDefault();if(this.model.get("_isLocked"))return;Backbone.history.navigate("#/id/"+this.model.get("_id"),{trigger:true})}}CoreMenuItemView.template="coremenu-item";var CoreMenuItemView$1=__AMD("menu/53f3448081e18d917addc6df-6996d4d2d8e2977cd4df1354/js/CoreMenuItemView",CoreMenuItemView);class CoreMenuView extends MenuView$1{initialize(options){this.model.checkCompletionStatus();this.model.checkInteractionCompletionStatus();Adapt$1.deferUntilCompletionChecked(_.bind((function(){MenuView$1.prototype.initialize.call(this,options)}),this))}postRender(){$("html").addClass("coremenu");if($(".menu").hasClass("logo-menu")){$("html").addClass("logo-menu")}let nthChild=0;this.model.getChildren().each((item=>{if(item.get("_isAvailable")){nthChild++;item.set("_nthChild",nthChild);this.$(".js-children").append(new CoreMenuItemView$1({model:item}).$el)}}))}}CoreMenuView.template="coremenu";var CoreMenuView$1=__AMD("menu/53f3448081e18d917addc6df-6996d4d2d8e2977cd4df1354/js/CoreMenuView",CoreMenuView);var CoreMenuModel=__AMD("menu/53f3448081e18d917addc6df-6996d4d2d8e2977cd4df1354/js/CoreMenuModel",class CoreMenuModel extends MenuModel$1{});components$1.register("course menu",{view:CoreMenuView$1,model:CoreMenuModel});components$1.register("coreMenu",{view:CoreMenuView$1,model:CoreMenuModel});class Classes{addTemplateClasses(){$(".article__title-inner").addClass("h2");$(".block__title-inner").addClass("h3");$(".component__title-inner").addClass("h4")}addComponentButtonClasses(componentView){if(!componentView.model.get("_isQuestionType")||componentView.model.get("_canShowFeedback"))return;const $buttons=componentView.$(".btn__cluster");$buttons.find(".btn__marking, .btn__feedback").addClass("no-feedback");$buttons.find(".btn__action").addClass("btn__action-large")}addClasses(){$("html").addClass("salsatheme");const elementStatic=[".article__title-inner",".assessmentresults__widget",".block__body-inner",".block__title-inner",".component__body",".component__instruction",".component__title",".course-score__widget",".flipcard__item-back",".matching-item__title",".mcqresults__feedback",".media__transcript-container",".narrative__content",".narrative__strapline",".referencelist__widget",".reveal__widget-item-text-container",".slider__widget",".stacker__item-texts",".textinput-item",".truefalse__item-container",".truefalse__item-radio.is-selected",".truefalse__label-container",".page__title-inner",".page__body",".graphic__longdescription-inner"].join(",");const elementDynamic=[".accordion__item-title",".gmcq-item label",".matching-item__select-container",".mcq-item label",".select2-container"].join(",");const elementIcons=[".accordion-item__icon",".js-narrative-strapline-open-popup",".mcqresults__table-container .selected",".narrative__controls",".narrative__strapline-icon",".opentextinput__count-characters",".rangeslider__fill",".slider__number-selection",".slider__number-model-answer"].join(",");const elementTextIcons=[".gmcq-item__icon",".matching-item__select-icon",".mcq-item__icon",".select2-selection__placeholder",".select2-selection",".truefalse__item-answer-icon .icon"].join(",");const elementControls=[".btn__action",".btn__feedback",".btn",".js-narrative-strapline-open-popup",".matching-item__select-state",".narrative__controls",".narrative__strapline-icon",".reveal__widget-control",".stacker__item-navigation","button:not(.yesno__btn)"].join(",");const elementColorBorder=["table td","table th"].join(",");const elementColorInverted=[".mcqresults__table-container td",".mcqresults__table-container th",".reveal__popup-open"].join(",");const elementColorControlIcon=[".btn__display",".hotgraphic__pin-item .icon"].join(",");const elementColorControlTable=["table th"].join(",");const elementColorBackgroundTextColor=[".rangeslider__handle",".slider__scale-container",".slider__scale-notch-container"].join(",");const elementColorDynamicIcon=[".stacker__item-sorter"].join(",");$(elementStatic).addClass("element-color-static");$(elementDynamic).addClass("element-color-dynamic");$(elementIcons).addClass("element-color-icon");$(elementTextIcons).addClass("element-color-text-icon");$(elementControls).addClass("element-color-control");$(elementColorBorder).addClass("element-color-border");$(elementColorInverted).addClass("element-color-inverted");$(elementColorControlIcon).addClass("element-color-control-icon");$(elementColorControlTable).addClass("element-color-table");$(elementColorBackgroundTextColor).addClass("element-color-bg-text-color");$(elementColorDynamicIcon).addClass("element-color-icon-dynamic")}}var Classes$1=__AMD("theme/53f3448081e18d917addc6df-6996d4d2d8e2977cd4df1354/js/Classes",new Classes);class Helpers{checkPageReady(pageView){const initialDelaySeconds=2;const intervalSeconds=1;const maxTimeSeconds=30;const componentsOnPage=pageView.model.findDescendantModels("component");let currentTime=initialDelaySeconds;setTimeout(checkReadyStatus,initialDelaySeconds*1e3);function checkReadyStatus(){if(pageView.model.get("_isReady"))return;if(currentTime>=maxTimeSeconds){return forceReadyStatus()}currentTime+=intervalSeconds;setTimeout(checkReadyStatus,intervalSeconds*1e3)}function forceReadyStatus(){componentsOnPage.forEach((component=>{if(component.get("_isReady"))return;component.set("_isReady",true);logging$1.warn("Timeout waiting for component id:"+component.get("_id")+". Forcing ready state.")}))}}checkPageLevelProgress(courseModel){if(!courseModel?.get("_pageLevelProgress")?._isEnabled)return;$("html").addClass("pagelevelprogress")}scrollChecker(){const shouldAddClass=$(window).scrollTop()>0;$(".nav").toggleClass("collapsed",shouldAddClass);$("html").toggleClass("scrolled",shouldAddClass)}hideHomeButton(){const startController=Adapt$1.course.get("_start")||{};if(startController._isEnabled&&startController._isMenuDisabled){$(".nav__home-btn, .nav__logo-home-btn").addClass("u-display-none")}}setCourseSubtitle(displayTitle){const loadingSubTitle=$("#course__title-sub-title");loadingSubTitle&&loadingSubTitle.html(displayTitle)}removeAnimationClasses(){const $animatedElements=$(".animated");const itemCount=$animatedElements.length;if(itemCount===0)return;let animationEndedCount=0;$animatedElements.on("animationend",(function onAnimationEnd(e){const $animatedItem=$(this);animationEndedCount++;$animatedItem.removeClass(e.animationName+" animated animated-hide");if(animationEndedCount===itemCount){$animatedElements.off("animationend")}}))}checkExternalMediaConfig(){Adapt$1.components.each((component=>{if(component.get("_component")!=="media")return;const mediaConfig=component.get("_media");if(["video/youtube","video/vimeo"].indexOf(mediaConfig.type)===-1)return;if(mediaConfig.type==="video/youtube"){const rx=/(?:https?:\/\/)?(?:www\.)?(?:youtu\.be\/|youtube\.com(?:\/embed\/|\/v\/|\/watch\?v=|\/watch\?.+&v=))([\w-]{11})(?:.+)?$/;const matches=mediaConfig.source.match(rx);if(matches){const videoId=matches[1];mediaConfig._source="//www.youtube.com/embed/"+videoId;mediaConfig._controls=true;mediaConfig._allowFullscreen=component.get("_allowFullScreen")}}else{mediaConfig._source=mediaConfig.source}const extMediaType=mediaConfig.type.split("/")[1];component.set("_component",extMediaType);mediaConfig._autoplay=false;mediaConfig._loop=false}))}applyEdgeBackgroundFix(){if(device$1.browser!=="microsoft edge")return;const $page=$(".page");const backgroundImage=$page.css("background-image");if(backgroundImage==="none")return;const $bgContainer=$('<div style="background: center no-repeat fixed"></div>');$bgContainer.appendTo(".page");$bgContainer.css({position:"fixed",left:0,top:0,zIndex:-1,width:"100%",height:"100%",backgroundImage:backgroundImage,backgroundSize:"cover"});$page.addClass("edge-background-fix")}applyHotgraphicClasses(){if(!Object.keys(components$1._register).includes("hotgraphic"))return;Adapt$1.components.each((component=>{if(component.get("_component")!=="hotgraphic")return;if(!component.get("_useGraphicsAsPins"))return;const componentIdClass=component.get("_id");component.get("_items").forEach((item=>{if(!item._graphic||!item._graphic._classes)return;const $tile=$(`.${componentIdClass} .hotgraphic__tile.item-${item._index}`);$tile.css({left:`${item._left}%`,top:`${item._top}%`});$tile.parent().addClass(item._graphic._classes)}))}))}addAriaAttributesToPageTitle(){const pageTitle=$(".page__title");if(!pageTitle.is(":visible"))return;pageTitle.find(".page__title-inner").attr({"aria-level":1,role:"heading"})}addAriaAttributesToEditableFields(){$(`[type='text']`).attr({contenteditable:"true",role:"textbox"});$("textarea").attr({"aria-multiline":"true",contenteditable:"true",role:"textbox"})}addAriaAttributesToComponentTitles(){const isIPadOS=navigator.userAgent.match(/Mac/)&&navigator?.maxTouchPoints>2;if(!device$1.isAppleDevice()&&!isIPadOS)return;$(".article__title-inner").attr("aria-hidden",false);$(".block__title-inner").attr("aria-hidden",false);$(".component__title-inner").attr("aria-hidden",false)}setClosePopupText(){const closePopupText=Adapt$1.course.get("_globals")._accessibility._ariaLabels.closePopup||"Close Popup";const classNotifyClose=".js-notify-close-btn";const notifyWithoutCloseText=$(`${classNotifyClose}:not(:contains(${closePopupText}))`);if(notifyWithoutCloseText.length===0)return;$(notifyWithoutCloseText).append(closePopupText)}setupAnimations(view){const onScreen=view.model.get("_onScreen");if(!onScreen?._isEnabled)return;view.$el.addClass("animated-hide");view.$el.on("onscreen.adaptView",((e,m)=>{if(!m.onscreen)return;view.$el.addClass(`animated ${onScreen._animationName} ${onScreen._animationDelay} ${onScreen._animationRepetition} ${onScreen._animationSpeed} ${onScreen._classes}`);view.$el.removeClass("animated-hide").off("onscreen.adaptView")}))}loadFontAwesomeCDN(){const styleSheet='<link rel="stylesheet" href="https://kit.fontawesome.com/4ed4a33a82.css" crossorigin="anonymous">';$("head").append(styleSheet)}}var Helpers$1=__AMD("theme/53f3448081e18d917addc6df-6996d4d2d8e2977cd4df1354/js/Helpers",new Helpers);class Navigation{getDefaultLogoSize(){const defer=$.Deferred();const bgImg=$(".nav__inner").css("background-image");if(bgImg==="none"){return defer.promise()}const bgImgUrl=bgImg.replace(/(url\(|\)|'|")/gi,"");const tmpImg=document.createElement("img");tmpImg.src=bgImgUrl;$(tmpImg).one("load",(function(){defer.resolve(tmpImg)}));return defer.promise()}resizeLogoHomeLink(tmpImg){const bgSize=$(".nav__inner").css("background-size");if(!bgSize?.split(" ")[1])return;const bgSizeHeight=parseInt(bgSize.split(" ")[1].replace("px",""));const percentageValue=bgSizeHeight/tmpImg.height;const calculatedImgWidth=tmpImg.width*percentageValue+20;const imgWidth=`${Math.round(calculatedImgWidth)}px`;$(".nav__logo-home-btn").css("width",imgWidth)}addNavigationBtns(){if($(".nav__home-btn").length>0)return;if(!Adapt$1.course)return;let logoAsHomeButton=getComputedStyle(document.querySelector(".nav")).getPropertyValue("--logo-as-home-button").trim();const ariaLabels=Adapt$1.course.get("_globals")._accessibility._ariaLabels;const navigationLogoPosition=Adapt$1.config.get("_themeNavigationLogoPosition");let homeIconButtonOrder=0;let logoHomeBtnOrder=0;switch(navigationLogoPosition){case"Left":homeIconButtonOrder=150;break;case"Right":logoHomeBtnOrder=200;homeIconButtonOrder=-200;break}logoAsHomeButton=logoAsHomeButton==="true";const logoAltText=logoAsHomeButton?ariaLabels.menuBack:ariaLabels.logoHomeButtonAltText||ariaLabels.menuBack;const $logoHomeBtn=this.createBtn("nav__logo-home-btn btn-icon nav__btn icon-logo",logoAsHomeButton?"homeButton":null,logoAltText,logoHomeBtnOrder);const $homeIconBtn=this.createBtn("nav__home-btn btn-icon nav__btn icon icon-home","homeButton",ariaLabels.menuBack,homeIconButtonOrder);const $skipBtn=$(".nav__skip-btn");const $navBackBtn=$(".nav__back-btn");if($skipBtn.length>0){$skipBtn.after($logoHomeBtn).after($navBackBtn).after($homeIconBtn)}else{$navBackBtn.after($logoHomeBtn).after($homeIconBtn)}if(!Adapt$1.avatar)return;Adapt$1.once("avatar:initialised",this.reorderNavWithAvatar)}handleExitButton(){const $courseExitConfirmationBtn=$(".nav-course__exit-btn");if(window.top!==window&&!window.opener){$courseExitConfirmationBtn.addClass("u-display-none");return}const navigationLogoPosition=Adapt$1.config.get("_themeNavigationLogoPosition");const isNavLogoPositionRight=navigationLogoPosition==="Right";const exitButtonOrder=isNavLogoPositionRight?-100:200;if($courseExitConfirmationBtn.length>0){$courseExitConfirmationBtn.addClass("nav__btn");$courseExitConfirmationBtn[0].setAttribute("data-order",exitButtonOrder);return}if($(".nav__exit-btn").length>0)return;const ariaLabel=Adapt$1.course.get("_globals")._accessibility._ariaLabels.exit;const exitIconBtn=this.createBtn("nav__exit-btn btn-icon nav__btn icon fa fa-sign-out","exitButton",ariaLabel,exitButtonOrder);if(!navigationLogoPosition==="Center"){$(".nav__spacer").remove()}$(".nav__inner").append(exitIconBtn);const $exitIconBtn=$(".nav__exit-btn");$exitIconBtn.on("click",(()=>{window.top.close()}))}reorderNavWithAvatar(){if(!Adapt$1.avatar?.model?.get("_isEnabled"))return;$(".nav__avatar-name").insertBefore($(".nav__home-btn"))}createBtn(btnClasses,dataEvent,ariaLabel,dataOrder){return`<button class="${btnClasses}" data-event="${dataEvent}" aria-label="${ariaLabel}" data-order="${dataOrder}"></button>`}}var Navigation$1=__AMD("theme/53f3448081e18d917addc6df-6996d4d2d8e2977cd4df1354/js/Navigation",new Navigation);class Salsa extends Backbone.Controller{initialize(){this.setupListeners();this.lazyLayout=_.debounce(this.lazyLayout.bind(this),1)}setupListeners(){this.listenTo(Adapt$1,{"app:dataLoaded":this.onAppDataLoaded,"articleView:render":this.onArticleViewRender,"blockView:render":this.onBlockViewRender,"componentView:render":this.onComponentViewRender,"componentView:postRender":this.onComponentViewPostRender,"configModel:dataLoaded":this.onConfigDataLoaded,"device:resize":this.onDeviceResize,"drawer:opened":this.onDrawerOpened,"menuView:postRender":this.onMenuViewPostRender,"menuView:ready":this.onMenuViewReady,"navigationView:postRender":this.onNavPostRender,"pageView:postRender":this.onPageViewPostRender,"pageView:ready":this.onPageViewReady,"popup:opened":this.onPopupOpened,"questionView:submitted":this.onComponentViewPostRender})}focusOnNewAriaLabel(textToFocus,elemName,isBusy=false){a11y$1.focusFirst("#a11y-focuser");if(!$(`.${elemName}`).length){$(`<div class="${elemName}" role="alert" aria-live="polite" aria-busy="${isBusy?"true":"false"}" aria-label="${textToFocus}"></div>`).prependTo("body")}a11y$1.focusFirst(`.${elemName}`)}lazyLayout(){Classes$1.addTemplateClasses();Classes$1.addClasses()}onAppDataLoaded(){Helpers$1.checkExternalMediaConfig();Helpers$1.setCourseSubtitle(Adapt$1.course.get("displayTitle"))}onArticleViewRender(articleView){Helpers$1.setupAnimations(articleView)}onBlockViewRender(blockView){Helpers$1.setupAnimations(blockView)}onComponentViewRender(componentView){Helpers$1.setupAnimations(componentView)}onComponentViewPostRender(componentView){this.lazyLayout();Classes$1.addComponentButtonClasses(componentView);this.listenTo(componentView.model.getChildren(),"change:_isActive",this.lazyLayout);this.listenTo(componentView.model.getChildren(),"change:_isVisited",this.lazyLayout);this.listenTo(componentView.model.getChildren(),"change:_isHighlighted",this.lazyLayout);this.listenTo(componentView.buttonsView,"buttons:stateUpdate",this.lazyLayout)}onConfigDataLoaded(){let textToFocus="";$(".course__loading-alt").each((function(){textToFocus=window.getComputedStyle(this,":before").content}));textToFocus=textToFocus.replace(/['"]+/g,"");this.focusOnNewAriaLabel(textToFocus,"loading__data-loading",true);Helpers$1.loadFontAwesomeCDN()}onDeviceResize(){Helpers$1.applyHotgraphicClasses();return this.lazyLayout()}onDrawerOpened(){Helpers$1.addAriaAttributesToEditableFields();Helpers$1.addAriaAttributesToComponentTitles()}onMenuViewPostRender(){if($(".loading__data-loading").length){$(".loading__data-loading").remove()}if($(".loading__page-loaded").length){$(".loading__page-loaded").remove()}if(device$1.isAppleDevice()||device$1.getOperatingSystem()==="mac"){const textToFocus=Adapt$1.course.get("_globals")._accessibility._ariaLabels.menuLoaded;this.focusOnNewAriaLabel(textToFocus,"loading__menu-loaded")}}onMenuViewReady(){Helpers$1.checkPageLevelProgress(Adapt$1.course);Helpers$1.removeAnimationClasses();$("html").addClass("salsatheme");Navigation$1.handleExitButton();if(!(device$1.isAppleDevice()||device$1.getOperatingSystem()==="mac")){const textToFocus=Adapt$1.course.get("_globals")._accessibility._ariaLabels.menuLoaded;this.focusOnNewAriaLabel(textToFocus,"loading__menu-loaded")}}onNavPostRender(){Navigation$1.addNavigationBtns();Navigation$1.getDefaultLogoSize().done(Navigation$1.resizeLogoHomeLink)}onPageViewPostRender(pageView){Helpers$1.checkPageReady(pageView);if($(".loading__data-loading").length){$(".loading__data-loading").remove()}if($(".loading__menu-loaded").length){$(".loading__menu-loaded").remove()}const textToFocus=Adapt$1.course.get("_globals")._accessibility._ariaLabels.pageLoaded;this.focusOnNewAriaLabel(textToFocus,"loading__page-loaded");this.fixNavigationHeight()}onPageViewReady(){this.lazyLayout();Helpers$1.checkPageLevelProgress(Adapt$1.course);Helpers$1.hideHomeButton();Helpers$1.removeAnimationClasses();Helpers$1.applyEdgeBackgroundFix();Helpers$1.applyHotgraphicClasses();Helpers$1.addAriaAttributesToPageTitle();Helpers$1.addAriaAttributesToEditableFields();Helpers$1.addAriaAttributesToComponentTitles();Navigation$1.handleExitButton();this.fixNavigationHeight()}fixNavigationHeight(){setTimeout((()=>{const navElement=document.querySelector(".nav");if(navElement){const navHeight=navElement.offsetHeight;document.documentElement.style.setProperty("--adapt-navigation-height",`${navHeight}px`)}}),200)}onPopupOpened(){Helpers$1.setClosePopupText()}}__AMD("theme/53f3448081e18d917addc6df-6996d4d2d8e2977cd4df1354/js/Salsa",new Salsa);register("header",(function Header(props){const jsxHeading=React.useRef(null);const{_id:_id,displayTitle:displayTitle,body:body,instruction:instruction,mobileBody:mobileBody,mobileInstruction:mobileInstruction,_type:_type,_component:_component,_extension:_extension,_isA11yComponentDescriptionEnabled:_isA11yComponentDescriptionEnabled,classNamePrefixes:classNamePrefixes=[_type&&_type.toLowerCase(),_component&&_component.toLowerCase(),_extension&&_extension.toLowerCase()].filter(Boolean)}=props;const sizedBody=mobileBody&&!device$1.isScreenSizeMin("medium")?mobileBody:body;const sizedInstruction=mobileInstruction&&!device$1.isScreenSizeMin("medium")?mobileInstruction:instruction;const _globals=Adapt$1.course.get("_globals");const ariaRegion=_globals?._components?.[`_${_component}`]?.ariaRegion??_globals?._extensions?.[`_${_extension}`]?.ariaRegion;const isSet=displayTitle||body||sizedInstruction;if(!isSet&&_isA11yComponentDescriptionEnabled&&ariaRegion){return React__default["default"].createElement("div",{className:"aria-label",dangerouslySetInnerHTML:{__html:compile(ariaRegion)}})}if(!isSet)return null;return React__default["default"].createElement("div",{id:`${_id}-header`,className:classes([prefixClasses(classNamePrefixes,["__header"]),props.classes])},React__default["default"].createElement("div",{className:prefixClasses(classNamePrefixes,["__header-inner"])},displayTitle&&React__default["default"].createElement("div",{className:prefixClasses(classNamePrefixes,["__title"])},React__default["default"].createElement("div",{className:prefixClasses(classNamePrefixes,["__title-inner"])+" js-heading",ref:jsxHeading})),_isA11yComponentDescriptionEnabled&&ariaRegion&&React__default["default"].createElement("div",{className:"aria-label",dangerouslySetInnerHTML:{__html:compile(ariaRegion,props)}}),sizedBody&&React__default["default"].createElement("div",{className:prefixClasses(classNamePrefixes,["__body"])},React__default["default"].createElement("div",{className:prefixClasses(classNamePrefixes,["__body-inner"]),dangerouslySetInnerHTML:{__html:compile(sizedBody,props)}})),sizedInstruction&&React__default["default"].createElement("div",{className:prefixClasses(classNamePrefixes,["__instruction"])},React__default["default"].createElement("span",{className:"icon","aria-hidden":"true"}),React__default["default"].createElement("div",{className:prefixClasses(classNamePrefixes,["__instruction-inner"]),dangerouslySetInnerHTML:{__html:compile(sizedInstruction,props)}}))))}));register("image",(function Image(props){const hasMatchingSetting=Object.hasOwn(props,`_${device$1.screenSize}`)||Object.hasOwn(props,device$1.screenSize);const screenSize=hasMatchingSetting?device$1.screenSize:device$1.isScreenSizeMin("medium")?"large":"small";const src=props[`_${screenSize}`]||props[`${screenSize}`]||props._src||props.src;const hasSource=Boolean(src);if(!hasSource)return null;const classNamePrefixSeparator=props.classNamePrefixSeparator||"__";const attributionClassNamePrefixes=props.attributionClassNamePrefixes||props.classNamePrefixes;return React__default["default"].createElement("span",{id:props.id,className:classes([prefixClasses(props.classNamePrefixes,[`${classNamePrefixSeparator}image-container`]),props.classes,props.attribution&&"has-attribution"])},React__default["default"].createElement("img",{className:classes([prefixClasses(props.classNamePrefixes,[`${classNamePrefixSeparator}image`]),props?._srcFocalPoint&&`object-position-${props?._srcFocalPoint}`]),src:src,"aria-label":props.alt?a11y$1.normalize(props.alt):null,"aria-hidden":!props.alt,loading:"eager","aria-describedby":props.longdescription?props.longDescriptionId:undefined,draggable:props.draggable??null}),props.attribution&&React__default["default"].createElement("span",{className:prefixClasses(attributionClassNamePrefixes,["__attribution"])},React__default["default"].createElement("span",{className:prefixClasses(attributionClassNamePrefixes,["__attribution-inner"]),dangerouslySetInnerHTML:{__html:compile(props.attribution,props)}})))}));register("navButton",(function NavButton(props){const{text:text,_iconClasses:_iconClasses}=props;return React__default["default"].createElement(React__default["default"].Fragment,null,React__default["default"].createElement("span",{className:classes(["icon",_iconClasses]),"aria-hidden":"true"}),React__default["default"].createElement("span",{className:"nav__btn-label","aria-hidden":"true"},compile(text,props)))}));register("tooltip",(function Tooltip(props){const{text:text,disabledText:disabledText,isDisabled:isDisabled,ariaHidden:ariaHidden}=props;return React__default["default"].createElement(React__default["default"].Fragment,null,React__default["default"].createElement("div",{className:classes(["tooltip__arrow"]),"aria-hidden":"true"}),React__default["default"].createElement("div",{className:classes(["tooltip__body"]),"aria-hidden":ariaHidden},React__default["default"].createElement("div",{className:"tooltip__body-inner",dangerouslySetInnerHTML:{__html:compile((isDisabled?disabledText:text)||"",props)}})))}));register("fillInTheBlanks",(function FillInTheBlanks(props){const{_useClassicStyle:_useClassicStyle,_isEnabled:_isEnabled,_isInteractionComplete:_isInteractionComplete,_isCorrect:_isCorrect,textBlock:textBlock,_items:_items}=props;const _globals=Adapt$1.course.get("_globals");const placeholderCount=textBlock?.match(/%\?%/gi)?.length;if(placeholderCount!==_items.length){logging$1.warn("Fill In The Blanks: '_items' count does not match the number of placeholders in 'textBlock' -- please check.")}const ariaQuestion=textBlock.split("<p>").join("").split("%?%").join("blank").split("</p>").join("").split("&nbsp;").join(" ");return React__default["default"].createElement("div",{className:"component__inner fillintheblanks__inner",role:"region","aria-label":_globals._components._fillInTheBlanks.ariaRegion},React__default["default"].createElement(templates.header,props),React__default["default"].createElement("div",{className:classes(["component__widget","fillintheblanks__widget",!_useClassicStyle&&"element-color-static",!_isEnabled&&"is-disabled",_isInteractionComplete&&"is-complete is-submitted is-show-user-answer",_isCorrect&&"is-correct"]),"aria-label":ariaQuestion},React__default["default"].createElement(templates.fillInTheBlanksInput,props)),React__default["default"].createElement("div",{className:"btn__container"}))}));var Dropdown=__AMD("components/adapt-component-fillInTheBlanks/partials/dropdownx",(function BuildDropdown(props){return React__default["default"].createElement("span",{className:classes(["fillintheblanks__item-control-wrapper",props._useValidationColors&&"use-validation-colors"])},React__default["default"].createElement("select",{className:"fillintheblanks__item-control","data-index":props.index,defaultValue:-1},React__default["default"].createElement("option",{value:"-1",disabled:true,hidden:true,key:"-1"}),props._answers.map((({_answer:_answer},index)=>React__default["default"].createElement("option",{value:_answer,key:index,"aria-label":_answer},_answer)))),React__default["default"].createElement("span",{className:"for-marking icon"}))}));function getCorrectAnswer(props){const{_isCorrect:_isCorrect}=props;if(_isCorrect){return props._answer}logging$1.warn("Fill In The Blanks: No correct answers have been set in an '_item' object -- please check.");return React__default["default"].createElement("div",null,"*****")}var MissingWord=__AMD("components/adapt-component-fillInTheBlanks/partials/missingWordx",(function BuildMissingWord(props){const _answer=getCorrectAnswer(props);const inputSizeOverflow=2;return React__default["default"].createElement("span",{className:classes(["fillintheblanks__item-control-wrapper",props._useValidationColors&&"use-validation-colors"])},React__default["default"].createElement("input",{className:"fillintheblanks__item-control",type:"text","data-index":props.index,size:_answer.length+inputSizeOverflow,"aria-live":"assertive",value:props._userAnswer}),React__default["default"].createElement("span",{className:"for-marking icon"}))}));register("fillInTheBlanksInput",(function FillInTheBlanksInput(props){const{_useValidationColors:_useValidationColors,textBlock:textBlock}=props;const escapeRegExp=function(string){const reRegExpChar=/[\\^$.*+?()[\]{}|]/g;const reHasRegExpChar=RegExp(reRegExpChar.source);return string&&reHasRegExpChar.test(string)?string.replace(reRegExpChar,"\\$&"):string};const replaceString=function(str,match,fn){let index=0;const result=str.split(new RegExp("("+escapeRegExp(match)+")","gi"));for(let i=1,length=result.length;i<length;i+=2){if(result[i]===undefined||result[i-1]===undefined){logging$1.warn("Encountered undefined value during string replacement. Your RegExp may not be working the way you expect.");continue}result[i]=renderToString__default["default"](fn(props._items[index],index));index++}return HTMLReactParser__default["default"](result.join(" "))};return React__default["default"].createElement(React__default["default"].Fragment,null,replaceString(textBlock,"%?%",((item,index)=>item._controlType==="Missing Word"?item._answers.filter((missingWordAnswer=>missingWordAnswer._isCorrect===true)).map((({_isCorrect:_isCorrect,_answer:_answer,_userAnswer:_userAnswer},missingWordIndex)=>React__default["default"].createElement(MissingWord,{_isCorrect:_isCorrect,_answer:_answer,_userAnswer:_userAnswer,_useValidationColors:_useValidationColors,key:missingWordIndex,index:index}))):React__default["default"].createElement(Dropdown,{_answers:item._answers,_useValidationColors:_useValidationColors,key:index,index:index}))))}));function _extends(){return _extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},_extends.apply(null,arguments)}register("accordion",(function Accordion(props){const visited=Adapt$1.course.get("_globals")?._accessibility?._ariaLabels.visited;const{_id:_id,onClick:onClick,_isCenterAligned:_isCenterAligned}=props;return React__default["default"].createElement("div",{className:"component__inner accordion__inner"},React__default["default"].createElement(templates.header,props),React__default["default"].createElement("div",{className:"component__widget accordion__widget"},props._items.map((({_graphic:_graphic,_imageAlignment:_imageAlignment,_classes:_classes,title:title,body:body,_titleIcon:_titleIcon,_index:_index,_isVisited:_isVisited,_isActive:_isActive},index)=>{const ariaLabel=`${_isVisited?visited+". ":""}${compile(title)}`;return React__default["default"].createElement("div",{className:classes(["accordion-item","js-accordion-item",_graphic?.src&&"has-image",_graphic?.src&&_imageAlignment&&`align-image-${_imageAlignment}`,_isCenterAligned&&"is-center-aligned",_classes]),key:_index,"data-index":_index},React__default["default"].createElement("div",{role:"heading","aria-level":a11y$1.ariaLevel({id:_id,level:"componentItem"})},React__default["default"].createElement("button",{id:`${_id}-${index}-accordion-button`,className:classes(["accordion-item__btn","js-toggle-item",_titleIcon&&"has-title-icon",_isVisited&&"is-visited",_isActive?"is-open is-selected":"is-closed"]),onClick:onClick,"aria-expanded":_isActive.toString(),"aria-controls":`${_id}-${index}-accordion-button-panel`},React__default["default"].createElement("span",{className:"accordion-item__btn-inner"},_titleIcon&&React__default["default"].createElement("span",{className:"accordion-item__title-icon"},React__default["default"].createElement("span",{className:classes(["icon",_titleIcon]),"aria-hidden":"true"})),React__default["default"].createElement("span",{className:"accordion-item__title"},React__default["default"].createElement("span",{className:"aria-label",dangerouslySetInnerHTML:{__html:compile(ariaLabel)}}),React__default["default"].createElement("span",{className:"accordion-item__title-inner","aria-hidden":"true",dangerouslySetInnerHTML:{__html:compile(title)}})),React__default["default"].createElement("span",{className:"accordion-item__icon"},React__default["default"].createElement("span",{className:"icon","aria-hidden":"true"}))))),React__default["default"].createElement("div",{id:`${_id}-${index}-accordion-button-panel`,className:"accordion-item__content js-accordion-item-content",role:"region","aria-labelledby":`${_id}-${index}-accordion-button`},React__default["default"].createElement("div",{className:"accordion-item__content-inner"},body&&React__default["default"].createElement("div",{className:"accordion-item__body"},React__default["default"].createElement("div",{className:"accordion-item__body-inner",dangerouslySetInnerHTML:{__html:compile(body)}})),React__default["default"].createElement(templates.image,_extends({},_graphic,{classNamePrefixes:["component-item","accordion-item"],attributionClassNamePrefixes:["component","accordion"]})))))}))))}));const LinkWrapper=({href:href,children:children,target:target,className:className,role:role})=>href?React__default["default"].createElement("a",{href:href,target:target,className:className,role:role},children):children;register("graphic",(function Graphic(props){const{_id:_id,_isScrollable:_isScrollable,_scrollPercent:_scrollPercent,_graphic:_graphic,_globals:_globals}=props;const scrollableProperties=_isScrollable?{role:"slider",className:"component__widget graphic__widget js-graphic-scrollbar","aria-controls":`graphic__scroll__container__${_id}`,"aria-orientation":"horizontal","aria-valuemax":"100","aria-valuemin":"0","aria-valuenow":_scrollPercent,"aria-label":Handlebars.compile(_globals._components._graphic.scrollAriaLabel)(props),"aria-describedby":_graphic.longdescription?`graphic__longdescription__${_id}`:undefined,tabIndex:"0"}:{};return React__default["default"].createElement("div",{className:"component__inner graphic__inner"},React__default["default"].createElement(templates.header,props),React__default["default"].createElement("div",_extends({className:"component__widget graphic__widget"},scrollableProperties),React__default["default"].createElement(LinkWrapper,{href:_graphic._url,target:_graphic._target||null,className:"graphic__link js-graphic-link",role:"link"},React__default["default"].createElement(templates.image,_extends({},_graphic,{"aria-hidden":_isScrollable,id:`graphic__scroll__container__${_id}`,longDescriptionId:`graphic__longdescription__${_id}`,classes:"js-graphic-scroll-container",classNamePrefixes:["component","graphic"]})),_graphic.longdescription&&React__default["default"].createElement("div",{id:`graphic__longdescription__${_id}`,className:"graphic__longdescription"},React__default["default"].createElement("div",{className:"graphic__longdescription-inner"},_graphic.longdescription)))))}));register("mcq",(function Mcq(props){const ariaLabels=Adapt$1.course.get("_globals")._accessibility._ariaLabels;const{_id:_id,_isEnabled:_isEnabled,_isInteractionComplete:_isInteractionComplete,_isCorrect:_isCorrect,_isCorrectAnswerShown:_isCorrectAnswerShown,_shouldShowMarking:_shouldShowMarking,_canShowModelAnswer:_canShowModelAnswer,_canShowCorrectness:_canShowCorrectness,_isRadio:_isRadio,displayTitle:displayTitle,body:body,instruction:instruction,ariaQuestion:ariaQuestion,onKeyDown:onKeyDown,onItemSelect:onItemSelect,onItemFocus:onItemFocus,onItemBlur:onItemBlur}=props;return React__default["default"].createElement("div",{className:"component__inner mcq__inner"},React__default["default"].createElement(templates.header,props),React__default["default"].createElement("div",{className:classes(["component__widget","mcq__widget",!_isEnabled&&"is-disabled",_isInteractionComplete&&"is-complete is-submitted",_isInteractionComplete&&!_canShowCorrectness&&!_isCorrectAnswerShown&&"show-user-answer",_isInteractionComplete&&_canShowModelAnswer&&_isCorrectAnswerShown&&"show-correct-answer",_isInteractionComplete&&_canShowCorrectness&&"show-correctness",_isCorrect&&"is-correct"]),role:_isRadio?"radiogroup":"group","aria-labelledby":ariaQuestion?null:(displayTitle||body||instruction)&&`${_id}-header`,"aria-label":ariaQuestion||null},props._items.map((({text:text,altText:altText,_index:_index,_isActive:_isActive,_shouldBeSelected:_shouldBeSelected,_isHighlighted:_isHighlighted},index)=>React__default["default"].createElement("div",{className:classes([`mcq-item item-${index}`,_canShowCorrectness&&_shouldShowMarking&&_shouldBeSelected&&"is-correct",_canShowCorrectness&&_shouldShowMarking&&!_shouldBeSelected&&"is-incorrect"]),key:_index},React__default["default"].createElement("input",{className:"mcq-item__input",id:`${_id}-${index}-input`,name:_isRadio?`${_id}-item`:null,type:_isRadio?"radio":"checkbox","aria-disabled":!_isEnabled,checked:_isActive,"aria-label":!_shouldShowMarking?a11y$1.normalize(altText||text):`${_shouldBeSelected?ariaLabels.correct:ariaLabels.incorrect}, ${_isActive?ariaLabels.selectedAnswer:ariaLabels.unselectedAnswer}. ${a11y$1.normalize(altText||text)}`,"data-adapt-index":_index,onKeyDown:onKeyDown,onChange:onItemSelect,onFocus:onItemFocus,onBlur:onItemBlur}),React__default["default"].createElement("label",{className:classes(["mcq-item__label","u-no-select",!_isEnabled&&"is-disabled",_isHighlighted&&"is-highlighted",(_isCorrectAnswerShown?_shouldBeSelected:_isActive)&&"is-selected"]),"aria-hidden":true,htmlFor:`${_id}-${index}-input`,"data-adapt-index":_index},React__default["default"].createElement("span",{className:"mcq-item__state"},React__default["default"].createElement("span",{className:classes(["mcq-item__icon","mcq-item__answer-icon",_isRadio?"is-radio":"is-checkbox"])},React__default["default"].createElement("span",{className:"icon"}))),React__default["default"].createElement("span",{className:"mcq-item__text"},React__default["default"].createElement("span",{className:"mcq-item__text-inner",dangerouslySetInnerHTML:{__html:compile(text)}})),React__default["default"].createElement("span",{className:"mcq-item__state mcq-item__state-correctness"},React__default["default"].createElement("span",{className:"mcq-item__icon mcq-item__correct-icon"},React__default["default"].createElement("span",{className:"icon"})),React__default["default"].createElement("span",{className:"mcq-item__icon mcq-item__incorrect-icon"},React__default["default"].createElement("span",{className:"icon"})))))))),React__default["default"].createElement("div",{className:"btn__container"}))}));register("narrative",(function Narrative(props){const{_hasNavigationInTextAreaResolved:_hasNavigationInTextAreaResolved,_isLargeMode:_isLargeMode,_isStackedOnMobile:_isStackedOnMobile,_isTextBelowImageResolved:_isTextBelowImageResolved}=props;return React__default["default"].createElement("div",{className:classes(["component__inner narrative__inner",_isLargeMode?"mode-large":"mode-small",_isTextBelowImageResolved&&"items-are-full-width",_isStackedOnMobile&&!_isLargeMode&&"is-stacked"])},React__default["default"].createElement(templates.header,props),React__default["default"].createElement("div",{className:classes(["component__widget narrative__widget",_hasNavigationInTextAreaResolved&&"narrative__text-controls"])},React__default["default"].createElement(templates.narrativeContent,props),React__default["default"].createElement(templates.narrativeStrapline,props),React__default["default"].createElement(templates.narrativeSlideContainer,props),React__default["default"].createElement(templates.narrativeIndicators,props)))}));register("narrativeContent",(function Narrative(props){const{_id:_id,_items:_items,_isLargeMode:_isLargeMode,_isStackedOnMobile:_isStackedOnMobile}=props;return React__default["default"].createElement("div",{className:"narrative__content"},React__default["default"].createElement("div",{className:"narrative__content-inner"},_items.map((({_index:_index,_isActive:_isActive,_isVisited:_isVisited,title:title,body:body,_graphic:_graphic})=>React__default["default"].createElement("div",{className:classes(["narrative__content-item",_isActive&&"is-active",_isVisited&&"is-visited"]),"aria-hidden":!_isActive||null,"data-index":_index,key:_index},_graphic&&_isStackedOnMobile&&!_isLargeMode&&React__default["default"].createElement("div",{className:"narrative__content-image"},React__default["default"].createElement(templates.image,_extends({},_graphic,{classNamePrefixes:["narrative__slider-image js-narrative-swipe"],attributionClassNamePrefixes:["component","narrative"],draggable:"false"}))),title&&React__default["default"].createElement("div",{className:"narrative__content-title"},React__default["default"].createElement("div",{className:"narrative__content-title-inner",role:"heading","aria-level":a11y$1.ariaLevel({id:_id,level:"componentItem"}),dangerouslySetInnerHTML:{__html:compile(title,props)}})),body&&React__default["default"].createElement("div",{className:"narrative__content-body"},React__default["default"].createElement("div",{className:"narrative__content-body-inner",dangerouslySetInnerHTML:{__html:compile(body,props)}}))))),React__default["default"].createElement(templates.narrativeControls,props)))}));register("narrativeControls",(function NarrativeControls(props){const{_items:_items,_isLargeMode:_isLargeMode,_isStackedOnMobile:_isStackedOnMobile,onNavigationClicked:onNavigationClicked,backLabel:backLabel,nextLabel:nextLabel,shouldEnableBack:shouldEnableBack,shouldEnableNext:shouldEnableNext}=props;if(_isStackedOnMobile&&!_isLargeMode){return false}return React__default["default"].createElement("div",{className:"narrative__controls-container u-clearfix"},React__default["default"].createElement("button",{"data-direction":"left",className:classes(["btn-icon narrative__controls narrative__controls-left",!shouldEnableBack&&"is-disabled"]),"aria-disabled":!shouldEnableBack||null,onClick:onNavigationClicked},React__default["default"].createElement("span",{className:"aria-label",dangerouslySetInnerHTML:{__html:backLabel}}),React__default["default"].createElement("span",{className:"icon","aria-hidden":"true"})),React__default["default"].createElement("div",{className:"narrative__indicators"},_items.map((({_index:_index,_isVisited:_isVisited,_isActive:_isActive})=>React__default["default"].createElement("div",{className:classes(["narrative__progress",_isVisited&&"is-visited",_isActive&&"is-selected"]),"data-index":_index,key:_index},React__default["default"].createElement("span",{className:"icon","aria-hidden":"true"}))))),React__default["default"].createElement("button",{"data-direction":"right",className:classes(["btn-icon narrative__controls narrative__controls-right",!shouldEnableNext&&"is-disabled"]),"aria-disabled":!shouldEnableNext||null,onClick:onNavigationClicked},React__default["default"].createElement("span",{className:"aria-label",dangerouslySetInnerHTML:{__html:nextLabel}}),React__default["default"].createElement("span",{className:"icon","aria-hidden":"true"})))}));register("narrativeIndicators",(function NarrativeIndicators(props){const{_items:_items,_isLargeMode:_isLargeMode,_isStackedOnMobile:_isStackedOnMobile}=props;if(_isStackedOnMobile&&!_isLargeMode){return false}return React__default["default"].createElement("div",{className:"narrative__indicators narrative__slide-indicators"},_items.map((({_index:_index,_isVisited:_isVisited,_isActive:_isActive})=>React__default["default"].createElement("div",{className:classes(["narrative__progress",_isVisited&&"is-visited",_isActive&&"is-selected"]),"data-index":_index,key:_index},React__default["default"].createElement("span",{className:"icon","aria-hidden":"true"})))))}));register("narrativeSlideContainer",(function NarrativeSlideContainer(props){const{_items:_items,_isLargeMode:_isLargeMode,_isStackedOnMobile:_isStackedOnMobile,_translateXOffset:_translateXOffset,onNavigationClicked:onNavigationClicked,_itemWidth:_itemWidth,_totalWidth:_totalWidth,backLabel:backLabel,nextLabel:nextLabel,shouldEnableBack:shouldEnableBack,shouldEnableNext:shouldEnableNext}=props;if(_isStackedOnMobile&&!_isLargeMode){return false}return React__default["default"].createElement("div",{className:"narrative__slide-container"},React__default["default"].createElement("div",{className:"narrative__slider u-clearfix",style:{width:`${_totalWidth}%`,transform:`translateX(${_translateXOffset}%)`}},_items.map((({_index:_index,_isActive:_isActive,_isVisited:_isVisited,_graphic:_graphic})=>React__default["default"].createElement("div",{className:classes(["narrative__slider-image-container",_isActive&&"is-active",_isVisited&&"is-visited",_graphic.attribution&&"has-attribution"]),style:{width:`${_itemWidth}%`},"aria-hidden":!_isActive||null,"data-index":_index,key:_index},React__default["default"].createElement(templates.image,_extends({},_graphic,{classNamePrefixes:["narrative__slider-image js-narrative-swipe"],attributionClassNamePrefixes:["component","narrative"],draggable:"false"})))))),React__default["default"].createElement("button",{"data-direction":"left",className:classes(["btn-icon narrative__controls narrative__controls-left",!shouldEnableBack&&"is-disabled"]),"aria-disabled":!shouldEnableBack||null,onClick:onNavigationClicked},React__default["default"].createElement("span",{className:"aria-label",dangerouslySetInnerHTML:{__html:backLabel}}),React__default["default"].createElement("span",{className:"icon","aria-hidden":"true"})),React__default["default"].createElement("button",{"data-direction":"right",className:classes(["btn-icon narrative__controls narrative__controls-right",!shouldEnableNext&&"is-disabled"]),"aria-disabled":!shouldEnableNext||null,onClick:onNavigationClicked},React__default["default"].createElement("span",{className:"aria-label",dangerouslySetInnerHTML:{__html:nextLabel}}),React__default["default"].createElement("span",{className:"icon","aria-hidden":"true"})))}));register("narrativeStrapline",(function NarrativeStrapline(props){const{_items:_items,_isLargeMode:_isLargeMode,_isStackedOnMobile:_isStackedOnMobile,_translateXOffset:_translateXOffset,openPopup:openPopup,_itemWidth:_itemWidth,_totalWidth:_totalWidth}=props;if(_isStackedOnMobile&&!_isLargeMode){return false}const globals=Adapt$1.course.get("_globals")._components._narrative;return React__default["default"].createElement("div",{className:"narrative__strapline"},React__default["default"].createElement("div",{className:"narrative__strapline-header"},React__default["default"].createElement("div",{className:"narrative__strapline-header-inner u-clearfix",style:{width:`${_totalWidth}%`,transform:`translateX(${_translateXOffset}%)`}},_items.map((({_index:_index,_isActive:_isActive,_isVisited:_isVisited,strapline:strapline,title:title})=>React__default["default"].createElement("button",{className:classes(["narrative__strapline-btn",_isVisited&&"is-visited"]),"aria-label":strapline,tabIndex:_isActive?0:-1,"aria-hidden":!_isActive||null,style:{width:`${_itemWidth}%`},onClick:openPopup,"data-index":_index,key:_index},React__default["default"].createElement("span",{className:"narrative__strapline-title"},React__default["default"].createElement("span",{className:"narrative__strapline-title-inner",dangerouslySetInnerHTML:{__html:compile(strapline||title||globals.titleStrapline,props)}})),React__default["default"].createElement("span",{className:"btn-icon narrative__strapline-icon"},React__default["default"].createElement("span",{className:"icon","aria-hidden":"true"}))))))))}));register("text",(function Text(props){return React__default["default"].createElement("div",{className:"component__inner text__inner"},React__default["default"].createElement(templates.header,props))}));register("yesNo",(function YesNo(props){const{stateClass:stateClass,displayTitle:displayTitle,body:body,instruction:instruction,_shouldDisplayAttempts:_shouldDisplayAttempts,_disableTimer:_disableTimer,_globals:_globals,_isComplete:_isComplete,_images:_images,_numCorrectAnswers:_numCorrectAnswers}=props;return React__default["default"].createElement("div",{className:classes([stateClass,"component__inner","yesno__inner",`images-right`,"timer-top"]),role:"region","aria-label":_globals._components._yesNo.ariaRegion},React__default["default"].createElement(templates.header,props),React__default["default"].createElement("div",{className:"component__widget yesno__widget clearfix"},React__default["default"].createElement("div",{className:"yesno__text yesno__section"},React__default["default"].createElement("div",{className:"yesno__section-inner element-color-static"},React__default["default"].createElement("div",{className:"yesno__title",dangerouslySetInnerHTML:{__html:compile(displayTitle)}}),React__default["default"].createElement("div",{className:"yesno__score",dangerouslySetInnerHTML:{__html:compile(_isComplete?_numCorrectAnswers+"/"+_images.length:"")}}),React__default["default"].createElement("div",{className:"yesno__body",dangerouslySetInnerHTML:{__html:compile(body)}}),React__default["default"].createElement("div",{className:"yesno__instruction",dangerouslySetInnerHTML:{__html:compile(instruction)}}))),React__default["default"].createElement("div",{className:"yesno__images yesno__section"},React__default["default"].createElement("div",{className:"yesno__section-inner"},React__default["default"].createElement("div",{className:"yesno__images-container buttons-bottom"},React__default["default"].createElement("div",{className:"yesno__images-container-inner"},React__default["default"].createElement(templates.yesNoImages,props))),!_disableTimer&&React__default["default"].createElement("div",{className:"yesno__timer-container"},React__default["default"].createElement("div",{className:"yesno__timer"},React__default["default"].createElement("div",{className:"yesno__timer-inner"},React__default["default"].createElement("span",{className:"minutes"}),React__default["default"].createElement("span",{className:"separator"},":"),React__default["default"].createElement("span",{className:"seconds"})))),React__default["default"].createElement("div",{className:classes(["btn__container",_shouldDisplayAttempts&&"display-attempts"])})))))}));register("yesNoImages",(function YesNoImages(props){const{_buttons:_buttons,_images:_images,_isSubmitted:_isSubmitted,_globals:_globals}=props;const numberOfImages=_images.length;return React__default["default"].createElement(React__default["default"].Fragment,null,React__default["default"].createElement("div",{className:"yesno__buttons"},React__default["default"].createElement("div",{className:"yesno__start-btn"},React__default["default"].createElement("button",null,_buttons._start.buttonText))),React__default["default"].createElement("div",{className:"yesno__image-container","aria-labelledby":"yesno__image0"},_images.map((({_graphic:_graphic,feedback:feedback,iconSrc:iconSrc,label:label,_isCorrect:_isCorrect},index)=>React__default["default"].createElement("div",{className:"yesno__image",id:`yesno__image${index}`,"aria-label":`${numberOfImages} ${_globals._components._yesNo.ariaImageContainer}, ${index+1}`,key:index},React__default["default"].createElement("img",{src:_graphic.src,alt:`${_graphic.alt}, ${numberOfImages} ${_globals._components._yesNo.ariaImageContainer}, ${index+1}`}),React__default["default"].createElement("div",{className:classes(["yesno__image-buttons",_buttons._disableIcons&&"no-icons"]),role:"list"},_buttons._yes&&React__default["default"].createElement("div",{className:"yesno__button"},React__default["default"].createElement("button",{className:"base yesno__btn yesno__yes-btn",value:1,"aria-label":_buttons._yes.ariaLabel,role:"listitem"},_buttons._yes._graphic.src?React__default["default"].createElement("img",{src:_buttons._yes._graphic.src,alt:_buttons._yes._graphic.alt}):React__default["default"].createElement("div",{className:"icon icon-tick",tabIndex:-1,"aria-hidden":"true"}),React__default["default"].createElement("div",{className:"yesno__button-label element-color-control",dangerouslySetInnerHTML:{__html:compile(_buttons._yes.buttonText)}}))),_buttons._no&&React__default["default"].createElement("div",{className:"yesno__button"},React__default["default"].createElement("button",{className:"base yesno__btn yesno__no-btn",value:0,"aria-label":_buttons._no.ariaLabel,role:"listitem"},_buttons._no._graphic.src?React__default["default"].createElement("img",{src:_buttons._no._graphic.src,alt:_buttons._no._graphic.alt}):React__default["default"].createElement("div",{className:"icon icon-cross",tabIndex:-1,"aria-hidden":"true"}),React__default["default"].createElement("div",{className:"yesno__button-label element-color-control",dangerouslySetInnerHTML:{__html:compile(_buttons._no.buttonText)}})))),_isSubmitted&&React__default["default"].createElement("div",null,feedback&&React__default["default"].createElement("div",{className:"yesno__image-feedback yesno__review"},React__default["default"].createElement("div",{className:"yesno__image-feedback-inner",dangerouslySetInnerHTML:{__html:compile(feedback)}})),React__default["default"].createElement("div",{className:"yesno__image-marking yesno__review"},React__default["default"].createElement("div",{className:"yesno__image-marking-icon"},iconSrc?React__default["default"].createElement("img",{src:iconSrc,alt:label}):React__default["default"].createElement("span",{className:classes(["icon",_isCorrect&&"icon-tick",!_isCorrect&&"icon-cross"]),"aria-label":label,role:"region"})))))))),_isSubmitted&&React__default["default"].createElement(React__default["default"].Fragment,null,React__default["default"].createElement("button",{className:"yesno__scroll-buttons yesno__review yesno__prev-btn element-color-control","aria-label":_globals._accessibility._ariaLabels.previous},React__default["default"].createElement("div",{className:"icon"})),React__default["default"].createElement("button",{className:"yesno__scroll-buttons yesno__review yesno__next-btn element-color-control","aria-label":_globals._accessibility._ariaLabels.next},React__default["default"].createElement("div",{className:"icon"})),React__default["default"].createElement("div",{className:"yesno__scroll-indicators yesno__review"},_images.map((({_graphic:_graphic},index)=>React__default["default"].createElement("button",{className:"base yesno__scroll-indicator element-color-icon element-color-border","aria-label":_graphic.alt,key:index}))))))}));register("bookmarkingResume",(function Bookmarking(props){const{label:label,ariaLabel:ariaLabel,isDisabled:isDisabled}=props;return React__default["default"].createElement("div",{className:"bookmarking-resume__inner"},React__default["default"].createElement("button",{type:"button",className:classes(["btn-text bookmarking-resume__button js-bookmarking-resume-button",isDisabled&&"is-disabled"]),"aria-disabled":isDisabled||null,"aria-label":ariaLabel},label))}));register("languagePickerNavigationButton",(function LanguagePickerNavigationButton(props){const{text:text,_iconClasses:_iconClasses}=props;return React__default["default"].createElement(React__default["default"].Fragment,null,React__default["default"].createElement("span",{className:classes(["icon",_iconClasses]),"aria-hidden":"true"}),React__default["default"].createElement("span",{className:"nav__btn-label","aria-hidden":"true",dangerouslySetInnerHTML:{__html:compile(text,props)}}))}));register("pageLevelProgress",(function PageLevelProgress(props){const{_items:_items,_item:_item,_globals:_globals}=props;return React__default["default"].createElement("div",{className:"pagelevelprogress__inner"},React__default["default"].createElement("span",{className:"aria-label"},compile(_globals._extensions._pageLevelProgress.pageLevelProgress)),React__default["default"].createElement("div",{role:"list",className:"js-children"},_items&&_items.map((item=>React__default["default"].createElement(templates.pageLevelProgressItem,_extends({},item,{_globals:_globals,key:item._id})))),_item&&React__default["default"].createElement(templates.pageLevelProgressItem,_extends({},_item,{_globals:_globals,key:_item._id}))))}));register("pageLevelProgressIndicator",(function PageLevelProgressIndicator(props){const{ariaLabel:ariaLabel}=props;return React__default["default"].createElement("span",{className:"pagelevelprogress__indicator"},React__default["default"].createElement("span",{className:"pagelevelprogress__indicator-inner"},React__default["default"].createElement("span",{className:"pagelevelprogress__indicator-bar"}),ariaLabel&&React__default["default"].createElement("span",{className:"aria-label"},compile(ariaLabel,props))))}));register("pageLevelProgressItem",(function PageLevelProgressItem(props){const{_globals:_globals,_isOptional:_isOptional,_isLocked:_isLocked,_isVisible:_isVisible,_isComplete:_isComplete,_isCorrect:_isCorrect,_isAtLeastOneCorrectSelection:_isAtLeastOneCorrectSelection,_canShowMarking:_canShowMarking,title:title,altTitle:altTitle,_id:_id,_type:_type,_children:_children}=props;const isCorrect=_canShowMarking&&_isComplete&&_isCorrect===true;const isPartlyCorrect=_canShowMarking&&_isComplete&&_isCorrect===false&&_isAtLeastOneCorrectSelection;const isIncorrect=_canShowMarking&&_isComplete&&_isCorrect===false&&!_isAtLeastOneCorrectSelection;const indicatorSeat=React__default["default"].createRef();React.useEffect((()=>{if(_isOptional)return;const model=data$1.findById(_id);const item=new PageLevelProgressIndicatorView$1({model:model,calculatePercentage:model.isTypeGroup("contentobject")&&completionCalculations.calculatePercentageComplete.bind(this,model,true)});$(indicatorSeat.current).append(item.$el)}));return React__default["default"].createElement("div",{className:classes(["pagelevelprogress__item drawer__item",`${_type}__indicator`,location$1._currentModel.get("_id")===_id&&"is-current-location"]),role:"listitem"},React__default["default"].createElement("button",{className:classes(["pagelevelprogress__item-btn drawer__item-btn","js-indicator js-pagelevelprogress-item-click",`is-${_type}-indicator`,_isComplete&&"is-complete",_isOptional&&"is-optional",_isLocked&&"is-locked",(_isLocked||!_isVisible)&&"is-disabled"]),ref:indicatorSeat,"data-pagelevelprogress-id":_id,"aria-label":classes([(_isLocked||!_isVisible)&&`${_globals._accessibility._ariaLabels.locked}.`,_isOptional&&`${_globals._extensions._pageLevelProgress.optionalContent}.`,!_isOptional&&_isComplete&&`${_globals._accessibility._ariaLabels.complete}.`,!_isOptional&&!_isComplete&&`${_globals._accessibility._ariaLabels.incomplete}.`,isCorrect&&`${_globals._accessibility._ariaLabels.answeredCorrectly}.`,isPartlyCorrect&&`${_globals._accessibility._ariaLabels.answeredPartlyCorrect??_globals._accessibility._ariaLabels.answeredIncorrectly}.`,isIncorrect&&`${_globals._accessibility._ariaLabels.answeredIncorrectly}.`,compile(a11y$1.normalize(altTitle||title))]),"aria-disabled":_isLocked||!_isVisible?true:null},React__default["default"].createElement("span",{className:"pagelevelprogress__item-title drawer__item-title"},React__default["default"].createElement("span",{className:"pagelevelprogress__item-title-inner drawer__item-title-inner",dangerouslySetInnerHTML:{__html:compile(altTitle||title,props)}})),_isOptional&&React__default["default"].createElement("span",{className:"pagelevelprogress__item-optional"},React__default["default"].createElement("span",{className:"pagelevelprogress__item-optional-inner"},_globals._extensions._pageLevelProgress.optionalContent)),React__default["default"].createElement("span",{className:"pagelevelprogress__item-icon"},React__default["default"].createElement("span",{className:"icon","aria-hidden":"true"}))),React__default["default"].createElement("div",{className:"pagelevelprogress__item-children"},React__default["default"].createElement("div",{role:"list",className:"js-children"},_children&&_children.map((item=>React__default["default"].createElement(PageLevelProgressItem,_extends({},item,{key:item._id,_globals:_globals})))))))}));register("pageLevelProgressNavigationButton",(function PageLevelProgressNavigationButton(props){const{text:text,_iconClasses:_iconClasses}=props;return React__default["default"].createElement(React__default["default"].Fragment,null,React__default["default"].createElement("span",{className:classes(["icon",_iconClasses]),"aria-hidden":"true"}),React__default["default"].createElement("div",{className:"pagelevelprogress__indicator-wrapper"}),React__default["default"].createElement("span",{className:"nav__btn-label","aria-hidden":"true"},compile(text,props)))}));register("resources",(function Resources(props){const{resources:resources,resourceTypes:resourceTypes,_showFilters:_showFilters,_filterColumnCount:_filterColumnCount}=props;const _globals=Adapt$1.course.get("_globals");const[selectedFilter,setSelectedFilter]=React.useState("all");const[selectedId,setSelectedId]=React.useState("resources__show-all");const[focusFlag,setFocusFlag]=React.useState(false);React.useEffect((()=>{if(focusFlag){let $items;if(selectedFilter==="all"){$items=$(".resources__item")}else{$items=$(".resources__item.is-"+selectedFilter)}if($items.length<0)return;a11y$1.focusFirst($items);setFocusFlag(false)}}),[focusFlag]);const onFilterClicked=e=>{if(e&&e.preventDefault)e.preventDefault();const $clickedButton=$(e.currentTarget);const filter=$clickedButton.data("filter");const id=$clickedButton.attr("id");setSelectedFilter(filter);setSelectedId(id);setFocusFlag(true)};return React__default["default"].createElement("div",{className:"resources__inner"},React__default["default"].createElement(templates.header,props.model),_showFilters&&React__default["default"].createElement("div",{className:classes(["resources__filter",`has-${_filterColumnCount}-columns`,_filterColumnCount>4&&"has-extra-types"])},React__default["default"].createElement("div",{className:"resources__filter-inner",role:"tablist"},React__default["default"].createElement("div",{className:"aria-label","aria-label":_globals._extensions._resources.resources}),resourceTypes.map(((type,index)=>React__default["default"].createElement(templates.resourcesFilterButton,_extends({},props,{key:index,resources:resources,_filter:type,onClick:onFilterClicked,selected:selectedFilter})))))),React__default["default"].createElement("div",{id:"resources",className:"resources__item-container",role:"tabpanel","aria-labelledby":selectedId},React__default["default"].createElement("div",{role:"list"},resources.map((({title:title,description:description,_link:_link,_type:_type,_isGlobal:_isGlobal,filename:filename,_forceDownload:_forceDownload},index)=>React__default["default"].createElement(templates.resourcesItem,_extends({},props,{key:index,_index:index,title:title,description:description,_link:_link,_type:_type,_isGlobal:_isGlobal,selectedFilter:selectedFilter,filename:filename,_forceDownload:_forceDownload})))))))}));register("resourcesFilterButton",(function ResourcesFilterButton(props){const{model:model,onClick:onClick,selected:selected,_filter:_filter}=props;const buttonText=model._filterButtons[_filter];const ariaLabel=model._filterAria[`${_filter}Aria`];return React__default["default"].createElement("button",{id:`resources__show-${_filter}`,className:classes(["resources__filter-btn",selected===_filter&&"is-selected"]),onClick:onClick,"data-filter":_filter,"aria-label":ariaLabel,role:"tab","aria-selected":selected===_filter,"aria-controls":"resources",dangerouslySetInnerHTML:{__html:buttonText}})}));register("resourcesItem",(function ResourcesItem(props){const{_forceDownload:_forceDownload,_canDownload:_canDownload,_isGlobal:_isGlobal,_link:_link,_type:_type,_index:_index,description:description,filename:filename,selectedFilter:selectedFilter,title:title,onResourceItemClicked:onResourceItemClicked}=props;return React__default["default"].createElement("div",{className:classes(["resources__item drawer__item",`is-${_type}`,_isGlobal&&"is-global",!["all",_type].includes(selectedFilter)&&"u-display-none"]),role:"listitem"},React__default["default"].createElement("a",{href:_link,className:"resources__item-btn drawer__item-btn","data-type":_type,"data-index":_index,download:_canDownload&&_forceDownload&&filename,onClick:onResourceItemClicked,target:"_blank",rel:"noreferrer","aria-label":title},title&&React__default["default"].createElement("div",{className:"resources__item-title drawer__item-title"},React__default["default"].createElement("div",{className:"resources__item-title-inner drawer__item-title-inner",dangerouslySetInnerHTML:{__html:title}})),description&&React__default["default"].createElement("div",{className:"resources__item-body drawer__item-body"},React__default["default"].createElement("div",{className:"resources__item-body-inner drawer__item-body-inner",dangerouslySetInnerHTML:{__html:description}}))))}));$("body").append(Handlebars.templates.loading());data$1.on("ready",(()=>{logging$1.debug("Calling Adapt.init");Adapt$1.init();Adapt$1.off("adaptCollection:dataLoaded courseModel:dataLoaded")})).init()}));window.__AMD=function(id,value){window.define(id,(function(){return value}));window.require([id]);return value};
